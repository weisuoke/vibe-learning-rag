# 最小可用

掌握以下内容，就能设计出可用的 RAG Prompt：

---

## 4.1 一个能用的 RAG Prompt 模板

```python
"""
最小可用的 RAG Prompt 模板
复制即用，覆盖80%场景
"""

# 系统提示词（必需）
SYSTEM_PROMPT = """你是一个问答助手。请根据提供的参考文档回答问题。
如果文档中没有相关信息，请说"根据提供的文档，我无法回答这个问题"。
不要编造信息。"""

# 构建 Prompt 的函数
def build_rag_prompt(docs: list[str], query: str) -> list[dict]:
    # 拼接文档
    context = "\n\n".join([f"[文档{i+1}]\n{doc}" for i, doc in enumerate(docs)])

    return [
        {"role": "system", "content": SYSTEM_PROMPT},
        {"role": "user", "content": f"参考文档：\n{context}\n\n问题：{query}"}
    ]

# 使用示例
docs = ["产品支持7天无理由退款...", "退款流程：登录-订单-申请退款..."]
messages = build_rag_prompt(docs, "怎么退款？")
```

**这个模板为什么有效？**
- ✅ 明确了角色（问答助手）
- ✅ 约束了信息来源（参考文档）
- ✅ 处理了边界情况（无法回答时的回复）
- ✅ 禁止了幻觉（不要编造）

---

## 4.2 系统提示词的三句话公式

```
你是[角色]。请根据[信息来源]回答问题。如果[边界情况]，请[处理方式]。
```

**示例：**

```python
# 客服场景
"你是客服助手。请根据产品文档回答问题。如果文档中没有答案，请建议用户联系人工客服。"

# 技术文档场景
"你是技术文档助手。请根据API文档回答问题。如果涉及文档未覆盖的内容，请明确说明。"

# 法律咨询场景
"你是法律知识助手。请根据提供的法规条文回答问题。如果问题需要专业判断，请建议咨询律师。"
```

---

## 4.3 上下文注入的最简格式

```python
def simple_context(docs: list[str]) -> str:
    """最简单的上下文格式"""
    return "\n\n---\n\n".join(docs)

# 输出示例：
# 文档内容1...
#
# ---
#
# 文档内容2...
```

**进阶：带编号的格式（推荐）**

```python
def numbered_context(docs: list[str]) -> str:
    """带编号的上下文格式，方便引用"""
    return "\n\n".join([f"[{i+1}] {doc}" for i, doc in enumerate(docs)])

# 输出示例：
# [1] 文档内容1...
#
# [2] 文档内容2...
```

---

## 4.4 处理"无相关内容"的标准回复

```python
NO_ANSWER_INSTRUCTION = """
如果提供的文档中没有相关信息，请回复：
"根据提供的文档，我无法找到关于[问题主题]的信息。您可以：
1. 尝试用不同的方式描述问题
2. 联系人工客服获取帮助"
"""
```

**为什么这很重要？**
- 防止 LLM 编造答案
- 给用户明确的下一步指引
- 保持用户体验的一致性

---

## 4.5 快速调试 Prompt 的方法

```python
def debug_rag_prompt(docs: list[str], query: str, response: str):
    """打印完整的 Prompt 用于调试"""
    print("=" * 50)
    print("【系统提示词】")
    print(SYSTEM_PROMPT)
    print("=" * 50)
    print("【注入的文档】")
    for i, doc in enumerate(docs):
        print(f"[{i+1}] {doc[:100]}...")  # 只显示前100字
    print("=" * 50)
    print("【用户问题】")
    print(query)
    print("=" * 50)
    print("【LLM 回答】")
    print(response)
    print("=" * 50)
```

**调试时检查：**
1. 文档内容是否包含答案？（检索问题）
2. 文档是否被正确注入？（格式问题）
3. LLM 是否理解了指令？（Prompt 问题）

---

## 这些知识足以：

- ✅ 构建一个基本可用的 RAG 问答系统
- ✅ 处理常见的边界情况
- ✅ 快速定位 Prompt 相关的问题
- ✅ 为后续学习进阶技巧打好基础

---

## 最小可用 Checklist

```
□ 系统提示词包含角色设定
□ 系统提示词约束了信息来源
□ 系统提示词处理了"无答案"情况
□ 文档内容被清晰地注入
□ 用户问题被明确地呈现
```

---

**下一步：** [05_双重类比](./05_双重类比.md) - 用熟悉的概念理解 RAG Prompt
