# ChatModel与PromptTemplate - 学习概览

> **知识点编号**: L1_核心抽象 - 02
> **难度等级**: ⭐⭐⭐ (核心基础)
> **预计学习时长**: 4-6小时
> **前置知识**: Runnable接口与LCEL基础

---

## 📚 知识点简介

**ChatModel与PromptTemplate** 是 LangChain 中最核心的两个抽象，它们构成了与大语言模型交互的基础设施。

- **ChatModel**: 基于消息的模型抽象，专为对话场景设计
- **PromptTemplate**: 模板系统，用于构建结构化的提示词

掌握这两个概念是构建 AI Agent 和对话应用的必备基础。

---

## 🗂️ 文档结构

本知识点按照原子化学习模板组织，包含以下维度：

### 基础维度 (快速理解)

| 文件 | 维度 | 说明 | 阅读时长 |
|------|------|------|----------|
| `01_30字核心.md` | 30字核心 | 一句话理解本质 | 1分钟 |
| `02_第一性原理.md` | 第一性原理 | 从根本问题出发的推导 | 10分钟 |
| `04_最小可用.md` | 最小可用知识 | 20%核心解决80%问题 | 15分钟 |
| `05_双重类比.md` | 双重类比 | 前端+日常生活类比 | 10分钟 |
| `06_反直觉点.md` | 反直觉点 | 常见误区与正确理解 | 10分钟 |
| `10_一句话总结.md` | 一句话总结 | 全面总结 | 1分钟 |

### 核心概念 (深入理解)

| 文件 | 概念 | 说明 | 阅读时长 |
|------|------|------|----------|
| `03_核心概念_01_ChatModel抽象.md` | ChatModel抽象 | ChatModel vs LLM, Runnable接口 | 20分钟 |
| `03_核心概念_02_消息类型系统.md` | 消息类型系统 | System/Human/AI Message | 20分钟 |
| `03_核心概念_03_PromptTemplate基础.md` | PromptTemplate基础 | 模板变量与格式化 | 20分钟 |
| `03_核心概念_04_ChatPromptTemplate.md` | ChatPromptTemplate | 对话模板构建 | 20分钟 |
| `03_核心概念_05_消息格式化.md` | 消息格式化 | 变量注入与验证 | 15分钟 |
| `03_核心概念_06_Runnable方法.md` | Runnable方法 | invoke/batch/stream | 20分钟 |

### 实战代码 (动手实践)

| 文件 | 场景 | 说明 | 实践时长 |
|------|------|------|----------|
| `07_实战代码_01_基础ChatModel调用.md` | 基础调用 | 简单消息构建与调用 | 15分钟 |
| `07_实战代码_02_ChatPromptTemplate使用.md` | 模板使用 | 模板创建与变量替换 | 20分钟 |
| `07_实战代码_03_对话历史管理.md` | 历史管理 | MessagesPlaceholder应用 | 25分钟 |
| `07_实战代码_04_结构化输出.md` | 结构化输出 | Pydantic集成 | 25分钟 |
| `07_实战代码_05_流式对话.md` | 流式对话 | Streaming响应 | 20分钟 |
| `07_实战代码_06_批处理场景.md` | 批处理 | Batch优化 | 20分钟 |

### 进阶维度 (面试与深化)

| 文件 | 维度 | 说明 | 阅读时长 |
|------|------|------|----------|
| `08_面试必问.md` | 面试必问 | 高频面试题与出彩回答 | 15分钟 |
| `09_化骨绵掌.md` | 10个知识卡片 | 体系化速查手册 | 20分钟 |

---

## 🎯 学习路径建议

### 快速入门路径 (1小时)
适合快速了解核心概念的学习者：

1. **30字核心** (1分钟) → 建立初步认知
2. **最小可用** (15分钟) → 掌握核心用法
3. **双重类比** (10分钟) → 理解类比关系
4. **实战代码_01** (15分钟) → 动手实践
5. **实战代码_02** (20分钟) → 模板应用

### 系统学习路径 (4-6小时)
适合深入掌握的学习者：

**第一阶段：建立认知** (30分钟)
1. 30字核心 → 第一性原理 → 双重类比

**第二阶段：核心概念** (2小时)
2. 核心概念_01 → 核心概念_02 → 核心概念_03 → 核心概念_04 → 核心概念_05 → 核心概念_06

**第三阶段：实战练习** (2小时)
3. 实战代码_01 → 实战代码_02 → 实战代码_03 → 实战代码_04 → 实战代码_05 → 实战代码_06

**第四阶段：巩固提升** (1小时)
4. 反直觉点 → 面试必问 → 化骨绵掌 → 一句话总结

### 面试突击路径 (1小时)
适合准备面试的学习者：

1. **30字核心** (1分钟) → 快速定位
2. **第一性原理** (10分钟) → 理解本质
3. **核心概念_01** (20分钟) → ChatModel vs LLM
4. **反直觉点** (10分钟) → 避免误区
5. **面试必问** (15分钟) → 出彩回答
6. **化骨绵掌** (20分钟) → 体系梳理

---

## 🔑 核心要点预览

### ChatModel 三大特性

1. **消息驱动**: 使用 SystemMessage/HumanMessage/AIMessage 而非字符串
2. **角色感知**: 模型理解不同角色的语义差异
3. **Runnable协议**: 统一的 invoke/batch/stream 接口

### PromptTemplate 三大价值

1. **可复用性**: 模板定义一次，多处使用
2. **类型安全**: 变量验证，避免运行时错误
3. **可组合性**: 与 LCEL 无缝集成

### 2025-2026 最新特性

- **LangChain 1.0** (2025年10月): 稳定版本，中间件机制
- **MCP集成**: 统一的模型调用协议
- **安全增强**: CVE-2025-65106 模板注入修复
- **性能优化**: Streaming降低延迟，Batch降低成本

---

## ⚠️ 学习注意事项

### 必须掌握的概念

- [ ] ChatModel 与 LLM 的区别
- [ ] SystemMessage 的作用
- [ ] ChatPromptTemplate 的构建方式
- [ ] MessagesPlaceholder 的使用场景
- [ ] invoke/batch/stream 的选择标准

### 常见误区

- ❌ "ChatModel 和 LLM 是一回事"
- ❌ "SystemMessage 是可选的"
- ❌ "PromptTemplate 只是字符串格式化"
- ❌ "模板注入不是安全问题"
- ❌ "Streaming 只是为了UI体验"

### 实践建议

1. **代码先行**: 每个概念都要动手写代码验证
2. **对比学习**: 对比 ChatModel 与 LLM 的差异
3. **安全意识**: 注意模板注入风险 (CVE-2025-65106)
4. **性能优化**: 理解 invoke/batch/stream 的性能差异
5. **版本关注**: 使用 LangChain 0.3.x+ (2025-2026标准)

---

## 🔗 相关知识点

### 前置知识
- **L1-01**: Runnable接口与LCEL基础 (必须先学)

### 后续知识
- **L1-03**: OutputParser与结构化输出
- **L1-04**: 链式组合（管道操作符）
- **L2**: LCEL表达式
- **L4**: Agent系统

### 扩展阅读
- LangChain官方文档: ChatModel
- LangChain官方文档: PromptTemplate
- LangChain 1.0 发布说明 (2025年10月)
- CVE-2025-65106 安全公告

---

## 📊 学习检查清单

完成学习后，你应该能够：

**基础能力**
- [ ] 解释 ChatModel 与 LLM 的核心区别
- [ ] 构建包含 System/Human/AI 消息的对话
- [ ] 使用 ChatPromptTemplate 创建可复用模板
- [ ] 理解 MessagesPlaceholder 的作用

**实战能力**
- [ ] 编写基础的 ChatModel 调用代码
- [ ] 使用模板变量构建动态提示词
- [ ] 实现对话历史管理
- [ ] 使用 Pydantic 实现结构化输出
- [ ] 实现流式响应
- [ ] 使用批处理优化成本

**进阶能力**
- [ ] 回答面试中关于 ChatModel 的问题
- [ ] 识别并避免常见误区
- [ ] 理解 2025-2026 的安全最佳实践
- [ ] 选择合适的调用方式 (invoke/batch/stream)

---

## 💡 快速参考

### ChatModel 基础调用

```python
from langchain_openai import ChatOpenAI
from langchain_core.messages import SystemMessage, HumanMessage

# 创建模型
model = ChatOpenAI(model="gpt-4o-mini")

# 构建消息
messages = [
    SystemMessage(content="你是一个专业的Python助手"),
    HumanMessage(content="如何使用列表推导式？")
]

# 调用模型
response = model.invoke(messages)
print(response.content)
```

### ChatPromptTemplate 基础使用

```python
from langchain_core.prompts import ChatPromptTemplate

# 创建模板
template = ChatPromptTemplate.from_messages([
    ("system", "你是一个{role}"),
    ("human", "{question}")
])

# 格式化消息
messages = template.format_messages(
    role="Python助手",
    question="如何使用列表推导式？"
)

# 与模型组合
chain = template | model
response = chain.invoke({
    "role": "Python助手",
    "question": "如何使用列表推导式？"
})
```

---

## 🎓 学习成果

完成本知识点学习后，你将：

1. **理解核心抽象**: 深刻理解 ChatModel 和 PromptTemplate 的设计理念
2. **掌握实战技能**: 能够构建生产级的对话应用
3. **建立安全意识**: 了解模板注入等安全风险
4. **优化性能成本**: 知道如何选择合适的调用方式
5. **面试准备充分**: 能够出彩地回答相关面试问题

---

**开始学习**: 建议从 `01_30字核心.md` 开始，建立初步认知！

**版本信息**: 基于 LangChain 0.3.x (2025-2026标准)
**最后更新**: 2026-02-18
**维护者**: Claude Code
