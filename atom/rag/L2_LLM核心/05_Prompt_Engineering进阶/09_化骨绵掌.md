# åŒ–éª¨ç»µæŒ

10 ä¸ª 2 åˆ†é’ŸçŸ¥è¯†å¡ç‰‡ï¼Œå…¨é¢è¦†ç›–è¿›é˜¶ Prompt æŠ€å·§å’Œ RAG ä¸“é¡¹ä¼˜åŒ–ã€‚

---

## å¡ç‰‡1ï¼šFew-shot åŸºç¡€ â€”â€” ç¤ºä¾‹å°±æ˜¯æœ€å¥½çš„è¯´æ˜ä¹¦

**ä¸€å¥è¯ï¼š** ç»™ LLM çœ‹å‡ ä¸ª"æ ‡å‡†ç­”æ¡ˆ"ï¼Œå®ƒå°±ä¼šç…§ç€å†™ã€‚

**åŸç†ï¼š**
LLM åœ¨é¢„è®­ç»ƒæ—¶å­¦ä¼šäº†æ¨¡å¼è¯†åˆ«ã€‚å½“ä½ ç»™å®ƒå‡ ä¸ªç¤ºä¾‹ï¼Œå®ƒä¼šï¼š
1. è¯†åˆ«è¾“å…¥å’Œè¾“å‡ºçš„å¯¹åº”å…³ç³»
2. æå–æ ¼å¼ã€é£æ ¼ã€è¯¦ç»†ç¨‹åº¦ç­‰æ¨¡å¼
3. å°†æ¨¡å¼åº”ç”¨åˆ°æ–°é—®é¢˜

**ä»£ç ç¤ºä¾‹ï¼š**
```python
prompt = """
ç¤ºä¾‹1ï¼š
è¾“å…¥ï¼šè‹¹æœ
è¾“å‡ºï¼šğŸ æ°´æœ | çº¢è‰²/ç»¿è‰² | å¯Œå«ç»´ç”Ÿç´ C

ç¤ºä¾‹2ï¼š
è¾“å…¥ï¼šèƒ¡èåœ
è¾“å‡ºï¼šğŸ¥• è”¬èœ | æ©™è‰² | å¯Œå«èƒ¡èåœç´ 

è¾“å…¥ï¼šé¦™è•‰
è¾“å‡ºï¼š
"""
# LLM ä¼šè¾“å‡ºï¼šğŸŒ æ°´æœ | é»„è‰² | å¯Œå«é’¾å…ƒç´ 
```

**åº”ç”¨ï¼š** ç»Ÿä¸€ RAG å›ç­”çš„æ ¼å¼å’Œé£æ ¼ã€‚

---

## å¡ç‰‡2ï¼šFew-shot åœ¨ RAG ä¸­çš„åº”ç”¨ â€”â€” è®©å›ç­”é£æ ¼ä¸€è‡´

**ä¸€å¥è¯ï¼š** ç”¨ç¤ºä¾‹æ•™ RAG ç³»ç»Ÿ"ä»€ä¹ˆæ˜¯å¥½çš„å›ç­”"ã€‚

**RAG åœºæ™¯ï¼š**
- å®¢æœç³»ç»Ÿéœ€è¦ç»Ÿä¸€çš„å›ç­”è¯­æ°”
- æŠ€æœ¯æ–‡æ¡£é—®ç­”éœ€è¦å›ºå®šçš„æ ¼å¼
- å¤šè½®å¯¹è¯éœ€è¦ä¸€è‡´çš„è¯¦ç»†ç¨‹åº¦

**å®æˆ˜æ¨¡æ¿ï¼š**
```python
RAG_FEW_SHOT = """
## å›ç­”ç¤ºä¾‹

é—®é¢˜ï¼šå¦‚ä½•é€€æ¬¾ï¼Ÿ
æ–‡æ¡£ï¼šç”¨æˆ·å¯åœ¨7å¤©å†…ç”³è¯·é€€æ¬¾...
å›ç­”ï¼š
**é€€æ¬¾æµç¨‹**
1. ç¡®è®¤è´­ä¹°åœ¨7å¤©å†…
2. å‡†å¤‡è®¢å•å·
3. è”ç³»å®¢æœç”³è¯·

---

é—®é¢˜ï¼š{query}
æ–‡æ¡£ï¼š{context}
å›ç­”ï¼š
"""
```

**å…³é”®ç‚¹ï¼š** ç¤ºä¾‹è¦å±•ç¤ºä½ æœŸæœ›çš„æ ¼å¼ï¼ˆæ ‡é¢˜ã€åˆ—è¡¨ã€åŠ ç²—ç­‰ï¼‰ã€‚

---

## å¡ç‰‡3ï¼šZero-shot CoT â€”â€” ä¸€å¥è¯çš„é­”æ³•

**ä¸€å¥è¯ï¼š** åªéœ€åŠ "è®©æˆ‘ä»¬ä¸€æ­¥æ­¥æ€è€ƒ"ï¼Œæ¨ç†å‡†ç¡®ç‡å°±èƒ½æå‡ã€‚

**åŸç†ï¼š**
è¿™å¥è¯è§¦å‘ LLM è¿›å…¥"æ¨ç†æ¨¡å¼"ï¼Œè¾“å‡ºä¸­é—´æ­¥éª¤è€Œä¸æ˜¯ç›´æ¥è·³åˆ°ç­”æ¡ˆã€‚

**å¯¹æ¯”ï¼š**
```python
# âŒ ç›´æ¥é—®
"å°æ˜æœ‰100å…ƒï¼Œä¹°äº†3æœ¬15å…ƒçš„ä¹¦ï¼Œè¿˜å‰©å¤šå°‘ï¼Ÿ"
# LLM å¯èƒ½ç›´æ¥çŒœï¼š55å…ƒï¼ˆé”™è¯¯ï¼‰

# âœ… åŠ ä¸€å¥è¯
"å°æ˜æœ‰100å…ƒï¼Œä¹°äº†3æœ¬15å…ƒçš„ä¹¦ï¼Œè¿˜å‰©å¤šå°‘ï¼Ÿè®©æˆ‘ä»¬ä¸€æ­¥æ­¥æ€è€ƒï¼š"
# LLM è¾“å‡ºï¼š
# 1. 3æœ¬ä¹¦çš„æ€»ä»·ï¼š3 Ã— 15 = 45å…ƒ
# 2. å‰©ä½™ï¼š100 - 45 = 55å…ƒ
# ç­”æ¡ˆï¼š55å…ƒ
```

**é€‚ç”¨ï¼š** æ•°å­¦è®¡ç®—ã€é€»è¾‘æ¨ç†ã€å¤šæ­¥éª¤é—®é¢˜ã€‚

---

## å¡ç‰‡4ï¼šManual CoT â€”â€” æ‰‹æŠŠæ‰‹æ•™æ¨ç†

**ä¸€å¥è¯ï¼š** åœ¨ç¤ºä¾‹ä¸­å±•ç¤ºå®Œæ•´æ¨ç†è¿‡ç¨‹ï¼Œæ•ˆæœæ¯” Zero-shot CoT æ›´å¥½ã€‚

**ç»“æ„ï¼š**
```
ç¤ºä¾‹é—®é¢˜ â†’ æ¨ç†æ­¥éª¤1 â†’ æ¨ç†æ­¥éª¤2 â†’ ... â†’ ç­”æ¡ˆ
æ–°é—®é¢˜ â†’ ï¼ˆLLM ä¼šæ¨¡ä»¿æ¨ç†è¿‡ç¨‹ï¼‰
```

**ä»£ç ç¤ºä¾‹ï¼š**
```python
prompt = """
é—®é¢˜ï¼šå•†åº—æœ‰20ä¸ªè‹¹æœï¼Œå–äº†8ä¸ªï¼Œåˆè¿›äº†5ä¸ªï¼Œç°åœ¨æœ‰å¤šå°‘ï¼Ÿ
æ€è€ƒï¼š
- åˆå§‹ï¼š20ä¸ª
- å–å‡ºåï¼š20 - 8 = 12ä¸ª
- è¿›è´§åï¼š12 + 5 = 17ä¸ª
ç­”æ¡ˆï¼š17ä¸ª

é—®é¢˜ï¼š{new_question}
æ€è€ƒï¼š
"""
```

**ä¼˜åŠ¿ï¼š** å¯ä»¥æ§åˆ¶æ¨ç†çš„ç²’åº¦å’Œé£æ ¼ã€‚

---

## å¡ç‰‡5ï¼šCoT åœ¨ RAG å¤æ‚æ¨ç†ä¸­çš„åº”ç”¨

**ä¸€å¥è¯ï¼š** å½“é—®é¢˜éœ€è¦ç»¼åˆå¤šä¸ªæ–‡æ¡£æ—¶ï¼ŒCoT å¼•å¯¼ LLM åˆ†æ­¥åˆ†æã€‚

**RAG åœºæ™¯ï¼š**
- ç”¨æˆ·é—®é¢˜æ¶‰åŠå¤šä¸ªæ–‡æ¡£
- éœ€è¦å¯¹æ¯”ã€ç»¼åˆã€æ¨ç†
- ç­”æ¡ˆä¸èƒ½ç›´æ¥ä»å•ä¸ªæ–‡æ¡£æå–

**å®æˆ˜æ¨¡æ¿ï¼š**
```python
RAG_COT = """
## å‚è€ƒæ–‡æ¡£
{context}

## é—®é¢˜
{query}

## è¯·æŒ‰æ­¥éª¤åˆ†æï¼š

### 1. é—®é¢˜åˆ†æ
è¿™ä¸ªé—®é¢˜éœ€è¦ä»€ä¹ˆä¿¡æ¯ï¼Ÿ

### 2. ä¿¡æ¯å®šä½
åœ¨å“ªäº›æ–‡æ¡£ä¸­æ‰¾åˆ°äº†ç›¸å…³ä¿¡æ¯ï¼Ÿ

### 3. ç»¼åˆæ¨ç†
å¦‚ä½•æ•´åˆè¿™äº›ä¿¡æ¯ï¼Ÿ

### 4. æœ€ç»ˆç­”æ¡ˆ
"""
```

**æ•ˆæœï¼š** å¤šæ–‡æ¡£ç»¼åˆé—®é¢˜çš„å‡†ç¡®ç‡æ˜¾è‘—æå‡ã€‚

---

## å¡ç‰‡6ï¼šJSON Mode ç»“æ„åŒ–è¾“å‡º

**ä¸€å¥è¯ï¼š** å¼ºåˆ¶ LLM è¾“å‡º JSONï¼Œè®©ç»“æœå¯è¢«ç¨‹åºè§£æã€‚

**ä¸‰ç§å®ç°æ–¹å¼ï¼š**

| æ–¹å¼ | å¯é æ€§ | ä»£ç  |
|------|-------|------|
| Prompt çº¦æŸ | ä¸­ | "è¯·è¾“å‡º JSON æ ¼å¼" |
| API å‚æ•° | é«˜ | `response_format={"type": "json_object"}` |
| Function Calling | æœ€é«˜ | å®šä¹‰ Schema |

**ä»£ç ç¤ºä¾‹ï¼š**
```python
response = client.chat.completions.create(
    model="gpt-4o",
    messages=[...],
    response_format={"type": "json_object"}
)
result = json.loads(response.choices[0].message.content)
```

**æ³¨æ„ï¼š** æ ¼å¼æ­£ç¡® â‰  å†…å®¹æ­£ç¡®ï¼Œè¦æ·»åŠ éªŒè¯é€»è¾‘ã€‚

---

## å¡ç‰‡7ï¼šSelf-Consistency â€”â€” å¤šæ¬¡é‡‡æ ·å–æœ€ä¼˜

**ä¸€å¥è¯ï¼š** è®© LLM å›ç­”å¤šæ¬¡ï¼Œé€‰æ‹©å‡ºç°æœ€å¤šçš„ç­”æ¡ˆã€‚

**åŸç†ï¼š**
LLM è¾“å‡ºæœ‰éšæœºæ€§ï¼ŒåŒä¸€é—®é¢˜å¯èƒ½ç»™å‡ºä¸åŒç­”æ¡ˆã€‚å¤šæ¬¡é‡‡æ ·åï¼Œæ­£ç¡®ç­”æ¡ˆå‡ºç°çš„æ¦‚ç‡æ›´é«˜ã€‚

**ä»£ç ç¤ºä¾‹ï¼š**
```python
def self_consistency(prompt: str, n: int = 5) -> str:
    """å¤šæ¬¡é‡‡æ ·ï¼Œè¿”å›æœ€å¸¸è§çš„ç­”æ¡ˆ"""
    answers = []
    for _ in range(n):
        response = client.chat.completions.create(
            model="gpt-4o",
            messages=[{"role": "user", "content": prompt}],
            temperature=0.7  # éœ€è¦ä¸€å®šéšæœºæ€§
        )
        answers.append(extract_answer(response))

    # è¿”å›å‡ºç°æœ€å¤šçš„ç­”æ¡ˆ
    from collections import Counter
    return Counter(answers).most_common(1)[0][0]
```

**é€‚ç”¨ï¼š** æ•°å­¦é¢˜ã€é€‰æ‹©é¢˜ç­‰æœ‰æ˜ç¡®ç­”æ¡ˆçš„åœºæ™¯ã€‚

---

## å¡ç‰‡8ï¼šQuery Decomposition â€”â€” é—®é¢˜åˆ†è§£

**ä¸€å¥è¯ï¼š** æŠŠå¤æ‚é—®é¢˜æ‹†æˆå¤šä¸ªç®€å•å­é—®é¢˜ï¼Œåˆ†åˆ«æ£€ç´¢åç»¼åˆå›ç­”ã€‚

**æµç¨‹ï¼š**
```
å¤æ‚é—®é¢˜
    â†“ LLM åˆ†è§£
[å­é—®é¢˜1, å­é—®é¢˜2, å­é—®é¢˜3]
    â†“ åˆ†åˆ«æ£€ç´¢
[ç»“æœ1, ç»“æœ2, ç»“æœ3]
    â†“ LLM ç»¼åˆ
æœ€ç»ˆç­”æ¡ˆ
```

**ä»£ç ç¤ºä¾‹ï¼š**
```python
def decompose_query(query: str) -> list[str]:
    """ç”¨ LLM åˆ†è§£å¤æ‚é—®é¢˜"""
    prompt = f"""
å°†ä»¥ä¸‹å¤æ‚é—®é¢˜åˆ†è§£ä¸º2-4ä¸ªç®€å•å­é—®é¢˜ï¼š

é—®é¢˜ï¼š{query}

å­é—®é¢˜ï¼ˆæ¯è¡Œä¸€ä¸ªï¼‰ï¼š
"""
    response = client.chat.completions.create(...)
    return response.choices[0].message.content.strip().split('\n')

# ä½¿ç”¨
sub_queries = decompose_query("æ¯”è¾ƒäº§å“Aå’Œäº§å“Bçš„ä»·æ ¼ã€ä¿ä¿®æœŸå’Œå”®åæœåŠ¡")
# ["äº§å“Açš„ä»·æ ¼æ˜¯å¤šå°‘ï¼Ÿ", "äº§å“Bçš„ä»·æ ¼æ˜¯å¤šå°‘ï¼Ÿ", "ä¸¤ä¸ªäº§å“çš„ä¿ä¿®æœŸåˆ†åˆ«æ˜¯å¤šä¹…ï¼Ÿ", ...]
```

**é€‚ç”¨ï¼š** æ¯”è¾ƒç±»ã€å¤šæ–¹é¢åˆ†æç±»é—®é¢˜ã€‚

---

## å¡ç‰‡9ï¼šSelf-RAG / Reflection â€”â€” è‡ªæˆ‘åæ€

**ä¸€å¥è¯ï¼š** è®© LLM æ£€æŸ¥è‡ªå·±çš„å›ç­”ï¼Œå‘ç°é—®é¢˜åä¿®æ­£ã€‚

**æµç¨‹ï¼š**
```
ç¬¬ä¸€è½®ï¼šç”Ÿæˆåˆå§‹å›ç­”
    â†“
ç¬¬äºŒè½®ï¼šæ£€æŸ¥å›ç­”æ˜¯å¦å‡†ç¡®ã€å®Œæ•´
    â†“
ç¬¬ä¸‰è½®ï¼šå¦‚æœ‰é—®é¢˜ï¼Œä¿®æ­£åè¾“å‡º
```

**ä»£ç ç¤ºä¾‹ï¼š**
```python
def self_rag_with_reflection(context: str, query: str) -> str:
    # ç¬¬ä¸€è½®ï¼šç”Ÿæˆå›ç­”
    initial_answer = generate_answer(context, query)

    # ç¬¬äºŒè½®ï¼šè‡ªæˆ‘æ£€æŸ¥
    check_prompt = f"""
æ£€æŸ¥ä»¥ä¸‹å›ç­”æ˜¯å¦å‡†ç¡®ï¼š

é—®é¢˜ï¼š{query}
å‚è€ƒæ–‡æ¡£ï¼š{context}
å›ç­”ï¼š{initial_answer}

æ£€æŸ¥é¡¹ï¼š
1. å›ç­”æ˜¯å¦åŸºäºæ–‡æ¡£å†…å®¹ï¼Ÿ
2. æ˜¯å¦æœ‰é—æ¼çš„é‡è¦ä¿¡æ¯ï¼Ÿ
3. æ˜¯å¦æœ‰é”™è¯¯æˆ–ä¸å‡†ç¡®çš„åœ°æ–¹ï¼Ÿ

å¦‚æœæœ‰é—®é¢˜ï¼Œè¯·æŒ‡å‡ºå¹¶ç»™å‡ºä¿®æ­£åçš„å›ç­”ã€‚
å¦‚æœæ²¡æœ‰é—®é¢˜ï¼Œå›å¤"å›ç­”æ­£ç¡®"ã€‚
"""
    reflection = client.chat.completions.create(...)

    # å¦‚æœéœ€è¦ä¿®æ­£ï¼Œè¿”å›ä¿®æ­£åçš„ç­”æ¡ˆ
    if "å›ç­”æ­£ç¡®" not in reflection:
        return extract_corrected_answer(reflection)
    return initial_answer
```

**æ•ˆæœï¼š** å‡å°‘å¹»è§‰ï¼Œæé«˜å›ç­”å‡†ç¡®æ€§ã€‚

---

## å¡ç‰‡10ï¼šPrompt Chaining â€”â€” æç¤ºé“¾ç»„åˆ

**ä¸€å¥è¯ï¼š** æŠŠå¤æ‚ä»»åŠ¡æ‹†æˆå¤šä¸ª Promptï¼Œä¸²è”æ‰§è¡Œã€‚

**ä¸å•ä¸ªå¤æ‚ Prompt çš„åŒºåˆ«ï¼š**

| å•ä¸ªå¤æ‚ Prompt | Prompt Chaining |
|----------------|-----------------|
| ä¸€æ¬¡å®Œæˆæ‰€æœ‰ä»»åŠ¡ | åˆ†æ­¥å®Œæˆï¼Œæ¯æ­¥ä¸“æ³¨ä¸€ä¸ªä»»åŠ¡ |
| å®¹æ˜“å‡ºé”™ | æ¯æ­¥å¯éªŒè¯ï¼Œæ›´å¯æ§ |
| éš¾ä»¥è°ƒè¯• | å¯ä»¥å®šä½é—®é¢˜åœ¨å“ªä¸€æ­¥ |

**RAG ç¤ºä¾‹ï¼š**
```python
def rag_with_chaining(docs: list, query: str) -> str:
    # Chain 1: ç­›é€‰ç›¸å…³æ–‡æ¡£
    relevant_docs = filter_relevant_docs(docs, query)

    # Chain 2: æå–å…³é”®ä¿¡æ¯
    key_info = extract_key_info(relevant_docs, query)

    # Chain 3: ç”Ÿæˆç»“æ„åŒ–å›ç­”
    answer = generate_structured_answer(key_info, query)

    # Chain 4: è´¨é‡æ£€æŸ¥
    final_answer = quality_check(answer, query)

    return final_answer
```

**ä¼˜åŠ¿ï¼š** æ¯ä¸ªç¯èŠ‚å¯ä»¥ç‹¬ç«‹ä¼˜åŒ–å’Œè°ƒè¯•ã€‚

---

## 10 ä¸ªå¡ç‰‡æ€»ç»“

| å¡ç‰‡ | æŠ€å·§ | æ ¸å¿ƒä»·å€¼ |
|------|------|---------|
| 1 | Few-shot åŸºç¡€ | é€šè¿‡ç¤ºä¾‹æ•™ä¼š LLM |
| 2 | Few-shot RAG | ç»Ÿä¸€å›ç­”é£æ ¼ |
| 3 | Zero-shot CoT | ä¸€å¥è¯æå‡æ¨ç† |
| 4 | Manual CoT | ç²¾ç¡®æ§åˆ¶æ¨ç†è¿‡ç¨‹ |
| 5 | CoT RAG | å¤šæ–‡æ¡£ç»¼åˆæ¨ç† |
| 6 | JSON Mode | è¾“å‡ºå¯ç¨‹åºè§£æ |
| 7 | Self-Consistency | å¤šæ¬¡é‡‡æ ·å–æœ€ä¼˜ |
| 8 | Query Decomposition | å¤æ‚é—®é¢˜åˆ†è§£ |
| 9 | Self-RAG | è‡ªæˆ‘åæ€ä¿®æ­£ |
| 10 | Prompt Chaining | ä»»åŠ¡ä¸²è”æ‰§è¡Œ |

---

**ä¸‹ä¸€æ­¥ï¼š** [10_ä¸€å¥è¯æ€»ç»“](./10_ä¸€å¥è¯æ€»ç»“.md) - æœ€ç»ˆæ€»ç»“
