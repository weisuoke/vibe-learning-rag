# 最小可用

> 掌握这 20% 的核心知识，解决 80% 的 RAG 问题

---

## 核心要点

掌握以下内容，就能理解和构建基本的 RAG 系统：

---

### 4.1 RAG 的核心公式

```
RAG = 检索（Retrieval） + 增强（Augmented） + 生成（Generation）
```

**用一句话记住**：

> RAG 就是"先查资料，再回答问题"

```python
# RAG 的本质就是这三行代码
relevant_docs = retriever.search(user_question)  # 检索
prompt = f"根据以下资料回答：{relevant_docs}\n问题：{user_question}"  # 增强
answer = llm.generate(prompt)  # 生成
```

---

### 4.2 双阶段架构

**必须记住的两个阶段：**

| 阶段 | 时机 | 做什么 | 频率 |
|-----|------|-------|------|
| **离线索引** | 提前准备 | 文档 → 分块 → 向量 → 存储 | 一次（或文档更新时） |
| **在线查询** | 用户提问时 | 问题 → 检索 → 生成答案 | 每次查询 |

```
离线索引（Build Time）:
文档 ──→ Chunker ──→ Embedder ──→ VectorStore
                                      ↓
在线查询（Runtime）:                   ↓
问题 ──→ Embedder ──→ Retriever ←────┘
                         ↓
                    Generator ──→ 答案
```

---

### 4.3 六大组件速记

**记住这个口诀：加分向存检生**

| 组件 | 口诀 | 职责 | 一句话 |
|-----|------|------|-------|
| Loader | **加**载 | 加载文档 | 把 PDF/Word 变成文本 |
| Chunker | **分**块 | 切分文本 | 把长文本切成小块 |
| Embedder | **向**量化 | 生成向量 | 把文本变成数字 |
| VectorStore | **存**储 | 存储向量 | 把向量存起来 |
| Retriever | **检**索 | 检索相关 | 找到最相关的块 |
| Generator | **生**成 | 生成答案 | 调用 LLM 回答 |

---

### 4.4 最简 RAG 流程

```python
# 这是你需要理解的最简 RAG 流程

# ===== 离线索引 =====
# 1. 加载文档
documents = load_documents("./docs/")

# 2. 分块
chunks = split_into_chunks(documents, chunk_size=500)

# 3. 向量化并存储
for chunk in chunks:
    vector = embed(chunk)
    vector_store.add(vector, chunk)

# ===== 在线查询 =====
# 4. 用户提问
question = "如何申请退款？"

# 5. 检索相关内容
question_vector = embed(question)
relevant_chunks = vector_store.search(question_vector, top_k=3)

# 6. 生成答案
prompt = f"""
根据以下信息回答问题：

{relevant_chunks}

问题：{question}
"""
answer = llm.generate(prompt)
```

---

### 4.5 关键决策点

构建 RAG 系统时，最重要的 3 个决策：

| 决策 | 选项 | 建议 |
|-----|------|------|
| **Chunk 大小** | 100-2000 字符 | 从 500 开始，根据效果调整 |
| **Top-K 数量** | 1-10 个 | 从 3 开始，太多会干扰生成 |
| **Embedding 模型** | OpenAI / 开源 | 先用 OpenAI，效果不好再换 |

---

## 这些知识足以：

- ✅ 理解任何 RAG 系统的架构
- ✅ 阅读 LangChain / LlamaIndex 的 RAG 代码
- ✅ 构建一个基本的 RAG 原型
- ✅ 定位 RAG 系统的问题出在哪个环节
- ✅ 与团队讨论 RAG 方案时不掉队

---

## 快速检查

能回答以下问题，说明你掌握了最小可用知识：

- [ ] RAG 的三个字母分别代表什么？
- [ ] 离线索引和在线查询分别做什么？
- [ ] 六大组件的顺序是什么？
- [ ] 为什么需要把文本分块？
- [ ] 检索到的内容是怎么给到 LLM 的？

---

**下一步：** [05_双重类比](./05_双重类比.md) - 用熟悉的概念理解 RAG
