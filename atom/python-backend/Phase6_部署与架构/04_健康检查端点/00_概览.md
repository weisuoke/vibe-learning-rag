# 健康检查端点 - 学习概览

> 为 AI Agent 后端实现生产级的健康检查系统，支持监控、负载均衡和高可用性

---

## 📋 学习导航

### 快速开始（10分钟）
1. 阅读 **01_30字核心.md** - 理解健康检查的本质
2. 阅读 **04_最小可用.md** - 掌握基础实现
3. 运行 **07_实战代码_01_基础健康检查实现.md** 中的代码

### 系统学习（3-4小时）
按顺序阅读所有维度：
1. **30字核心** → 快速理解
2. **第一性原理** → 深层理解
3. **核心概念（5个）** → 全面掌握
4. **最小可用** → 快速上手
5. **双重类比** → 加深理解
6. **反直觉点** → 避免误区
7. **实战代码（8个）** → 实践应用
8. **面试必问** → 面试准备
9. **化骨绵掌** → 碎片化复习
10. **一句话总结** → 精华回顾

### 碎片化学习（10分钟/天）
- 每天阅读 **09_化骨绵掌.md** 中的1-2个知识卡片
- 每周运行一个实战代码示例

---

## 🎯 学习目标

完成本知识点后，你将能够：

- [ ] 理解 Liveness、Readiness、Startup 三种探测的区别
- [ ] 实现基础的 /health 和 /ready 端点
- [ ] 检查数据库、Redis、外部 API 等依赖服务
- [ ] 设计浅层检查和深层检查策略
- [ ] 实现健康检查缓存，避免频繁检查影响性能
- [ ] 配置 Kubernetes 健康探测
- [ ] 集成负载均衡器（Nginx、HAProxy）
- [ ] 暴露健康检查指标给 Prometheus
- [ ] 实现服务降级和熔断策略
- [ ] 构建生产级的健康检查系统

---

## 📚 文档结构

### 基础维度（8个文件）

| 文件 | 内容 | 阅读时间 |
|------|------|----------|
| 01_30字核心.md | 超简洁定义 | 1分钟 |
| 02_第一性原理.md | 深层概念基础 | 15分钟 |
| 04_最小可用.md | 20%核心知识 | 10分钟 |
| 05_双重类比.md | 前端+日常生活类比 | 10分钟 |
| 06_反直觉点.md | 常见误区 | 10分钟 |
| 08_面试必问.md | 面试问答 | 10分钟 |
| 10_一句话总结.md | 精华总结 | 1分钟 |

### 核心概念（5个文件）

每个文件 300-500 行，深入讲解一个核心概念：

| 文件 | 内容 | 阅读时间 |
|------|------|----------|
| 03_核心概念_01_Liveness与Readiness探测原理.md | Kubernetes 三种探测机制 | 30分钟 |
| 03_核心概念_02_健康检查实现模式.md | 浅层/深层、同步/异步、缓存策略 | 30分钟 |
| 03_核心概念_03_依赖服务检查策略.md | 数据库、Redis、外部API检查 | 30分钟 |
| 03_核心概念_04_负载均衡器集成.md | Nginx、HAProxy、云服务集成 | 30分钟 |
| 03_核心概念_05_监控与告警集成.md | Prometheus、日志、告警 | 30分钟 |

### 实战代码（8个文件）

每个文件 300-600 行，包含完整可运行的 Python 代码：

| 文件 | 内容 | 实践时间 |
|------|------|----------|
| 07_实战代码_01_基础健康检查实现.md | FastAPI 基础健康检查 | 20分钟 |
| 07_实战代码_02_数据库连接检查.md | SQLAlchemy 连接池检查 | 20分钟 |
| 07_实战代码_03_Redis缓存检查.md | Redis 连接健康检查 | 20分钟 |
| 07_实战代码_04_外部API可用性检查.md | HTTP 客户端健康检查 | 20分钟 |
| 07_实战代码_05_AI_Agent特定检查.md | LLM API、向量数据库检查 | 30分钟 |
| 07_实战代码_06_Kubernetes健康探测配置.md | K8s YAML 配置 | 20分钟 |
| 07_实战代码_07_生产级健康检查系统.md | 完整的健康检查框架 | 40分钟 |
| 07_实战代码_08_降级与熔断策略.md | 熔断器模式实现 | 30分钟 |

### 知识卡片（1个文件）

| 文件 | 内容 | 复习时间 |
|------|------|----------|
| 09_化骨绵掌.md | 10个2分钟知识卡片 | 20分钟 |

---

## 🔗 知识点关联

### 前置知识

- ✅ **Phase2_FastAPI核心** - 路由、依赖注入、异常处理
- ✅ **Phase3_数据库层** - Session管理、连接池配置
- ✅ **Phase5_生产级实践** - 结构化日志、错误处理策略
- ✅ **Docker容器化** - 容器运行环境

### 后续学习

- → **优雅关闭** - 处理 SIGTERM 信号
- → **Kubernetes 部署** - 生产级容器编排
- → **监控告警** - Prometheus、Grafana
- → **性能优化** - 负载均衡、自动扩缩容

---

## 💡 学习建议

### 对于前端工程师

健康检查端点类似于：
- **Express 的 /health 路由** - 返回服务状态
- **React 的 Error Boundary** - 捕获错误并降级
- **Service Worker 的 health check** - 检查后台服务可用性

### 对于 AI Agent 开发者

健康检查在 AI Agent 后端中的关键作用：
- **LLM API 可用性检查** - 确保 OpenAI/Anthropic API 可访问
- **向量数据库连接检查** - 确保 pgvector 可用
- **Agent 任务队列健康检查** - 确保后台任务正常运行
- **RAG 系统端到端检查** - 确保检索和生成流程正常

---

## 📊 学习检查清单

### 基础理解
- [ ] 理解健康检查的第一性原理
- [ ] 区分 Liveness、Readiness、Startup 探测
- [ ] 理解浅层检查和深层检查的区别
- [ ] 理解健康检查缓存的必要性

### 实现能力
- [ ] 实现基础的 /health 端点
- [ ] 实现 /ready 端点（检查依赖服务）
- [ ] 检查数据库连接池状态
- [ ] 检查 Redis 连接
- [ ] 检查外部 API 可用性
- [ ] 实现健康检查缓存

### 生产实践
- [ ] 配置 Kubernetes 健康探测
- [ ] 集成负载均衡器
- [ ] 暴露 Prometheus 指标
- [ ] 实现服务降级策略
- [ ] 实现熔断器模式
- [ ] 设计健康检查告警规则

### AI Agent 特定
- [ ] 检查 LLM API 可用性
- [ ] 检查向量数据库连接
- [ ] 检查 Embedding 模型加载状态
- [ ] 实现 RAG 系统端到端健康检查

---

## 🚀 快速参考

### 常用命令

```bash
# 测试健康检查端点
curl http://localhost:8000/health
curl http://localhost:8000/ready

# 查看 Kubernetes Pod 健康状态
kubectl describe pod <pod-name>

# 查看健康检查日志
kubectl logs <pod-name> | grep health
```

### 常用配置

```python
# FastAPI 健康检查端点
@app.get("/health")
async def health():
    return {"status": "healthy"}

@app.get("/ready")
async def ready():
    # 检查依赖服务
    return {"status": "ready"}
```

```yaml
# Kubernetes 健康探测配置
livenessProbe:
  httpGet:
    path: /health
    port: 8000
  initialDelaySeconds: 10
  periodSeconds: 10

readinessProbe:
  httpGet:
    path: /ready
    port: 8000
  initialDelaySeconds: 5
  periodSeconds: 5
```

---

## 📖 参考资源

### 官方文档
- [Kubernetes Liveness, Readiness and Startup Probes](https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-startup-probes/)
- [FastAPI Advanced User Guide](https://fastapi.tiangolo.com/advanced/)
- [Prometheus Python Client](https://github.com/prometheus/client_python)

### 最佳实践
- [Health Check Response Format for HTTP APIs](https://tools.ietf.org/id/draft-inadarei-api-health-check-06.html)
- [The Twelve-Factor App - Admin processes](https://12factor.net/admin-processes)

---

**版本：** v1.0
**最后更新：** 2026-02-13
**预计学习时间：** 快速上手 1小时，系统学习 3-4小时，碎片化学习 10分钟/天
