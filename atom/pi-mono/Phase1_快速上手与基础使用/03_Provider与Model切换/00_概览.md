# Provider 与 Model 切换 - 完整学习指南

> **掌握 Pi Coding Agent 的多模型切换能力，实现成本优化与高效协作**

---

## 文档概述

本知识点包含 **22 个文件**，覆盖 **10 个维度**，帮助你全面掌握 Pi 的 Provider 与 Model 切换系统。

**学习目标**：
- 理解 Provider 抽象层的设计原理
- 掌握 3 种模型选择方法（命令、快捷键、CLI）
- 配置 Scoped Models 实现快速切换
- 实现基于任务复杂度的成本优化策略
- 集成自定义 Provider（Ollama、LM Studio 等）

**预计学习时间**：3-5 小时（可根据需求选择性学习）

---

## 文档结构

### 📋 快速导航

| 维度 | 文件 | 核心内容 | 推荐阅读时间 |
|------|------|----------|--------------|
| **核心摘要** | [01_30字核心.md](./01_30字核心.md) | 一句话掌握全部精髓 | 2 分钟 |
| **第一性原理** | [02_第一性原理.md](./02_第一性原理.md) | 为什么需要 Provider 切换 | 15 分钟 |
| **核心概念** | 6 个文件（见下方） | 深入理解技术细节 | 60 分钟 |
| **最小可用** | [04_最小可用.md](./04_最小可用.md) | 20% 知识解决 80% 问题 | 10 分钟 |
| **双重类比** | [05_双重类比.md](./05_双重类比.md) | TypeScript + 日常生活类比 | 15 分钟 |
| **反直觉点** | [06_反直觉点.md](./06_反直觉点.md) | 3 个常见误区 | 10 分钟 |
| **实战代码** | 6 个文件（见下方） | 可运行的完整示例 | 90 分钟 |
| **面试必问** | [08_面试必问.md](./08_面试必问.md) | Q&A 与标准答案 | 15 分钟 |
| **化骨绵掌** | [09_化骨绵掌.md](./09_化骨绵掌.md) | 10 张速查卡片 | 20 分钟 |
| **一句话总结** | [10_一句话总结.md](./10_一句话总结.md) | 最终记忆锚点 | 1 分钟 |

---

## 核心概念详解（6 个文件）

### 1. [Provider 定义与配置](./03_核心概念_01_Provider定义与配置.md)
**内容**：
- Provider 在 models.json 中的结构
- API 类型：openai-completions、anthropic-messages、google-generative-ai
- 认证方法：API keys、OAuth、shell commands
- 内置 vs 自定义 Provider

**适合人群**：需要理解配置文件结构的开发者

---

### 2. [Model 选择机制](./03_核心概念_02_Model选择机制.md)
**内容**：
- 三种选择方法：`/model` 命令、Scoped Models、CLI 参数
- 选择 UI 与搜索功能
- 模型元数据：reasoning、contextWindow、cost
- 优先级顺序与覆盖行为

**适合人群**：需要灵活切换模型的用户

---

### 3. [Scoped Models 快速切换](./03_核心概念_03_Scoped_Models快速切换.md)
**内容**：
- `Ctrl+P` / `Shift+Ctrl+P` 键盘快捷键
- 在 .pi/settings.json 中的配置
- 交互式 `/scoped-models` 命令
- 最佳实践：3-5 个模型最优

**适合人群**：追求高效工作流的开发者

---

### 4. [Provider 切换命令](./03_核心概念_04_Provider切换命令.md)
**内容**：
- 交互式命令：`/model`、`/provider`、`/reload`、`/session`
- CLI 启动选项：`--provider`、`--model`
- 会话延续与不同模型对话
- 热重载机制

**适合人群**：需要命令行控制的用户

---

### 5. [配置文件层级](./03_核心概念_05_配置文件层级.md)
**内容**：
- 全局配置：~/.pi/agent/settings.json、models.json、auth.json
- 项目配置：.pi/settings.json、SYSTEM.md、AGENTS.md
- 优先级顺序：CLI > 项目 > 全局 > 环境变量 > 默认值
- 安全凭证存储（0600 权限）

**适合人群**：需要多项目配置管理的团队

---

### 6. [成本优化策略](./03_核心概念_06_成本优化策略.md)
**内容**：
- 基于任务的模型选择（Haiku → Sonnet → Opus）
- Fallback 链保障可靠性
- 成本对比表（2025-2026 定价）
- Token 使用监控（`/session` 命令）

**适合人群**：关注成本控制的企业用户

---

## 实战代码详解（6 个文件）

### 1. [基础 Provider 配置](./07_实战代码_01_基础Provider配置.md)
**内容**：
- Anthropic、OpenAI、xAI 的完整 models.json 示例
- 认证设置脚本
- 验证命令
- 故障排查指南

**代码示例**：完整的配置文件 + 验证脚本

---

### 2. [Scoped Models 配置](./07_实战代码_02_Scoped_Models配置.md)
**内容**：
- .pi/settings.json 配置示例
- 交互式 `/scoped-models` 设置
- 键盘快捷键工作流
- 测试脚本

**代码示例**：配置文件 + 自动化测试

---

### 3. [自定义 Provider 集成](./07_实战代码_03_自定义Provider集成.md)
**内容**：
- Ollama 本地部署完整示例
- LM Studio 集成
- OpenRouter 配置
- 验证脚本

**代码示例**：端到端集成脚本

---

### 4. [成本优化实战](./07_实战代码_04_成本优化实战.md)
**内容**：
- 任务分类脚本
- 基于复杂度的自动模型选择
- 成本跟踪与报告
- 月度预算优化

**代码示例**：智能模型选择器 + 成本分析工具

---

### 5. [多 Provider 切换脚本](./07_实战代码_05_多Provider切换脚本.md)
**内容**：
- Bash/Node.js 自动化脚本
- Provider 健康检查
- 自动 Fallback 实现
- 会话管理

**代码示例**：完整的自动化工具链

---

### 6. [企业代理配置](./07_实战代码_06_企业代理配置.md)
**内容**：
- 企业代理设置（带认证）
- 自定义 Headers 与安全配置
- AWS Secrets Manager 集成
- 合规性考虑

**代码示例**：企业级配置模板

---

## 学习路径推荐

### 🚀 快速上手路径（30 分钟）
适合：想快速开始使用的开发者

1. [01_30字核心.md](./01_30字核心.md) - 2 分钟
2. [04_最小可用.md](./04_最小可用.md) - 10 分钟
3. [07_实战代码_01_基础Provider配置.md](./07_实战代码_01_基础Provider配置.md) - 15 分钟
4. [09_化骨绵掌.md](./09_化骨绵掌.md) - 3 分钟

**学习成果**：能够配置基础 Provider 并使用 `/model` 命令切换

---

### 📚 系统学习路径（3 小时）
适合：想全面掌握的开发者

1. [01_30字核心.md](./01_30字核心.md) - 2 分钟
2. [02_第一性原理.md](./02_第一性原理.md) - 15 分钟
3. 核心概念 6 个文件 - 60 分钟
4. [05_双重类比.md](./05_双重类比.md) - 15 分钟
5. [06_反直觉点.md](./06_反直觉点.md) - 10 分钟
6. 实战代码 6 个文件 - 90 分钟
7. [08_面试必问.md](./08_面试必问.md) - 15 分钟
8. [10_一句话总结.md](./10_一句话总结.md) - 2 分钟

**学习成果**：完全掌握 Provider 切换系统，能够实现成本优化与多模型协作

---

### 🎯 问题驱动路径（按需学习）
适合：遇到具体问题的开发者

| 问题 | 推荐阅读 |
|------|----------|
| 如何快速切换模型？ | [03_核心概念_03_Scoped_Models快速切换.md](./03_核心概念_03_Scoped_Models快速切换.md) |
| 如何降低 API 成本？ | [03_核心概念_06_成本优化策略.md](./03_核心概念_06_成本优化策略.md) + [07_实战代码_04_成本优化实战.md](./07_实战代码_04_成本优化实战.md) |
| 如何集成本地模型？ | [07_实战代码_03_自定义Provider集成.md](./07_实战代码_03_自定义Provider集成.md) |
| 配置文件优先级是什么？ | [03_核心概念_05_配置文件层级.md](./03_核心概念_05_配置文件层级.md) |
| 如何实现自动 Fallback？ | [07_实战代码_05_多Provider切换脚本.md](./07_实战代码_05_多Provider切换脚本.md) |

---

### 🏢 企业应用路径（2 小时）
适合：企业级部署的架构师

1. [02_第一性原理.md](./02_第一性原理.md) - 15 分钟
2. [03_核心概念_05_配置文件层级.md](./03_核心概念_05_配置文件层级.md) - 15 分钟
3. [03_核心概念_06_成本优化策略.md](./03_核心概念_06_成本优化策略.md) - 15 分钟
4. [07_实战代码_04_成本优化实战.md](./07_实战代码_04_成本优化实战.md) - 30 分钟
5. [07_实战代码_06_企业代理配置.md](./07_实战代码_06_企业代理配置.md) - 30 分钟
6. [08_面试必问.md](./08_面试必问.md) - 15 分钟

**学习成果**：能够设计企业级多租户 Provider 管理方案

---

## 前置知识

建议先学习以下知识点：

1. **Pi Coding Agent 安装与配置**
   - 理解基础配置文件结构
   - 掌握 CLI 基本使用

2. **基础命令与工作流**
   - 熟悉 `/` 命令系统
   - 理解会话管理

---

## 后续知识

学习本知识点后，建议继续学习：

1. **Prompt Engineering 基础**
   - 不同模型需要不同的 Prompt 策略
   - 上下文管理与 Token 优化

2. **成本管理与监控**
   - Token 计费详解
   - 使用量分析与预算控制

3. **企业级部署**
   - 多租户环境配置
   - 安全与合规性

---

## 核心要点速记

### 15+ Provider 支持
- **主流云服务**：Anthropic、OpenAI、xAI、Google、Mistral、Cohere、Groq
- **自定义集成**：Ollama、LM Studio、OpenRouter、Azure OpenAI、AWS Bedrock

### 3 种模型选择方法
1. **`/model` 命令**：交互式选择，支持搜索
2. **Scoped Models**：`Ctrl+P` 快速循环（3-5 个预配置模型）
3. **CLI 参数**：`--provider` 和 `--model` 启动时指定

### 配置优先级
```
CLI 参数 > 项目配置 (.pi/settings.json) > 全局配置 (~/.pi/agent/settings.json) > 环境变量 > 默认值
```

### 成本优化策略
- **简单任务**：Haiku ($0.25/MTok)
- **中等任务**：Sonnet ($3/MTok)
- **复杂任务**：Opus ($15/MTok)
- **成本比**：1:12:60

### 热重载机制
- **`/reload`**：重新加载配置文件
- **`/session`**：查看当前会话信息
- **无需重启**：运行时动态切换

---

## 常见问题快速索引

| 问题 | 答案位置 |
|------|----------|
| 如何添加新的 Provider？ | [03_核心概念_01_Provider定义与配置.md](./03_核心概念_01_Provider定义与配置.md) |
| Scoped Models 最多配置几个？ | [03_核心概念_03_Scoped_Models快速切换.md](./03_核心概念_03_Scoped_Models快速切换.md) - 建议 3-5 个 |
| 如何查看当前使用的模型？ | 使用 `/session` 命令 |
| 配置文件存放在哪里？ | [03_核心概念_05_配置文件层级.md](./03_核心概念_05_配置文件层级.md) |
| 如何实现自动 Fallback？ | [07_实战代码_05_多Provider切换脚本.md](./07_实战代码_05_多Provider切换脚本.md) |
| API 密钥如何安全存储？ | auth.json 文件（0600 权限） |

---

## 实战检验清单

学完本知识点后，你应该能够：

- [ ] 配置至少 3 个不同的 Provider
- [ ] 使用 `Ctrl+P` 快速切换 Scoped Models
- [ ] 理解配置文件的优先级顺序
- [ ] 实现基于任务复杂度的模型选择
- [ ] 集成至少 1 个自定义 Provider（如 Ollama）
- [ ] 使用 `/session` 命令监控 Token 使用
- [ ] 配置 Fallback 链保障可靠性
- [ ] 回答 [08_面试必问.md](./08_面试必问.md) 中的所有问题

---

## 资源链接

### 官方文档
- [Pi Coding Agent GitHub](https://github.com/pi-mono/pi)
- [Models.json 配置参考](https://github.com/pi-mono/pi/blob/main/docs/models.md)
- [Provider 开发指南](https://github.com/pi-mono/pi/blob/main/docs/providers.md)

### 社区资源
- [GitHub Issues](https://github.com/pi-mono/pi/issues) - 最新问题与解决方案
- [GitHub Discussions](https://github.com/pi-mono/pi/discussions) - 社区讨论

### 相关知识点
- [01_Pi_Coding_Agent安装与配置](../01_Pi_Coding_Agent安装与配置/00_概览.md)
- [02_基础命令与工作流](../02_基础命令与工作流/00_概览.md)

---

## 版本信息

- **文档版本**：v1.0
- **最后更新**：2026-02-18
- **适用 Pi 版本**：v2.0+
- **信息时效**：2025-2026

---

## 开始学习

**推荐起点**：
- 如果你是新手，从 [04_最小可用.md](./04_最小可用.md) 开始
- 如果你想深入理解，从 [02_第一性原理.md](./02_第一性原理.md) 开始
- 如果你想快速实践，从 [07_实战代码_01_基础Provider配置.md](./07_实战代码_01_基础Provider配置.md) 开始

**记住**：Provider 切换不是为了炫技，而是为了在成本、性能、可靠性之间找到最佳平衡点。

**现在，选择你的学习路径，开始吧！** 🚀
