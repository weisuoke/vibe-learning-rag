# 一句话总结

**Compaction 是 Pi-mono 的智能上下文管理机制，通过自动检测 token 使用量并在接近上限时将历史对话压缩为结构化摘要，实现了无限长对话能力，同时支持手动压缩和自定义压缩策略扩展，是构建长期运行 AI Agent 的核心基础设施。**

---

## 为什么这句话涵盖了全部？

这句话包含了 Compaction 的：

1. **定义**：智能上下文管理机制
2. **触发机制**：自动检测 token 使用量
3. **核心算法**：压缩为结构化摘要
4. **核心价值**：实现无限长对话
5. **扩展能力**：支持手动压缩和自定义策略
6. **应用场景**：长期运行 AI Agent 的基础设施

---

## 记住这句话的技巧

**关键词记忆法：**
- **自动检测** → 无需人工干预
- **压缩摘要** → 保留关键信息
- **无限对话** → 突破上下文限制
- **可扩展** → 支持自定义

**类比记忆法：**
> Compaction 就像一个智能笔记本管家，自动监控笔记本剩余空间，在快满时把旧笔记总结成摘要，腾出空间记录新内容，让你可以无限记录下去。

---

## 与其他知识点的关系

```
Session 存储 (11)
    ↓
Compaction 压缩 (12) ← 你在这里
    ↓
Prompt Templates (13)
```

- **Session 存储**提供了数据基础（JSONL 树形结构）
- **Compaction**在此基础上实现智能压缩
- **Prompt Templates**可以定制压缩时的总结提示词

---

## 学完 Compaction 你将掌握

- ✅ 理解 LLM 上下文窗口限制的本质
- ✅ 掌握自动压缩的触发条件和算法
- ✅ 能够实现自定义压缩策略
- ✅ 理解长期运行 Agent 的内存管理
- ✅ 能够优化 Agent 的性能和成本

---

**恭喜！** 你已经完成了 Compaction 压缩机制的学习。

**下一步学习建议：**
- **Phase 3: 定制化开发** → 学习如何定制 Prompt Templates 和 Extensions
- **深入源码** → 阅读 `packages/coding-agent/src/core/compaction/compaction.ts`
- **实战项目** → 构建一个需要长期对话的 AI Agent

---

**版本：** v1.0
**最后更新：** 2026-02-20
**维护者：** Claude Code
