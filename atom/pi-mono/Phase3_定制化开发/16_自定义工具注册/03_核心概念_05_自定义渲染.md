# æ ¸å¿ƒæ¦‚å¿µ 05ï¼šè‡ªå®šä¹‰æ¸²æŸ“

> **ç¾åŒ–å·¥å…·æ˜¾ç¤º - æå‡ç”¨æˆ·ä½“éªŒçš„å…³é”®**

## æ¦‚è¿°

è‡ªå®šä¹‰æ¸²æŸ“å…è®¸ Extension æ§åˆ¶å·¥å…·è°ƒç”¨å’Œç»“æœåœ¨ UI ä¸­çš„æ˜¾ç¤ºæ–¹å¼ã€‚é€šè¿‡ renderCall å’Œ renderResult å‡½æ•°,å¯ä»¥åˆ›å»ºæ›´å‹å¥½ã€æ›´ç›´è§‚çš„ç”¨æˆ·ç•Œé¢ã€‚

---

## ä¸¤ä¸ªæ¸²æŸ“å‡½æ•°

### renderCall - å·¥å…·è°ƒç”¨æ—¶çš„æ˜¾ç¤º

**è§¦å‘æ—¶æœº**: å·¥å…·è¢«è°ƒç”¨æ—¶,åœ¨æ‰§è¡Œå‰æ˜¾ç¤º

**å‡½æ•°ç­¾å**:
```typescript
renderCall?: (params: any) => React.ReactNode
```

**ç”¨é€”**:
- æ˜¾ç¤º"æ­£åœ¨ä½¿ç”¨å·¥å…·X"
- æ ¼å¼åŒ–æ˜¾ç¤ºå‚æ•°
- æä¾›è§†è§‰åé¦ˆ

**é»˜è®¤è¡Œä¸º**: æ˜¾ç¤ºå·¥å…·åç§°å’Œå‚æ•°çš„ JSON

### renderResult - å·¥å…·ç»“æœçš„æ˜¾ç¤º

**è§¦å‘æ—¶æœº**: å·¥å…·æ‰§è¡Œå®Œæˆåæ˜¾ç¤ºç»“æœ

**å‡½æ•°ç­¾å**:
```typescript
renderResult?: (result: AgentToolResult) => React.ReactNode
```

**ç”¨é€”**:
- æ ¼å¼åŒ–æ˜¾ç¤ºç»“æœ
- æå–å…³é”®ä¿¡æ¯
- ç¾åŒ–è¾“å‡º

**é»˜è®¤è¡Œä¸º**: æ˜¾ç¤º result.content

---

## åŸºæœ¬ç¤ºä¾‹

### ç¤ºä¾‹ 1: ç®€å•æ–‡æœ¬æ¸²æŸ“

```typescript
const tool = {
  name: 'search',
  description: 'Search files',
  parameters: Type.Object({
    query: Type.String()
  }),
  execute: async ({ query }) => {
    const results = await search(query);
    return { content: results.join('\n') };
  },
  
  // è‡ªå®šä¹‰è°ƒç”¨æ˜¾ç¤º
  renderCall: (params) => {
    return `ğŸ” Searching for: ${params.query}`;
  },
  
  // è‡ªå®šä¹‰ç»“æœæ˜¾ç¤º
  renderResult: (result) => {
    const lines = result.content.split('\n');
    return `âœ… Found ${lines.length} results:\n${result.content}`;
  }
};
```

### ç¤ºä¾‹ 2: ä½¿ç”¨ pi-tui ç»„ä»¶

```typescript
import { Box, Text } from '@pi-mono/pi-tui';

const tool = {
  name: 'weather',
  description: 'Get weather',
  parameters: Type.Object({
    city: Type.String()
  }),
  execute: async ({ city }) => {
    const weather = await getWeather(city);
    return {
      content: `${weather.temperature}Â°C, ${weather.condition}`,
      metadata: { temperature: weather.temperature, condition: weather.condition }
    };
  },
  
  renderCall: (params) => {
    return (
      <Box flexDirection="column">
        <Text bold>ğŸŒ¤ï¸ Checking Weather</Text>
        <Text color="gray">City: {params.city}</Text>
      </Box>
    );
  },
  
  renderResult: (result) => {
    return (
      <Box flexDirection="column">
        <Text color="green">âœ“ Weather Retrieved</Text>
        <Text>{result.content}</Text>
      </Box>
    );
  }
};
```

---

## pi-tui ç»„ä»¶åº“

### å¸¸ç”¨ç»„ä»¶

**Box** - å¸ƒå±€å®¹å™¨
```typescript
<Box flexDirection="column">
  <Text>Line 1</Text>
  <Text>Line 2</Text>
</Box>

<Box flexDirection="row">
  <Text>Left</Text>
  <Text>Right</Text>
</Box>
```

**Text** - æ–‡æœ¬æ˜¾ç¤º
```typescript
<Text>Normal text</Text>
<Text bold>Bold text</Text>
<Text color="green">Green text</Text>
<Text color="red">Red text</Text>
<Text color="gray">Gray text</Text>
```

**Newline** - æ¢è¡Œ
```typescript
<Box>
  <Text>Line 1</Text>
  <Newline />
  <Text>Line 2</Text>
</Box>
```

---

## å®æˆ˜ç¤ºä¾‹

### ç¤ºä¾‹ 1: æ–‡ä»¶è¯»å–å·¥å…·

```typescript
import { Box, Text } from '@pi-mono/pi-tui';

const readFileTool = {
  name: 'read-file',
  description: 'Read file content',
  parameters: Type.Object({
    path: Type.String()
  }),
  execute: async ({ path }) => {
    const content = await fs.readFile(path, 'utf-8');
    return {
      content,
      metadata: {
        fileSize: content.length,
        lines: content.split('\n').length
      }
    };
  },
  
  renderCall: (params) => {
    return (
      <Box flexDirection="column">
        <Text bold>ğŸ“„ Reading File</Text>
        <Text color="gray">Path: {params.path}</Text>
      </Box>
    );
  },
  
  renderResult: (result) => {
    const { fileSize, lines } = result.metadata || {};
    return (
      <Box flexDirection="column">
        <Text color="green">âœ“ File Read Successfully</Text>
        <Text color="gray">Size: {fileSize} bytes, Lines: {lines}</Text>
        <Text>{result.content}</Text>
      </Box>
    );
  }
};
```

### ç¤ºä¾‹ 2: æœç´¢å·¥å…·

```typescript
const searchTool = {
  name: 'search',
  description: 'Search code',
  parameters: Type.Object({
    query: Type.String(),
    maxResults: Type.Optional(Type.Number({ default: 10 }))
  }),
  execute: async ({ query, maxResults = 10 }) => {
    const results = await search(query);
    const limited = results.slice(0, maxResults);
    return {
      content: limited.map(r => `${r.file}:${r.line}`).join('\n'),
      metadata: {
        totalResults: results.length,
        returnedResults: limited.length
      }
    };
  },
  
  renderCall: (params) => {
    return (
      <Box flexDirection="column">
        <Text bold>ğŸ” Searching Code</Text>
        <Text>Query: {params.query}</Text>
        <Text color="gray">Max results: {params.maxResults || 10}</Text>
      </Box>
    );
  },
  
  renderResult: (result) => {
    const { totalResults, returnedResults } = result.metadata || {};
    
    if (returnedResults === 0) {
      return (
        <Box>
          <Text color="yellow">âš  No results found</Text>
        </Box>
      );
    }
    
    return (
      <Box flexDirection="column">
        <Text color="green">
          âœ“ Found {returnedResults} results (total: {totalResults})
        </Text>
        <Text>{result.content}</Text>
      </Box>
    );
  }
};
```

### ç¤ºä¾‹ 3: API è°ƒç”¨å·¥å…·

```typescript
const apiTool = {
  name: 'call-api',
  description: 'Call external API',
  parameters: Type.Object({
    url: Type.String(),
    method: Type.Union([
      Type.Literal('GET'),
      Type.Literal('POST')
    ])
  }),
  execute: async ({ url, method }) => {
    const response = await fetch(url, { method });
    const data = await response.text();
    return {
      content: data,
      metadata: {
        status: response.status,
        statusText: response.statusText
      }
    };
  },
  
  renderCall: (params) => {
    return (
      <Box flexDirection="column">
        <Text bold>ğŸŒ Calling API</Text>
        <Text>{params.method} {params.url}</Text>
      </Box>
    );
  },
  
  renderResult: (result) => {
    const { status, statusText } = result.metadata || {};
    const isSuccess = status >= 200 && status < 300;
    
    return (
      <Box flexDirection="column">
        <Text color={isSuccess ? 'green' : 'red'}>
          {isSuccess ? 'âœ“' : 'âœ—'} Response: {status} {statusText}
        </Text>
        <Text>{result.content}</Text>
      </Box>
    );
  }
};
```

---

## æœ€ä½³å®è·µ

### 1. çªå‡ºå…³é”®ä¿¡æ¯

```typescript
// âœ… å¥½çš„åšæ³•
renderResult: (result) => {
  const count = result.metadata?.count || 0;
  return (
    <Box flexDirection="column">
      <Text color="green">âœ“ Found {count} results</Text>
      <Text>{result.content}</Text>
    </Box>
  );
}

// âŒ ä¸å¥½çš„åšæ³•
renderResult: (result) => {
  return result.content;  // æ²¡æœ‰çªå‡ºå…³é”®ä¿¡æ¯
}
```

### 2. ä½¿ç”¨é¢œè‰²å’Œå›¾æ ‡

```typescript
// âœ… å¥½çš„åšæ³•
renderCall: (params) => {
  return (
    <Box>
      <Text bold>ğŸ” Searching for: {params.query}</Text>
    </Box>
  );
}

// âŒ ä¸å¥½çš„åšæ³•
renderCall: (params) => {
  return `Searching for: ${params.query}`;  // ç¼ºå°‘è§†è§‰å…ƒç´ 
}
```

### 3. å¤„ç†é”™è¯¯çŠ¶æ€

```typescript
// âœ… å¥½çš„åšæ³•
renderResult: (result) => {
  if (result.metadata?.error) {
    return (
      <Box>
        <Text color="red">âœ— {result.content}</Text>
      </Box>
    );
  }
  
  return (
    <Box>
      <Text color="green">âœ“ {result.content}</Text>
    </Box>
  );
}
```

### 4. ä¿æŒä¸€è‡´çš„ UI é£æ ¼

```typescript
// âœ… å¥½çš„åšæ³•ï¼šç»Ÿä¸€çš„å›¾æ ‡å’Œé¢œè‰²
renderCall: (params) => (
  <Box flexDirection="column">
    <Text bold>ğŸ”§ Tool Name</Text>
    <Text color="gray">Details...</Text>
  </Box>
);

renderResult: (result) => (
  <Box flexDirection="column">
    <Text color="green">âœ“ Success</Text>
    <Text>{result.content}</Text>
  </Box>
);
```

---

## æ¥è‡ª pi-mono çš„çœŸå®ç¤ºä¾‹

### question.ts - äº¤äº’å¼é—®é¢˜å·¥å…·

```typescript
// sourcecode/pi-mono/packages/coding-agent/examples/extensions/question.ts

renderCall: (params) => {
  return (
    <Box flexDirection="column">
      <Text bold>{params.question}</Text>
      {params.options.map((opt, i) => (
        <Text key={i}>  {i + 1}. {opt.label}</Text>
      ))}
    </Box>
  );
}
```

### todo.ts - ä»»åŠ¡ç®¡ç†å·¥å…·

```typescript
// sourcecode/pi-mono/packages/coding-agent/examples/extensions/todo.ts

renderResult: (result) => {
  const tasks = JSON.parse(result.content);
  return (
    <Box flexDirection="column">
      <Text bold>ğŸ“‹ Task List</Text>
      {tasks.map((task, i) => (
        <Text key={i}>
          {task.completed ? 'âœ“' : 'â—‹'} {task.task}
        </Text>
      ))}
    </Box>
  );
}
```

---

## æ€»ç»“

**è‡ªå®šä¹‰æ¸²æŸ“çš„å…³é”®è¦ç‚¹:**

1. **renderCall**: å·¥å…·è°ƒç”¨å‰æ˜¾ç¤º
2. **renderResult**: å·¥å…·ç»“æœæ˜¾ç¤º
3. **pi-tui ç»„ä»¶**: Box, Text, Newline
4. **æœ€ä½³å®è·µ**: çªå‡ºå…³é”®ä¿¡æ¯ã€ä½¿ç”¨é¢œè‰²å’Œå›¾æ ‡ã€å¤„ç†é”™è¯¯çŠ¶æ€ã€ä¿æŒä¸€è‡´é£æ ¼

ç†è§£è‡ªå®šä¹‰æ¸²æŸ“,ä½ å°±èƒ½åˆ›å»ºæ›´å‹å¥½ã€æ›´ç›´è§‚çš„å·¥å…·ç•Œé¢!
