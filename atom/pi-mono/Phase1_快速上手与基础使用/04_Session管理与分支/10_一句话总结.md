# Session 管理与分支 - 一句话总结

**Session 管理是 Pi 通过 JSONL 追加日志实现的树形对话持久化机制，支持 /tree 导航、/fork 分支和时间旅行，在 AI Agent 开发中实现有状态的多路径探索与决策回溯，是构建可追溯、可恢复的智能系统的基础设施。**

---

## 核心要点

- **定义**：基于 JSONL 的树形对话持久化机制
- **核心特征**：树形结构、分支导航、时间旅行、原地分支
- **实际应用价值**：
  - 有状态 AI Agent 系统
  - 多路径探索与 A/B 测试
  - 决策回溯与历史追溯
  - 跨设备会话恢复
  - 长期知识积累

---

## 与其他概念的关系

| 概念 | 关系 |
|------|------|
| **Git 分支** | 类似但更轻量，单文件树形结构 vs 多文件版本控制 |
| **Express Session** | 都是会话管理，但 Pi Session 支持分支和时间旅行 |
| **数据库事务** | 都支持回滚，但 Pi Session 保留完整历史 |
| **Undo/Redo** | 类似但更强大，支持多分支并行探索 |
| **AI Agent Memory** | Session 是短期记忆，可扩展为长期记忆层 |

---

## 学习检查

完成本知识点学习后，你应该能够：

- [ ] 理解 Session 的 JSONL 存储机制
- [ ] 使用 /tree 导航会话树
- [ ] 使用 /fork 创建分支
- [ ] 使用 /new 和 /resume 管理会话
- [ ] 理解 Compaction 压缩机制
- [ ] 理解树形结构的 id/parentId 链接
- [ ] 在实际项目中应用 Session 管理

---

## 下一步学习

- **Phase 1.05 - Context Files 与项目配置**：学习如何配置项目级别的上下文
- **Phase 2.11 - Session 存储与树形结构**：深入理解 Session 的底层实现
- **Phase 2.12 - Compaction 压缩机制**：深入理解压缩策略和优化

---

**版本：** v1.0
**最后更新：** 2026-02-18
**维护者：** Claude Code
