# 最小可用知识

> 掌握以下内容，就能开始使用 Pi 交互模式进行日常 AI 编码协作

---

## 4.1 理解交互界面布局

**Pi 的交互界面分为三个区域：**

```
┌─────────────────────────────────────────────────────────┐
│ 顶部状态栏：模型信息 | Session 名称 | Token 使用情况    │
├─────────────────────────────────────────────────────────┤
│                                                         │
│ 中间对话区：                                             │
│   - 用户消息（你的输入）                                  │
│   - AI 响应（Claude 的回复）                             │
│   - 工具调用输出（read/write/edit/bash 等）              │
│                                                         │
│                                                         │
├─────────────────────────────────────────────────────────┤
│ 底部编辑器：                                             │
│ > 在这里输入你的消息...                                   │
│   支持多行输入、@文件引用、Tab 补全                        │
└─────────────────────────────────────────────────────────┘
```

**TypeScript 类比：**
```typescript
interface PiInterface {
  statusBar: {
    model: string;        // 当前使用的模型
    sessionName: string;  // 会话名称
    tokenUsage: number;   // Token 使用量
  };

  conversationArea: {
    messages: Array<{
      role: 'user' | 'assistant';
      content: string;
      toolCalls?: ToolCall[];
    }>;
  };

  editor: {
    input: string;
    cursorPosition: number;
    suggestions: string[];  // Tab 补全建议
  };
}
```

**实际应用：**
- 顶部状态栏帮助你监控成本（Token 使用）
- 对话区可以折叠工具输出（Ctrl+O）节省屏幕空间
- 编辑器支持多行输入，适合复杂的代码讨论

---

## 4.2 掌握 5 个核心命令

**只需记住这 5 个命令，就能完成 80% 的日常工作：**

### 1. `/login` - 认证登录

```bash
# 启动 pi 后首次使用
pi
/login
# 浏览器打开 OAuth 认证页面，登录后自动返回
```

**何时使用：**
- 首次使用 pi
- Token 过期需要重新认证
- 切换账号

---

### 2. `/model` - 切换模型

```bash
# 快捷键：Ctrl+L
/model

# 或直接输入模型名
/model claude-opus-4
/model gpt-4o
```

**TypeScript 类比：**
```typescript
// 类似于切换 API 端点
const client = new APIClient({
  endpoint: '/model/claude-opus-4'  // 动态切换
});
```

**何时使用：**
- 需要更强的推理能力（切换到 Opus）
- 需要更快的响应速度（切换到 Haiku）
- 需要降低成本（切换到更便宜的模型）

---

### 3. `/new` - 创建新会话

```bash
/new
# 创建一个全新的对话会话，清空上下文
```

**日常生活类比：**
- 就像打开一个新的聊天窗口
- 之前的对话历史不会影响新会话

**何时使用：**
- 开始一个新的编码任务
- 当前会话上下文太长，需要清空
- 想要隔离不同项目的讨论

---

### 4. `/settings` - 打开设置

```bash
/settings
# 打开交互式设置界面
```

**可配置项：**
- 默认模型
- Scoped models（快速切换的模型列表）
- 编辑器行为
- 快捷键绑定

**TypeScript 类比：**
```typescript
interface PiSettings {
  defaultModel: string;
  scopedModels: string[];
  editor: {
    multilineKey: 'shift+enter' | 'ctrl+enter';
    tabCompletion: boolean;
  };
  keybindings: Record<string, string>;
}
```

---

### 5. `/tree` - 查看会话树

```bash
/tree
# 显示当前会话的分支结构
```

**输出示例：**
```
Session: my-project
├─ main (current)
│  ├─ 10 messages
│  └─ Last: "Fix the bug in auth.ts"
├─ feature-branch
│  ├─ 5 messages
│  └─ Last: "Add new API endpoint"
└─ experiment
   ├─ 3 messages
   └─ Last: "Try different approach"
```

**何时使用：**
- 想要回到之前的对话分支
- 查看会话的历史结构
- 使用 `/fork` 创建新分支前

---

## 4.3 使用编辑器的 3 个核心功能

### 1. @文件引用

```bash
# 在编辑器中输入 @，然后输入文件名
@src/auth.ts

# 支持模糊搜索
@auth  # 会列出所有包含 "auth" 的文件
```

**TypeScript 类比：**
```typescript
// 类似于 import 语句
import { authenticate } from '@src/auth.ts';

// Pi 的 @引用会将文件内容注入到上下文
const context = {
  files: ['@src/auth.ts'],
  content: readFileSync('src/auth.ts', 'utf-8')
};
```

**实际应用：**
```bash
# 场景：修复 bug
请帮我修复 @src/auth.ts 中的登录问题

# 场景：代码审查
请审查 @src/api/users.ts 和 @src/api/posts.ts 的代码质量

# 场景：重构
请将 @src/utils/old.ts 重构为 TypeScript
```

---

### 2. Tab 补全

```bash
# 输入路径时按 Tab 自动补全
@src/[Tab]
# 显示 src/ 目录下的所有文件和文件夹

@src/api/[Tab]
# 显示 src/api/ 目录下的所有文件
```

**日常生活类比：**
- 就像手机输入法的联想功能
- 或者 IDE 中的代码补全

**实际应用：**
- 快速定位文件，无需记住完整路径
- 探索项目结构
- 减少输入错误

---

### 3. !命令执行

```bash
# 执行命令并将输出发送给 AI
!npm test

# 执行命令但不发送输出
!!npm run build
```

**TypeScript 类比：**
```typescript
import { exec } from 'child_process';

// !command - 执行并发送输出
const output = await exec('npm test');
sendToAI(output);

// !!command - 仅执行
await exec('npm run build');
// 不发送输出给 AI
```

**实际应用：**
```bash
# 场景：测试失败，需要 AI 帮助分析
!npm test
请帮我分析这个测试失败的原因

# 场景：构建项目（不需要 AI 看输出）
!!npm run build

# 场景：查看 git 状态
!git status
请帮我决定哪些文件应该提交
```

---

## 4.4 记住 3 个关键快捷键

### 1. `Ctrl+L` - 快速切换模型

```bash
# 按 Ctrl+L 打开模型选择器
# 使用方向键选择，Enter 确认
```

**何时使用：**
- 需要更强推理能力时切换到 Opus
- 需要快速响应时切换到 Haiku
- 需要降低成本时切换到更便宜的模型

---

### 2. `Ctrl+C` - 清空编辑器 / 退出

```bash
# 按一次：清空编辑器内容
# 按两次：退出 pi
```

**日常生活类比：**
- 就像按 Esc 键取消操作
- 或者清空搜索框

---

### 3. `Ctrl+O` - 折叠/展开工具输出

```bash
# 当 AI 调用工具（read/write/bash）时
# 按 Ctrl+O 折叠输出，节省屏幕空间
```

**实际应用：**
```bash
# AI 读取了一个很长的文件
[Tool: read] src/large-file.ts (1000 lines)
# 按 Ctrl+O 折叠，只显示摘要
[Tool: read] src/large-file.ts (collapsed)
```

---

## 4.5 理解会话管理基础

### Session 是什么？

**TypeScript 类比：**
```typescript
interface Session {
  id: string;
  name: string;
  messages: Message[];
  branches: Session[];  // 子分支
  parent?: Session;     // 父分支
  createdAt: Date;
  updatedAt: Date;
}

// Session 存储为 JSONL 文件
// ~/.pi/sessions/my-project.jsonl
```

**日常生活类比：**
- Session 就像一个聊天记录本
- 每条消息都是一行记录
- 可以创建分支（平行宇宙）

---

### 基本操作

```bash
# 创建新 Session
/new

# 命名当前 Session
/name my-feature-work

# 查看 Session 信息
/session

# 查看 Session 树形结构
/tree

# Fork 到历史分支
/tree
# 选择一个历史节点，按 Enter
/fork
```

**实际应用场景：**

```bash
# 场景 1：开始新功能开发
/new
/name feature-user-auth
# 开始讨论用户认证功能

# 场景 2：尝试不同方案
/tree
# 回到之前的某个节点
/fork
/name experiment-approach-2
# 尝试另一种实现方案

# 场景 3：查看历史决策
/tree
# 查看之前的对话分支
# 了解为什么做了某个技术决策
```

---

## 这些知识足以

掌握以上 5 个部分，你就能：

✅ **日常编码协作**
- 与 AI 讨论代码问题
- 让 AI 帮你修复 bug
- 让 AI 生成代码片段

✅ **项目开发**
- 引用项目文件进行讨论
- 执行测试并分析结果
- 管理不同功能的开发会话

✅ **成本控制**
- 根据任务复杂度切换模型
- 监控 Token 使用情况
- 及时创建新会话避免上下文过长

✅ **为后续学习打基础**
- 理解 Session 管理机制
- 理解工具调用流程
- 理解模型切换逻辑

---

## 快速参考卡

```
┌─────────────────────────────────────────────────────────┐
│ Pi 交互模式 - 最小可用知识速查                            │
├─────────────────────────────────────────────────────────┤
│ 核心命令：                                               │
│   /login      - 认证登录                                 │
│   /model      - 切换模型（Ctrl+L）                       │
│   /new        - 创建新会话                               │
│   /settings   - 打开设置                                 │
│   /tree       - 查看会话树                               │
├─────────────────────────────────────────────────────────┤
│ 编辑器功能：                                             │
│   @file       - 引用文件（支持模糊搜索）                  │
│   Tab         - 路径补全                                 │
│   !command    - 执行命令并发送输出                        │
│   !!command   - 执行命令不发送输出                        │
├─────────────────────────────────────────────────────────┤
│ 快捷键：                                                 │
│   Ctrl+L      - 快速切换模型                             │
│   Ctrl+C      - 清空编辑器（两次退出）                    │
│   Ctrl+O      - 折叠/展开工具输出                         │
│   Shift+Enter - 换行（macOS/Linux）                      │
│   Ctrl+Enter  - 换行（Windows）                          │
└─────────────────────────────────────────────────────────┘
```

---

## 实战练习

### 练习 1：基础对话

```bash
# 1. 启动 pi
pi

# 2. 如果未登录，先登录
/login

# 3. 创建新会话
/new

# 4. 命名会话
/name practice-session

# 5. 开始对话
请帮我解释 TypeScript 的泛型
```

---

### 练习 2：文件引用

```bash
# 1. 引用项目文件
@src/index.ts

# 2. 请求代码审查
请审查这个文件的代码质量，给出改进建议

# 3. 引用多个文件
@src/auth.ts @src/api.ts
这两个文件的职责是否清晰？是否需要重构？
```

---

### 练习 3：命令执行

```bash
# 1. 运行测试
!npm test

# 2. 请求分析
请分析测试失败的原因，并给出修复建议

# 3. 查看 git 状态
!git status
请帮我决定哪些文件应该提交
```

---

### 练习 4：模型切换

```bash
# 1. 切换到 Opus（更强推理）
/model claude-opus-4

# 2. 复杂任务
请帮我设计一个用户认证系统的架构

# 3. 切换到 Haiku（更快响应）
/model claude-haiku-4

# 4. 简单任务
请帮我写一个计算两数之和的函数
```

---

### 练习 5：会话管理

```bash
# 1. 查看会话树
/tree

# 2. Fork 到历史分支
# 选择一个历史节点，按 Enter
/fork

# 3. 命名新分支
/name experiment-branch

# 4. 尝试不同方案
让我们尝试另一种实现方式...
```

---

## 常见问题

### Q1: 为什么我的 @文件引用没有补全？

**A:** 确保：
1. 你在项目根目录运行 `pi`
2. 文件路径正确（相对于项目根目录）
3. 按 Tab 键触发补全

---

### Q2: !command 和 !!command 有什么区别？

**A:**
- `!command` - 执行命令并将输出发送给 AI
- `!!command` - 仅执行命令，不发送输出

**使用场景：**
```bash
# 需要 AI 分析输出
!npm test

# 不需要 AI 看输出（如构建）
!!npm run build
```

---

### Q3: 如何知道当前使用的是哪个模型？

**A:** 查看顶部状态栏，显示当前模型名称：
```
claude-opus-4 | my-session | 1.2K tokens
```

---

### Q4: Session 存储在哪里？

**A:** 默认存储在 `~/.pi/sessions/` 目录：
```bash
~/.pi/sessions/
├── my-project.jsonl
├── feature-work.jsonl
└── experiment.jsonl
```

每个 Session 是一个 JSONL 文件（每行一个 JSON 对象）。

---

### Q5: 如何删除一个 Session？

**A:** 直接删除对应的 JSONL 文件：
```bash
rm ~/.pi/sessions/old-session.jsonl
```

---

## 下一步学习

掌握最小可用知识后，你可以：

1. **深入学习命令** - 学习所有 15 个命令的详细用法
2. **掌握编辑器高级功能** - 学习更多编辑器技巧
3. **理解 Session 管理** - 学习分支、Fork、Compaction
4. **探索扩展功能** - 学习 Extensions 和 Skills

---

**来源：**
- [Pi Coding Agent README](https://github.com/badlogic/pi-mono/blob/main/packages/coding-agent/README.md) - 2026-02
- [Commands 文档](https://github.com/badlogic/pi-mono/blob/main/packages/coding-agent/README.md#commands) - 2026-02
- [Keybindings 文档](https://github.com/badlogic/pi-mono/blob/main/packages/coding-agent/docs/keybindings.md) - 2026-02
- [Sessions 文档](https://github.com/badlogic/pi-mono/blob/main/packages/coding-agent/docs/sessions.md) - 2026-02
