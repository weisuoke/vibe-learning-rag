# 一句话总结

**Runnable 是 LangChain 的统一执行协议，通过 invoke/batch/stream 三大方法和声明式 LCEL 管道操作符实现 AI 组件的可组合、可观测和可测试，在 2025-2026 年已成为企业级 AI 应用的生产标准。**

---

## 核心价值链

```
Runnable 协议
    ↓
统一执行接口 (invoke/batch/stream)
    ↓
LCEL 声明式组合 (|)
    ↓
可组合 + 可观测 + 可测试
    ↓
企业级生产应用 (Klarna, Elastic, C.H. Robinson)
```

---

## 三个关键认知

### 1. Runnable 不是类，是协议

Runnable 是 Python Protocol（接口契约），任何实现了 `invoke`/`batch`/`stream` 方法的对象都是 Runnable。这种设计比继承更灵活。

```python
from typing import Protocol, TypeVar

Input = TypeVar("Input")
Output = TypeVar("Output")

class Runnable(Protocol[Input, Output]):
    def invoke(self, input: Input) -> Output: ...
    def batch(self, inputs: list[Input]) -> list[Output]: ...
    def stream(self, input: Input) -> Iterator[Output]: ...
```

### 2. LCEL 不是语法糖，是执行引擎

LCEL 的管道操作符 `|` 不仅仅是语法糖，它构建了优化的执行图，支持：
- **并行执行**: RunnableParallel 自动并发
- **流式传输**: 自动支持 token-by-token 流式
- **异步优化**: 默认支持 async/await

### 3. 生产级不是未来，是现在

2025-2026 年数据显示：
- **57%** 的企业已在生产环境部署 LangChain Agent[^1]
- **50%** 的成本节省通过 batch API 和 langasync 实现[^2]
- **80%** 的查询解决时间缩短（Klarna 案例）[^3]

---

## 适用场景

### ✅ 推荐使用 Runnable + LCEL

- 多步骤 AI 工作流（RAG、Agent、多轮对话）
- 需要可观测性和调试的生产应用
- 需要批量处理和成本优化的场景
- 团队协作和代码复用

### ❌ 不推荐使用

- 极简单的单次 LLM 调用（直接用 SDK 更简单）
- 需要极致性能优化的场景（考虑 vLLM）
- 团队更熟悉其他框架（如 Semantic Kernel）

---

## 学习路径

```
01. 理解 Runnable 协议 (本文档)
    ↓
02. 掌握 invoke/batch/stream 三大方法
    ↓
03. 学习 LCEL 管道组合
    ↓
04. 实践 RunnableParallel/Branch/Passthrough
    ↓
05. 集成 LangGraph 构建有状态工作流
    ↓
06. 生产部署与成本优化
```

---

## 2025-2026 关键更新

### LangChain 1.0 稳定性

2025年10月发布，承诺到 2.0 无重大 breaking changes，Runnable 协议保持稳定[^4]。

### 安全修复

CVE-2025-68664 序列化注入漏洞已修复，升级到 langchain-core 1.2.5+[^5]。

### 成本优化

langasync 工具通过批处理 API 实现 50% 成本降低[^2]。

---

## 实战检查清单

在开始使用 Runnable 和 LCEL 前，确保：

- [ ] 理解 Runnable 是协议而非类
- [ ] 掌握 invoke/batch/stream 的使用场景
- [ ] 了解 LCEL 管道操作符的执行优化
- [ ] 知道何时使用 LCEL，何时直接用 SDK
- [ ] 配置好 LangSmith 进行可观测性监控
- [ ] 了解 2025 年的安全最佳实践
- [ ] 评估是否需要 langasync 进行成本优化

---

## 参考资料

[^1]: [State of Agent Engineering 2026](https://www.langchain.com/state-of-agent-engineering) - LangChain, 2026
[^2]: [langasync GitHub](https://github.com/langasync/langasync) - 50% LLM API Cost Savings, 2025-2026
[^3]: [LangChain Customer Stories](https://www.langchain.com/customers) - Klarna, Elastic, C.H. Robinson, 2025-2026
[^4]: [LangChain 1.0 Release](https://blog.langchain.com/langchain-langgraph-1dot0) - LangChain Blog, 2025年10月
[^5]: [CVE-2025-68664](https://nvd.nist.gov/vuln/detail/CVE-2025-68664) - NVD, 2025年12月

---

**完成学习后**: 继续阅读 [03_核心概念_01_Runnable协议.md](./03_核心概念_01_Runnable协议.md) 深入理解协议设计
