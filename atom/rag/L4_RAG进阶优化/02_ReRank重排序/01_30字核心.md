# 01_30字核心

## 核心定义（30字以内）

**ReRank重排序：在初检结果上用Cross-Encoder深度模型重新打分排序，将NDCG@10提升15-48%，是RAG精度优化的性价比之王。**

---

## 为什么是这30个字？

### 1. "初检结果上" - 明确位置

ReRank不是第一道检索，而是**二次精排**：

```
用户Query → 初检（BM25/向量检索）→ 候选集50-100个 → ReRank → Top 5-10 → LLM生成
```

**为什么不直接用ReRank？**
- Cross-Encoder计算成本高：O(n²) vs Bi-Encoder的O(n)
- 全量文档rerank会导致延迟爆炸（百万文档 × 200ms = 55小时）
- 初检快速过滤无关文档，rerank只处理候选集

### 2. "Cross-Encoder深度模型" - 技术本质

**Cross-Encoder vs Bi-Encoder：**

| 维度 | Bi-Encoder（初检） | Cross-Encoder（ReRank） |
|------|-------------------|------------------------|
| 编码方式 | Query和Doc分别编码 | Query+Doc联合编码 |
| 交互深度 | 无交互（余弦相似度） | 深度注意力交互 |
| 精度 | 中等 | 高（+15-48%） |
| 速度 | 快（毫秒级） | 慢（50文档1.5秒） |
| 适用场景 | 海量初筛 | 候选集精排 |

**为什么Cross-Encoder更准？**
```python
# Bi-Encoder：分别编码，无交互
query_emb = encoder(query)      # [768]
doc_emb = encoder(doc)          # [768]
score = cosine(query_emb, doc_emb)  # 简单相似度

# Cross-Encoder：联合编码，深度交互
input = f"{query} [SEP] {doc}"  # 拼接输入
score = model(input)            # Transformer深度注意力
```

### 3. "NDCG@10提升15-48%" - 量化效果

**2025-2026年实测数据：**

| 研究来源 | 提升幅度 | 测试场景 |
|---------|---------|---------|
| MIT研究 | +40% | 通用问答 |
| Databricks | +48% | 企业知识库 |
| Pinecone | +15-30% | 电商搜索 |
| ZeroEntropy | +28% | 多语言RAG |

**NDCG@10是什么？**
- Normalized Discounted Cumulative Gain at position 10
- 衡量排序质量：位置越靠前的相关文档权重越高
- 值域[0,1]，1表示完美排序

**为什么不是Recall或Precision？**
- Recall/Precision只看"有没有"，不看"排第几"
- RAG场景中，Top 5的排序质量直接影响LLM生成质量
- NDCG同时考虑相关性和位置，更符合实际需求

### 4. "性价比之王" - 成本效益

**成本对比（2026年数据）：**

| 优化方法 | 成本 | 精度提升 | ROI |
|---------|------|---------|-----|
| 更好的Embedding模型 | 高（重新索引） | +5-10% | 低 |
| 更大的候选集 | 中（延迟增加） | +3-5% | 中 |
| **Cross-Encoder ReRank** | **低（$0.025/M tokens）** | **+15-48%** | **极高** |
| LLM-based ReRank | 极高（$0.50-5.00/M tokens） | +20-50% | 低 |

**ZeroEntropy zerank-1案例：**
- 成本降低72%（vs LLM reranking）
- 延迟仅60ms（50文档）
- NDCG@10提升28%

---

## RAG开发中的体现

### 场景1：文档问答系统

**问题：** 向量检索返回的Top 10中，真正相关的文档排在第7位

**影响：**
- LLM只看前5个文档（context window限制）
- 错过关键信息，生成答案不准确
- 用户体验差

**ReRank解决：**
```python
# 初检：向量检索Top 50
initial_results = vector_search(query, top_k=50)

# ReRank：精排到Top 5
reranked = reranker.rerank(query, initial_results, top_k=5)

# 真正相关的文档从第7位跃升到第1位
# LLM基于高质量上下文生成准确答案
```

### 场景2：多模态知识库

**挑战：** 图文混合内容，纯向量检索难以捕捉细粒度语义

**ReRank优势：**
- Jina reranker-m0支持视觉文档排名
- 理解PDF扫描件、图像+文本的复杂关系
- 提升多模态RAG准确率35%

### 场景3：实时客服系统

**需求：** 低延迟（<2秒）+ 高精度

**架构：**
```
BM25初检（10ms）→ 向量检索（50ms）→ RRF融合（5ms）→
Cross-Encoder ReRank（200ms）→ LLM生成（1s）= 总计1.3秒
```

**关键：**
- 候选集控制在50个（延迟vs精度平衡）
- 使用轻量级reranker（BGE-reranker-v2-m3，<600M参数）
- 语义缓存降低68.8%重复请求成本

---

## 前端开发类比

**ReRank = 搜索结果的二次排序算法**

```javascript
// 初检：快速过滤（类似数组filter）
const initialResults = allDocs.filter(doc =>
  doc.keywords.includes(query)  // 简单匹配
).slice(0, 50);  // 取前50

// ReRank：深度评分排序（类似复杂sort）
const reranked = initialResults.sort((a, b) => {
  // 深度模型计算相关性分数（类似ML模型推理）
  const scoreA = deepModel.predict(query, a);
  const scoreB = deepModel.predict(query, b);
  return scoreB - scoreA;
}).slice(0, 5);  // 最终Top 5
```

**对应关系：**
- 初检 = `Array.filter()` - 快速粗筛
- ReRank = `Array.sort()` with ML model - 精细排序
- Cross-Encoder = 复杂的比较函数，考虑query和doc的深度交互

---

## 日常生活类比

**ReRank = 面试的二轮筛选**

1. **简历初筛（初检）：**
   - HR快速浏览1000份简历
   - 根据关键词（学历、经验）筛选出50份
   - 速度快但可能遗漏细节

2. **技术面试（ReRank）：**
   - 技术专家深度评估50位候选人
   - 考察实际能力、项目经验、思维方式
   - 耗时但精准，最终选出5位进入终面

3. **为什么不直接技术面试1000人？**
   - 成本太高（1000人 × 1小时 = 1000小时）
   - 效率低下
   - 初筛已经过滤掉明显不合格的候选人

**ReRank的价值：**
- 在有限的候选集中找到真正最优的结果
- 平衡成本和精度
- 两阶段策略：粗筛+精排

---

## 一句话记忆

**"ReRank是RAG的二轮面试官：在初检的50个候选人中，用Cross-Encoder深度评估，把真正相关的文档排到前5，让LLM看到最好的上下文。"**

---

## 参考资料

### 核心研究
- [Cross-Encoder Reranking Improves RAG Accuracy by 40%](https://app.ailog.fr/en/blog/news/reranking-cross-encoders-study) - MIT, 2026
- [Databricks Reranking Research](https://www.databricks.com/blog/reranking-mosaic-ai-vector-search-faster-smarter-retrieval-rag-agents) - 48%质量提升

### 技术指南
- [Ultimate Guide to Choosing the Best Reranking Model in 2026](https://www.zeroentropy.dev/articles/ultimate-guide-to-choosing-the-best-reranking-model-in-2025) - ZeroEntropy
- [Top 7 Rerankers for RAG](https://www.analyticsvidhya.com/blog/2025/06/top-rerankers-for-rag) - Analytics Vidhya, 2025

---

**版本：** v1.0 (2026年标准)
**最后更新：** 2026-02-16
**适用场景：** RAG开发、信息检索、搜索优化
