# å®æˆ˜ä»£ç  02ï¼šé«˜çº§æŠ€èƒ½ä¸ç»„åˆ

## åœºæ™¯ 1ï¼šæŠ€èƒ½ç»„åˆï¼ˆè°ƒç”¨å…¶ä»–æŠ€èƒ½ï¼‰

### éœ€æ±‚

åˆ›å»ºä¸€ä¸ªå¤åˆæŠ€èƒ½ï¼ŒæŒ‰é¡ºåºè°ƒç”¨å¤šä¸ªå­æŠ€èƒ½å®Œæˆå®Œæ•´çš„å¼€å‘å·¥ä½œæµã€‚

### å®ç°

```markdown
---
name: full-dev-workflow
description: Complete development workflow from exploration to deployment
---

You are a project manager guiding a complete development workflow.

## Workflow Overview

This skill orchestrates a complete development cycle by calling multiple specialized skills in sequence.

## Execution Steps

### Step 1: Codebase Exploration
**Action:** Use /skill:explore to understand the codebase structure.

**What to look for:**
- Project structure and organization
- Key files and directories
- Existing patterns and conventions
- Dependencies and technologies used

**Wait for exploration to complete before proceeding to Step 2.**

### Step 2: Implementation Planning
**Action:** Based on the exploration results, use /skill:plan to generate a detailed implementation plan.

**Plan should include:**
- Files to create or modify
- Step-by-step implementation approach
- Potential challenges and solutions
- Testing strategy

**Wait for planning to complete before proceeding to Step 3.**

### Step 3: Code Implementation
**Action:** Use /skill:implement to execute the plan.

**Implementation guidelines:**
- Follow the plan step by step
- Write clean, maintainable code
- Add appropriate comments
- Follow project conventions

**Wait for implementation to complete before proceeding to Step 4.**

### Step 4: Test Generation
**Action:** Use /skill:test-generation to create comprehensive tests.

**Test coverage:**
- Unit tests for new functions
- Integration tests for new features
- Edge cases and error scenarios

**Wait for test generation to complete before proceeding to Step 5.**

### Step 5: Code Review
**Action:** Use /skill:code-review to review all changes.

**Review focus:**
- Code quality and maintainability
- Security vulnerabilities
- Performance issues
- Test coverage

### Step 6: Final Report
**Action:** Provide a comprehensive summary of the entire workflow.

**Report format:**
```
## Development Workflow Summary

### 1. Exploration Results
[Key findings from codebase exploration]

### 2. Implementation Plan
[Summary of the plan]

### 3. Implementation Details
[What was implemented]

### 4. Tests Created
[Test coverage summary]

### 5. Code Review Results
[Review findings and recommendations]

### 6. Next Steps
[Recommended actions]
```

## Important Notes

- **Sequential Execution**: Execute steps in order. Do not skip any step.
- **Wait Between Steps**: Wait for each step to complete before moving to the next.
- **Error Handling**: If any step fails, report the error and ask for guidance.
- **Context Preservation**: Carry context from previous steps to inform later steps.

## Example Usage

```
User: /skill:full-dev-workflow "Add user authentication feature"

Agent:
Step 1: Exploring codebase...
[Uses /skill:explore]
Found: Express.js backend, React frontend, MongoDB database

Step 2: Creating implementation plan...
[Uses /skill:plan]
Plan: Add JWT authentication, create auth middleware, update user model

Step 3: Implementing changes...
[Uses /skill:implement]
Created: auth.middleware.ts, updated user.model.ts, added login/register routes

Step 4: Generating tests...
[Uses /skill:test-generation]
Created: auth.test.ts with 15 test cases

Step 5: Reviewing code...
[Uses /skill:code-review]
âœ… Strengths: Clean implementation, good test coverage
âš ï¸ Issues: Missing rate limiting on login endpoint

Step 6: Final Report
[Comprehensive summary]
```
```

### å…³é”®å®ç°ç‚¹

**1. æ˜ç¡®çš„æ­¥éª¤é¡ºåº**
```markdown
Step 1 â†’ Step 2 â†’ Step 3 â†’ Step 4 â†’ Step 5 â†’ Step 6
```

**2. ç­‰å¾…æœºåˆ¶**
```markdown
**Wait for X to complete before proceeding to Y.**
```

**3. ä¸Šä¸‹æ–‡ä¼ é€’**
```markdown
Based on the exploration results, use /skill:plan...
```

**4. é”™è¯¯å¤„ç†**
```markdown
If any step fails, report the error and ask for guidance.
```

---

## åœºæ™¯ 2ï¼šæ¡ä»¶é€»è¾‘å’Œåˆ†æ”¯

### éœ€æ±‚

åˆ›å»ºä¸€ä¸ªè‡ªé€‚åº”æŠ€èƒ½ï¼Œæ ¹æ®ä»£ç ç±»å‹å’Œä¸Šä¸‹æ–‡é€‰æ‹©ä¸åŒçš„å¤„ç†ç­–ç•¥ã€‚

### å®ç°

```markdown
---
name: adaptive-analyzer
description: Adaptive code analysis based on file type and context
---

You are an adaptive code analyzer that adjusts analysis strategy based on context.

## Analysis Process

### Step 1: Context Detection

Analyze the provided code to determine:

1. **File Type**
   - TypeScript/JavaScript (.ts, .tsx, .js, .jsx)
   - Python (.py)
   - Go (.go)
   - Rust (.rs)
   - Other

2. **Code Category**
   - Frontend (React, Vue, Angular components)
   - Backend (API routes, services, middleware)
   - Database (models, migrations, queries)
   - Tests (unit tests, integration tests)
   - Configuration (config files, build scripts)

3. **Complexity Level**
   - Simple (< 50 lines, straightforward logic)
   - Moderate (50-200 lines, some complexity)
   - Complex (> 200 lines, high complexity)

### Step 2: Strategy Selection

**Branch 1: Frontend Code**
```
IF file type is TypeScript/JavaScript AND category is Frontend:
  Use /skill:frontend-analyzer
  Focus on:
  - React/Vue/Angular patterns
  - Component structure
  - State management
  - Accessibility
  - Performance (re-renders, memoization)
```

**Branch 2: Backend Code**
```
IF file type is TypeScript/JavaScript/Python AND category is Backend:
  Use /skill:backend-analyzer
  Focus on:
  - API design
  - Database queries
  - Authentication/Authorization
  - Error handling
  - Security vulnerabilities
```

**Branch 3: Database Code**
```
IF category is Database:
  Use /skill:database-analyzer
  Focus on:
  - Schema design
  - Query optimization
  - Indexing strategy
  - Data integrity
  - Migration safety
```

**Branch 4: Test Code**
```
IF category is Tests:
  Use /skill:test-analyzer
  Focus on:
  - Test coverage
  - Edge cases
  - Mocking strategy
  - Test maintainability
  - Performance
```

**Branch 5: Complex Code**
```
IF complexity level is Complex:
  Use /skill:complexity-analyzer
  Focus on:
  - Cyclomatic complexity
  - Code smells
  - Refactoring opportunities
  - Design patterns
```

**Default Branch**
```
IF none of the above match:
  Use /skill:general-analyzer
  Provide comprehensive analysis covering all aspects
```

### Step 3: Execute Analysis

Execute the selected analysis strategy and provide detailed feedback.

### Step 4: Recommendations

Based on the analysis, provide:
- Specific improvements
- Code examples
- Best practices
- Links to documentation

## Decision Tree

```
Code Input
    â†“
Detect Context
    â†“
    â”œâ”€ Frontend? â†’ /skill:frontend-analyzer
    â”œâ”€ Backend? â†’ /skill:backend-analyzer
    â”œâ”€ Database? â†’ /skill:database-analyzer
    â”œâ”€ Tests? â†’ /skill:test-analyzer
    â”œâ”€ Complex? â†’ /skill:complexity-analyzer
    â””â”€ Default â†’ /skill:general-analyzer
```

## Important Notes

- **Single Branch**: Choose only ONE analysis strategy
- **Clear Reasoning**: Explain why you chose this strategy
- **Fallback**: Use general-analyzer if unsure

## Example

```
Input: React component with 300 lines

Detection:
- File Type: TypeScript (.tsx)
- Category: Frontend (React component)
- Complexity: Complex (> 200 lines)

Strategy Selection:
Primary: Frontend (React component detected)
Secondary: Complexity (> 200 lines)
â†’ Use /skill:frontend-analyzer with complexity focus

Analysis:
[Frontend-specific analysis with complexity considerations]
```
```

### å…³é”®å®ç°ç‚¹

**1. æ¡ä»¶åˆ¤æ–­**
```markdown
IF condition THEN action
```

**2. äº’æ–¥åˆ†æ”¯**
```markdown
Choose only ONE analysis strategy
```

**3. ä¼˜å…ˆçº§**
```markdown
Primary: Frontend
Secondary: Complexity
```

**4. é»˜è®¤å¤„ç†**
```markdown
IF none match: Use general-analyzer
```

---

## åœºæ™¯ 3ï¼šå¼‚æ­¥æ“ä½œå’Œé”™è¯¯å¤„ç†

### éœ€æ±‚

åˆ›å»ºä¸€ä¸ªå¥å£®çš„æŠ€èƒ½ï¼Œèƒ½å¤Ÿå¤„ç†å¼‚æ­¥æ“ä½œå’Œå„ç§é”™è¯¯æƒ…å†µã€‚

### å®ç°

```markdown
---
name: robust-deployment
description: Robust deployment with error handling and rollback
---

You are a deployment specialist ensuring safe and reliable deployments.

## Deployment Process

### Phase 1: Pre-Deployment Checks

**Check 1: Environment Validation**
```
Verify:
- Environment variables are set
- Database connection is available
- Required services are running
- Disk space is sufficient

IF any check fails:
  - Report the specific failure
  - Provide remediation steps
  - STOP deployment
  - DO NOT proceed to Phase 2
```

**Check 2: Code Quality**
```
Run:
- Linting (npm run lint)
- Type checking (npm run type-check)
- Unit tests (npm run test)

IF any check fails:
  - Report test failures
  - Show error details
  - STOP deployment
  - DO NOT proceed to Phase 2
```

**Check 3: Build Verification**
```
Run:
- Production build (npm run build)
- Build size check
- Asset optimization verification

IF build fails:
  - Report build errors
  - Show compilation errors
  - STOP deployment
  - DO NOT proceed to Phase 2
```

### Phase 2: Deployment Execution

**Step 1: Backup Current State**
```
Create backup:
- Database snapshot
- Current deployment tag
- Configuration files

IF backup fails:
  - Report backup error
  - STOP deployment
  - DO NOT proceed
```

**Step 2: Deploy New Version**
```
Deploy:
- Upload new build
- Update configuration
- Restart services

IF deployment fails:
  - Capture error details
  - Proceed to Phase 3 (Rollback)
```

**Step 3: Health Check**
```
Verify:
- Application is responding
- Database connections work
- API endpoints are accessible
- No critical errors in logs

IF health check fails:
  - Capture failure details
  - Proceed to Phase 3 (Rollback)
```

### Phase 3: Rollback (Error Recovery)

**Triggered when:**
- Deployment fails
- Health check fails
- Critical error detected

**Rollback Steps:**
```
1. Stop new version
2. Restore previous version from backup
3. Restore database if needed
4. Restart services
5. Verify rollback success
6. Report rollback completion
```

### Phase 4: Post-Deployment

**If deployment succeeded:**
```
- Tag successful deployment
- Update deployment log
- Notify team
- Monitor for 5 minutes
```

**If deployment failed:**
```
- Document failure reason
- Preserve error logs
- Notify team with details
- Provide remediation steps
```

## Error Handling Strategy

### Error Categories

**1. Recoverable Errors**
```
Examples:
- Temporary network issues
- Service temporarily unavailable

Action:
- Retry up to 3 times
- Wait 5 seconds between retries
- If still failing, treat as non-recoverable
```

**2. Non-Recoverable Errors**
```
Examples:
- Build compilation errors
- Missing environment variables
- Database connection failure

Action:
- STOP immediately
- DO NOT retry
- Report error details
- Provide remediation steps
```

**3. Critical Errors**
```
Examples:
- Data corruption
- Security breach
- System crash

Action:
- STOP immediately
- Initiate rollback
- Alert team urgently
- Preserve all logs
```

## Timeout Handling

```
Operation Timeouts:
- Build: 10 minutes
- Deployment: 5 minutes
- Health check: 2 minutes
- Rollback: 5 minutes

IF timeout exceeded:
  - Cancel operation
  - Report timeout
  - Initiate rollback if needed
```

## Example Execution

```
User: /skill:robust-deployment

Agent:
Phase 1: Pre-Deployment Checks
âœ… Environment validation passed
âœ… Code quality checks passed
âœ… Build verification passed

Phase 2: Deployment Execution
âœ… Backup created successfully
âœ… New version deployed
âš ï¸ Health check failed: API endpoint /api/users returning 500

Phase 3: Rollback
ğŸ”„ Initiating rollback...
âœ… Stopped new version
âœ… Restored previous version
âœ… Services restarted
âœ… Health check passed

Phase 4: Post-Deployment
âŒ Deployment failed
ğŸ“‹ Failure reason: API endpoint error
ğŸ“ Error details: [error logs]
ğŸ’¡ Remediation: Check database connection in new version

Rollback completed successfully. System is stable on previous version.
```
```

### å…³é”®å®ç°ç‚¹

**1. é”™è¯¯åˆ†ç±»**
```markdown
- Recoverable (retry)
- Non-Recoverable (stop)
- Critical (rollback)
```

**2. é‡è¯•æœºåˆ¶**
```markdown
Retry up to 3 times with 5-second delay
```

**3. è¶…æ—¶å¤„ç†**
```markdown
IF timeout exceeded: Cancel and rollback
```

**4. å›æ»šç­–ç•¥**
```markdown
Automatic rollback on critical errors
```

---

## åœºæ™¯ 4ï¼šä¸ Extensions é›†æˆ

### éœ€æ±‚

åˆ›å»ºä¸€ä¸ªæŠ€èƒ½ï¼Œåˆ©ç”¨ Extension API æä¾›é¢å¤–çš„åŠŸèƒ½å’Œé›†æˆã€‚

### å®ç°

**æ­¥éª¤ 1ï¼šåˆ›å»º Extension**

```typescript
// my-extension/index.ts
import { ExtensionContext } from '@pi-mono/coding-agent';

export function activate(context: ExtensionContext) {
  // æä¾›æŠ€èƒ½
  context.on('resources_discover', () => {
    return {
      skills: [
        {
          name: 'git-smart-commit',
          description: 'Generate smart commit messages based on changes',
          filePath: join(__dirname, 'skills', 'git-smart-commit', 'SKILL.md'),
          baseDir: join(__dirname, 'skills', 'git-smart-commit'),
          source: 'extension:my-extension',
          disableModelInvocation: false
        }
      ]
    };
  });

  // æä¾›è‡ªå®šä¹‰å·¥å…·
  context.registerTool({
    name: 'analyze_git_diff',
    description: 'Analyze git diff and extract key changes',
    inputSchema: {
      type: 'object',
      properties: {
        diff: { type: 'string', description: 'Git diff output' }
      },
      required: ['diff']
    },
    handler: async (input) => {
      const { diff } = input;
      // åˆ†æ diff
      const changes = analyzeDiff(diff);
      return {
        filesChanged: changes.files,
        linesAdded: changes.added,
        linesRemoved: changes.removed,
        summary: changes.summary
      };
    }
  });
}

function analyzeDiff(diff: string) {
  // å®ç° diff åˆ†æé€»è¾‘
  const files = [];
  const lines = diff.split('\n');
  let added = 0, removed = 0;

  for (const line of lines) {
    if (line.startsWith('+++')) {
      files.push(line.substring(6));
    } else if (line.startsWith('+') && !line.startsWith('+++')) {
      added++;
    } else if (line.startsWith('-') && !line.startsWith('---')) {
      removed++;
    }
  }

  return {
    files,
    added,
    removed,
    summary: `Modified ${files.length} files: +${added} -${removed}`
  };
}
```

**æ­¥éª¤ 2ï¼šåˆ›å»ºæŠ€èƒ½**

```markdown
---
name: git-smart-commit
description: Generate smart commit messages based on git changes
---

You are a Git commit message expert following conventional commits specification.

## Process

### Step 1: Analyze Changes
Use the `analyze_git_diff` tool to analyze the current git diff:
```
git diff --staged
```

### Step 2: Categorize Changes
Based on the analysis, categorize changes:
- **feat**: New feature
- **fix**: Bug fix
- **docs**: Documentation changes
- **style**: Code style changes
- **refactor**: Code refactoring
- **test**: Test changes
- **chore**: Build/tooling changes

### Step 3: Generate Commit Message
Format: `<type>(<scope>): <subject>`

Example:
```
feat(auth): add JWT authentication

- Implement JWT token generation
- Add authentication middleware
- Update user model with password hashing
```

### Step 4: Validate Message
Ensure:
- Type is valid
- Subject is concise (< 50 chars)
- Body explains what and why
- Follows conventional commits

## Output Format

```
Proposed Commit Message:
---
<type>(<scope>): <subject>

<body>

<footer>
---

Changes Summary:
- Files modified: X
- Lines added: +Y
- Lines removed: -Z

Would you like to use this commit message? (yes/no)
```

## Example

```
User: /skill:git-smart-commit

Agent:
Analyzing changes...
[Uses analyze_git_diff tool]

Changes detected:
- src/auth/jwt.ts (new file)
- src/middleware/auth.ts (new file)
- src/models/user.ts (modified)

Categorization: feat (new feature)
Scope: auth

Proposed Commit Message:
---
feat(auth): add JWT authentication

- Implement JWT token generation and validation
- Add authentication middleware for protected routes
- Update user model with password hashing using bcrypt
- Add login and register endpoints

Closes #123
---

Changes Summary:
- Files modified: 3
- Lines added: +245
- Lines removed: -12

Would you like to use this commit message?
```
```

### å…³é”®å®ç°ç‚¹

**1. Extension API é›†æˆ**
```typescript
context.on('resources_discover', () => {
  return { skills: [...] };
});
```

**2. è‡ªå®šä¹‰å·¥å…·æ³¨å†Œ**
```typescript
context.registerTool({
  name: 'analyze_git_diff',
  handler: async (input) => { ... }
});
```

**3. æŠ€èƒ½ä½¿ç”¨å·¥å…·**
```markdown
Use the `analyze_git_diff` tool to analyze...
```

**4. å·¥å…·ç»“æœå¤„ç†**
```markdown
Based on the analysis, categorize changes...
```

---

## æ€»ç»“

**é«˜çº§æŠ€èƒ½å¼€å‘è¦ç‚¹ï¼š**

1. **æŠ€èƒ½ç»„åˆ** - é¡ºåºè°ƒç”¨å¤šä¸ªå­æŠ€èƒ½
2. **æ¡ä»¶é€»è¾‘** - æ ¹æ®ä¸Šä¸‹æ–‡é€‰æ‹©ç­–ç•¥
3. **å¼‚æ­¥æ“ä½œ** - å¤„ç†å¼‚æ­¥å’Œé”™è¯¯
4. **Extension é›†æˆ** - åˆ©ç”¨æ‰©å±•èƒ½åŠ›

**å…³é”®æŠ€æœ¯ï¼š**

- **ä¸Šä¸‹æ–‡ä¼ é€’** - åœ¨æŠ€èƒ½é—´ä¼ é€’ä¿¡æ¯
- **é”™è¯¯å¤„ç†** - åˆ†ç±»ã€é‡è¯•ã€å›æ»š
- **å·¥å…·é›†æˆ** - ä½¿ç”¨è‡ªå®šä¹‰å·¥å…·
- **çŠ¶æ€ç®¡ç†** - è·Ÿè¸ªæ‰§è¡ŒçŠ¶æ€

**ä¸‹ä¸€æ­¥ï¼š**

- ã€æµ‹è¯•å‘å¸ƒä¸é›†æˆã€‘- å­¦ä¹ æµ‹è¯•å’Œå‘å¸ƒæµç¨‹

---

**ç‰ˆæœ¬ï¼š** v1.0
**æœ€åæ›´æ–°ï¼š** 2026-02-20
**ç»´æŠ¤è€…ï¼š** Claude Code
