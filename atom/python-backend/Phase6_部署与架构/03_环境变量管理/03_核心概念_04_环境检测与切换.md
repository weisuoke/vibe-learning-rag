# æ ¸å¿ƒæ¦‚å¿µ4ï¼šç¯å¢ƒæ£€æµ‹ä¸åˆ‡æ¢

## ä¸€å¥è¯å®šä¹‰

**ç¯å¢ƒæ£€æµ‹ä¸åˆ‡æ¢æ˜¯æ ¹æ®è¿è¡Œç¯å¢ƒï¼ˆå¼€å‘/æµ‹è¯•/ç”Ÿäº§ï¼‰è‡ªåŠ¨åŠ è½½å¯¹åº”é…ç½®çš„æœºåˆ¶ï¼Œè®©åŒä¸€ä»½ä»£ç åœ¨ä¸åŒç¯å¢ƒä¸­ä½¿ç”¨ä¸åŒçš„é…ç½®è€Œæ— éœ€ä¿®æ”¹ä»£ç ã€‚**

---

## ä¸ºä»€ä¹ˆéœ€è¦ç¯å¢ƒæ£€æµ‹ä¸åˆ‡æ¢ï¼Ÿ

### é—®é¢˜åœºæ™¯

åœ¨å®é™…å¼€å‘ä¸­ï¼Œä½ ä¼šé‡åˆ°è¿™äº›é—®é¢˜ï¼š

```python
# âŒ é—®é¢˜1ï¼šæ‰‹åŠ¨åˆ‡æ¢é…ç½®ï¼Œå®¹æ˜“å‡ºé”™
if ENV == "dev":
    DATABASE_URL = "postgresql://localhost:5432/dev_db"
    DEBUG = True
elif ENV == "test":
    DATABASE_URL = "postgresql://test-db:5432/test_db"
    DEBUG = False
elif ENV == "prod":
    DATABASE_URL = "postgresql://prod-db:5432/prod_db"
    DEBUG = False

# âŒ é—®é¢˜2ï¼šå¿˜è®°åˆ‡æ¢ç¯å¢ƒï¼Œå¯¼è‡´ç”Ÿäº§äº‹æ•…
# å¼€å‘æ—¶è¿æ¥ç”Ÿäº§æ•°æ®åº“ï¼Œè¯¯åˆ æ•°æ®ï¼

# âŒ é—®é¢˜3ï¼šé…ç½®åˆ†æ•£ï¼Œéš¾ä»¥ç»´æŠ¤
# æ¯æ¬¡æ·»åŠ æ–°é…ç½®ï¼Œéƒ½è¦åœ¨å¤šä¸ªåœ°æ–¹ä¿®æ”¹
```

### ç¯å¢ƒæ£€æµ‹ä¸åˆ‡æ¢çš„è§£å†³æ–¹æ¡ˆ

```python
# âœ… è‡ªåŠ¨æ£€æµ‹ç¯å¢ƒï¼ŒåŠ è½½å¯¹åº”é…ç½®
import os
from dotenv import load_dotenv

# æ£€æµ‹ç¯å¢ƒ
env = os.getenv("ENV", "dev")

# åŠ è½½å¯¹åº”çš„é…ç½®æ–‡ä»¶
load_dotenv(f".env.{env}")

# ä½¿ç”¨é…ç½®
DATABASE_URL = os.getenv("DATABASE_URL")
DEBUG = os.getenv("DEBUG", "False").lower() == "true"

print(f"å½“å‰ç¯å¢ƒ: {env}")
print(f"æ•°æ®åº“: {DATABASE_URL}")
```

---

## æ ¸å¿ƒæ¦‚å¿µ

### æ¦‚å¿µ1ï¼šç¯å¢ƒæ ‡è¯†

**ç¯å¢ƒæ ‡è¯†æ˜¯ç”¨äºåŒºåˆ†ä¸åŒè¿è¡Œç¯å¢ƒçš„æ ‡è®°ï¼Œé€šå¸¸æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚**

**å¸¸è§çš„ç¯å¢ƒæ ‡è¯†ï¼š**

```python
from enum import Enum

class Environment(str, Enum):
    DEV = "dev"          # å¼€å‘ç¯å¢ƒ
    TEST = "test"        # æµ‹è¯•ç¯å¢ƒ
    STAGING = "staging"  # é¢„å‘å¸ƒç¯å¢ƒ
    PROD = "prod"        # ç”Ÿäº§ç¯å¢ƒ
```

**è®¾ç½®ç¯å¢ƒæ ‡è¯†ï¼š**

```bash
# æ–¹å¼1ï¼šç¯å¢ƒå˜é‡
export ENV=dev
python app.py

# æ–¹å¼2ï¼šå‘½ä»¤è¡Œå‚æ•°
python app.py --env=dev

# æ–¹å¼3ï¼šé…ç½®æ–‡ä»¶
# config.ini
[app]
env=dev
```

---

### æ¦‚å¿µ2ï¼šç¯å¢ƒæ£€æµ‹

**ç¯å¢ƒæ£€æµ‹æ˜¯è¯»å–ç¯å¢ƒæ ‡è¯†ï¼Œç¡®å®šå½“å‰è¿è¡Œç¯å¢ƒçš„è¿‡ç¨‹ã€‚**

**æ£€æµ‹æ–¹å¼ï¼š**

```python
import os

# æ–¹å¼1ï¼šä»ç¯å¢ƒå˜é‡è¯»å–ï¼ˆæ¨èï¼‰
env = os.getenv("ENV", "dev")

# æ–¹å¼2ï¼šä»å‘½ä»¤è¡Œå‚æ•°è¯»å–
import sys
env = sys.argv[1] if len(sys.argv) > 1 else "dev"

# æ–¹å¼3ï¼šä»é…ç½®æ–‡ä»¶è¯»å–
import configparser
config = configparser.ConfigParser()
config.read("config.ini")
env = config.get("app", "env", fallback="dev")

# æ–¹å¼4ï¼šè‡ªåŠ¨æ£€æµ‹ï¼ˆæ ¹æ®ä¸»æœºåã€IPç­‰ï¼‰
import socket
hostname = socket.gethostname()
if "prod" in hostname:
    env = "prod"
elif "test" in hostname:
    env = "test"
else:
    env = "dev"
```

---

### æ¦‚å¿µ3ï¼šé…ç½®åˆ‡æ¢

**é…ç½®åˆ‡æ¢æ˜¯æ ¹æ®æ£€æµ‹åˆ°çš„ç¯å¢ƒï¼ŒåŠ è½½å¯¹åº”é…ç½®çš„è¿‡ç¨‹ã€‚**

**åˆ‡æ¢æ–¹å¼ï¼š**

```python
# æ–¹å¼1ï¼šå¤šä¸ª .env æ–‡ä»¶
import os
from dotenv import load_dotenv

env = os.getenv("ENV", "dev")
load_dotenv(f".env.{env}")

# æ–¹å¼2ï¼šæ¡ä»¶åŠ è½½
if env == "dev":
    load_dotenv(".env.dev")
elif env == "test":
    load_dotenv(".env.test")
elif env == "prod":
    load_dotenv(".env.prod")

# æ–¹å¼3ï¼šPydantic Settings è‡ªåŠ¨åˆ‡æ¢
from pydantic_settings import BaseSettings

class Settings(BaseSettings):
    database_url: str

    class Config:
        env_file = f".env.{os.getenv('ENV', 'dev')}"

settings = Settings()
```

---

## å®ç°æ–¹å¼

### æ–¹å¼1ï¼šåŸºäºç¯å¢ƒå˜é‡çš„åˆ‡æ¢

**æœ€ç®€å•çš„æ–¹å¼ï¼Œæ¨èç”¨äºå°å‹é¡¹ç›®ã€‚**

```python
# config.py
import os
from dotenv import load_dotenv

# æ£€æµ‹ç¯å¢ƒ
env = os.getenv("ENV", "dev")

# åŠ è½½å¯¹åº”çš„é…ç½®æ–‡ä»¶
dotenv_path = f".env.{env}"
load_dotenv(dotenv_path)

print(f"âœ… åŠ è½½é…ç½®æ–‡ä»¶: {dotenv_path}")
print(f"âœ… å½“å‰ç¯å¢ƒ: {env}")

# è¯»å–é…ç½®
DATABASE_URL = os.getenv("DATABASE_URL")
DEBUG = os.getenv("DEBUG", "False").lower() == "true"
```

**ä½¿ç”¨ï¼š**

```bash
# å¼€å‘ç¯å¢ƒ
ENV=dev python app.py

# æµ‹è¯•ç¯å¢ƒ
ENV=test python app.py

# ç”Ÿäº§ç¯å¢ƒ
ENV=prod python app.py
```

---

### æ–¹å¼2ï¼šåŸºäº Pydantic Settings çš„åˆ‡æ¢

**ç±»å‹å®‰å…¨ï¼Œæ¨èç”¨äºä¸­å¤§å‹é¡¹ç›®ã€‚**

```python
# config.py
import os
from enum import Enum
from pydantic_settings import BaseSettings

class Environment(str, Enum):
    DEV = "dev"
    TEST = "test"
    PROD = "prod"

class Settings(BaseSettings):
    # ç¯å¢ƒæ ‡è¯†
    env: Environment = Environment.DEV

    # åº”ç”¨é…ç½®
    database_url: str
    debug: bool = False

    class Config:
        # æ ¹æ®ç¯å¢ƒå˜é‡é€‰æ‹©é…ç½®æ–‡ä»¶
        env_file = f".env.{os.getenv('ENV', 'dev')}"

settings = Settings()

print(f"âœ… å½“å‰ç¯å¢ƒ: {settings.env}")
print(f"âœ… æ•°æ®åº“: {settings.database_url}")
print(f"âœ… è°ƒè¯•æ¨¡å¼: {settings.debug}")
```

---

### æ–¹å¼3ï¼šå¤šå±‚é…ç½®è¦†ç›–

**æ”¯æŒåŸºç¡€é…ç½® + ç¯å¢ƒç‰¹å®šé…ç½®çš„è¦†ç›–ã€‚**

```python
# config.py
import os
from dotenv import load_dotenv

# 1. åŠ è½½åŸºç¡€é…ç½®ï¼ˆæ‰€æœ‰ç¯å¢ƒå…±äº«ï¼‰
load_dotenv(".env")

# 2. åŠ è½½ç¯å¢ƒç‰¹å®šé…ç½®ï¼ˆè¦†ç›–åŸºç¡€é…ç½®ï¼‰
env = os.getenv("ENV", "dev")
load_dotenv(f".env.{env}", override=True)

print(f"âœ… åŠ è½½åŸºç¡€é…ç½®: .env")
print(f"âœ… åŠ è½½ç¯å¢ƒé…ç½®: .env.{env}")
```

**é…ç½®æ–‡ä»¶ï¼š**

```bash
# .envï¼ˆåŸºç¡€é…ç½®ï¼Œæ‰€æœ‰ç¯å¢ƒå…±äº«ï¼‰
APP_NAME=AI Agent API
LOG_LEVEL=INFO
MAX_CONNECTIONS=100

# .env.devï¼ˆå¼€å‘ç¯å¢ƒç‰¹å®šé…ç½®ï¼‰
DATABASE_URL=postgresql://localhost:5432/dev_db
DEBUG=True

# .env.prodï¼ˆç”Ÿäº§ç¯å¢ƒç‰¹å®šé…ç½®ï¼‰
DATABASE_URL=postgresql://prod-db:5432/prod_db
DEBUG=False
```

---

### æ–¹å¼4ï¼šé…ç½®å·¥å‚æ¨¡å¼

**é¢å‘å¯¹è±¡çš„é…ç½®ç®¡ç†ï¼Œé€‚åˆå¤æ‚é¡¹ç›®ã€‚**

```python
# config.py
import os
from abc import ABC, abstractmethod
from pydantic_settings import BaseSettings

class BaseConfig(BaseSettings):
    """åŸºç¡€é…ç½®ï¼ˆæ‰€æœ‰ç¯å¢ƒå…±äº«ï¼‰"""
    app_name: str = "AI Agent API"
    log_level: str = "INFO"

    class Config:
        env_file = ".env"

class DevelopmentConfig(BaseConfig):
    """å¼€å‘ç¯å¢ƒé…ç½®"""
    debug: bool = True
    database_url: str = "postgresql://localhost:5432/dev_db"

class TestConfig(BaseConfig):
    """æµ‹è¯•ç¯å¢ƒé…ç½®"""
    debug: bool = False
    database_url: str = "postgresql://test-db:5432/test_db"

class ProductionConfig(BaseConfig):
    """ç”Ÿäº§ç¯å¢ƒé…ç½®"""
    debug: bool = False
    database_url: str = "postgresql://prod-db:5432/prod_db"

# é…ç½®å·¥å‚
def get_config() -> BaseConfig:
    env = os.getenv("ENV", "dev")

    config_map = {
        "dev": DevelopmentConfig,
        "test": TestConfig,
        "prod": ProductionConfig
    }

    config_class = config_map.get(env, DevelopmentConfig)
    return config_class()

# ä½¿ç”¨
settings = get_config()
print(f"âœ… å½“å‰ç¯å¢ƒ: {os.getenv('ENV', 'dev')}")
print(f"âœ… æ•°æ®åº“: {settings.database_url}")
```

---

## ç¯å¢ƒæ£€æµ‹çš„æœ€ä½³å®è·µ

### å®è·µ1ï¼šä½¿ç”¨ç¯å¢ƒå˜é‡ä½œä¸ºç¯å¢ƒæ ‡è¯†

**æ¨èï¼š** ä½¿ç”¨ `ENV` ç¯å¢ƒå˜é‡

```bash
# è®¾ç½®ç¯å¢ƒ
export ENV=dev
export ENV=test
export ENV=prod
```

**ä¸æ¨èï¼š** ä½¿ç”¨å…¶ä»–åç§°ï¼ˆå¦‚ `ENVIRONMENT`ã€`APP_ENV`ï¼‰

```bash
# ä¸æ¨èï¼šåç§°ä¸ç»Ÿä¸€
export ENVIRONMENT=dev
export APP_ENV=dev
```

---

### å®è·µ2ï¼šæä¾›é»˜è®¤ç¯å¢ƒ

**æ€»æ˜¯æä¾›é»˜è®¤ç¯å¢ƒï¼ˆé€šå¸¸æ˜¯ `dev`ï¼‰ï¼Œé¿å…æœªè®¾ç½®ç¯å¢ƒæ—¶æŠ¥é”™ã€‚**

```python
# âœ… æ­£ç¡®ï¼šæä¾›é»˜è®¤ç¯å¢ƒ
env = os.getenv("ENV", "dev")

# âŒ é”™è¯¯ï¼šä¸æä¾›é»˜è®¤ç¯å¢ƒ
env = os.getenv("ENV")  # å¯èƒ½æ˜¯ None
```

---

### å®è·µ3ï¼šéªŒè¯ç¯å¢ƒæ ‡è¯†

**éªŒè¯ç¯å¢ƒæ ‡è¯†æ˜¯å¦åˆæ³•ï¼Œé¿å…æ‹¼å†™é”™è¯¯ã€‚**

```python
import os
from enum import Enum

class Environment(str, Enum):
    DEV = "dev"
    TEST = "test"
    PROD = "prod"

# è¯»å–ç¯å¢ƒ
env_str = os.getenv("ENV", "dev")

# éªŒè¯ç¯å¢ƒ
try:
    env = Environment(env_str)
except ValueError:
    raise ValueError(f"æ— æ•ˆçš„ç¯å¢ƒ: {env_str}ï¼Œæœ‰æ•ˆå€¼: {[e.value for e in Environment]}")

print(f"âœ… å½“å‰ç¯å¢ƒ: {env}")
```

---

### å®è·µ4ï¼šç¯å¢ƒç‰¹å®šçš„è¡Œä¸º

**æ ¹æ®ç¯å¢ƒè°ƒæ•´åº”ç”¨è¡Œä¸ºã€‚**

```python
from config import settings

# å¼€å‘ç¯å¢ƒï¼šå¯ç”¨è°ƒè¯•æ¨¡å¼
if settings.env == "dev":
    app = FastAPI(debug=True)
    logger.setLevel(logging.DEBUG)

# ç”Ÿäº§ç¯å¢ƒï¼šç¦ç”¨è°ƒè¯•æ¨¡å¼
elif settings.env == "prod":
    app = FastAPI(debug=False)
    logger.setLevel(logging.WARNING)
```

---

## å®é™…åº”ç”¨ç¤ºä¾‹

### ç¤ºä¾‹1ï¼šFastAPI åº”ç”¨çš„ç¯å¢ƒåˆ‡æ¢

```python
# config.py
import os
from enum import Enum
from pydantic_settings import BaseSettings

class Environment(str, Enum):
    DEV = "dev"
    TEST = "test"
    PROD = "prod"

class Settings(BaseSettings):
    env: Environment = Environment.DEV
    database_url: str
    debug: bool = False
    log_level: str = "INFO"

    class Config:
        env_file = f".env.{os.getenv('ENV', 'dev')}"

settings = Settings()

# main.py
from fastapi import FastAPI
from config import settings
import logging

# æ ¹æ®ç¯å¢ƒé…ç½®æ—¥å¿—
logging.basicConfig(level=settings.log_level)
logger = logging.getLogger(__name__)

# æ ¹æ®ç¯å¢ƒé…ç½®åº”ç”¨
app = FastAPI(
    title="AI Agent API",
    debug=settings.debug
)

@app.on_event("startup")
async def startup():
    logger.info(f"ğŸš€ å¯åŠ¨åº”ç”¨")
    logger.info(f"ğŸ“ ç¯å¢ƒ: {settings.env}")
    logger.info(f"ğŸ—„ï¸  æ•°æ®åº“: {settings.database_url}")
    logger.info(f"ğŸ› è°ƒè¯•æ¨¡å¼: {settings.debug}")

@app.get("/")
def read_root():
    return {
        "env": settings.env,
        "debug": settings.debug
    }
```

**é…ç½®æ–‡ä»¶ï¼š**

```bash
# .env.dev
DATABASE_URL=postgresql://localhost:5432/dev_db
DEBUG=True
LOG_LEVEL=DEBUG

# .env.test
DATABASE_URL=postgresql://test-db:5432/test_db
DEBUG=False
LOG_LEVEL=INFO

# .env.prod
DATABASE_URL=postgresql://prod-db:5432/prod_db
DEBUG=False
LOG_LEVEL=WARNING
```

**ä½¿ç”¨ï¼š**

```bash
# å¼€å‘ç¯å¢ƒ
ENV=dev uvicorn main:app --reload

# æµ‹è¯•ç¯å¢ƒ
ENV=test uvicorn main:app

# ç”Ÿäº§ç¯å¢ƒ
ENV=prod uvicorn main:app --host 0.0.0.0 --port 8000
```

---

### ç¤ºä¾‹2ï¼šæ•°æ®åº“è¿æ¥çš„ç¯å¢ƒåˆ‡æ¢

```python
# database.py
from sqlalchemy import create_engine
from sqlalchemy.orm import sessionmaker
from config import settings

# æ ¹æ®ç¯å¢ƒé…ç½®æ•°æ®åº“è¿æ¥æ± 
if settings.env == "dev":
    # å¼€å‘ç¯å¢ƒï¼šå°è¿æ¥æ± 
    engine = create_engine(
        settings.database_url,
        pool_size=5,
        max_overflow=10,
        echo=True  # æ‰“å° SQL
    )
elif settings.env == "prod":
    # ç”Ÿäº§ç¯å¢ƒï¼šå¤§è¿æ¥æ± 
    engine = create_engine(
        settings.database_url,
        pool_size=20,
        max_overflow=40,
        echo=False  # ä¸æ‰“å° SQL
    )

SessionLocal = sessionmaker(bind=engine)
```

---

### ç¤ºä¾‹3ï¼šLLM API çš„ç¯å¢ƒåˆ‡æ¢

```python
# llm.py
from openai import OpenAI
from config import settings

# æ ¹æ®ç¯å¢ƒé€‰æ‹© LLM é…ç½®
if settings.env == "dev":
    # å¼€å‘ç¯å¢ƒï¼šä½¿ç”¨ä¾¿å®œçš„æ¨¡å‹
    client = OpenAI(
        api_key=settings.openai_api_key,
        base_url=settings.openai_base_url
    )
    model = "gpt-3.5-turbo"
    temperature = 0.7

elif settings.env == "prod":
    # ç”Ÿäº§ç¯å¢ƒï¼šä½¿ç”¨é«˜è´¨é‡æ¨¡å‹
    client = OpenAI(
        api_key=settings.openai_api_key,
        base_url=settings.openai_base_url
    )
    model = "gpt-4"
    temperature = 0.5

def chat(message: str) -> str:
    response = client.chat.completions.create(
        model=model,
        messages=[{"role": "user", "content": message}],
        temperature=temperature
    )
    return response.choices[0].message.content
```

---

### ç¤ºä¾‹4ï¼šDocker ç¯å¢ƒåˆ‡æ¢

```dockerfile
# Dockerfile
FROM python:3.13
COPY . /app
WORKDIR /app
RUN pip install -r requirements.txt
CMD ["uvicorn", "app.main:app", "--host", "0.0.0.0"]
```

```yaml
# docker-compose.dev.ymlï¼ˆå¼€å‘ç¯å¢ƒï¼‰
services:
  api:
    build: .
    environment:
      - ENV=dev
    env_file:
      - .env.dev
    ports:
      - "8000:8000"
    volumes:
      - .:/app  # æŒ‚è½½ä»£ç ï¼Œæ”¯æŒçƒ­é‡è½½

# docker-compose.prod.ymlï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
services:
  api:
    build: .
    environment:
      - ENV=prod
    env_file:
      - .env.prod
    ports:
      - "80:8000"
    # ä¸æŒ‚è½½ä»£ç 
```

**ä½¿ç”¨ï¼š**

```bash
# å¼€å‘ç¯å¢ƒ
docker-compose -f docker-compose.dev.yml up

# ç”Ÿäº§ç¯å¢ƒ
docker-compose -f docker-compose.prod.yml up -d
```

---

## é«˜çº§ç‰¹æ€§

### ç‰¹æ€§1ï¼šç¯å¢ƒç»§æ‰¿

**å­ç¯å¢ƒç»§æ‰¿çˆ¶ç¯å¢ƒçš„é…ç½®ã€‚**

```python
# config.py
import os
from dotenv import load_dotenv

# 1. åŠ è½½åŸºç¡€é…ç½®
load_dotenv(".env")

# 2. åŠ è½½ç¯å¢ƒé…ç½®ï¼ˆè¦†ç›–åŸºç¡€é…ç½®ï¼‰
env = os.getenv("ENV", "dev")
load_dotenv(f".env.{env}", override=True)

# 3. åŠ è½½æœ¬åœ°é…ç½®ï¼ˆè¦†ç›–ç¯å¢ƒé…ç½®ï¼‰
load_dotenv(".env.local", override=True)
```

**é…ç½®æ–‡ä»¶ï¼š**

```bash
# .envï¼ˆåŸºç¡€é…ç½®ï¼‰
APP_NAME=AI Agent API
LOG_LEVEL=INFO

# .env.devï¼ˆå¼€å‘ç¯å¢ƒé…ç½®ï¼‰
DATABASE_URL=postgresql://localhost:5432/dev_db
DEBUG=True

# .env.localï¼ˆæœ¬åœ°é…ç½®ï¼Œä¸æäº¤åˆ° gitï¼‰
DATABASE_URL=postgresql://localhost:5433/my_local_db
```

---

### ç‰¹æ€§2ï¼šç¯å¢ƒè‡ªåŠ¨æ£€æµ‹

**æ ¹æ®ä¸»æœºåã€IPã€åŸŸåç­‰è‡ªåŠ¨æ£€æµ‹ç¯å¢ƒã€‚**

```python
import os
import socket

def detect_environment() -> str:
    """è‡ªåŠ¨æ£€æµ‹ç¯å¢ƒ"""

    # 1. ä¼˜å…ˆä½¿ç”¨ç¯å¢ƒå˜é‡
    if env := os.getenv("ENV"):
        return env

    # 2. æ ¹æ®ä¸»æœºåæ£€æµ‹
    hostname = socket.gethostname()
    if "prod" in hostname or "production" in hostname:
        return "prod"
    elif "test" in hostname or "testing" in hostname:
        return "test"
    elif "staging" in hostname:
        return "staging"

    # 3. æ ¹æ® IP æ£€æµ‹
    ip = socket.gethostbyname(hostname)
    if ip.startswith("10.0."):  # ç”Ÿäº§ç¯å¢ƒ IP æ®µ
        return "prod"
    elif ip.startswith("192.168."):  # å¼€å‘ç¯å¢ƒ IP æ®µ
        return "dev"

    # 4. é»˜è®¤å¼€å‘ç¯å¢ƒ
    return "dev"

env = detect_environment()
print(f"âœ… æ£€æµ‹åˆ°ç¯å¢ƒ: {env}")
```

---

### ç‰¹æ€§3ï¼šç¯å¢ƒé”å®š

**ç”Ÿäº§ç¯å¢ƒé”å®šï¼Œé˜²æ­¢è¯¯æ“ä½œã€‚**

```python
from config import settings

# ç”Ÿäº§ç¯å¢ƒé”å®š
if settings.env == "prod":
    # ç¦æ­¢å±é™©æ“ä½œ
    if settings.debug:
        raise ValueError("ç”Ÿäº§ç¯å¢ƒä¸èƒ½å¯ç”¨è°ƒè¯•æ¨¡å¼")

    # å¼ºåˆ¶ä½¿ç”¨ HTTPS
    if not settings.database_url.startswith("postgresql://"):
        raise ValueError("ç”Ÿäº§ç¯å¢ƒå¿…é¡»ä½¿ç”¨ PostgreSQL")

    # å¼ºåˆ¶è®¾ç½®å¯†é’¥
    if len(settings.secret_key) < 32:
        raise ValueError("ç”Ÿäº§ç¯å¢ƒå¯†é’¥é•¿åº¦å¿…é¡»è‡³å°‘ 32 å­—ç¬¦")
```

---

## å¸¸è§é—®é¢˜

### Q1: å¦‚ä½•åœ¨ Docker ä¸­åˆ‡æ¢ç¯å¢ƒï¼Ÿ

**A:** ä½¿ç”¨ç¯å¢ƒå˜é‡æˆ–ä¸åŒçš„ docker-compose æ–‡ä»¶ã€‚

```bash
# æ–¹å¼1ï¼šç¯å¢ƒå˜é‡
docker run -e ENV=prod my-api

# æ–¹å¼2ï¼šä¸åŒçš„ docker-compose æ–‡ä»¶
docker-compose -f docker-compose.prod.yml up
```

---

### Q2: å¦‚ä½•åœ¨ CI/CD ä¸­åˆ‡æ¢ç¯å¢ƒï¼Ÿ

**A:** åœ¨ CI/CD é…ç½®ä¸­è®¾ç½®ç¯å¢ƒå˜é‡ã€‚

```yaml
# .github/workflows/deploy.yml
jobs:
  deploy-dev:
    runs-on: ubuntu-latest
    steps:
      - name: Deploy to dev
        env:
          ENV: dev
        run: |
          python deploy.py

  deploy-prod:
    runs-on: ubuntu-latest
    steps:
      - name: Deploy to prod
        env:
          ENV: prod
        run: |
          python deploy.py
```

---

### Q3: å¦‚ä½•é¿å…åœ¨ç”Ÿäº§ç¯å¢ƒè¯¯ç”¨å¼€å‘é…ç½®ï¼Ÿ

**A:** ä½¿ç”¨ç¯å¢ƒéªŒè¯å’Œé”å®šæœºåˆ¶ã€‚

```python
from config import settings

# éªŒè¯ç”Ÿäº§ç¯å¢ƒé…ç½®
if settings.env == "prod":
    assert not settings.debug, "ç”Ÿäº§ç¯å¢ƒä¸èƒ½å¯ç”¨è°ƒè¯•æ¨¡å¼"
    assert "localhost" not in settings.database_url, "ç”Ÿäº§ç¯å¢ƒä¸èƒ½ä½¿ç”¨æœ¬åœ°æ•°æ®åº“"
    assert len(settings.secret_key) >= 32, "ç”Ÿäº§ç¯å¢ƒå¯†é’¥é•¿åº¦ä¸è¶³"
```

---

## æœ€ä½³å®è·µæ€»ç»“

### 1. ä½¿ç”¨ç¯å¢ƒå˜é‡ä½œä¸ºç¯å¢ƒæ ‡è¯†

```bash
export ENV=dev
export ENV=test
export ENV=prod
```

### 2. æä¾›é»˜è®¤ç¯å¢ƒ

```python
env = os.getenv("ENV", "dev")
```

### 3. éªŒè¯ç¯å¢ƒæ ‡è¯†

```python
from enum import Enum

class Environment(str, Enum):
    DEV = "dev"
    TEST = "test"
    PROD = "prod"

env = Environment(os.getenv("ENV", "dev"))
```

### 4. å¤šå±‚é…ç½®è¦†ç›–

```python
# åŸºç¡€é…ç½® â†’ ç¯å¢ƒé…ç½® â†’ æœ¬åœ°é…ç½®
load_dotenv(".env")
load_dotenv(f".env.{env}", override=True)
load_dotenv(".env.local", override=True)
```

### 5. ç¯å¢ƒç‰¹å®šçš„è¡Œä¸º

```python
if settings.env == "dev":
    app = FastAPI(debug=True)
elif settings.env == "prod":
    app = FastAPI(debug=False)
```

### 6. ç”Ÿäº§ç¯å¢ƒé”å®š

```python
if settings.env == "prod":
    assert not settings.debug
    assert "localhost" not in settings.database_url
```

---

## åœ¨ AI Agent åç«¯ä¸­çš„åº”ç”¨

### å®Œæ•´ç¤ºä¾‹

```python
# config.py
import os
from enum import Enum
from pydantic import Field, field_validator
from pydantic_settings import BaseSettings

class Environment(str, Enum):
    DEV = "dev"
    TEST = "test"
    PROD = "prod"

class Settings(BaseSettings):
    # ç¯å¢ƒæ ‡è¯†
    env: Environment = Environment.DEV

    # åº”ç”¨é…ç½®
    app_name: str = "AI Agent API"
    debug: bool = False
    log_level: str = "INFO"

    # æ•°æ®åº“é…ç½®
    database_url: str
    database_pool_size: int = 10

    # LLM é…ç½®
    openai_api_key: str
    openai_model: str = "gpt-4"

    # å®‰å…¨é…ç½®
    secret_key: str

    @field_validator("debug")
    @classmethod
    def validate_debug(cls, v: bool, info) -> bool:
        # ç”Ÿäº§ç¯å¢ƒä¸èƒ½å¯ç”¨è°ƒè¯•æ¨¡å¼
        if info.data.get("env") == Environment.PROD and v:
            raise ValueError("ç”Ÿäº§ç¯å¢ƒä¸èƒ½å¯ç”¨è°ƒè¯•æ¨¡å¼")
        return v

    @field_validator("database_url")
    @classmethod
    def validate_database_url(cls, v: str, info) -> str:
        # ç”Ÿäº§ç¯å¢ƒä¸èƒ½ä½¿ç”¨æœ¬åœ°æ•°æ®åº“
        if info.data.get("env") == Environment.PROD and "localhost" in v:
            raise ValueError("ç”Ÿäº§ç¯å¢ƒä¸èƒ½ä½¿ç”¨æœ¬åœ°æ•°æ®åº“")
        return v

    class Config:
        env_file = f".env.{os.getenv('ENV', 'dev')}"

settings = Settings()

# å¯åŠ¨æ—¶æ‰“å°ç¯å¢ƒä¿¡æ¯
print(f"âœ… ç¯å¢ƒ: {settings.env}")
print(f"âœ… æ•°æ®åº“: {settings.database_url}")
print(f"âœ… è°ƒè¯•æ¨¡å¼: {settings.debug}")
```

---

## æ€»ç»“

**ç¯å¢ƒæ£€æµ‹ä¸åˆ‡æ¢çš„æ ¸å¿ƒä»·å€¼ï¼š**

1. **è‡ªåŠ¨åŒ–**ï¼šæ ¹æ®ç¯å¢ƒè‡ªåŠ¨åŠ è½½é…ç½®ï¼Œæ— éœ€æ‰‹åŠ¨åˆ‡æ¢
2. **å®‰å…¨**ï¼šé¿å…åœ¨ç”Ÿäº§ç¯å¢ƒè¯¯ç”¨å¼€å‘é…ç½®
3. **çµæ´»**ï¼šæ”¯æŒå¤šå±‚é…ç½®è¦†ç›–
4. **å¯ç»´æŠ¤**ï¼šé…ç½®é›†ä¸­ç®¡ç†ï¼Œæ˜“äºç»´æŠ¤

**å®ç°æ–¹å¼ï¼š**
- ç¯å¢ƒå˜é‡ï¼š`ENV=dev`
- å¤šä¸ª .env æ–‡ä»¶ï¼š`.env.dev`ã€`.env.test`ã€`.env.prod`
- Pydantic Settingsï¼šç±»å‹å®‰å…¨çš„é…ç½®åˆ‡æ¢
- é…ç½®å·¥å‚ï¼šé¢å‘å¯¹è±¡çš„é…ç½®ç®¡ç†

**æœ€ä½³å®è·µï¼š**
- ä½¿ç”¨ `ENV` ç¯å¢ƒå˜é‡ä½œä¸ºç¯å¢ƒæ ‡è¯†
- æä¾›é»˜è®¤ç¯å¢ƒï¼ˆé€šå¸¸æ˜¯ `dev`ï¼‰
- éªŒè¯ç¯å¢ƒæ ‡è¯†æ˜¯å¦åˆæ³•
- æ ¹æ®ç¯å¢ƒè°ƒæ•´åº”ç”¨è¡Œä¸º
- ç”Ÿäº§ç¯å¢ƒé”å®šï¼Œé˜²æ­¢è¯¯æ“ä½œ
