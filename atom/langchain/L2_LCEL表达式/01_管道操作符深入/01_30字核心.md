# 30字核心

**管道操作符(|)通过__or__方法将Runnable组合成RunnableSequence，实现类型安全的声明式链式编程。**

---

## 核心要素拆解

### 1. 管道操作符 `|`
- Python 中的位运算符
- 在 LCEL 中被重载为组合操作符
- 语法：`a | b | c`

### 2. `__or__` 方法
- Python 魔法方法
- 实现 `|` 操作符的行为
- 定义在 Runnable 基类中

### 3. RunnableSequence
- LCEL 的核心执行容器
- 管理多个 Runnable 的顺序执行
- 优化的执行引擎（支持流式、批处理、并行）

### 4. 类型安全
- 基于 Python 类型提示
- Pydantic v2 模型验证
- IDE 自动补全支持

### 5. 声明式编程
- 描述"做什么"而非"怎么做"
- 函数式组合思想
- 可读性强、易维护

---

## 一句话记忆法

**想象工厂流水线**：
- 管道操作符 = 传送带
- Runnable = 工序
- RunnableSequence = 整条生产线
- 类型安全 = 质检系统

**代码示例**：
```python
# 这一行代码背后发生了什么？
chain = prompt | llm | parser

# 等价于：
# 1. prompt.__or__(llm) → RunnableSequence(first=prompt, last=llm)
# 2. sequence.__or__(parser) → RunnableSequence(first=sequence, last=parser)
# 3. 最终：RunnableSequence([prompt, llm, parser])
```

---

## 为什么这30字很重要？

### 1. 抓住本质
- 不是语法糖，是设计哲学
- 不是简单串联，是类型安全的组合
- 不是性能损失，是优化的执行引擎

### 2. 指导实践
- 理解原理 → 写出更好的代码
- 掌握类型 → 减少运行时错误
- 熟悉机制 → 优化性能瓶颈

### 3. 面试必备
- 高频考点：管道操作符的实现原理
- 区分度高：能否解释 `__or__` 方法
- 深度体现：是否理解 RunnableSequence

---

## 快速验证理解

**问自己3个问题**：

1. **`a | b` 调用了谁的 `__or__` 方法？**
   - 答案：`a` 的 `__or__` 方法，参数是 `b`

2. **RunnableSequence 和普通函数组合有什么区别？**
   - 答案：RunnableSequence 支持流式、批处理、类型推断、配置传递

3. **类型安全体现在哪里？**
   - 答案：输入输出类型匹配检查、Pydantic 模型验证、IDE 提示

---

**下一步**：阅读 `02_第一性原理.md` 深入理解为什么需要管道操作符
