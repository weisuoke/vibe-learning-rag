# 混合检索 - 概览

本文档是 Milvus 混合检索知识点的导航概览，帮助你快速了解学习路径和内容结构。

---

## 知识点定位

**层级**: L3_高级特性 / 02_混合检索

**前置知识**:
- L1_快速入门（所有知识点）
- L2_核心功能（所有知识点）
- L3_高级特性 / 01_分区管理

**后续知识**:
- 03_数据管理CRUD
- 04_动态Schema

---

## 核心内容

### 一句话核心

**混合检索是向量检索与标量过滤的组合策略，通过同时匹配语义相似度和精确条件，在 RAG 系统中实现更精准的知识召回。**

### 学习目标

学完本知识点，你将掌握：

1. **向量检索原理**: ANN 算法、索引类型、相似度度量
2. **标量过滤机制**: 表达式语法、执行引擎、索引优化
3. **执行策略**: Filter-then-Search vs Search-then-Filter
4. **性能优化**: 高选择性过滤、索引创建、分区组合
5. **RAG 应用**: 在 RAG 系统中使用混合检索

---

## 文档结构

### 基础维度 (8个文件, ~2,800行)

| 文件 | 内容 | 行数 |
|------|------|------|
| 01_30字核心.md | 一句话概括核心要点 | 5 |
| 02_第一性原理.md | 从第一性原理理解混合检索 | 450 |
| 06_最小可用.md | 最小可用操作集 | 350 |
| 07_双重类比.md | 前端类比 + 日常生活类比 | 450 |
| 08_反直觉点.md | 4个常见误区深入解析 | 450 |
| 15_化骨绵掌.md | 10个知识卡片快速掌握 | 500 |
| 16_一句话总结.md | 最终总结 | 5 |

### 核心概念 (3个文件, ~1,400行)

| 文件 | 内容 | 行数 |
|------|------|------|
| 03_核心概念_1_向量检索原理.md | ANN 算法、HNSW、IVF、相似度度量 | 450 |
| 04_核心概念_2_标量过滤机制.md | 表达式语法、执行引擎、索引优化 | 450 |
| 05_核心概念_3_混合检索执行策略.md | Filter-then-Search、Search-then-Filter、自动优化 | 500 |

### 实战代码 (5个文件, ~2,500行)

| 文件 | 内容 | 行数 |
|------|------|------|
| 09_实战代码_场景1_基础混合检索操作.md | 完整的基础工作流程 | 500 |
| 10_实战代码_场景2_复杂过滤条件组合.md | AND/OR/IN/范围查询等复杂表达式 | 500 |
| 11_实战代码_场景3_性能对比测试.md | 高选择性 vs 低选择性、有索引 vs 无索引 | 500 |
| 12_实战代码_场景4_RAG场景混合检索.md | 完整的 RAG 文档问答系统 | 500 |
| 13_实战代码_场景5_生产级混合检索系统.md | 生产级系统（缓存、监控、错误处理） | 500 |

### 面试准备 (1个文件, ~400行)

| 文件 | 内容 | 行数 |
|------|------|------|
| 14_面试必问.md | 5个常见面试问题深入解析 | 400 |

**总计**: 17个文件, ~7,100行

---

## 学习路径

### 快速入门路径 (30分钟)

```
01_30字核心 → 06_最小可用 → 09_实战代码_场景1 → 16_一句话总结
```

适合：快速了解基本操作流程

### 系统学习路径 (4小时)

```
01_30字核心
  ↓
02_第一性原理
  ↓
03_核心概念_1 → 04_核心概念_2 → 05_核心概念_3
  ↓
06_最小可用
  ↓
07_双重类比 → 08_反直觉点
  ↓
09_场景1 → 10_场景2 → 11_场景3 → 12_场景4 → 13_场景5
  ↓
16_一句话总结
```

适合：全面掌握混合检索

### 面试准备路径 (1小时)

```
01_30字核心 → 14_面试必问 → 15_化骨绵掌 → 16_一句话总结
```

适合：快速准备面试

---

## 核心知识点

### 1. 向量检索原理

- **ANN 算法**: HNSW（高召回率）、IVF_FLAT（低内存）、IVF_SQ8（量化压缩）
- **相似度度量**: L2 距离、内积（IP）、余弦相似度
- **性能对比**: HNSW QPS 5000+，召回率 95-99%

### 2. 标量过滤机制

- **表达式语法**: ==, >, <, in, and, or, not
- **执行引擎**: 表达式解析、选择性估算、索引优化
- **性能优化**: 为高选择性字段创建索引，性能提升 2-10 倍

### 3. 混合检索执行策略

- **Filter-then-Search**: 先过滤后检索，适合高选择性（> 90%）
- **Search-then-Filter**: 先检索后过滤，适合低选择性（< 50%）
- **自动优化**: Milvus 自动选择最优策略

### 4. 性能优化

- **高选择性过滤**: 性能提升 10-100 倍
- **标量索引**: 加速 2-10 倍
- **分区 + 标量过滤**: 加速 10-50 倍
- **Top-K 控制**: 推荐 10-100

### 5. RAG 应用

- **精准召回**: 30% → 90%+
- **性能优化**: 10-100 倍
- **数据安全**: 多租户隔离
- **上下文相关性**: 减少幻觉

---

## 关键参数速查

| 参数 | 推荐值 | 说明 |
|------|--------|------|
| 向量索引类型 | HNSW | 高召回率，适合 RAG |
| 相似度度量 | IP（OpenAI）/ L2（自定义） | 根据 Embedding 类型选择 |
| HNSW M | 16 | 每个节点的连接数 |
| HNSW efConstruction | 200 | 构建时的搜索深度 |
| HNSW ef | 64 | 查询时的搜索深度 |
| Top-K | 10-100 | 返回结果数量 |
| 过滤选择性阈值 | > 90% | Filter-then-Search |

---

## 常见问题

### Q1: 什么时候应该使用混合检索？

**A**: 当你需要同时满足"语义相似"和"精确条件"时。

**场景**：
- RAG 系统：查询"2024年Q1的销售报告"
- 多租户系统：租户数据隔离
- 内容推荐：语义相关 + 年龄分级

详见：**02_第一性原理.md**

### Q2: Filter-then-Search 和 Search-then-Filter 有什么区别？

**A**: 执行顺序不同，性能差异可达 10-100 倍。

**决策规则**：
- 过滤选择性 > 90% → Filter-then-Search（快 10-100 倍）
- 过滤选择性 < 50% → Search-then-Filter

详见：**05_核心概念_3_混合检索执行策略.md**

### Q3: 如何优化混合检索的性能？

**A**: 四个层面优化。

**优化策略**：
1. 索引层：标量索引 + 向量索引
2. 表达式层：高选择性条件前置，使用 IN
3. 架构层：分区 + 标量过滤组合
4. 数据层：维度、量化、分布

详见：**11_实战代码_场景3_性能对比测试.md**

### Q4: 混合检索在 RAG 系统中的作用是什么？

**A**: 决定最终答案的质量。

**四大价值**：
1. 精准召回：30% → 90%+
2. 性能优化：10-100 倍
3. 数据安全：多租户隔离
4. 上下文相关性：减少幻觉

详见：**12_实战代码_场景4_RAG场景混合检索.md**

### Q5: 常见误区有哪些？

**A**: 4个常见误区。

**误区列表**：
1. 标量过滤越多越好（低选择性反而慢）
2. 向量检索和标量过滤是独立的（实际深度融合）
3. Filter-then-Search 总是更快（取决于选择性）
4. 混合检索是简单叠加（实际是复杂系统）

详见：**08_反直觉点.md**

---

## 实战代码索引

### 场景 1: 基础混合检索操作

**文件**: 09_实战代码_场景1_基础混合检索操作.md

**内容**: 完整的 Milvus 混合检索工作流程（创建 → 插入 → 查询）

**适合**: 初学者理解基本操作

### 场景 2: 复杂过滤条件组合

**文件**: 10_实战代码_场景2_复杂过滤条件组合.md

**内容**: AND/OR/IN/范围查询等复杂表达式

**适合**: 掌握表达式语法

### 场景 3: 性能对比测试

**文件**: 11_实战代码_场景3_性能对比测试.md

**内容**: 高选择性 vs 低选择性、有索引 vs 无索引、性能对比

**适合**: 理解性能优化原理

### 场景 4: RAG 场景混合检索

**文件**: 12_实战代码_场景4_RAG场景混合检索.md

**内容**: 完整的 RAG 文档问答系统（Milvus + OpenAI）

**适合**: 构建 RAG 系统

### 场景 5: 生产级混合检索系统

**文件**: 13_实战代码_场景5_生产级混合检索系统.md

**内容**: 生产级系统（缓存、监控、错误处理、日志）

**适合**: 生产环境部署

---

## 学习建议

### 初学者

1. 先阅读 **01_30字核心** 了解整体
2. 跟着 **09_实战代码_场景1** 动手实践
3. 阅读 **07_双重类比** 加深理解
4. 查看 **15_化骨绵掌** 巩固知识

### 进阶学习者

1. 深入学习 **03-05 核心概念** 三个文件
2. 实践 **10-13 实战代码** 四个场景
3. 研究 **08_反直觉点** 避免踩坑
4. 准备 **14_面试必问** 应对面试

### RAG 开发者

1. 重点学习 **12_实战代码_场景4_RAG场景混合检索**
2. 理解 **05_核心概念_3_混合检索执行策略** 的优化策略
3. 掌握 **11_实战代码_场景3_性能对比测试** 的性能优化
4. 参考 **13_实战代码_场景5_生产级混合检索系统** 的生产实践

---

## 性能提升总结

| 优化策略 | 性能提升 | 适用场景 |
|---------|---------|---------|
| 高选择性过滤（99%） | 10-100x | 多租户、时间范围 |
| 标量索引 | 2-10x | 高选择性字段 |
| 分区 + 标量过滤 | 10-50x | 大规模数据 |
| 使用 IN 代替 OR | 15-20% | 多值匹配 |
| 控制 Top-K（10-100） | - | 所有场景 |

---

## 相关资源

### 官方文档

- [Milvus 混合检索文档](https://milvus.io/docs/search.md)
- [PyMilvus API 文档](https://milvus.io/api-reference/pymilvus/v2.3.x/Collection.md)

### 相关知识点

- **前置**: L1_快速入门, L2_核心功能, L3_高级特性/01_分区管理
- **后续**: 03_数据管理CRUD, 04_动态Schema

### 扩展阅读

- ANN 算法原理
- 向量数据库性能优化
- RAG 系统架构设计

---

## 更新日志

- **2026-02-09**: 初始版本，完整的混合检索知识点文档

---

**开始学习**: 建议从 **01_30字核心.md** 开始，然后根据你的学习目标选择合适的路径。
