# 30字核心

**OutputParser 是将 LLM 文本输出转换为结构化数据的解析器，是 AI Agent 实现类型安全和数据验证的核心基础。**

---

## 为什么需要 OutputParser？

LLM 的输出是**字符串**，但应用需要的是**结构化数据**（对象、列表、字典）。

OutputParser 解决了这个核心矛盾：
- **输入**：LLM 返回的文本字符串
- **输出**：Python 对象（Pydantic 模型、字典、列表等）
- **价值**：类型安全 + 数据验证 + 应用集成

---

## 2025-2026 现代方法

**优先使用 `with_structured_output()`**（LangChain 1.0+）

```python
from langchain_openai import ChatOpenAI
from pydantic import BaseModel

class Person(BaseModel):
    name: str
    age: int

llm = ChatOpenAI(model="gpt-4o")
structured_llm = llm.with_structured_output(Person)

# 直接返回 Pydantic 对象
result = structured_llm.invoke("Alice is 25 years old")
print(result)  # Person(name='Alice', age=25)
```

**传统 OutputParser**（兼容旧模型）

```python
from langchain.output_parsers import PydanticOutputParser

parser = PydanticOutputParser(pydantic_object=Person)
# 需要手动注入格式指令到 prompt
```

---

## 核心价值

1. **类型安全**：编译时类型检查，避免运行时错误
2. **数据验证**：自动验证字段类型、约束条件
3. **应用集成**：结构化数据可直接用于数据库、API、UI

---

**一句话记住**：OutputParser 把 LLM 的"文本输出"变成"可用对象"，2025+ 优先用 `with_structured_output()`。
