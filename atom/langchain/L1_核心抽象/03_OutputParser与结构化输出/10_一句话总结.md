# 一句话总结

**OutputParser 是 LangChain 中将 LLM 文本输出转换为结构化数据的解析器系统，通过 Pydantic V2 模型实现类型安全和数据验证，2025-2026 年推荐使用 `with_structured_output()` 方法利用模型原生工具调用能力，传统 PydanticOutputParser、JsonOutputParser、OutputFixingParser 和 RetryOutputParser 作为不支持原生结构化输出模型的兼容方案，在 RAG 应用中用于元数据提取，在 Agent 系统中用于工具响应格式化，是构建生产级 AI 应用的核心基础设施。**

---

## 核心要点总结

### 定义
OutputParser 是一套将 LLM 字符串输出解析为 Python 对象的协议和实现。

### 核心特征
- **协议化设计**：基于 `Runnable` 协议，支持 invoke/batch/stream
- **多层次方案**：从原生工具调用到 LLM 修复的多种策略
- **Pydantic 集成**：深度集成 Pydantic V2 实现验证
- **错误处理**：支持自动修复和重试机制

### 2025-2026 现代实践
- **优先方案**：`with_structured_output()` + Pydantic V2 模型
- **适用模型**：OpenAI GPT-4/4o、Anthropic Claude 3.5+
- **兼容方案**：PydanticOutputParser 用于旧模型
- **成本考量**：OutputFixingParser 增加额外 LLM 调用成本

### 实际应用价值
- **RAG 系统**：从文档中提取结构化元数据（实体、日期、关系）
- **Agent 工具**：格式化工具返回值为标准结构
- **数据管道**：批量处理文本转结构化数据
- **API 集成**：生成符合 API schema 的请求/响应

### 技术演进
- **2024 前**：手动 JSON 解析 + 字符串处理
- **2024-2025**：PydanticOutputParser 成为标准
- **2025-2026**：with_structured_output() 成为最佳实践
- **未来趋势**：更多模型支持原生结构化输出

---

**记住这句话**：OutputParser 让 LLM 从"会说话"变成"会返回数据"，是 AI 应用从 Demo 到生产的关键一步。
