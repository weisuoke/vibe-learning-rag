# å®æˆ˜ä»£ç _åœºæ™¯5ï¼šå¤šä»£ç†çŠ¶æ€åè°ƒ

> **ç›®æ ‡**ï¼šæ„å»ºå¤šAgentåä½œç³»ç»Ÿï¼Œå®ç°çŠ¶æ€å…±äº«å’Œå¹¶è¡Œæ‰§è¡Œ

---

## ä¸€ã€åœºæ™¯æè¿°

**éœ€æ±‚**ï¼šæ„å»ºç ”ç©¶åŠ©æ‰‹ç³»ç»Ÿï¼ŒåŒ…å«æœç´¢ã€åˆ†æã€å†™ä½œä¸‰ä¸ªAgent

**æ¶æ„**ï¼šä¸»ä»æ¨¡å¼ï¼ˆMaster-Workerï¼‰

---

## äºŒã€å®Œæ•´å®ç°

```python
from typing import TypedDict, List, Annotated
from langgraph.graph import StateGraph, START, END
from langchain_openai import ChatOpenAI
from langchain_core.messages import HumanMessage
import operator

# 1. å®šä¹‰å…±äº«çŠ¶æ€
class ResearchState(TypedDict):
    """ç ”ç©¶åŠ©æ‰‹çŠ¶æ€"""
    topic: str
    search_results: Annotated[List[str], operator.add]
    analysis: str
    report: str
    messages: Annotated[List[str], operator.add]

# 2. æœç´¢Agent
def search_agent(state: ResearchState) -> ResearchState:
    """æœç´¢Agent"""
    topic = state["topic"]
    print(f"ğŸ” æœç´¢Agent: æœç´¢ '{topic}'")

    # æ¨¡æ‹Ÿæœç´¢
    results = [
        f"èµ„æ–™1: {topic}çš„å®šä¹‰",
        f"èµ„æ–™2: {topic}çš„åº”ç”¨",
        f"èµ„æ–™3: {topic}çš„è¶‹åŠ¿"
    ]

    return {
        "search_results": results,
        "messages": [f"æœç´¢Agent: æ‰¾åˆ°{len(results)}æ¡èµ„æ–™"]
    }

# 3. åˆ†æAgent
def analysis_agent(state: ResearchState) -> ResearchState:
    """åˆ†æAgent"""
    results = state["search_results"]
    print(f"ğŸ“Š åˆ†æAgent: åˆ†æ {len(results)} æ¡èµ„æ–™")

    # ä½¿ç”¨LLMåˆ†æ
    llm = ChatOpenAI(model="gpt-4", temperature=0)
    prompt = f"""åˆ†æä»¥ä¸‹èµ„æ–™ï¼š

{chr(10).join(results)}

æå–å…³é”®ä¿¡æ¯ï¼š"""

    response = llm.invoke([HumanMessage(content=prompt)])
    analysis = response.content

    return {
        "analysis": analysis,
        "messages": ["åˆ†æAgent: å®Œæˆåˆ†æ"]
    }

# 4. å†™ä½œAgent
def writing_agent(state: ResearchState) -> ResearchState:
    """å†™ä½œAgent"""
    analysis = state["analysis"]
    print(f"ğŸ“ å†™ä½œAgent: ç”ŸæˆæŠ¥å‘Š")

    # ä½¿ç”¨LLMç”ŸæˆæŠ¥å‘Š
    llm = ChatOpenAI(model="gpt-4", temperature=0.7)
    prompt = f"""åŸºäºä»¥ä¸‹åˆ†æï¼Œæ’°å†™ç ”ç©¶æŠ¥å‘Šï¼š

{analysis}

æŠ¥å‘Šï¼š"""

    response = llm.invoke([HumanMessage(content=prompt)])
    report = response.content

    return {
        "report": report,
        "messages": ["å†™ä½œAgent: å®ŒæˆæŠ¥å‘Š"]
    }

# 5. æ„å»ºå¤šAgentå›¾
def create_research_system():
    """åˆ›å»ºç ”ç©¶åŠ©æ‰‹ç³»ç»Ÿ"""
    graph = StateGraph(ResearchState)

    # æ·»åŠ AgentèŠ‚ç‚¹
    graph.add_node("search", search_agent)
    graph.add_node("analysis", analysis_agent)
    graph.add_node("writing", writing_agent)

    # é¡ºåºæ‰§è¡Œ
    graph.add_edge(START, "search")
    graph.add_edge("search", "analysis")
    graph.add_edge("analysis", "writing")
    graph.add_edge("writing", END)

    return graph.compile()

# 6. ä½¿ç”¨ç¤ºä¾‹
if __name__ == "__main__":
    print("=== å¤šAgentç ”ç©¶åŠ©æ‰‹ ===\n")

    app = create_research_system()

    result = app.invoke({
        "topic": "LangGraphå¤šAgentç³»ç»Ÿ",
        "search_results": [],
        "analysis": "",
        "report": "",
        "messages": []
    })

    print("\n=== ç ”ç©¶æŠ¥å‘Š ===")
    print(result["report"])

    print("\n=== æ‰§è¡Œæ—¥å¿— ===")
    for msg in result["messages"]:
        print(f"  {msg}")
```

---

## ä¸‰ã€å¹¶è¡Œæ‰§è¡Œç‰ˆæœ¬

```python
def create_parallel_research_system():
    """åˆ›å»ºå¹¶è¡Œæ‰§è¡Œçš„ç ”ç©¶ç³»ç»Ÿ"""
    graph = StateGraph(ResearchState)

    # æ·»åŠ AgentèŠ‚ç‚¹
    graph.add_node("search1", search_agent)
    graph.add_node("search2", search_agent)
    graph.add_node("analysis", analysis_agent)
    graph.add_node("writing", writing_agent)

    # å¹¶è¡Œæœç´¢
    graph.add_edge(START, "search1")
    graph.add_edge(START, "search2")

    # ç­‰å¾…ä¸¤ä¸ªæœç´¢å®Œæˆ
    graph.add_edge(["search1", "search2"], "analysis")
    graph.add_edge("analysis", "writing")
    graph.add_edge("writing", END)

    return graph.compile()
```

---

## å››ã€æ€»ç»“

### æ ¸å¿ƒè¦ç‚¹

1. **å…±äº«çŠ¶æ€**ï¼šä½¿ç”¨Annotated + operator.addè‡ªåŠ¨åˆå¹¶
2. **å¹¶è¡Œæ‰§è¡Œ**ï¼šå¤šä¸ªAgentåŒæ—¶è¿è¡Œ
3. **çŠ¶æ€åè°ƒ**ï¼šLangGraphè‡ªåŠ¨å¤„ç†çŠ¶æ€åˆå¹¶
4. **æ¶ˆæ¯ä¼ é€’**ï¼šé€šè¿‡messageså­—æ®µé€šä¿¡

---

**ç‰ˆæœ¬**: v1.0
**æœ€åæ›´æ–°**: 2026-02-14
**ä»£ç è¡Œæ•°**: ~150è¡Œ
**å¯è¿è¡Œ**: âœ… Python 3.13+ (éœ€è¦OpenAI API Key)
