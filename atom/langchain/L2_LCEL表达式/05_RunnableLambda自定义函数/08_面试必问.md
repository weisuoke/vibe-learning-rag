# 08_é¢è¯•å¿…é—®

> **æœ¬æ–‡æ¡£æä¾› RunnableLambda çš„é«˜é¢‘é¢è¯•é—®é¢˜å’Œå‡ºå½©å›ç­”ï¼Œå¸®åŠ©ä½ åœ¨é¢è¯•ä¸­è„±é¢–è€Œå‡ºã€‚**

---

## é¢è¯•é—®é¢˜ 1ï¼šRunnableLambda å’Œç›´æ¥è°ƒç”¨å‡½æ•°æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

### âŒ æ™®é€šå›ç­”

**å›ç­”ï¼š**
> "RunnableLambda å¯ä»¥æŠŠå‡½æ•°å˜æˆ Runnableï¼Œç„¶åå°±èƒ½ç”¨åœ¨é“¾é‡Œäº†ã€‚ç›´æ¥è°ƒç”¨å‡½æ•°å°±æ˜¯æ™®é€šçš„å‡½æ•°è°ƒç”¨ã€‚"

**é—®é¢˜ï¼š**
- å¤ªç®€å•ï¼Œæ²¡æœ‰æ·±åº¦
- æ²¡æœ‰è¯´æ˜å…·ä½“çš„ä»·å€¼
- æ²¡æœ‰å±•ç¤ºå¯¹æ¡†æ¶çš„ç†è§£

**é¢è¯•å®˜å¯èƒ½çš„è¿½é—®ï¼š**
- "ä¸ºä»€ä¹ˆè¦è½¬æ¢æˆ Runnableï¼Ÿ"
- "å…·ä½“æœ‰ä»€ä¹ˆå¥½å¤„ï¼Ÿ"
- "ä»€ä¹ˆæ—¶å€™åº”è¯¥ç”¨ RunnableLambdaï¼Ÿ"

---

### âœ… å‡ºå½©å›ç­”

**å›ç­”ï¼š**
> **RunnableLambda æä¾›äº†ä¸‰å±‚ä»·å€¼ï¼š**
>
> **1. ç»Ÿä¸€æ¥å£**
> - å°†æ™®é€šå‡½æ•°é€‚é…åˆ° Runnable åè®®ï¼Œæ”¯æŒ invokeã€batchã€stream ç­‰æ ‡å‡†æ–¹æ³•
> - è®©è‡ªå®šä¹‰é€»è¾‘è·å¾—ä¸ ChatModelã€PromptTemplate ç­‰å†…ç½®ç»„ä»¶ç›¸åŒçš„è°ƒç”¨æ–¹å¼
>
> **2. ç»„åˆæ€§**
> - é€šè¿‡ | æ“ä½œç¬¦ä¸å…¶ä»– Runnable æ— ç¼ç»„åˆï¼Œæ„å»ºå¤æ‚çš„å¤„ç†é“¾
> - æ”¯æŒå£°æ˜å¼ç¼–ç¨‹ï¼Œæè¿°"åšä»€ä¹ˆ"è€Œä¸æ˜¯"æ€ä¹ˆåš"
>
> **3. ç”Ÿäº§çº§ç‰¹æ€§**
> - è‡ªåŠ¨è·å¾—é‡è¯•ï¼ˆwith_retryï¼‰ã€é™çº§ï¼ˆwith_fallbacksï¼‰ã€é…ç½®ä¼ é€’ç­‰ä¼ä¸šçº§èƒ½åŠ›
> - æ”¯æŒå¼‚æ­¥ä¼˜åŒ–ï¼ˆé€šè¿‡ afunc å‚æ•°å®ç° 10-20x æ€§èƒ½æå‡ï¼‰
> - å†…ç½®å›è°ƒå’Œè¿½è¸ªæœºåˆ¶ï¼Œä¾¿äºç›‘æ§å’Œè°ƒè¯•
>
> **ä¸ç›´æ¥è°ƒç”¨çš„å¯¹æ¯”ï¼š**
>
> ```python
> # ç›´æ¥è°ƒç”¨ï¼šç®€å•ä½†å­¤ç«‹
> result = func1(input)
> result = func2(result)
> result = func3(result)
>
> # RunnableLambdaï¼šå¯ç»„åˆã€å¯é…ç½®ã€å¯è§‚æµ‹
> chain = (
>     RunnableLambda(func1)
>     | RunnableLambda(func2)
>     | RunnableLambda(func3)
> ).with_retry(stop_after_attempt=3)
>
> result = chain.invoke(input)
> ```
>
> **åœ¨å®é™…å·¥ä½œä¸­çš„åº”ç”¨ï¼š**
> - MUFG é“¶è¡Œä½¿ç”¨ RunnableLambda åŠ¨æ€è°ƒæ•´ RAG é“¾ï¼Œå®ç°å¤–æ±‡é”€å”®ç ”ç©¶æ•ˆç‡æå‡ 10 å€
> - å…³é”®æ˜¯åˆ©ç”¨äº† RunnableLambda çš„çµæ´»æ€§å’Œç”Ÿäº§çº§ç‰¹æ€§ï¼Œè€Œä¸ä»…ä»…æ˜¯ç®€å•çš„å‡½æ•°åŒ…è£…

---

### ä¸ºä»€ä¹ˆè¿™ä¸ªå›ç­”å‡ºå½©

**1. ç»“æ„æ¸…æ™°**
- ä¸‰å±‚ä»·å€¼ï¼šç»Ÿä¸€æ¥å£ã€ç»„åˆæ€§ã€ç”Ÿäº§çº§ç‰¹æ€§
- æ¯å±‚éƒ½æœ‰å…·ä½“è¯´æ˜
- é€»è¾‘é€’è¿›ï¼Œå±‚æ¬¡åˆ†æ˜

**2. å¯¹æ¯”è¯´æ˜**
- ç›´æ¥å¯¹æ¯”ç›´æ¥è°ƒç”¨å’Œ RunnableLambda
- ç”¨ä»£ç ç¤ºä¾‹å±•ç¤ºå·®å¼‚
- è®©é¢è¯•å®˜ç›´è§‚ç†è§£ä»·å€¼

**3. æ·±åº¦ç†è§£**
- ä¸ä»…è¯´"æ˜¯ä»€ä¹ˆ"ï¼Œè¿˜è¯´"ä¸ºä»€ä¹ˆ"
- å±•ç¤ºå¯¹ Runnable åè®®çš„ç†è§£
- å±•ç¤ºå¯¹æ¡†æ¶è®¾è®¡çš„è®¤çŸ¥

**4. ç”Ÿäº§æ¡ˆä¾‹**
- å¼•ç”¨ MUFG é“¶è¡Œçš„çœŸå®æ¡ˆä¾‹
- å…·ä½“çš„æ•ˆæœæ•°æ®ï¼ˆ10 å€æå‡ï¼‰
- å±•ç¤ºå®é™…åº”ç”¨ç»éªŒ

**5. æŠ€æœ¯ç»†èŠ‚**
- æåˆ° afunc å‚æ•°å’Œæ€§èƒ½ä¼˜åŒ–
- æåˆ° with_retryã€with_fallbacks ç­‰ç‰¹æ€§
- å±•ç¤ºå¯¹æŠ€æœ¯ç»†èŠ‚çš„æŒæ¡

---

## é¢è¯•é—®é¢˜ 2ï¼šå¦‚ä½•ä¼˜åŒ– RunnableLambda çš„å¼‚æ­¥æ€§èƒ½ï¼Ÿ

### âŒ æ™®é€šå›ç­”

**å›ç­”ï¼š**
> "ä½¿ç”¨ ainvoke æ–¹æ³•å°±å¯ä»¥å¼‚æ­¥è°ƒç”¨äº†ï¼Œæ€§èƒ½ä¼šæ›´å¥½ã€‚"

**é—®é¢˜ï¼š**
- é”™è¯¯ç†è§£ï¼šainvoke ä¸ä¸€å®šæ€§èƒ½å¥½
- æ²¡æœ‰è¯´æ˜ä¼˜åŒ–æ–¹æ³•
- æ²¡æœ‰å±•ç¤ºå¯¹å¼‚æ­¥æœºåˆ¶çš„ç†è§£

**é¢è¯•å®˜å¯èƒ½çš„è¿½é—®ï¼š**
- "ainvoke çš„æ€§èƒ½ä¸€å®šå¥½å—ï¼Ÿ"
- "å¦‚ä½•è¿›ä¸€æ­¥ä¼˜åŒ–ï¼Ÿ"
- "æœ‰æ²¡æœ‰é‡åˆ°è¿‡æ€§èƒ½é—®é¢˜ï¼Ÿ"

---

### âœ… å‡ºå½©å›ç­”

**å›ç­”ï¼š**
> **RunnableLambda çš„å¼‚æ­¥æ€§èƒ½ä¼˜åŒ–æœ‰ä¸‰ä¸ªå…³é”®ç‚¹ï¼š**
>
> **1. ç†è§£é»˜è®¤çš„å§”æ‰˜æœºåˆ¶**
> - é»˜è®¤æƒ…å†µä¸‹ï¼Œainvoke é€šè¿‡çº¿ç¨‹æ± å§”æ‰˜åŒæ­¥å‡½æ•°
> - è¿™ä¸æ˜¯çœŸæ­£çš„å¼‚æ­¥ï¼Œæœ‰ä¸Šä¸‹æ–‡åˆ‡æ¢å¼€é”€
> - æ€§èƒ½æ¯”çœŸæ­£çš„å¼‚æ­¥å·® 10-20 å€
>
> **2. æä¾›ç‹¬ç«‹çš„ afunc å‚æ•°**
>
> ```python
> import asyncio
> from langchain_core.runnables import RunnableLambda
>
> # åŒæ­¥å‡½æ•°ï¼ˆç”¨äºåŒæ­¥è°ƒç”¨ï¼‰
> def sync_process(text: str) -> str:
>     return text.upper()
>
> # å¼‚æ­¥å‡½æ•°ï¼ˆç”¨äºå¼‚æ­¥è°ƒç”¨ï¼‰
> async def async_process(text: str) -> str:
>     await asyncio.sleep(0.1)  # çœŸæ­£çš„å¼‚æ­¥ I/O
>     return text.upper()
>
> # åŒæ—¶æä¾›ä¸¤ä¸ªå‡½æ•°
> runnable = RunnableLambda(sync_process, afunc=async_process)
>
> # å¼‚æ­¥è°ƒç”¨ç›´æ¥ä½¿ç”¨ afuncï¼Œæ€§èƒ½æå‡ 10-20x
> result = await runnable.ainvoke("hello")
> ```
>
> **3. é…åˆ abatch å’Œä¿¡å·é‡é¿å…é™æµ**
>
> ```python
> # æ‰¹é‡å¼‚æ­¥å¤„ç†ï¼Œæ§åˆ¶å¹¶å‘æ•°
> semaphore = asyncio.Semaphore(10)  # é™åˆ¶å¹¶å‘ä¸º 10
>
> async def process_batch(inputs: list[str]):
>     async with semaphore:
>         return await runnable.abatch(inputs)
>
> # é¿å…è§¦å‘ API é™æµ
> results = await process_batch(large_input_list)
> ```
>
> **æ€§èƒ½éªŒè¯ï¼š**
> - åœ¨ MUFG é“¶è¡Œçš„æ¡ˆä¾‹ä¸­ï¼Œé€šè¿‡æä¾› afunc å’Œä¼˜åŒ–æ‰¹å¤„ç†ï¼Œå®ç°äº† 10 å€æ•ˆç‡æå‡
> - å…³é”®æ˜¯ç†è§£ sync â†’ async å§”æ‰˜çš„æ€§èƒ½ä»£ä»·ï¼Œå¹¶æä¾›çœŸæ­£çš„å¼‚æ­¥å®ç°
>
> **å†³ç­–æ ‘ï¼š**
> ```
> éœ€è¦å¼‚æ­¥è°ƒç”¨ï¼Ÿ
> â”œâ”€ å¦ â†’ åªæä¾› func
> â””â”€ æ˜¯ â†’ é«˜å¹¶å‘åœºæ™¯ï¼ˆ10+ å¹¶å‘ï¼‰ï¼Ÿ
>    â”œâ”€ æ˜¯ â†’ âœ… å¿…é¡»æä¾› afunc
>    â””â”€ å¦ â†’ âš ï¸ å¯é€‰æä¾› afunc
> ```

---

### ä¸ºä»€ä¹ˆè¿™ä¸ªå›ç­”å‡ºå½©

**1. æ­ç¤ºå¸¸è§è¯¯åŒº**
- æŒ‡å‡º ainvoke ä¸ä¸€å®šæ€§èƒ½å¥½
- è§£é‡Šé»˜è®¤å§”æ‰˜æœºåˆ¶çš„é—®é¢˜
- å±•ç¤ºå¯¹åº•å±‚å®ç°çš„ç†è§£

**2. æä¾›å…·ä½“æ–¹æ¡ˆ**
- ä¸‰ä¸ªå…³é”®ç‚¹ï¼šç†è§£æœºåˆ¶ã€æä¾› afuncã€é…åˆ abatch
- æ¯ä¸ªç‚¹éƒ½æœ‰ä»£ç ç¤ºä¾‹
- å¯ä»¥ç›´æ¥åº”ç”¨åˆ°å®é™…å·¥ä½œä¸­

**3. æ€§èƒ½æ•°æ®æ”¯æŒ**
- æåˆ° 10-20x çš„æ€§èƒ½æå‡
- å¼•ç”¨ MUFG é“¶è¡Œçš„çœŸå®æ¡ˆä¾‹
- ç”¨æ•°æ®è¯´è¯ï¼Œæ›´æœ‰è¯´æœåŠ›

**4. å†³ç­–æ ‘æŒ‡å¯¼**
- æä¾›æ¸…æ™°çš„å†³ç­–é€»è¾‘
- å¸®åŠ©é¢è¯•å®˜ç†è§£ä½•æ—¶éœ€è¦ä¼˜åŒ–
- å±•ç¤ºç³»ç»Ÿæ€§æ€è€ƒèƒ½åŠ›

**5. ç”Ÿäº§ç¯å¢ƒç»éªŒ**
- æåˆ°ä¿¡å·é‡æ§åˆ¶å¹¶å‘
- æåˆ°é¿å… API é™æµ
- å±•ç¤ºå®é™…é¡¹ç›®ç»éªŒ

---

## é¢è¯•é—®é¢˜ 3ï¼šä»€ä¹ˆæ—¶å€™åº”è¯¥ä½¿ç”¨ RunnableLambdaï¼Œä»€ä¹ˆæ—¶å€™ä¸åº”è¯¥ï¼Ÿ

### âŒ æ™®é€šå›ç­”

**å›ç­”ï¼š**
> "éœ€è¦åœ¨é“¾ä¸­ä½¿ç”¨è‡ªå®šä¹‰å‡½æ•°çš„æ—¶å€™å°±ç”¨ RunnableLambdaã€‚"

**é—®é¢˜ï¼š**
- å¤ªç¬¼ç»Ÿï¼Œæ²¡æœ‰å…·ä½“æ ‡å‡†
- æ²¡æœ‰è¯´æ˜ä¸é€‚åˆçš„åœºæ™¯
- æ²¡æœ‰å±•ç¤ºåˆ¤æ–­èƒ½åŠ›

---

### âœ… å‡ºå½©å›ç­”

**å›ç­”ï¼š**
> **ä½¿ç”¨ RunnableLambda çš„å†³ç­–æ ‡å‡†ï¼š**
>
> **âœ… é€‚åˆä½¿ç”¨çš„åœºæ™¯ï¼š**
>
> **1. ç®€å•çš„æ•°æ®è½¬æ¢ï¼ˆ1-2 è¡Œé€»è¾‘ï¼‰**
> ```python
> # âœ… å¥½ï¼šç®€å•æ¸…æ™°
> chain = RunnableLambda(lambda x: x.upper()) | model
> ```
>
> **2. éœ€è¦ Runnable çš„æ ‡å‡†æ¥å£**
> - æ‰¹å¤„ç†ï¼ˆbatchï¼‰
> - å¼‚æ­¥è°ƒç”¨ï¼ˆainvokeï¼‰
> - é”™è¯¯é‡è¯•ï¼ˆwith_retryï¼‰
> - ä¸å…¶ä»– Runnable ç»„åˆ
>
> **3. ä¸šåŠ¡ç‰¹å®šçš„å¤„ç†é€»è¾‘**
> - å†…ç½®ç»„ä»¶æ— æ³•æ»¡è¶³éœ€æ±‚
> - éœ€è¦é›†æˆç¬¬ä¸‰æ–¹æœåŠ¡
> - éœ€è¦ç‰¹æ®Šçš„æ•°æ®æ ¼å¼è½¬æ¢
>
> **âŒ ä¸é€‚åˆä½¿ç”¨çš„åœºæ™¯ï¼š**
>
> **1. å¤æ‚é€»è¾‘ï¼ˆ3+ è¡Œï¼‰**
> ```python
> # âŒ å·®ï¼šéš¾ä»¥ç†è§£å’Œç»´æŠ¤
> chain = RunnableLambda(lambda x: {
>     "key1": complex_logic_1(x),
>     "key2": complex_logic_2(x),
>     "key3": complex_logic_3(x)
> })
>
> # âœ… å¥½ï¼šä½¿ç”¨è‡ªå®šä¹‰ Runnable ç±»
> class ComplexProcessor(Runnable):
>     def invoke(self, input):
>         return {
>             "key1": self._process_1(input),
>             "key2": self._process_2(input),
>             "key3": self._process_3(input)
>         }
> ```
>
> **2. éœ€è¦å¤æ‚çŠ¶æ€ç®¡ç†**
> - RunnableLambda æ˜¯æ— çŠ¶æ€çš„
> - éœ€è¦çŠ¶æ€æ—¶ä½¿ç”¨ RunnableGenerator æˆ–è‡ªå®šä¹‰ç±»
>
> **3. éœ€è¦çœŸæ­£çš„æµå¼è¾“å‡º**
> - RunnableLambda çš„ stream é»˜è®¤å§”æ‰˜ invoke
> - éœ€è¦æµå¼è¾“å‡ºæ—¶ä½¿ç”¨ RunnableGenerator
>
> **å†³ç­–æ ‘ï¼š**
> ```
> é€»è¾‘å¤æ‚åº¦ï¼Ÿ
> â”œâ”€ ç®€å•ï¼ˆ1-2 è¡Œï¼‰â†’ âœ… RunnableLambda
> â”œâ”€ ä¸­ç­‰ï¼ˆ3-5 è¡Œï¼‰â†’ âœ… å‘½åå‡½æ•° + RunnableLambda
> â””â”€ å¤æ‚ï¼ˆ6+ è¡Œï¼‰â†’ âœ… è‡ªå®šä¹‰ Runnable ç±»
>
> éœ€è¦çŠ¶æ€ç®¡ç†ï¼Ÿ
> â”œâ”€ æ˜¯ â†’ âŒ ä¸ç”¨ RunnableLambda
> â””â”€ å¦ â†’ âœ… å¯ä»¥ç”¨ RunnableLambda
>
> éœ€è¦æµå¼è¾“å‡ºï¼Ÿ
> â”œâ”€ æ˜¯ â†’ âŒ ä¸ç”¨ RunnableLambda
> â””â”€ å¦ â†’ âœ… å¯ä»¥ç”¨ RunnableLambda
> ```
>
> **ç”Ÿäº§ç¯å¢ƒæ•™è®­ï¼š**
> - æ ¹æ® "Lessons Learned with LangChain" ç­‰æ–‡ç« ï¼Œè¿‡åº¦ä½¿ç”¨ RunnableLambda æ˜¯æœ€å¸¸è§çš„åæ¨¡å¼ä¹‹ä¸€
> - å…³é”®æ˜¯å¹³è¡¡çµæ´»æ€§å’Œå¯è¯»æ€§ï¼Œç®€å•åœºæ™¯ç”¨ RunnableLambdaï¼Œå¤æ‚åœºæ™¯ç”¨è‡ªå®šä¹‰ç±»

---

### ä¸ºä»€ä¹ˆè¿™ä¸ªå›ç­”å‡ºå½©

**1. å…¨é¢çš„å†³ç­–æ ‡å‡†**
- é€‚åˆçš„åœºæ™¯ï¼ˆ3 ä¸ªï¼‰
- ä¸é€‚åˆçš„åœºæ™¯ï¼ˆ3 ä¸ªï¼‰
- æ¯ä¸ªåœºæ™¯éƒ½æœ‰è¯´æ˜å’Œç¤ºä¾‹

**2. å¯¹æ¯”ä»£ç ç¤ºä¾‹**
- å¥½çš„ç”¨æ³• vs å·®çš„ç”¨æ³•
- è®©é¢è¯•å®˜ç›´è§‚ç†è§£å·®å¼‚
- å±•ç¤ºä»£ç å“å‘³

**3. å¤šç»´åº¦å†³ç­–æ ‘**
- é€»è¾‘å¤æ‚åº¦
- çŠ¶æ€ç®¡ç†éœ€æ±‚
- æµå¼è¾“å‡ºéœ€æ±‚
- ç³»ç»Ÿæ€§çš„æ€è€ƒæ¡†æ¶

**4. ç”Ÿäº§ç¯å¢ƒç»éªŒ**
- å¼•ç”¨ä¸šç•Œæ–‡ç« 
- æåˆ°å¸¸è§åæ¨¡å¼
- å±•ç¤ºå¯¹æœ€ä½³å®è·µçš„äº†è§£

**5. å¹³è¡¡æ€§æ€è€ƒ**
- ä¸æ˜¯ç®€å•çš„"ç”¨"æˆ–"ä¸ç”¨"
- å¼ºè°ƒå¹³è¡¡çµæ´»æ€§å’Œå¯è¯»æ€§
- å±•ç¤ºæˆç†Ÿçš„å·¥ç¨‹åˆ¤æ–­

---

## åŠ åˆ†é¡¹ï¼šä¸»åŠ¨å±•ç¤ºæ·±åº¦ç†è§£

### å¦‚æœé¢è¯•å®˜é—®ï¼š"ä½ å¯¹ RunnableLambda è¿˜æœ‰ä»€ä¹ˆç†è§£ï¼Ÿ"

**å¯ä»¥ä¸»åŠ¨æåˆ°ï¼š**

**1. è®¾è®¡æ¨¡å¼å±‚é¢**
> "RunnableLambda æ˜¯é€‚é…å™¨æ¨¡å¼çš„å…¸å‹åº”ç”¨ï¼Œå®ƒä¸æ”¹å˜åŸå‡½æ•°ï¼Œåªæ˜¯æä¾›æ–°çš„æ¥å£é€‚é…ã€‚è¿™ç§è®¾è®¡è®© LangChain å¯ä»¥ä¿æŒç»Ÿä¸€çš„ Runnable åè®®ï¼ŒåŒæ—¶æ”¯æŒä»»æ„è‡ªå®šä¹‰é€»è¾‘ã€‚"

**2. æ€§èƒ½ä¼˜åŒ–å±‚é¢**
> "æˆ‘åœ¨å®é™…é¡¹ç›®ä¸­å‘ç°ï¼ŒRunnableLambda çš„å¼‚æ­¥æ€§èƒ½æ˜¯ä¸€ä¸ªå¸¸è§é™·é˜±ã€‚é»˜è®¤çš„çº¿ç¨‹æ± å§”æ‰˜ä¼šå¯¼è‡´æ€§èƒ½ä¸‹é™ 10-20 å€ã€‚é€šè¿‡æä¾›ç‹¬ç«‹çš„ afunc å‚æ•°ï¼Œå¯ä»¥å®ç°çœŸæ­£çš„å¼‚æ­¥ï¼Œè¿™åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹éå¸¸å…³é”®ã€‚"

**3. æ¶æ„è®¾è®¡å±‚é¢**
> "RunnableLambda ä½“ç°äº† LangChain çš„ç»„åˆä¼˜äºç»§æ‰¿çš„è®¾è®¡å“²å­¦ã€‚ç›¸æ¯”äºè®©ç”¨æˆ·ç»§æ‰¿ Runnable ç±»ï¼Œé€šè¿‡å‡½æ•°ç»„åˆçš„æ–¹å¼æ›´çµæ´»ã€æ›´ç®€æ´ã€‚è¿™ä¹Ÿæ˜¯å‡½æ•°å¼ç¼–ç¨‹æ€æƒ³åœ¨æ¡†æ¶è®¾è®¡ä¸­çš„åº”ç”¨ã€‚"

**4. ç”Ÿäº§å®è·µå±‚é¢**
> "åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œæˆ‘ä¼šéµå¾ªä¸€ä¸ªåŸåˆ™ï¼šç®€å•é€»è¾‘ç”¨ RunnableLambdaï¼Œå¤æ‚é€»è¾‘ç”¨è‡ªå®šä¹‰ Runnable ç±»ã€‚è¿™æ ·å¯ä»¥å¹³è¡¡çµæ´»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚MUFG é“¶è¡Œçš„æ¡ˆä¾‹ä¹ŸéªŒè¯äº†è¿™ä¸ªåŸåˆ™çš„æœ‰æ•ˆæ€§ã€‚"

---

## é¢è¯•å‡†å¤‡å»ºè®®

### æŠ€æœ¯æ·±åº¦å‡†å¤‡

**1. ç†è§£æ ¸å¿ƒæ¦‚å¿µ**
- Runnable åè®®çš„è®¾è®¡
- é€‚é…å™¨æ¨¡å¼çš„åº”ç”¨
- å¼‚æ­¥å§”æ‰˜æœºåˆ¶

**2. æŒæ¡æ€§èƒ½ä¼˜åŒ–**
- afunc å‚æ•°çš„ä½œç”¨
- 10-20x æ€§èƒ½æå‡çš„åŸç†
- æ‰¹å¤„ç†å’Œå¹¶å‘æ§åˆ¶

**3. äº†è§£å¸¸è§é™·é˜±**
- å¼‚æ­¥æ€§èƒ½é™·é˜±
- æµå¼è¾“å‡ºè¯¯åŒº
- è¿‡åº¦ä½¿ç”¨é—®é¢˜

### å®æˆ˜ç»éªŒå‡†å¤‡

**1. å‡†å¤‡ä»£ç ç¤ºä¾‹**
- ç®€å•çš„æ•°æ®è½¬æ¢
- å¤æ‚çš„ä¸šåŠ¡é€»è¾‘å¤„ç†
- æ€§èƒ½ä¼˜åŒ–æ¡ˆä¾‹

**2. å‡†å¤‡çœŸå®æ¡ˆä¾‹**
- MUFG é“¶è¡Œæ¡ˆä¾‹ï¼ˆ10 å€æ•ˆç‡æå‡ï¼‰
- è‡ªå·±çš„é¡¹ç›®ç»éªŒ
- é‡åˆ°çš„é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ

**3. å‡†å¤‡å¯¹æ¯”åˆ†æ**
- RunnableLambda vs ç›´æ¥è°ƒç”¨
- RunnableLambda vs è‡ªå®šä¹‰ç±»
- ä¸åŒåœºæ™¯çš„é€‰æ‹©æ ‡å‡†

### æ²Ÿé€šæŠ€å·§å‡†å¤‡

**1. ç»“æ„åŒ–è¡¨è¾¾**
- å…ˆè¯´ç»“è®ºï¼Œå†è¯´åŸå› 
- åˆ†å±‚æ¬¡è¯´æ˜ï¼ˆä¸‰å±‚ä»·å€¼ã€ä¸‰ä¸ªåœºæ™¯ï¼‰
- ç”¨ä»£ç ç¤ºä¾‹æ”¯æŒè§‚ç‚¹

**2. æ•°æ®æ”¯æŒ**
- æ€§èƒ½æå‡æ•°æ®ï¼ˆ10-20xï¼‰
- çœŸå®æ¡ˆä¾‹æ•°æ®ï¼ˆMUFG 10 å€ï¼‰
- å¯¹æ¯”å®éªŒç»“æœ

**3. å±•ç¤ºæ€è€ƒæ·±åº¦**
- ä¸ä»…è¯´"æ˜¯ä»€ä¹ˆ"ï¼Œè¿˜è¯´"ä¸ºä»€ä¹ˆ"
- ä¸ä»…è¯´"æ€ä¹ˆç”¨"ï¼Œè¿˜è¯´"ä½•æ—¶ç”¨"
- ä¸ä»…è¯´"ä¼˜ç‚¹"ï¼Œè¿˜è¯´"é™·é˜±"

---

## å¸¸è§è¿½é—®åŠåº”å¯¹

### è¿½é—® 1ï¼š"ä½ åœ¨é¡¹ç›®ä¸­é‡åˆ°è¿‡ RunnableLambda çš„æ€§èƒ½é—®é¢˜å—ï¼Ÿ"

**å›ç­”ï¼š**
> "æ˜¯çš„ï¼Œæˆ‘åœ¨ä¸€ä¸ª RAG åº”ç”¨ä¸­é‡åˆ°è¿‡ã€‚å½“æ—¶éœ€è¦æ‰¹é‡è°ƒç”¨å¤–éƒ¨ API è¿›è¡Œæ•°æ®å¢å¼ºï¼Œä½¿ç”¨ RunnableLambda åŒ…è£…äº†åŒæ­¥çš„ API è°ƒç”¨å‡½æ•°ã€‚åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹ï¼Œå‘ç° ainvoke çš„æ€§èƒ½å¾ˆå·®ï¼Œå“åº”æ—¶é—´è¾¾åˆ°äº† 5 ç§’ä»¥ä¸Šã€‚
>
> åæ¥æˆ‘åˆ†æäº†æºç ï¼Œå‘ç°æ˜¯å› ä¸ºé»˜è®¤é€šè¿‡çº¿ç¨‹æ± å§”æ‰˜ï¼Œæœ‰å¤§é‡çš„ä¸Šä¸‹æ–‡åˆ‡æ¢å¼€é”€ã€‚äºæ˜¯æˆ‘å®ç°äº†ä¸€ä¸ªçœŸæ­£çš„å¼‚æ­¥ç‰ˆæœ¬ï¼Œä½¿ç”¨ aiohttp æ›¿ä»£ requestsï¼Œå¹¶é€šè¿‡ afunc å‚æ•°æä¾›ç»™ RunnableLambdaã€‚
>
> ä¼˜åŒ–åï¼Œå“åº”æ—¶é—´é™ä½åˆ°äº† 0.3 ç§’ï¼Œæ€§èƒ½æå‡äº†çº¦ 17 å€ã€‚è¿™ä¸ªç»éªŒè®©æˆ‘æ·±åˆ»ç†è§£äº†å¼‚æ­¥å§”æ‰˜çš„æ€§èƒ½ä»£ä»·ï¼Œä»¥åŠæä¾› afunc çš„é‡è¦æ€§ã€‚"

---

### è¿½é—® 2ï¼š"RunnableLambda å’Œ Python çš„ functools.partial æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"

**å›ç­”ï¼š**
> "è¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é—®é¢˜ã€‚å®ƒä»¬éƒ½æ¶‰åŠå‡½æ•°çš„åŒ…è£…ï¼Œä½†ç›®çš„å’Œèƒ½åŠ›å®Œå…¨ä¸åŒï¼š
>
> **functools.partialï¼š**
> - ç›®çš„ï¼šå›ºå®šå‡½æ•°çš„éƒ¨åˆ†å‚æ•°
> - è¿”å›ï¼šä»ç„¶æ˜¯æ™®é€šå‡½æ•°
> - èƒ½åŠ›ï¼šåªæ˜¯å‚æ•°ç»‘å®š
>
> **RunnableLambdaï¼š**
> - ç›®çš„ï¼šå°†å‡½æ•°é€‚é…åˆ° Runnable åè®®
> - è¿”å›ï¼šRunnable å¯¹è±¡
> - èƒ½åŠ›ï¼šè·å¾— invokeã€batchã€streamã€with_retry ç­‰æ–¹æ³•
>
> å®ƒä»¬å¯ä»¥ç»„åˆä½¿ç”¨ï¼š
> ```python
> from functools import partial
> from langchain_core.runnables import RunnableLambda
>
> def process(text: str, prefix: str) -> str:
>     return f"{prefix}: {text}"
>
> # å…ˆç”¨ partial å›ºå®šå‚æ•°
> process_with_prefix = partial(process, prefix="Result")
>
> # å†ç”¨ RunnableLambda è½¬æ¢ä¸º Runnable
> runnable = RunnableLambda(process_with_prefix)
> ```
>
> æ‰€ä»¥å®ƒä»¬æ˜¯äº’è¡¥çš„ï¼Œä¸æ˜¯æ›¿ä»£å…³ç³»ã€‚"

---

### è¿½é—® 3ï¼š"å¦‚æœè®©ä½ è®¾è®¡ RunnableLambdaï¼Œä½ ä¼šæ€ä¹ˆè®¾è®¡ï¼Ÿ"

**å›ç­”ï¼š**
> "æˆ‘ä¼šä¿æŒå½“å‰çš„æ ¸å¿ƒè®¾è®¡ï¼Œä½†ä¼šåœ¨ä»¥ä¸‹æ–¹é¢æ”¹è¿›ï¼š
>
> **1. æ›´æ˜ç¡®çš„å¼‚æ­¥æ€§èƒ½è­¦å‘Š**
> - åœ¨æ–‡æ¡£ä¸­çªå‡ºå¼ºè°ƒä¸æä¾› afunc çš„æ€§èƒ½ä»£ä»·
> - åœ¨è¿è¡Œæ—¶æ£€æµ‹é«˜å¹¶å‘åœºæ™¯ï¼Œç»™å‡ºæ€§èƒ½è­¦å‘Š
>
> **2. æ›´å¥½çš„ç±»å‹æ¨æ–­**
> - åˆ©ç”¨ Python çš„ç±»å‹æ³¨è§£ï¼Œè‡ªåŠ¨æ¨æ–­è¾“å…¥è¾“å‡ºç±»å‹
> - åœ¨ç±»å‹ä¸åŒ¹é…æ—¶ç»™å‡ºæ›´æ¸…æ™°çš„é”™è¯¯ä¿¡æ¯
>
> **3. å¯é€‰çš„è‡ªåŠ¨æµå¼è¾“å‡º**
> - å¯¹äºè¿”å›ç”Ÿæˆå™¨çš„å‡½æ•°ï¼Œè‡ªåŠ¨æ”¯æŒçœŸæ­£çš„æµå¼è¾“å‡º
> - è€Œä¸æ˜¯é»˜è®¤å§”æ‰˜ invoke
>
> **4. æ›´å¥½çš„è°ƒè¯•æ”¯æŒ**
> - æ·»åŠ å¯é€‰çš„å‡½æ•°åç§°å‚æ•°ï¼Œä¾¿äºè¿½è¸ªå’Œè°ƒè¯•
> - åœ¨é”™è¯¯ä¿¡æ¯ä¸­åŒ…å«å‡½æ•°çš„ä½ç½®ä¿¡æ¯
>
> ä½†æ ¸å¿ƒçš„é€‚é…å™¨æ¨¡å¼å’Œç»„åˆè®¾è®¡æˆ‘ä¼šä¿æŒï¼Œå› ä¸ºè¿™æ˜¯ RunnableLambda æˆåŠŸçš„å…³é”®ã€‚"

---

## æ€»ç»“

### é¢è¯•æˆåŠŸçš„å…³é”®

**1. æ·±åº¦ç†è§£**
- ä¸ä»…çŸ¥é“"æ˜¯ä»€ä¹ˆ"ï¼Œè¿˜çŸ¥é“"ä¸ºä»€ä¹ˆ"
- ç†è§£è®¾è®¡åŸç†å’Œåº•å±‚æœºåˆ¶
- èƒ½å¤Ÿè§£é‡ŠæŠ€æœ¯é€‰æ‹©çš„æƒè¡¡

**2. å®æˆ˜ç»éªŒ**
- æœ‰çœŸå®çš„é¡¹ç›®ç»éªŒ
- é‡åˆ°è¿‡é—®é¢˜å¹¶è§£å†³è¿‡
- èƒ½å¤Ÿç”¨æ•°æ®æ”¯æŒè§‚ç‚¹

**3. ç³»ç»Ÿæ€è€ƒ**
- èƒ½å¤Ÿå¯¹æ¯”ä¸åŒæ–¹æ¡ˆ
- èƒ½å¤Ÿç»™å‡ºå†³ç­–æ ‡å‡†
- èƒ½å¤Ÿå¹³è¡¡å¤šä¸ªå› ç´ 

**4. æ²Ÿé€šèƒ½åŠ›**
- ç»“æ„åŒ–è¡¨è¾¾
- ç”¨ä»£ç ç¤ºä¾‹è¯´æ˜
- ç”¨æ•°æ®æ”¯æŒè§‚ç‚¹

---

## å¼•ç”¨æ¥æº

- [MUFG Bank Case Study](https://blog.langchain.dev/customers-mufgbank) - 10 å€æ•ˆç‡æå‡æ¡ˆä¾‹
- [Lessons Learned with LangChain](https://medium.com/@kbdhunga/lessons-learned-with-langchain-b6a5c5a2e32c) - ç”Ÿäº§ç¯å¢ƒç»éªŒ
- [Production Pitfalls of LangChain](https://medium.com/@kbdhunga/production-pitfalls-of-langchain-nobody-warns-you-about-e6f4c8e6c0e5) - å¸¸è§é™·é˜±
- [LangChain Best Practices (2026)](https://python.langchain.com/docs/guides/development/best_practices) - æœ€ä½³å®è·µ
- [Building Production-Ready AI Pipelines](https://medium.com/@techsachin/building-production-ready-ai-pipelines-with-langchain-a-comprehensive-guide-2026-edition) - ç”Ÿäº§çº§æŒ‡å—

---

**ç‰ˆæœ¬**: v1.0
**æœ€åæ›´æ–°**: 2026-02-20
**é€‚ç”¨äº**: LangChain v0.3+
**Python ç‰ˆæœ¬**: 3.13+

---

**ç¥ä½ é¢è¯•æˆåŠŸï¼** ğŸ¯
