# 最小可用

掌握以下内容，就能在 RAG 系统中应用进阶 Prompt 技巧：

---

## 4.1 Zero-shot CoT：一句话提升推理能力

**最简单的进阶技巧：在 Prompt 末尾加一句"让我们一步步思考"**

```python
# ❌ 直接问（复杂问题容易出错）
prompt_direct = f"""
根据以下文档回答问题：
{context}

问题：{query}
"""

# ✅ 加一句话（推理准确率提升）
prompt_cot = f"""
根据以下文档回答问题：
{context}

问题：{query}

让我们一步步思考：
"""
```

**适用场景：**
- 需要多步推理的问题
- 需要综合多个文档的问题
- 数学计算、逻辑推理

---

## 4.2 Few-shot 模板：统一输出风格

**给 2-3 个示例，LLM 就会模仿你的格式**

```python
def create_rag_few_shot_prompt(context: str, query: str) -> str:
    """RAG Few-shot 模板"""

    return f"""
你是一个知识库问答助手。请参考示例的回答风格。

## 示例

问题：产品保修期是多久？
回答：根据保修政策，产品保修期为**1年**，自购买之日起计算。

问题：如何联系客服？
回答：您可以通过以下方式联系客服：
- 电话：400-xxx-xxxx
- 邮箱：support@example.com
- 在线客服：官网右下角

## 参考文档
{context}

## 请回答
问题：{query}
回答："""
```

**关键点：**
- 示例要展示你期望的格式（加粗、列表等）
- 示例要展示你期望的详细程度
- 2-3 个示例通常足够

---

## 4.3 JSON 输出：让结果可解析

**强制 LLM 输出 JSON，方便程序处理**

```python
import json
from openai import OpenAI

def rag_with_json_output(context: str, query: str) -> dict:
    """RAG + JSON 结构化输出"""

    client = OpenAI()

    prompt = f"""
根据参考文档回答问题，输出 JSON 格式。

参考文档：
{context}

问题：{query}

请输出以下 JSON 格式：
{{"answer": "你的回答", "confidence": "high/medium/low", "source": "信息来源"}}
"""

    response = client.chat.completions.create(
        model="gpt-4o",
        messages=[{"role": "user", "content": prompt}],
        response_format={"type": "json_object"}  # 强制 JSON
    )

    return json.loads(response.choices[0].message.content)


# 使用
result = rag_with_json_output(context, "产品保修期是多久？")
print(result["answer"])       # 直接获取答案
print(result["confidence"])   # 获取置信度
```

---

## 4.4 组合技巧：RAG 进阶模板

**把三个技巧组合起来，形成完整的 RAG 进阶模板**

```python
RAG_ADVANCED_TEMPLATE = """
你是一个专业的知识库问答助手。

## 回答示例

问题：退款流程是什么？
思考：
1. 用户询问退款流程
2. 在文档中找到退款政策相关内容
3. 整理成步骤形式回答
回答：{{"answer": "退款流程：1.提交申请 2.审核 3.退款到账", "confidence": "high", "source": "退款政策文档"}}

## 参考文档
{context}

## 用户问题
{query}

请按以下步骤回答：
1. 分析问题需要什么信息
2. 在文档中定位相关内容
3. 综合形成答案

思考：

回答（JSON格式）：
"""
```

---

## 4.5 快速决策指南

| 场景 | 推荐技巧 | 原因 |
|------|---------|------|
| 简单问答 | 基础 Prompt | 不需要进阶技巧 |
| 格式要求严格 | Few-shot | 示例最直观 |
| 复杂推理 | CoT | 分步思考更准确 |
| 需要程序解析 | JSON Mode | 输出稳定可解析 |
| 综合场景 | 三者组合 | 效果最好 |

---

## 这些知识足以：

- ✅ 用 Zero-shot CoT 提升复杂问题的回答准确率
- ✅ 用 Few-shot 统一 RAG 系统的回答风格
- ✅ 用 JSON Mode 让 RAG 输出可被程序解析
- ✅ 组合使用三种技巧，构建高质量 RAG 系统

---

**下一步：** [05_双重类比](./05_双重类比.md) - 用熟悉的概念理解进阶技巧
