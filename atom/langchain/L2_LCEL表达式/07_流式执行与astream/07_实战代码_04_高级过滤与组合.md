# 实战代码 04：高级过滤与组合

完整的高级过滤与组合代码示例。

```python
import asyncio
from langchain.agents import create_agent
from langchain_openai import ChatOpenAI

agent = create_agent(model="gpt-4o-mini", tools=[...])

async def advanced_filtering(user_input: str):
    """高级过滤与组合"""
    buffers = {"updates": [], "messages": [], "custom": []}

    async for mode, data in agent.astream(
        {"messages": [{"role": "user", "content": user_input}]},
        stream_mode=["updates", "messages", "custom"]
    ):
        buffers[mode].append(data)

        if mode == "updates":
            for node in data.keys():
                print(f"[步骤] {node}")
        elif mode == "messages":
            token, metadata = data
            if metadata.get('langgraph_node') == 'model':
                print(token.content, end="", flush=True)
        elif mode == "custom":
            print(f"\n[进度] {data}")

    print(f"\n统计: updates={len(buffers['updates'])}, "
          f"messages={len(buffers['messages'])}, "
          f"custom={len(buffers['custom'])}")

asyncio.run(advanced_filtering("查询天气"))
```

**版本**: LangChain 0.3.x (2025-2026)
