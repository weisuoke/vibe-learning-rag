# 面试必问

## 问题 1：查询处理在 RAG 系统中的作用是什么？为什么重要？

### 普通回答（60分）

查询处理是 RAG 系统中优化用户查询的技术，可以提升检索效果。主要包括查询改写、多查询生成等方法。

**问题：**
- 没有说明为什么重要
- 没有具体的技术细节
- 缺乏实际应用场景

---

### 优秀回答（90分）

查询处理是 RAG 系统中连接用户意图与文档检索的关键桥梁，主要解决三个核心问题：

**1. 语义鸿沟问题**
- 用户使用口语化表达，文档使用专业术语
- 示例：用户问"Python 怎么跑得快？"，文档标题是"Python 性能优化最佳实践"
- 查询处理通过改写将口语转化为专业表达，提升匹配率

**2. 单一查询的局限性**
- 单一查询无法覆盖用户意图的多样性
- 示例：查询"RAG 如何提升准确性？"实际包含检索优化、生成优化、评估等多个子意图
- 通过多查询生成或查询分解覆盖完整意图

**3. 检索与生成的协作**
- RAG 的目标是生成高质量答案，而非仅仅检索相似文档
- 查询处理为 LLM 提供最优上下文，而不仅仅是相似度高的文档
- HyDE 通过生成假设答案实现更好的语义对齐

**核心技术（2025-2026）：**
1. **查询改写**：最常用，提升 15-30% 准确率
2. **多查询生成**：3-5 个变体，提升 20-40% 召回率
3. **查询分解**：处理复杂查询，提升 25-45% 准确率
4. **HyDE**：概念解释类查询，提升 30-50% 准确率

**实际应用：**
- 技术文档问答：查询改写将口语转为技术术语
- 智能客服：多查询生成覆盖不同表达方式
- 对比分析：查询分解处理复杂对比问题

**引用来源：**
- StackAI 2026: 查询改写是最常用的 RAG 优化技术
- arXiv 2025: 查询分解在多跳推理上提升 20-30%

---

## 问题 2：对比查询改写、多查询生成、查询分解和 HyDE，如何选择？

### 普通回答（60分）

这些都是查询处理技术，可以根据需要选择。查询改写比较简单，HyDE 效果比较好。

**问题：**
- 没有明确的选择标准
- 没有对比各技术的优缺点
- 缺乏实际应用指导

---

### 优秀回答（90分）

选择查询处理策略需要考虑三个维度：**查询类型、复杂度、性能要求**。

**技术对比表：**

| 技术 | 适用场景 | 优势 | 劣势 | 成本 | 效果提升 |
|------|----------|------|------|------|----------|
| 查询改写 | 通用 | 简单、稳定、低成本 | 单一视角 | 低 | 15-30% |
| 多查询生成 | 中等复杂度 | 多角度覆盖 | 成本增加 30% | 中 | 20-40% |
| 查询分解 | 复杂、对比类 | 结构化处理 | 聚合困难 | 中 | 25-45% |
| HyDE | 概念解释 | 语义对齐好 | 不适合事实查询 | 中 | 30-50% |

**选择决策树：**

```
1. 判断查询类型
   ├─ 概念解释（"什么是..."）→ HyDE
   ├─ 操作指导（"如何..."）→ 查询改写
   ├─ 对比分析（"对比..."）→ 查询分解
   ├─ 事实查询（"什么时候..."）→ 直接检索
   └─ 探索式搜索 → 多查询生成

2. 判断复杂度
   ├─ 简单（< 5 词）→ 查询改写
   ├─ 中等（5-10 词）→ 多查询生成
   └─ 复杂（> 10 词）→ 查询分解

3. 判断性能要求
   ├─ 低延迟 → 查询改写（200ms）
   ├─ 平衡 → 多查询生成（300ms）
   └─ 高召回 → 查询分解（500ms）
```

**实战建议：**

1. **从查询改写开始**：性价比最高，适合 80% 场景
2. **根据效果升级**：如果召回率不足，考虑多查询生成
3. **特殊场景特殊处理**：概念解释用 HyDE，对比分析用查询分解
4. **混合策略**：可以组合使用，如查询改写 + 多查询生成

**2025-2026 最佳实践：**
- **StackAI 2026**：查询改写是最常用技术，覆盖 70% 场景
- **Elastic 2025**：查询改写应保持意图一致、增加关键词密度
- **arXiv 2025**：查询分解适合多跳推理，但要注意语义稀释

**代码示例：**

```python
def select_strategy(query: str) -> str:
    """智能选择查询处理策略"""
    # 1. 意图识别
    intent = detect_intent(query)

    # 2. 复杂度评估
    complexity = estimate_complexity(query)

    # 3. 策略选择
    if intent == "concept" and complexity == "simple":
        return "hyde"
    elif intent == "comparison":
        return "decompose"
    elif complexity == "complex":
        return "multi-query"
    elif intent == "how-to":
        return "rewrite"
    else:
        return "direct"
```

---

## 总结

### 面试要点

1. **理解本质**：查询处理解决语义鸿沟、意图覆盖、检索生成协作三大问题
2. **技术对比**：清楚各技术的适用场景、优缺点、成本效果
3. **选择标准**：根据查询类型、复杂度、性能要求选择
4. **实战经验**：能够举出具体应用场景和效果数据
5. **最新趋势**：了解 2025-2026 的最佳实践和研究进展

### 加分项

1. **引用数据**：能够引用 StackAI、Elastic、arXiv 等权威来源
2. **代码实现**：能够快速写出核心代码
3. **性能优化**：了解缓存、并行、异步等优化技巧
4. **生产经验**：有实际部署和优化经验

---

**记住：** 面试不仅要知道"是什么"，更要知道"为什么"和"怎么用"。结合实际场景和数据说话，展现深度理解和实战能力。

---

**引用来源汇总：**
- [Advanced RAG Techniques (Updated 2026)](https://www.stack-ai.com/blog/advanced-rag-techniques) - StackAI
- [Query Rewriting Strategies for LLMs](https://www.elastic.co/blog/query-rewriting-llms) - Elastic 2025
- [Query Decomposition for RAG](https://arxiv.org/abs/2510.18633) - arXiv 2025
- [HyDE Documentation](https://docs.haystack.deepset.ai/docs/hypothetical-document-embeddings) - Haystack 2025
