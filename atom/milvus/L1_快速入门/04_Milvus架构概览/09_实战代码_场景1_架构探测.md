# å®æˆ˜ä»£ç  - åœºæ™¯ 1ï¼šæ¶æ„æ¢æµ‹

> **åœºæ™¯å®šä½**ï¼šé€šè¿‡ä»£ç æ¢æµ‹ Milvus é›†ç¾¤çš„æ¶æ„ä¿¡æ¯
> **éš¾åº¦ç­‰çº§**ï¼šå…¥é—¨çº§
> **é¢„è®¡æ—¶é—´**ï¼š15 åˆ†é’Ÿ

---

## 1. åœºæ™¯æè¿°

### 1.1 ä¸šåŠ¡åœºæ™¯

ä½ åˆšæ¥æ‰‹ä¸€ä¸ª RAG é¡¹ç›®ï¼Œéœ€è¦äº†è§£ç°æœ‰ Milvus é›†ç¾¤çš„æ¶æ„ä¿¡æ¯ï¼š
- é›†ç¾¤æ˜¯å•æœºéƒ¨ç½²è¿˜æ˜¯åˆ†å¸ƒå¼éƒ¨ç½²ï¼Ÿ
- æœ‰å¤šå°‘ä¸ªèŠ‚ç‚¹ï¼Ÿæ¯ä¸ªèŠ‚ç‚¹çš„è§’è‰²æ˜¯ä»€ä¹ˆï¼Ÿ
- å„ä¸ªç»„ä»¶çš„å¥åº·çŠ¶æ€å¦‚ä½•ï¼Ÿ
- ç³»ç»Ÿèµ„æºä½¿ç”¨æƒ…å†µå¦‚ä½•ï¼Ÿ

### 1.2 æŠ€æœ¯ç›®æ ‡

é€šè¿‡ pymilvus å’Œ Milvus API å®ç°ï¼š
1. è·å–é›†ç¾¤åŸºæœ¬ä¿¡æ¯
2. åˆ—å‡ºæ‰€æœ‰èŠ‚ç‚¹åŠå…¶è§’è‰²
3. æ£€æŸ¥ç»„ä»¶å¥åº·çŠ¶æ€
4. æŸ¥çœ‹ç³»ç»Ÿèµ„æºä½¿ç”¨æƒ…å†µ

### 1.3 åœ¨ RAG ä¸­çš„åº”ç”¨

- **å®¹é‡è§„åˆ’**ï¼šäº†è§£å½“å‰é›†ç¾¤è§„æ¨¡ï¼Œåˆ¤æ–­æ˜¯å¦éœ€è¦æ‰©å®¹
- **æ•…éšœæ’æŸ¥**ï¼šå¿«é€Ÿå®šä½é—®é¢˜èŠ‚ç‚¹
- **æ€§èƒ½ä¼˜åŒ–**ï¼šæ ¹æ®èµ„æºä½¿ç”¨æƒ…å†µè°ƒæ•´é…ç½®
- **ç›‘æ§å‘Šè­¦**ï¼šå»ºç«‹åŸºçº¿ï¼Œè®¾ç½®å‘Šè­¦é˜ˆå€¼

---

## 2. ç¯å¢ƒå‡†å¤‡

### 2.1 å®‰è£…ä¾èµ–

```bash
# å®‰è£… pymilvus
uv add pymilvus

# å®‰è£…è¾…åŠ©åº“
uv add python-dotenv tabulate
```

### 2.2 å¯åŠ¨ Milvus

```bash
# ä½¿ç”¨ Docker Compose å¯åŠ¨ Milvusï¼ˆåˆ†å¸ƒå¼æ¨¡å¼ï¼‰
wget https://github.com/milvus-io/milvus/releases/download/v2.3.0/milvus-standalone-docker-compose.yml -O docker-compose.yml
docker-compose up -d

# ç­‰å¾…æœåŠ¡å¯åŠ¨
sleep 30
```

### 2.3 é…ç½®ç¯å¢ƒå˜é‡

```bash
# .env æ–‡ä»¶
MILVUS_HOST=localhost
MILVUS_PORT=19530
```

---

## 3. æ ¸å¿ƒä»£ç å®ç°

### 3.1 åŸºç¡€æ¶æ„æ¢æµ‹

```python
"""
åœºæ™¯ 1ï¼šMilvus æ¶æ„æ¢æµ‹
åŠŸèƒ½ï¼šè·å–é›†ç¾¤åŸºæœ¬ä¿¡æ¯å’ŒèŠ‚ç‚¹åˆ—è¡¨
"""

from pymilvus import connections, utility
from dotenv import load_dotenv
import os
from typing import Dict, List
from tabulate import tabulate

# åŠ è½½ç¯å¢ƒå˜é‡
load_dotenv()

class MilvusArchitectureProbe:
    """Milvus æ¶æ„æ¢æµ‹å™¨"""

    def __init__(self, host: str = None, port: str = None):
        """åˆå§‹åŒ–è¿æ¥"""
        self.host = host or os.getenv("MILVUS_HOST", "localhost")
        self.port = port or os.getenv("MILVUS_PORT", "19530")
        self.alias = "default"

    def connect(self):
        """è¿æ¥åˆ° Milvus"""
        connections.connect(
            alias=self.alias,
            host=self.host,
            port=self.port
        )
        print(f"âœ“ Connected to Milvus at {self.host}:{self.port}")

    def disconnect(self):
        """æ–­å¼€è¿æ¥"""
        connections.disconnect(alias=self.alias)
        print("âœ“ Disconnected from Milvus")

    def get_server_version(self) -> str:
        """è·å– Milvus ç‰ˆæœ¬"""
        version = utility.get_server_version()
        return version

    def get_cluster_info(self) -> Dict:
        """è·å–é›†ç¾¤åŸºæœ¬ä¿¡æ¯"""
        info = {
            "version": self.get_server_version(),
            "host": self.host,
            "port": self.port,
        }
        return info

    def list_nodes(self) -> List[Dict]:
        """åˆ—å‡ºæ‰€æœ‰èŠ‚ç‚¹"""
        # æ³¨æ„ï¼šè¿™ä¸ª API åœ¨æŸäº›ç‰ˆæœ¬ä¸­å¯èƒ½ä¸å¯ç”¨
        try:
            # è·å–æ‰€æœ‰ QueryNode
            query_nodes = utility.get_query_segment_info("_default")

            nodes = []
            node_ids = set()

            for segment in query_nodes:
                if segment.nodeID not in node_ids:
                    nodes.append({
                        "node_id": segment.nodeID,
                        "role": "QueryNode",
                        "state": segment.state
                    })
                    node_ids.add(segment.nodeID)

            return nodes
        except Exception as e:
            print(f"Warning: Unable to list nodes: {e}")
            return []

    def check_health(self) -> bool:
        """æ£€æŸ¥é›†ç¾¤å¥åº·çŠ¶æ€"""
        try:
            # å°è¯•æ‰§è¡Œä¸€ä¸ªç®€å•çš„æ“ä½œ
            utility.list_collections()
            return True
        except Exception as e:
            print(f"Health check failed: {e}")
            return False

    def print_architecture_summary(self):
        """æ‰“å°æ¶æ„æ‘˜è¦"""
        print("\n" + "="*60)
        print("Milvus Architecture Summary")
        print("="*60)

        # 1. é›†ç¾¤ä¿¡æ¯
        cluster_info = self.get_cluster_info()
        print("\n[Cluster Info]")
        print(f"  Version: {cluster_info['version']}")
        print(f"  Endpoint: {cluster_info['host']}:{cluster_info['port']}")

        # 2. å¥åº·çŠ¶æ€
        health = self.check_health()
        print(f"\n[Health Status]")
        print(f"  Status: {'âœ“ Healthy' if health else 'âœ— Unhealthy'}")

        # 3. èŠ‚ç‚¹åˆ—è¡¨
        nodes = self.list_nodes()
        if nodes:
            print(f"\n[Nodes] ({len(nodes)} nodes)")
            table_data = [
                [node["node_id"], node["role"], node["state"]]
                for node in nodes
            ]
            print(tabulate(
                table_data,
                headers=["Node ID", "Role", "State"],
                tablefmt="grid"
            ))
        else:
            print(f"\n[Nodes]")
            print("  Unable to retrieve node information")

        print("\n" + "="*60)


def main():
    """ä¸»å‡½æ•°"""
    # åˆ›å»ºæ¢æµ‹å™¨
    probe = MilvusArchitectureProbe()

    try:
        # è¿æ¥
        probe.connect()

        # æ‰“å°æ¶æ„æ‘˜è¦
        probe.print_architecture_summary()

    finally:
        # æ–­å¼€è¿æ¥
        probe.disconnect()


if __name__ == "__main__":
    main()
```

**è¿è¡Œç»“æœç¤ºä¾‹**ï¼š
```
âœ“ Connected to Milvus at localhost:19530

============================================================
Milvus Architecture Summary
============================================================

[Cluster Info]
  Version: v2.3.0
  Endpoint: localhost:19530

[Health Status]
  Status: âœ“ Healthy

[Nodes] (2 nodes)
+----------+------------+--------+
| Node ID  | Role       | State  |
+==========+============+========+
| 1        | QueryNode  | Sealed |
+----------+------------+--------+
| 2        | QueryNode  | Sealed |
+----------+------------+--------+

============================================================
âœ“ Disconnected from Milvus
```

---

### 3.2 è¿›é˜¶ï¼šä½¿ç”¨ Milvus HTTP API

```python
"""
åœºæ™¯ 1 è¿›é˜¶ï¼šä½¿ç”¨ HTTP API è·å–æ›´è¯¦ç»†çš„æ¶æ„ä¿¡æ¯
"""

import requests
from typing import Dict, List
import json

class MilvusHTTPProbe:
    """ä½¿ç”¨ HTTP API æ¢æµ‹ Milvus æ¶æ„"""

    def __init__(self, host: str = "localhost", port: int = 9091):
        """åˆå§‹åŒ– HTTP å®¢æˆ·ç«¯"""
        self.base_url = f"http://{host}:{port}"

    def get_metrics(self) -> str:
        """è·å– Prometheus æ ¼å¼çš„æŒ‡æ ‡"""
        url = f"{self.base_url}/metrics"
        response = requests.get(url)
        response.raise_for_status()
        return response.text

    def get_health(self) -> Dict:
        """è·å–å¥åº·çŠ¶æ€"""
        url = f"{self.base_url}/healthz"
        response = requests.get(url)
        return {
            "status_code": response.status_code,
            "healthy": response.status_code == 200
        }

    def parse_component_metrics(self, metrics: str) -> Dict:
        """è§£æç»„ä»¶æŒ‡æ ‡"""
        components = {
            "proxy": 0,
            "querynode": 0,
            "datanode": 0,
            "indexnode": 0
        }

        for line in metrics.split("\n"):
            # æŸ¥æ‰¾ç»„ä»¶ç›¸å…³çš„æŒ‡æ ‡
            if "milvus_proxy" in line and not line.startswith("#"):
                components["proxy"] += 1
            elif "milvus_querynode" in line and not line.startswith("#"):
                components["querynode"] += 1
            elif "milvus_datanode" in line and not line.startswith("#"):
                components["datanode"] += 1
            elif "milvus_indexnode" in line and not line.startswith("#"):
                components["indexnode"] += 1

        return components

    def print_http_architecture_summary(self):
        """æ‰“å°åŸºäº HTTP API çš„æ¶æ„æ‘˜è¦"""
        print("\n" + "="*60)
        print("Milvus Architecture Summary (HTTP API)")
        print("="*60)

        # 1. å¥åº·çŠ¶æ€
        health = self.get_health()
        print(f"\n[Health Status]")
        print(f"  Status: {'âœ“ Healthy' if health['healthy'] else 'âœ— Unhealthy'}")
        print(f"  HTTP Code: {health['status_code']}")

        # 2. ç»„ä»¶æŒ‡æ ‡
        try:
            metrics = self.get_metrics()
            components = self.parse_component_metrics(metrics)

            print(f"\n[Components]")
            print(f"  Proxy metrics: {components['proxy']}")
            print(f"  QueryNode metrics: {components['querynode']}")
            print(f"  DataNode metrics: {components['datanode']}")
            print(f"  IndexNode metrics: {components['indexnode']}")

        except Exception as e:
            print(f"\n[Components]")
            print(f"  Unable to retrieve metrics: {e}")

        print("\n" + "="*60)


def main_http():
    """HTTP API ä¸»å‡½æ•°"""
    probe = MilvusHTTPProbe()
    probe.print_http_architecture_summary()


if __name__ == "__main__":
    main_http()
```

**è¿è¡Œç»“æœç¤ºä¾‹**ï¼š
```
============================================================
Milvus Architecture Summary (HTTP API)
============================================================

[Health Status]
  Status: âœ“ Healthy
  HTTP Code: 200

[Components]
  Proxy metrics: 45
  QueryNode metrics: 128
  DataNode metrics: 67
  IndexNode metrics: 34

============================================================
```

---

### 3.3 å®Œæ•´ç¤ºä¾‹ï¼šæ¶æ„æ¢æµ‹ + èµ„æºç›‘æ§

```python
"""
åœºæ™¯ 1 å®Œæ•´ç‰ˆï¼šæ¶æ„æ¢æµ‹ + èµ„æºç›‘æ§
"""

from pymilvus import connections, utility
import requests
import psutil
from typing import Dict
from tabulate import tabulate
import time

class CompleteMilvusProbe:
    """å®Œæ•´çš„ Milvus æ¢æµ‹å™¨"""

    def __init__(self, host: str = "localhost", grpc_port: int = 19530, http_port: int = 9091):
        self.host = host
        self.grpc_port = grpc_port
        self.http_port = http_port
        self.alias = "default"

    def connect(self):
        """è¿æ¥åˆ° Milvus"""
        connections.connect(
            alias=self.alias,
            host=self.host,
            port=str(self.grpc_port)
        )

    def disconnect(self):
        """æ–­å¼€è¿æ¥"""
        connections.disconnect(alias=self.alias)

    def get_basic_info(self) -> Dict:
        """è·å–åŸºæœ¬ä¿¡æ¯"""
        return {
            "version": utility.get_server_version(),
            "collections": len(utility.list_collections()),
        }

    def get_http_health(self) -> bool:
        """é€šè¿‡ HTTP æ£€æŸ¥å¥åº·çŠ¶æ€"""
        try:
            url = f"http://{self.host}:{self.http_port}/healthz"
            response = requests.get(url, timeout=5)
            return response.status_code == 200
        except:
            return False

    def get_system_resources(self) -> Dict:
        """è·å–ç³»ç»Ÿèµ„æºä½¿ç”¨æƒ…å†µ"""
        return {
            "cpu_percent": psutil.cpu_percent(interval=1),
            "memory_percent": psutil.virtual_memory().percent,
            "disk_percent": psutil.disk_usage('/').percent
        }

    def print_complete_summary(self):
        """æ‰“å°å®Œæ•´æ‘˜è¦"""
        print("\n" + "="*70)
        print(" "*20 + "Milvus Complete Architecture Report")
        print("="*70)

        # 1. åŸºæœ¬ä¿¡æ¯
        basic_info = self.get_basic_info()
        print(f"\n[Basic Information]")
        print(f"  Version: {basic_info['version']}")
        print(f"  Endpoint: {self.host}:{self.grpc_port}")
        print(f"  Collections: {basic_info['collections']}")

        # 2. å¥åº·çŠ¶æ€
        grpc_health = True  # å¦‚æœè¿æ¥æˆåŠŸï¼Œè¯´æ˜ gRPC å¥åº·
        http_health = self.get_http_health()

        print(f"\n[Health Status]")
        print(f"  gRPC: {'âœ“ Healthy' if grpc_health else 'âœ— Unhealthy'}")
        print(f"  HTTP: {'âœ“ Healthy' if http_health else 'âœ— Unhealthy'}")

        # 3. ç³»ç»Ÿèµ„æº
        resources = self.get_system_resources()
        print(f"\n[System Resources]")
        print(f"  CPU Usage: {resources['cpu_percent']:.1f}%")
        print(f"  Memory Usage: {resources['memory_percent']:.1f}%")
        print(f"  Disk Usage: {resources['disk_percent']:.1f}%")

        # 4. æ¶æ„ç±»å‹åˆ¤æ–­
        print(f"\n[Architecture Type]")
        if self.http_port == 9091:
            print(f"  Type: Distributed (Cluster Mode)")
            print(f"  Components: Proxy, QueryNode, DataNode, IndexNode")
        else:
            print(f"  Type: Standalone")
            print(f"  Components: All-in-one")

        print("\n" + "="*70)


def main_complete():
    """å®Œæ•´ç¤ºä¾‹ä¸»å‡½æ•°"""
    probe = CompleteMilvusProbe()

    try:
        print("Connecting to Milvus...")
        probe.connect()
        print("âœ“ Connected successfully\n")

        probe.print_complete_summary()

    except Exception as e:
        print(f"âœ— Error: {e}")
    finally:
        probe.disconnect()
        print("\nâœ“ Disconnected")


if __name__ == "__main__":
    main_complete()
```

**è¿è¡Œç»“æœç¤ºä¾‹**ï¼š
```
Connecting to Milvus...
âœ“ Connected successfully

======================================================================
                    Milvus Complete Architecture Report
======================================================================

[Basic Information]
  Version: v2.3.0
  Endpoint: localhost:19530
  Collections: 3

[Health Status]
  gRPC: âœ“ Healthy
  HTTP: âœ“ Healthy

[System Resources]
  CPU Usage: 15.3%
  Memory Usage: 42.7%
  Disk Usage: 68.2%

[Architecture Type]
  Type: Distributed (Cluster Mode)
  Components: Proxy, QueryNode, DataNode, IndexNode

======================================================================

âœ“ Disconnected
```

---

## 4. ä»£ç è§£æ

### 4.1 å…³é”®æŠ€æœ¯ç‚¹

**1. è¿æ¥ç®¡ç†**
```python
connections.connect(alias="default", host="localhost", port="19530")
```
- ä½¿ç”¨ `alias` ç®¡ç†å¤šä¸ªè¿æ¥
- æ”¯æŒè¿æ¥æ± å¤ç”¨

**2. ç‰ˆæœ¬è·å–**
```python
version = utility.get_server_version()
```
- è¿”å› Milvus æœåŠ¡ç«¯ç‰ˆæœ¬
- ç”¨äºå…¼å®¹æ€§æ£€æŸ¥

**3. å¥åº·æ£€æŸ¥**
```python
# æ–¹æ³• 1ï¼šé€šè¿‡ gRPC æ“ä½œ
utility.list_collections()

# æ–¹æ³• 2ï¼šé€šè¿‡ HTTP API
requests.get("http://localhost:9091/healthz")
```

**4. èŠ‚ç‚¹ä¿¡æ¯è·å–**
```python
segments = utility.get_query_segment_info(collection_name)
for segment in segments:
    node_id = segment.nodeID
    state = segment.state
```

### 4.2 å¸¸è§é—®é¢˜

**é—®é¢˜ 1ï¼šæ— æ³•è·å–èŠ‚ç‚¹åˆ—è¡¨**
```python
# åŸå› ï¼šéœ€è¦å…ˆæœ‰ Collection å’Œæ•°æ®
# è§£å†³ï¼šåˆ›å»ºæµ‹è¯• Collection
from pymilvus import Collection, FieldSchema, CollectionSchema, DataType

fields = [
    FieldSchema(name="id", dtype=DataType.INT64, is_primary=True),
    FieldSchema(name="embedding", dtype=DataType.FLOAT_VECTOR, dim=128)
]
schema = CollectionSchema(fields)
collection = Collection("test", schema)
```

**é—®é¢˜ 2ï¼šHTTP API ç«¯å£ä¸é€š**
```python
# åŸå› ï¼šStandalone æ¨¡å¼é»˜è®¤ä¸å¼€å¯ HTTP ç«¯å£
# è§£å†³ï¼šä½¿ç”¨ Cluster æ¨¡å¼æˆ–ä¿®æ”¹é…ç½®
```

**é—®é¢˜ 3ï¼šæƒé™ä¸è¶³**
```python
# åŸå› ï¼šéœ€è¦ç®¡ç†å‘˜æƒé™
# è§£å†³ï¼šä½¿ç”¨æ­£ç¡®çš„ç”¨æˆ·åå’Œå¯†ç 
connections.connect(
    host="localhost",
    port="19530",
    user="root",
    password="Milvus"
)
```

---

## 5. åœ¨ RAG ä¸­çš„åº”ç”¨

### 5.1 å®¹é‡è§„åˆ’

```python
def check_capacity(probe: CompleteMilvusProbe):
    """æ£€æŸ¥å®¹é‡å¹¶ç»™å‡ºå»ºè®®"""
    resources = probe.get_system_resources()

    if resources['memory_percent'] > 80:
        print("âš  Warning: Memory usage > 80%, consider adding more QueryNodes")

    if resources['cpu_percent'] > 70:
        print("âš  Warning: CPU usage > 70%, consider scaling horizontally")

    if resources['disk_percent'] > 85:
        print("âš  Warning: Disk usage > 85%, consider adding more DataNodes")
```

### 5.2 æ•…éšœæ’æŸ¥

```python
def diagnose_issues(probe: CompleteMilvusProbe):
    """è¯Šæ–­å¸¸è§é—®é¢˜"""
    # æ£€æŸ¥è¿æ¥
    try:
        probe.connect()
        print("âœ“ gRPC connection OK")
    except Exception as e:
        print(f"âœ— gRPC connection failed: {e}")
        return

    # æ£€æŸ¥ HTTP
    if not probe.get_http_health():
        print("âœ— HTTP API not responding")
        print("  Possible causes:")
        print("  - Proxy component down")
        print("  - Network firewall blocking port 9091")

    # æ£€æŸ¥èµ„æº
    resources = probe.get_system_resources()
    if resources['memory_percent'] > 95:
        print("âœ— Critical: Memory exhausted")
        print("  Action: Restart Milvus or add more memory")
```

### 5.3 ç›‘æ§å‘Šè­¦

```python
import time

def monitor_loop(probe: CompleteMilvusProbe, interval: int = 60):
    """æŒç»­ç›‘æ§å¾ªç¯"""
    while True:
        try:
            probe.connect()

            # è·å–æŒ‡æ ‡
            resources = probe.get_system_resources()
            basic_info = probe.get_basic_info()

            # è®°å½•æ—¥å¿—
            timestamp = time.strftime("%Y-%m-%d %H:%M:%S")
            print(f"[{timestamp}] CPU: {resources['cpu_percent']:.1f}%, "
                  f"Memory: {resources['memory_percent']:.1f}%, "
                  f"Collections: {basic_info['collections']}")

            # å‘Šè­¦æ£€æŸ¥
            if resources['memory_percent'] > 90:
                send_alert("High memory usage", resources['memory_percent'])

            probe.disconnect()

        except Exception as e:
            print(f"âœ— Monitoring error: {e}")

        time.sleep(interval)

def send_alert(message: str, value: float):
    """å‘é€å‘Šè­¦ï¼ˆç¤ºä¾‹ï¼‰"""
    print(f"ğŸš¨ ALERT: {message} ({value:.1f}%)")
    # å®é™…åº”ç”¨ä¸­å¯ä»¥å‘é€é‚®ä»¶ã€Slack æ¶ˆæ¯ç­‰
```

---

## 6. æœ€ä½³å®è·µ

### 6.1 è¿æ¥ç®¡ç†

```python
# âœ“ æ¨èï¼šä½¿ç”¨ä¸Šä¸‹æ–‡ç®¡ç†å™¨
class MilvusConnection:
    def __init__(self, host, port):
        self.host = host
        self.port = port

    def __enter__(self):
        connections.connect(host=self.host, port=self.port)
        return self

    def __exit__(self, exc_type, exc_val, exc_tb):
        connections.disconnect()

# ä½¿ç”¨
with MilvusConnection("localhost", "19530"):
    # æ‰§è¡Œæ“ä½œ
    version = utility.get_server_version()
```

### 6.2 é”™è¯¯å¤„ç†

```python
# âœ“ æ¨èï¼šç»†ç²’åº¦é”™è¯¯å¤„ç†
from pymilvus.exceptions import MilvusException

try:
    probe.connect()
except MilvusException as e:
    if "connection refused" in str(e).lower():
        print("âœ— Milvus is not running")
    elif "timeout" in str(e).lower():
        print("âœ— Connection timeout, check network")
    else:
        print(f"âœ— Milvus error: {e}")
except Exception as e:
    print(f"âœ— Unexpected error: {e}")
```

### 6.3 æ€§èƒ½ä¼˜åŒ–

```python
# âœ“ æ¨èï¼šç¼“å­˜ç»“æœ
import functools
import time

@functools.lru_cache(maxsize=1)
def get_cached_version(ttl_hash=None):
    """ç¼“å­˜ç‰ˆæœ¬ä¿¡æ¯ï¼ˆ60ç§’ï¼‰"""
    return utility.get_server_version()

def get_ttl_hash(seconds=60):
    """ç”Ÿæˆ TTL å“ˆå¸Œ"""
    return round(time.time() / seconds)

# ä½¿ç”¨
version = get_cached_version(ttl_hash=get_ttl_hash())
```

---

## 7. æ€»ç»“

### 7.1 æ ¸å¿ƒè¦ç‚¹

1. **å¤šç§æ¢æµ‹æ–¹å¼**ï¼šgRPC API + HTTP API
2. **å¥åº·æ£€æŸ¥**ï¼šè¿æ¥æµ‹è¯• + æ“ä½œæµ‹è¯•
3. **èµ„æºç›‘æ§**ï¼šCPUã€å†…å­˜ã€ç£ç›˜
4. **æ¶æ„è¯†åˆ«**ï¼šStandalone vs Cluster

### 7.2 å®æˆ˜æŠ€å·§

1. **å…ˆè¿æ¥å†æ¢æµ‹**ï¼šç¡®ä¿ gRPC è¿æ¥æˆåŠŸ
2. **HTTP API è¡¥å……**ï¼šè·å–æ›´è¯¦ç»†çš„æŒ‡æ ‡
3. **å®šæœŸç›‘æ§**ï¼šå»ºç«‹ç›‘æ§å¾ªç¯
4. **å‘Šè­¦æœºåˆ¶**ï¼šè®¾ç½®åˆç†çš„é˜ˆå€¼

### 7.3 ä¸‹ä¸€æ­¥

- **åœºæ™¯ 2**ï¼šç»„ä»¶ç›‘æ§ - æ·±å…¥ç›‘æ§å„ä¸ªç»„ä»¶çš„çŠ¶æ€
- **åœºæ™¯ 3**ï¼šåˆ†å¸ƒå¼éƒ¨ç½² - å¤šèŠ‚ç‚¹æ¶æ„æ¢æµ‹
- **åœºæ™¯ 4**ï¼šRAG æ¶æ„é›†æˆ - å°†æ¢æµ‹é›†æˆåˆ° RAG ç³»ç»Ÿ

---

**å®Œæ•´ä»£ç **ï¼š`examples/milvus_architecture_probe.py`
