# æœ€å°å¯ç”¨

> **æ ¸å¿ƒç†å¿µï¼š** æŒæ¡ 20% çš„æ ¸å¿ƒçŸ¥è¯†ï¼Œå®ç° 80% çš„ Plan Mode åŠŸèƒ½ã€‚

---

## é€Ÿæˆè·¯çº¿å›¾

### ç¬¬ä¸€æ­¥ï¼šç†è§£æ ¸å¿ƒæ¦‚å¿µï¼ˆ5 åˆ†é’Ÿï¼‰

**Plan Mode æ˜¯ä»€ä¹ˆï¼Ÿ**
- ä¸æ˜¯å†…ç½®åŠŸèƒ½ï¼Œæ˜¯ä¸€ç§æ¨¡å¼
- é€šè¿‡æ‰©å±•å®ç°
- ä¸‰ç§å®ç°æ–¹å¼ï¼šæ–‡ä»¶å¼ã€æ‰©å±•å¼ã€Session é›†æˆå¼

**ä¸ºä»€ä¹ˆä¸æ˜¯å†…ç½®åŠŸèƒ½ï¼Ÿ**
- æç®€å“²å­¦ï¼šæ ¸å¿ƒä¿æŒç®€å•
- å¯è§‚å¯Ÿæ€§ï¼šæ–‡ä»¶ä¼˜å…ˆ
- ç”¨æˆ·æ§åˆ¶ï¼šç”¨æˆ·å†³å®šå·¥ä½œæµ

### ç¬¬äºŒæ­¥ï¼šé€‰æ‹©å®ç°æ–¹å¼ï¼ˆ2 åˆ†é’Ÿï¼‰

| åœºæ™¯ | æ¨èæ–¹å¼ | åŸå›  |
|------|---------|------|
| å¿«é€ŸåŸå‹ | æ–‡ä»¶å¼ | æœ€ç®€å• |
| é¢‘ç¹ä½¿ç”¨ | æ‰©å±•å¼ | æœ€æ–¹ä¾¿ |
| å¤æ‚é¡¹ç›® | Session é›†æˆ | æœ€å¼ºå¤§ |

### ç¬¬ä¸‰æ­¥ï¼šå®ç°æœ€å°å¯ç”¨ç‰ˆæœ¬ï¼ˆ30 åˆ†é’Ÿï¼‰

æ ¹æ®ä½ é€‰æ‹©çš„æ–¹å¼ï¼Œè·³è½¬åˆ°å¯¹åº”ç« èŠ‚ï¼š
- **æ–‡ä»¶å¼**ï¼šè§ä¸‹æ–¹"æ–‡ä»¶å¼è§„åˆ’"
- **æ‰©å±•å¼**ï¼šè§ä¸‹æ–¹"æ‰©å±•å¼è§„åˆ’"
- **Session é›†æˆ**ï¼šè§ä¸‹æ–¹"Session é›†æˆå¼è§„åˆ’"

---

## æ–‡ä»¶å¼è§„åˆ’ï¼ˆæœ€ç®€å•ï¼‰

### æ ¸å¿ƒä»£ç ï¼ˆ10 è¡Œï¼‰

```typescript
// åˆ›å»ºè®¡åˆ’æ–‡ä»¶
async function createPlan(task: string) {
  const planFile = '.pi/plan.md';
  const content = `# Plan: ${task}\n\n## Goal\n\n${task}\n\n## Tasks\n\n- [ ] Task 1\n- [ ] Task 2\n`;
  await api.tools.write(planFile, content);
  return planFile;
}

// ä½¿ç”¨
await createPlan('Implement auth system');
```

### å®Œæ•´ç¤ºä¾‹ï¼ˆ50 è¡Œï¼‰

```typescript
// plan-file.ts
import { ExtensionAPI } from '@pi/extension-api';

interface Plan {
  goal: string;
  tasks: string[];
  createdAt: string;
}

// åˆ›å»ºè®¡åˆ’
async function createPlan(api: ExtensionAPI, goal: string): Promise<string> {
  const plan: Plan = {
    goal,
    tasks: [],
    createdAt: new Date().toISOString()
  };

  const planFile = '.pi/plan.md';
  const content = `# Plan: ${goal}

**Created**: ${plan.createdAt}

## Goal

${goal}

## Tasks

- [ ] Task 1: [Description]
- [ ] Task 2: [Description]
- [ ] Task 3: [Description]

## Notes

[Add any notes here]
`;

  await api.tools.write(planFile, content);
  return planFile;
}

// è¯»å–è®¡åˆ’
async function readPlan(api: ExtensionAPI): Promise<string> {
  const planFile = '.pi/plan.md';
  return await api.tools.read(planFile);
}

// ä½¿ç”¨
export default function(api: ExtensionAPI) {
  // åˆ›å»ºè®¡åˆ’
  createPlan(api, 'Implement user authentication');

  // è¯»å–è®¡åˆ’
  const plan = readPlan(api);
  console.log(plan);
}
```

### ä¼˜åŠ¿

- âœ… æœ€ç®€å•ï¼šåªéœ€è¦ 10 è¡Œä»£ç 
- âœ… æœ€ç›´è§‚ï¼šè®¡åˆ’å­˜å‚¨åœ¨æ–‡ä»¶ä¸­
- âœ… æœ€çµæ´»ï¼šå¯ä»¥æ‰‹åŠ¨ç¼–è¾‘

### åŠ£åŠ¿

- âŒ æ—  UI é›†æˆ
- âŒ æ— å¿«æ·é”®
- âŒ æ— çŠ¶æ€ç®¡ç†

### é€‚ç”¨åœºæ™¯

- å¿«é€ŸåŸå‹å¼€å‘
- ç®€å•ä»»åŠ¡è§„åˆ’
- ä¸ªäººé¡¹ç›®

---

## æ‰©å±•å¼è§„åˆ’ï¼ˆæœ€å¸¸ç”¨ï¼‰

### æ ¸å¿ƒä»£ç ï¼ˆ30 è¡Œï¼‰

```typescript
// plan-extension.ts
export default function(api: ExtensionAPI) {
  // æ³¨å†Œ /plan å‘½ä»¤
  api.registerCommand({
    name: 'plan',
    description: 'Enter plan mode',
    handler: async (args) => {
      const task = args.join(' ');

      // 1. è®¾ç½®çŠ¶æ€
      await api.setState({ mode: 'plan', task });

      // 2. ç¦ç”¨å†™å…¥å·¥å…·
      api.disableTools(['write', 'edit', 'delete']);

      // 3. åˆ›å»ºè®¡åˆ’æ–‡ä»¶
      const planFile = '.pi/plan.md';
      await api.tools.write(planFile, `# Plan: ${task}\n\n`);

      return `Entered plan mode: ${task}`;
    }
  });

  // æ³¨å†Œ /execute å‘½ä»¤
  api.registerCommand({
    name: 'execute',
    description: 'Exit plan mode',
    handler: async () => {
      await api.setState({ mode: 'execute' });
      api.enableTools(['write', 'edit', 'delete']);
      return 'Exited plan mode';
    }
  });
}
```

### å®Œæ•´ç¤ºä¾‹ï¼ˆ100 è¡Œï¼‰

```typescript
// ~/.pi/extensions/plan-mode/index.ts
import { ExtensionAPI } from '@pi/extension-api';

export default function(api: ExtensionAPI) {
  // åˆå§‹åŒ–çŠ¶æ€
  const state = api.getState();
  if (!state.mode) {
    api.setState({ mode: 'idle' });
  }

  // æ³¨å†Œ /plan å‘½ä»¤
  api.registerCommand({
    name: 'plan',
    description: 'Enter plan mode for architecture planning',
    aliases: ['p'],
    handler: async (args) => {
      const task = args.join(' ') || 'general task';

      // è®¾ç½®çŠ¶æ€
      await api.setState({
        mode: 'plan',
        task,
        planStartTime: Date.now()
      });

      // ç¦ç”¨å†™å…¥å·¥å…·
      api.disableTools(['write', 'edit', 'delete', 'move', 'rename']);

      // åˆ›å»ºè®¡åˆ’æ–‡ä»¶
      const planId = `plan-${Date.now()}`;
      const planFile = `.pi/plans/${planId}.md`;
      await api.tools.write(planFile, `# Plan: ${task}

**ID**: ${planId}
**Created**: ${new Date().toISOString()}

## Goal

${task}

## Tasks

- [ ] Task 1: [Description]
- [ ] Task 2: [Description]

## Notes

[Add notes here]
`);

      // è§¦å‘äº‹ä»¶
      api.emit('plan:entered', { task, planFile });

      return `âœ… Entered plan mode: ${task}\nğŸ“„ Plan file: ${planFile}`;
    }
  });

  // æ³¨å†Œ /execute å‘½ä»¤
  api.registerCommand({
    name: 'execute',
    description: 'Exit plan mode and start execution',
    aliases: ['e', 'exec'],
    handler: async () => {
      const state = api.getState();

      if (state.mode !== 'plan') {
        return 'âŒ Not in plan mode';
      }

      // è®¾ç½®çŠ¶æ€
      await api.setState({
        mode: 'execute',
        planEndTime: Date.now()
      });

      // å¯ç”¨å†™å…¥å·¥å…·
      api.enableTools(['write', 'edit', 'delete', 'move', 'rename']);

      // è§¦å‘äº‹ä»¶
      api.emit('plan:exited', {
        duration: Date.now() - state.planStartTime
      });

      const duration = Math.round((Date.now() - state.planStartTime) / 1000);
      return `âœ… Exited plan mode\nâ±ï¸  Planning duration: ${duration}s`;
    }
  });

  // æ³¨å†Œå¿«æ·é”®
  api.registerShortcut({
    key: 'Shift+P',
    description: 'Enter plan mode',
    handler: () => api.executeCommand('plan')
  });

  api.registerShortcut({
    key: 'Shift+E',
    description: 'Exit plan mode',
    handler: () => api.executeCommand('execute')
  });

  console.log('âœ… Plan Mode extension loaded');
}
```

### ä¼˜åŠ¿

- âœ… UI é›†æˆï¼š`/plan` å’Œ `/execute` å‘½ä»¤
- âœ… å¿«æ·é”®ï¼š`Shift+P` å’Œ `Shift+E`
- âœ… çŠ¶æ€ç®¡ç†ï¼šè‡ªåŠ¨ä¿å­˜çŠ¶æ€

### åŠ£åŠ¿

- âŒ éœ€è¦åˆ›å»ºæ‰©å±•
- âŒ éœ€è¦ç†è§£ Extension API

### é€‚ç”¨åœºæ™¯

- é¢‘ç¹ä½¿ç”¨ Plan Mode
- å›¢é˜Ÿåä½œ
- éœ€è¦ UI é›†æˆ

---

## Session é›†æˆå¼è§„åˆ’ï¼ˆæœ€å¼ºå¤§ï¼‰

### æ ¸å¿ƒä»£ç ï¼ˆ40 è¡Œï¼‰

```typescript
// plan-session.ts
export default function(api: ExtensionAPI) {
  api.registerCommand({
    name: 'plan',
    handler: async (args) => {
      const task = args.join(' ');

      // åˆ›å»ºè§„åˆ’ä¼šè¯
      const session = await api.createSession({
        labels: ['planning', 'active'],
        state: {
          mode: 'plan',
          task,
          startTime: Date.now()
        },
        readOnly: true
      });

      // åˆ‡æ¢åˆ°è§„åˆ’ä¼šè¯
      await api.switchSession(session.id);

      // æ·»åŠ æ—¥å¿—
      await api.addSessionEntry(session.id, {
        type: 'system',
        content: `Entered plan mode: ${task}`,
        timestamp: Date.now()
      });

      return `Entered plan mode (Session: ${session.id})`;
    }
  });

  api.registerCommand({
    name: 'execute',
    handler: async () => {
      const session = api.getCurrentSession();

      // æ›´æ–°æ ‡ç­¾
      await api.removeSessionLabel(session.id, 'active');
      await api.addSessionLabel(session.id, 'completed');

      return 'Exited plan mode';
    }
  });
}
```

### ä¼˜åŠ¿

- âœ… çŠ¶æ€æŒä¹…åŒ–ï¼šSession è‡ªåŠ¨ä¿å­˜
- âœ… å†å²è¿½è¸ªï¼šè®°å½•æ‰€æœ‰æ“ä½œ
- âœ… åˆ†æ”¯æ”¯æŒï¼šå¯ä»¥åˆ›å»ºåˆ†æ”¯å®éªŒ

### åŠ£åŠ¿

- âŒ æœ€å¤æ‚ï¼šéœ€è¦ç†è§£ Session API
- âŒ å­¦ä¹ æ›²çº¿ï¼šéœ€è¦æ›´å¤šæ—¶é—´å­¦ä¹ 

### é€‚ç”¨åœºæ™¯

- å¤æ‚é¡¹ç›®
- éœ€è¦å†å²è¿½è¸ª
- éœ€è¦åˆ†æ”¯å®éªŒ

---

## æ ¸å¿ƒ API é€ŸæŸ¥

### æ–‡ä»¶æ“ä½œ

```typescript
// å†™æ–‡ä»¶
await api.tools.write(path, content);

// è¯»æ–‡ä»¶
const content = await api.tools.read(path);
```

### å‘½ä»¤æ³¨å†Œ

```typescript
api.registerCommand({
  name: 'plan',
  handler: async (args) => {
    // å‘½ä»¤é€»è¾‘
  }
});
```

### çŠ¶æ€ç®¡ç†

```typescript
// è®¾ç½®çŠ¶æ€
await api.setState({ mode: 'plan' });

// è·å–çŠ¶æ€
const state = api.getState();
```

### å·¥å…·æ§åˆ¶

```typescript
// ç¦ç”¨å·¥å…·
api.disableTools(['write', 'edit']);

// å¯ç”¨å·¥å…·
api.enableTools(['write', 'edit']);
```

### Session ç®¡ç†

```typescript
// åˆ›å»º Session
const session = await api.createSession({
  labels: ['planning'],
  state: { mode: 'plan' }
});

// åˆ‡æ¢ Session
await api.switchSession(session.id);
```

---

## å¸¸è§é—®é¢˜é€ŸæŸ¥

### Q1: å¦‚ä½•å¿«é€Ÿå¼€å§‹ï¼Ÿ

**A:** ä½¿ç”¨æ–‡ä»¶å¼è§„åˆ’ï¼Œåªéœ€ 10 è¡Œä»£ç ï¼š

```typescript
async function createPlan(task: string) {
  await api.tools.write('.pi/plan.md', `# Plan: ${task}\n\n`);
}
```

### Q2: å¦‚ä½•æ·»åŠ  /plan å‘½ä»¤ï¼Ÿ

**A:** åˆ›å»ºæ‰©å±•ï¼Œæ³¨å†Œå‘½ä»¤ï¼š

```typescript
api.registerCommand({
  name: 'plan',
  handler: async (args) => {
    await api.setState({ mode: 'plan' });
    api.disableTools(['write', 'edit']);
  }
});
```

### Q3: å¦‚ä½•ç¦ç”¨å†™å…¥å·¥å…·ï¼Ÿ

**A:** ä½¿ç”¨ `disableTools`ï¼š

```typescript
api.disableTools(['write', 'edit', 'delete']);
```

### Q4: å¦‚ä½•ä¿å­˜è®¡åˆ’çŠ¶æ€ï¼Ÿ

**A:** ä½¿ç”¨ `setState`ï¼š

```typescript
await api.setState({
  mode: 'plan',
  planFile: '.pi/plan.md'
});
```

### Q5: å¦‚ä½•æ·»åŠ å¿«æ·é”®ï¼Ÿ

**A:** ä½¿ç”¨ `registerShortcut`ï¼š

```typescript
api.registerShortcut({
  key: 'Shift+P',
  handler: () => api.executeCommand('plan')
});
```

---

## å­¦ä¹ è·¯å¾„

### åˆå­¦è€…ï¼ˆ0-3 ä¸ªæœˆï¼‰

1. **ç¬¬ä¸€å‘¨**ï¼šç†è§£æ¦‚å¿µï¼Œä½¿ç”¨æ–‡ä»¶å¼è§„åˆ’
2. **ç¬¬äºŒå‘¨**ï¼šåˆ›å»ºç®€å•æ‰©å±•ï¼Œæ·»åŠ  /plan å‘½ä»¤
3. **ç¬¬ä¸‰å‘¨**ï¼šæ·»åŠ å¿«æ·é”®å’ŒçŠ¶æ€ç®¡ç†
4. **ç¬¬å››å‘¨**ï¼šå®è·µé¡¹ç›®ï¼Œå·©å›ºçŸ¥è¯†

### æœ‰ç»éªŒå¼€å‘è€…ï¼ˆ3-12 ä¸ªæœˆï¼‰

1. **ç¬¬ä¸€å¤©**ï¼šå¿«é€Ÿè¿‡æ¦‚å¿µï¼Œç›´æ¥çœ‹æ‰©å±•å¼è§„åˆ’
2. **ç¬¬äºŒå¤©**ï¼šå®ç°å®Œæ•´æ‰©å±•ï¼ŒåŒ…æ‹¬ UI å’Œå¿«æ·é”®
3. **ç¬¬ä¸‰å¤©**ï¼šå­¦ä¹  Session é›†æˆ
4. **ç¬¬å››å¤©**ï¼šå®è·µé¡¹ç›®ï¼Œä¼˜åŒ–å·¥ä½œæµ

### é«˜çº§å¼€å‘è€…ï¼ˆ12+ ä¸ªæœˆï¼‰

1. **1 å°æ—¶**ï¼šç†è§£ pi-mono å“²å­¦
2. **2 å°æ—¶**ï¼šå®ç°å®Œæ•´ Plan Mode æ‰©å±•
3. **1 å°æ—¶**ï¼šé›†æˆåˆ°ç°æœ‰å·¥ä½œæµ
4. **æŒç»­**ï¼šæ ¹æ®éœ€æ±‚ä¼˜åŒ–å’Œæ‰©å±•

---

## å®æˆ˜æ£€æŸ¥æ¸…å•

### æ–‡ä»¶å¼è§„åˆ’

- [ ] åˆ›å»º `.pi/plan.md` æ–‡ä»¶
- [ ] å†™å…¥è®¡åˆ’å†…å®¹
- [ ] æ‰‹åŠ¨ç¼–è¾‘è®¡åˆ’
- [ ] ç”¨ Git è¿½è¸ªè®¡åˆ’å˜åŒ–

### æ‰©å±•å¼è§„åˆ’

- [ ] åˆ›å»ºæ‰©å±•ç›®å½• `~/.pi/extensions/plan-mode/`
- [ ] å®ç° `index.ts` å…¥å£æ–‡ä»¶
- [ ] æ³¨å†Œ `/plan` å‘½ä»¤
- [ ] æ³¨å†Œ `/execute` å‘½ä»¤
- [ ] æ·»åŠ å¿«æ·é”® `Shift+P` å’Œ `Shift+E`
- [ ] æµ‹è¯•å‘½ä»¤å’Œå¿«æ·é”®

### Session é›†æˆå¼è§„åˆ’

- [ ] ç†è§£ Session API
- [ ] åˆ›å»ºè§„åˆ’ Session
- [ ] æ·»åŠ  CustomEntry æ—¥å¿—
- [ ] ä½¿ç”¨ labels ç®¡ç†çŠ¶æ€
- [ ] æµ‹è¯• Session åˆ‡æ¢

---

## ä¸‹ä¸€æ­¥

### å¦‚æœä½ é€‰æ‹©äº†æ–‡ä»¶å¼è§„åˆ’

- **07_å®æˆ˜ä»£ç _01_æ–‡ä»¶å¼è®¡åˆ’.md**ï¼šæŸ¥çœ‹å®Œæ•´ä»£ç ç¤ºä¾‹
- **03_æ ¸å¿ƒæ¦‚å¿µ_01_Planè¡¨ç¤ºä¸æ–‡ä»¶å­˜å‚¨.md**ï¼šæ·±å…¥ç†è§£æ–‡ä»¶å­˜å‚¨

### å¦‚æœä½ é€‰æ‹©äº†æ‰©å±•å¼è§„åˆ’

- **07_å®æˆ˜ä»£ç _02_Extensionå‘½ä»¤å®ç°.md**ï¼šæŸ¥çœ‹å®Œæ•´æ‰©å±•ä»£ç 
- **03_æ ¸å¿ƒæ¦‚å¿µ_02_Extension_APIé›†æˆ.md**ï¼šæ·±å…¥ç†è§£ Extension API

### å¦‚æœä½ é€‰æ‹©äº† Session é›†æˆå¼è§„åˆ’

- **07_å®æˆ˜ä»£ç _03_Sessioné›†æˆæ‰§è¡Œ.md**ï¼šæŸ¥çœ‹å®Œæ•´ Session ä»£ç 
- **03_æ ¸å¿ƒæ¦‚å¿µ_03_SessionçŠ¶æ€ç®¡ç†.md**ï¼šæ·±å…¥ç†è§£ Session API

---

## å‚è€ƒèµ„æº

### å®˜æ–¹èµ„æº

- [Pi-mono GitHub](https://github.com/badlogic/pi-mono)
- [Extension API Documentation](https://github.com/badlogic/pi-mono/blob/main/packages/coding-agent/docs/extensions.md)
- [Plan Mode Example](https://github.com/badlogic/pi-mono/tree/main/packages/coding-agent/examples/extensions/plan-mode)

### ç ”ç©¶èµ„æ–™

- `temp/03_grok_pi_mono_extensions.md` - Pi-mono æ‰©å±• API
- `temp/04_grok_pi_mono_examples.md` - Pi-mono æ‰©å±•ç¤ºä¾‹
