# 最小可用

> 掌握 20% 的核心知识，解决 80% 的问题

---

## 核心理念

你不需要掌握所有细节就能开始使用 Pi 的基础工具。以下是**最小可用知识集**，掌握这些就能完成大部分编码任务。

---

## 4.1 理解 4 个工具的基本用途

### read - 查看文件内容

**核心：** 读取文件，了解现有代码

```typescript
// Agent 调用示例
await read("src/app.ts")
await read("package.json")
```

**何时使用：**
- 需要了解现有代码结构
- 查看配置文件
- 分析错误日志

**TypeScript 类比：** `fs.readFileSync(path, 'utf-8')`

---

### write - 创建或覆盖文件

**核心：** 创建新文件或完全重写现有文件

```typescript
// Agent 调用示例
await write("src/new-feature.ts", `
export function newFeature() {
  return "Hello World"
}
`)
```

**何时使用：**
- 创建新文件
- 完全重写文件（不保留原内容）
- 生成配置文件

**TypeScript 类比：** `fs.writeFileSync(path, content)`

**⚠️ 注意：** write 会覆盖现有文件，修改现有代码应该用 edit

---

### edit - 精确修改文件

**核心：** 在现有文件中替换特定内容

```typescript
// Agent 调用示例
await edit(
  "src/app.ts",
  "const port = 3000",  // 旧内容
  "const port = 8080"   // 新内容
)
```

**何时使用：**
- 修改现有代码
- 修复 bug
- 重构代码

**TypeScript 类比：** `content.replace(oldText, newText)`

**⚠️ 注意：** 旧内容必须精确匹配，否则编辑失败

---

### bash - 执行命令

**核心：** 运行 shell 命令

```typescript
// Agent 调用示例
await bash("npm test")
await bash("npm run build")
await bash("git status")
```

**何时使用：**
- 运行测试
- 构建项目
- 执行 Git 操作
- 安装依赖

**TypeScript 类比：** `child_process.execSync(command)`

**⚠️ 注意：** 命令在项目根目录执行

---

## 4.2 掌握基本工作流

### 工作流 1：查看和修改代码

```
1. read  → 查看现有代码
2. edit  → 修改代码
3. bash  → 运行测试验证
```

**示例场景：** 修复 bug

```typescript
// 1. 查看代码
await read("src/calculator.ts")
// 发现：function add(a, b) { return a - b }  // Bug!

// 2. 修改代码
await edit(
  "src/calculator.ts",
  "return a - b",
  "return a + b"
)

// 3. 验证修复
await bash("npm test")
```

---

### 工作流 2：创建新功能

```
1. read  → 了解现有结构
2. write → 创建新文件
3. edit  → 集成到现有代码
4. bash  → 测试新功能
```

**示例场景：** 添加新功能

```typescript
// 1. 了解现有结构
await read("src/index.ts")

// 2. 创建新文件
await write("src/logger.ts", `
export function log(message: string) {
  console.log(\`[LOG] \${message}\`)
}
`)

// 3. 集成到现有代码
await edit(
  "src/index.ts",
  "import { app } from './app'",
  "import { app } from './app'\nimport { log } from './logger'"
)

// 4. 测试
await bash("npm run dev")
```

---

### 工作流 3：调试问题

```
1. bash → 运行失败
2. read → 查看错误日志
3. read → 查看相关代码
4. edit → 修复问题
5. bash → 验证修复
```

**示例场景：** 测试失败

```typescript
// 1. 运行测试
await bash("npm test")
// 输出：FAIL src/app.test.ts

// 2. 查看测试文件
await read("src/app.test.ts")

// 3. 查看被测试的代码
await read("src/app.ts")

// 4. 修复代码
await edit("src/app.ts", oldCode, newCode)

// 5. 重新测试
await bash("npm test")
```

---

## 4.3 理解工具选择原则

### 何时用 write vs edit？

**用 write：**
- ✅ 创建新文件
- ✅ 文件内容完全不同
- ✅ 生成配置文件

**用 edit：**
- ✅ 修改现有代码
- ✅ 保留大部分内容
- ✅ 精确修改特定部分

**示例对比：**

```typescript
// 场景 1：创建新文件 → 用 write
await write("src/config.ts", `
export const config = {
  port: 3000,
  host: 'localhost'
}
`)

// 场景 2：修改配置 → 用 edit
await edit(
  "src/config.ts",
  "port: 3000",
  "port: 8080"
)
```

---

### 何时用 bash？

**用 bash：**
- ✅ 运行测试
- ✅ 构建项目
- ✅ 安装依赖
- ✅ Git 操作
- ✅ 查找文件（`find`, `grep`）
- ✅ 任何需要 shell 的操作

**不要用 bash：**
- ❌ 读取文件内容（用 read）
- ❌ 创建文件（用 write）
- ❌ 修改文件（用 edit）

**示例：**

```typescript
// ✅ 正确：用 bash 运行测试
await bash("npm test")

// ✅ 正确：用 bash 查找文件
await bash("find src -name '*.ts'")

// ❌ 错误：用 bash 读取文件
await bash("cat src/app.ts")  // 应该用 read

// ❌ 错误：用 bash 创建文件
await bash("echo 'content' > file.ts")  // 应该用 write
```

---

## 4.4 掌握常见操作

### 操作 1：读取多个文件

```typescript
// 依次读取
await read("src/app.ts")
await read("src/config.ts")
await read("package.json")
```

---

### 操作 2：批量修改

```typescript
// 修改多个文件中的相同内容
await edit("src/app.ts", "oldValue", "newValue")
await edit("src/config.ts", "oldValue", "newValue")
await edit("src/utils.ts", "oldValue", "newValue")
```

---

### 操作 3：创建目录结构

```typescript
// 先创建目录
await bash("mkdir -p src/features/auth")

// 再创建文件
await write("src/features/auth/login.ts", content)
await write("src/features/auth/register.ts", content)
```

---

### 操作 4：运行命令链

```typescript
// 依次执行多个命令
await bash("npm install")
await bash("npm run build")
await bash("npm test")
```

---

### 操作 5：查看命令输出

```typescript
// bash 工具会返回命令输出
const result = await bash("git status")
// Agent 可以读取 result 并做出决策
```

---

## 4.5 避免常见错误

### 错误 1：edit 时内容不匹配

```typescript
// ❌ 错误：旧内容不精确
await edit(
  "src/app.ts",
  "const port = 3000",  // 实际代码可能有空格差异
  "const port = 8080"
)

// ✅ 正确：先 read 确认精确内容
await read("src/app.ts")
// 看到实际内容：const port  =  3000  (多个空格)
await edit(
  "src/app.ts",
  "const port  =  3000",  // 精确匹配
  "const port = 8080"
)
```

---

### 错误 2：用 write 修改现有文件

```typescript
// ❌ 错误：用 write 修改会丢失其他内容
await write("src/app.ts", `
const port = 8080  // 只有这一行，其他内容都丢失了
`)

// ✅ 正确：用 edit 修改
await edit("src/app.ts", "const port = 3000", "const port = 8080")
```

---

### 错误 3：bash 命令路径错误

```typescript
// ❌ 错误：假设在特定目录
await bash("cd src && npm test")  // cd 不会持久化

// ✅ 正确：使用绝对路径或相对于项目根目录
await bash("npm test")  // 在项目根目录执行
```

---

### 错误 4：忘记验证操作结果

```typescript
// ❌ 错误：修改后不验证
await edit("src/app.ts", oldCode, newCode)
// 没有验证是否成功

// ✅ 正确：修改后运行测试
await edit("src/app.ts", oldCode, newCode)
await bash("npm test")  // 验证修改是否正确
```

---

## 这些知识足以

掌握以上内容，你就能：

### 基础操作
- ✅ 查看和理解现有代码
- ✅ 创建新文件和功能
- ✅ 修改和重构代码
- ✅ 运行测试和构建
- ✅ 执行 Git 操作

### 常见任务
- ✅ 修复 bug
- ✅ 添加新功能
- ✅ 重构代码
- ✅ 更新配置
- ✅ 调试问题

### 为后续学习打基础
- ✅ 理解工具调用机制（Phase 2）
- ✅ 学习工具扩展（Phase 3）
- ✅ 构建自定义 Agent（Phase 5）

---

## 快速参考卡

### 4 个工具速查

| 工具 | 用途 | 示例 |
|------|------|------|
| **read** | 读取文件 | `read("src/app.ts")` |
| **write** | 创建/覆盖文件 | `write("new.ts", content)` |
| **edit** | 修改文件 | `edit("app.ts", old, new)` |
| **bash** | 执行命令 | `bash("npm test")` |

### 工作流速查

| 任务 | 工作流 |
|------|--------|
| **修复 bug** | read → edit → bash |
| **新功能** | read → write → edit → bash |
| **调试** | bash → read → edit → bash |
| **重构** | read → edit → bash |

### 选择原则速查

| 场景 | 选择 |
|------|------|
| 创建新文件 | write |
| 修改现有代码 | edit |
| 完全重写文件 | write |
| 运行测试 | bash |
| 查看代码 | read |
| Git 操作 | bash |

---

## 实战练习

### 练习 1：修复简单 bug

**任务：** 修复函数中的拼写错误

```typescript
// 1. 查看代码
await read("src/utils.ts")
// 发现：function calcualte() { ... }  // 拼写错误

// 2. 修复
await edit("src/utils.ts", "calcualte", "calculate")

// 3. 验证
await bash("npm test")
```

---

### 练习 2：添加新配置

**任务：** 添加新的环境变量

```typescript
// 1. 查看现有配置
await read(".env")

// 2. 添加新配置
await edit(
  ".env",
  "PORT=3000",
  "PORT=3000\nDATABASE_URL=postgres://localhost/db"
)

// 3. 验证
await bash("npm run dev")
```

---

### 练习 3：创建新模块

**任务：** 创建一个新的工具模块

```typescript
// 1. 了解项目结构
await read("src/index.ts")

// 2. 创建新模块
await write("src/utils/logger.ts", `
export function log(msg: string) {
  console.log(\`[LOG] \${msg}\`)
}
`)

// 3. 导入到主文件
await edit(
  "src/index.ts",
  "// imports",
  "import { log } from './utils/logger'\n// imports"
)

// 4. 测试
await bash("npm run build")
```

---

## 下一步学习

掌握最小可用知识后，可以深入学习：

### 深入理解
- [03_核心概念_01_read工具详解](./03_核心概念_01_read工具详解.md) - read 工具的高级特性
- [03_核心概念_03_edit工具详解](./03_核心概念_03_edit工具详解.md) - edit 工具的编辑策略
- [06_反直觉点](./06_反直觉点.md) - 避免常见误区

### 实战应用
- [07_实战代码_05_工具组合模式](./07_实战代码_05_工具组合模式.md) - 复杂工作流
- [07_实战代码_06_文件操作自动化](./07_实战代码_06_文件操作自动化.md) - 批量处理
- [07_实战代码_08_故障排查与调试](./07_实战代码_08_故障排查与调试.md) - 问题解决

---

## 2025-2026 实际应用案例

### OpenClaw 的工具使用模式

OpenClaw 基于 Pi 构建，展示了 4 个工具的实际应用：

**典型工作流：**
1. read → 理解代码库结构
2. bash → 运行测试发现问题
3. edit → 修复问题
4. bash → 验证修复
5. bash → Git commit

**来源：**
- [What is Pi, the coding agent behind OpenClaw?](https://www.reddit.com/r/coding_agents/comments/1qsldpi/what_is_pi_the_coding_agent_behind_openclaw) - Reddit 讨论，2025

---

### 社区最佳实践

开发者分享的高效使用模式：

> "我发现最有效的模式是：read → edit → bash test → edit → bash test，循环直到测试通过。Pi 的 4 个工具强制我建立这种节奏。"
> — Reddit r/LocalLLaMA 用户，2025

**来源：**
- [Recommendations for minimal CLI AI agent library](https://www.reddit.com/r/LocalLLaMA/comments/1qw8jvb/recommendations_for_a_minimal_lightweight_cli_ai) - Reddit 讨论，2025

---

**版本：** v1.0
**最后更新：** 2026-02-19
**维护者：** Claude Code
