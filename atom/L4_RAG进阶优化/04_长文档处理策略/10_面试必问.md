# 面试必问

长文档处理策略的高频面试问题及出彩回答。

---

## 问题1："如何处理超过 LLM Context Window 限制的文档？"

### 普通回答（❌ 不出彩）

"可以把文档分成小块，然后分别处理每个块。"

**问题**：
- 太笼统，没有具体方法
- 没有说明如何选择策略
- 没有展示深度思考

---

### 出彩回答（✅ 推荐）

> **处理超长文档有三种主流策略，需要根据场景选择：**
>
> **1. 分层索引（Hierarchical Indexing）**
> - **原理**：构建树形索引结构，从粗到细逐层检索
> - **适用场景**：需要快速定位具体章节的问题，如"如何配置网络策略？"
> - **优势**：检索效率高，保留文档结构
> - **实现**：为每个层级（章节、段落）生成摘要和 Embedding，逐层缩小检索范围
>
> **2. 摘要链（Summary Chain）**
> - **原理**：递归总结，将长文档压缩成多层摘要
> - **适用场景**：需要全文理解的问题，如"这篇论文的核心创新是什么？"
> - **优势**：突破 Context Window 限制，保留核心信息
> - **实现**：原文 → 段落摘要 → 章节摘要 → 全文摘要，每层压缩 10:1
>
> **3. Map-Reduce 策略**
> - **原理**：并行处理文档片段，最后聚合结果
> - **适用场景**：可以分解为独立子问题，如"每章的核心观点是什么？"
> - **优势**：并行处理，速度快
> - **实现**：Map 阶段并行处理每个片段，Reduce 阶段聚合所有结果
>
> **策略选择的决策树**：
> ```
> 问题是否可以分解为独立子问题？
>   ├─ 是 → Map-Reduce
>   └─ 否 → 是否需要全文理解？
>       ├─ 是 → 摘要链
>       └─ 否 → 分层索引
> ```
>
> **在实际项目中的应用**：
> - 学术论文问答：分层索引 + 摘要链组合
> - 技术文档检索：分层索引（文档结构清晰）
> - 多文档对比：Map-Reduce（并行处理多个文档）

---

### 为什么这个回答出彩？

1. ✅ **结构化**：清晰地列出了三种策略及其适用场景
2. ✅ **有深度**：说明了每种策略的原理和实现方式
3. ✅ **有对比**：提供了决策树，展示了如何选择策略
4. ✅ **有实践**：结合实际项目场景说明应用
5. ✅ **展示思考**：不是简单的"分块处理"，而是系统性的解决方案

---

## 问题2："分层索引和摘要链有什么区别？什么时候用哪个？"

### 普通回答（❌ 不出彩）

"分层索引是建立索引，摘要链是生成摘要。分层索引更快，摘要链更省空间。"

**问题**：
- 没有说清楚本质区别
- 没有说明适用场景
- 没有展示对原理的理解

---

### 出彩回答（✅ 推荐）

> **分层索引和摘要链的核心区别在于信息保留方式：**
>
> **1. 信息保留**
> - **分层索引**：无损保留原文，只是构建了检索路径
>   - 叶节点是完整的原文片段
>   - 中间节点是摘要（用于检索）
>   - 最终返回的是原文内容
> - **摘要链**：有损压缩，用摘要代替原文
>   - 每层都是摘要
>   - 递归压缩（10:1 → 10:1 → 10:1）
>   - 最终返回的是摘要内容
>
> **2. 适用场景对比**
>
> | 问题类型 | 分层索引 | 摘要链 | 原因 |
> |---------|---------|--------|------|
> | "第3章第2节的公式是什么？" | ✅ | ❌ | 需要精确信息，摘要会丢失 |
> | "这篇论文的核心创新是什么？" | ⚠️ | ✅ | 需要全文理解，摘要足够 |
> | "如何配置网络策略？" | ✅ | ❌ | 需要快速定位，分层索引更快 |
> | "论文的整体逻辑结构" | ⚠️ | ✅ | 需要全局视角，摘要更合适 |
>
> **3. 技术实现对比**
> - **分层索引**：
>   ```python
>   # 构建树形结构
>   root → [章节1, 章节2, 章节3]
>   章节1 → [段落1.1, 段落1.2, 段落1.3]
>
>   # 逐层检索
>   第1层：在章节中检索 → 找到章节1
>   第2层：在段落中检索 → 找到段落1.2
>   返回：段落1.2的原文
>   ```
>
> - **摘要链**：
>   ```python
>   # 递归总结
>   原文（500,000字） → 段落摘要（50,000字）
>   段落摘要（50,000字） → 章节摘要（5,000字）
>   章节摘要（5,000字） → 全文摘要（500字）
>
>   # 使用时
>   先读全文摘要（500字）理解大意
>   如需更多细节，读章节摘要（5,000字）
>   ```
>
> **4. 实际项目中的选择**
> - **学术论文问答**：两者结合
>   - 用摘要链理解全文大意
>   - 用分层索引定位具体章节
> - **技术文档检索**：优先分层索引
>   - 文档结构清晰
>   - 用户需要精确步骤
> - **长文档总结**：优先摘要链
>   - 需要压缩信息
>   - 不需要所有细节

---

### 为什么这个回答出彩？

1. ✅ **抓住本质**：信息保留方式的区别（无损 vs 有损）
2. ✅ **有对比**：用表格清晰对比适用场景
3. ✅ **有实现**：展示了具体的技术实现方式
4. ✅ **有实践**：说明了实际项目中如何选择
5. ✅ **有深度**：不是简单的"快 vs 省空间"，而是从原理出发

---

## 加分项：展示实际经验

### 如果面试官追问："你在实际项目中用过吗？"

**出彩回答**：

> "我在一个学术论文问答系统中使用过这些策略。具体场景是：
>
> **项目背景**：
> - 处理 50-100 页的 AI 研究论文
> - 用户问题类型多样（定位、理解、对比）
> - 需要在 2 秒内返回结果
>
> **技术方案**：
> 1. **离线阶段**：
>    - 为每篇论文构建分层索引（章节 → 段落）
>    - 生成摘要链（段落摘要 → 章节摘要 → 全文摘要）
>    - 预计算所有 Embedding 并缓存
>
> 2. **在线阶段**：
>    - 根据问题类型自动选择策略
>    - 包含"核心"、"创新"等关键词 → 摘要链
>    - 包含"如何"、"步骤"等关键词 → 分层索引
>    - 包含"每章"、"对比"等关键词 → Map-Reduce
>
> 3. **性能优化**：
>    - Embedding 缓存：避免重复计算
>    - 分层检索剪枝：父节点不相关，子节点不检索
>    - 并行处理：Map-Reduce 使用 ThreadPoolExecutor
>
> **效果**：
> - 平均响应时间：1.5 秒
> - 准确率：85%（用户满意度）
> - 成本：相比全文检索降低 60%（减少 LLM 调用次数）
>
> **遇到的坑**：
> 1. **摘要质量问题**：初期用简单截断代替摘要，效果很差
>    - 解决：改用 LLM 生成摘要，质量显著提升
> 2. **检索精度问题**：分层索引容易漏掉相关内容
>    - 解决：增加 Top-K，从 1 提升到 2-3
> 3. **成本问题**：摘要链需要多次调用 LLM，成本高
>    - 解决：离线预生成摘要，在线只读取缓存"

---

## 快速记忆卡片

### 卡片1：三种策略的核心区别

```
分层索引 = 树形导航 + 逐层检索 + 保留原文
摘要链 = 递归总结 + 信息压缩 + 有损压缩
Map-Reduce = 并行处理 + 结果聚合 + 独立子问题
```

### 卡片2：策略选择决策树

```
问题可以分解？
  ├─ 是 → Map-Reduce
  └─ 否 → 需要全文理解？
      ├─ 是 → 摘要链
      └─ 否 → 分层索引
```

### 卡片3：面试回答框架

```
1. 列出三种策略
2. 说明每种策略的原理
3. 对比适用场景
4. 提供决策方法
5. 结合实际项目经验
```

---

## 总结

**面试中的关键点**：
1. **不要只说"分块处理"**：要说清楚具体策略
2. **展示系统性思考**：原理 → 场景 → 决策 → 实践
3. **用对比突出理解**：表格、决策树、代码示例
4. **结合实际经验**：项目背景、技术方案、遇到的坑

**记住**：
- 分层索引 = 快速定位 + 保留原文
- 摘要链 = 全文理解 + 信息压缩
- Map-Reduce = 并行处理 + 独立子问题

---

**下一步：** [11_化骨绵掌.md](./11_化骨绵掌.md) - 10个2分钟知识卡片
