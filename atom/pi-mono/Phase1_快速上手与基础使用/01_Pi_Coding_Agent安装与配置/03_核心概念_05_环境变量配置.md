# æ ¸å¿ƒæ¦‚å¿µ 05ï¼šç¯å¢ƒå˜é‡é…ç½®

> **çŸ¥è¯†ç‚¹å®šä½**ï¼šæŒæ¡ Pi Coding Agent çš„æ‰€æœ‰ç¯å¢ƒå˜é‡é…ç½®ï¼Œç†è§£ç¯å¢ƒå˜é‡çš„ä¼˜å…ˆçº§ã€ä½œç”¨åŸŸå’Œæœ€ä½³å®è·µ

---

## ä¸€ã€ç¯å¢ƒå˜é‡æ¦‚è¿°

### 1.1 ä»€ä¹ˆæ˜¯ç¯å¢ƒå˜é‡

ç¯å¢ƒå˜é‡æ˜¯æ“ä½œç³»ç»Ÿçº§åˆ«çš„é…ç½®å‚æ•°ï¼Œç”¨äºåœ¨ä¸ä¿®æ”¹ä»£ç çš„æƒ…å†µä¸‹é…ç½®åº”ç”¨ç¨‹åºè¡Œä¸ºã€‚

**Pi ä¸­çš„ç¯å¢ƒå˜é‡ç”¨é€”ï¼š**
- ğŸ”‘ **è®¤è¯é…ç½®**ï¼šAPI Keyã€OAuth Token
- ğŸŒ **Provider é…ç½®**ï¼šBase URLã€Regionã€Deployment
- âš™ï¸ **è¡Œä¸ºé…ç½®**ï¼šDebug æ¨¡å¼ã€æ—¥å¿—çº§åˆ«ã€è¶…æ—¶è®¾ç½®
- ğŸ“ **è·¯å¾„é…ç½®**ï¼šé…ç½®æ–‡ä»¶ä½ç½®ã€Session å­˜å‚¨è·¯å¾„

### 1.2 ç¯å¢ƒå˜é‡ vs é…ç½®æ–‡ä»¶

| é…ç½®æ–¹å¼ | ä¼˜å…ˆçº§ | é€‚ç”¨åœºæ™¯ | æŒä¹…åŒ– |
|---------|-------|---------|--------|
| **CLI å‚æ•°** | æœ€é«˜ | ä¸´æ—¶è¦†ç›– | å¦ |
| **ç¯å¢ƒå˜é‡** | é«˜ | ç³»ç»Ÿçº§é…ç½® | æ˜¯ï¼ˆShell é…ç½®ï¼‰ |
| **auth.json** | ä¸­ | è®¤è¯ä¿¡æ¯ | æ˜¯ |
| **settings.json** | ä½ | ç”¨æˆ·åå¥½ | æ˜¯ |

---

## äºŒã€è®¤è¯ç›¸å…³ç¯å¢ƒå˜é‡

### 2.1 API Key ç¯å¢ƒå˜é‡

**å®Œæ•´åˆ—è¡¨ï¼š**

```bash
# Anthropic Claude
export ANTHROPIC_API_KEY=sk-ant-api03-...

# OpenAI GPT
export OPENAI_API_KEY=sk-proj-...

# Azure OpenAI
export AZURE_OPENAI_API_KEY=...
export AZURE_OPENAI_BASE_URL=https://your-resource.openai.azure.com
export AZURE_OPENAI_RESOURCE_NAME=your-resource
export AZURE_OPENAI_API_VERSION=2024-02-01
export AZURE_OPENAI_DEPLOYMENT_NAME_MAP=gpt-4=my-gpt4,gpt-4o=my-gpt4o

# Google Gemini
export GEMINI_API_KEY=AI...

# Google Vertex AI
export GOOGLE_CLOUD_PROJECT=your-project
export GOOGLE_CLOUD_LOCATION=us-central1
export GOOGLE_APPLICATION_CREDENTIALS=/path/to/service-account.json

# Amazon Bedrock
export AWS_PROFILE=your-profile
# æˆ–
export AWS_ACCESS_KEY_ID=AKIA...
export AWS_SECRET_ACCESS_KEY=...
export AWS_REGION=us-west-2
export AWS_BEARER_TOKEN_BEDROCK=...

# Mistral
export MISTRAL_API_KEY=...

# Groq
export GROQ_API_KEY=gsk_...

# Cerebras
export CEREBRAS_API_KEY=...

# xAI (Grok)
export XAI_API_KEY=xai-...

# OpenRouter
export OPENROUTER_API_KEY=sk-or-...

# Vercel AI Gateway
export AI_GATEWAY_API_KEY=...

# ZAI
export ZAI_API_KEY=...

# OpenCode Zen
export OPENCODE_API_KEY=...

# Hugging Face
export HF_TOKEN=hf_...

# Kimi For Coding
export KIMI_API_KEY=...

# MiniMax
export MINIMAX_API_KEY=...
export MINIMAX_CN_API_KEY=...  # ä¸­å›½åŒº
```

> **æ¥æº**ï¼š[Pi Providers Documentation - API Keys](https://github.com/badlogic/pi-mono/blob/main/packages/coding-agent/docs/providers.md#api-keys) (2026-02)

### 2.2 ç¯å¢ƒå˜é‡å‘½åè§„èŒƒ

**å‘½åæ¨¡å¼ï¼š**
```
<PROVIDER>_API_KEY
<PROVIDER>_<RESOURCE>_<PROPERTY>
```

**ç¤ºä¾‹ï¼š**
- `ANTHROPIC_API_KEY`ï¼šAnthropic çš„ API Key
- `AZURE_OPENAI_BASE_URL`ï¼šAzure OpenAI çš„ Base URL
- `GOOGLE_CLOUD_PROJECT`ï¼šGoogle Cloud çš„é¡¹ç›® ID

---

## ä¸‰ã€Provider é…ç½®ç¯å¢ƒå˜é‡

### 3.1 Azure OpenAI é…ç½®

```bash
# å¿…éœ€ï¼šAPI Key
export AZURE_OPENAI_API_KEY=your-api-key

# å¿…éœ€ï¼šBase URL æˆ– Resource Nameï¼ˆäºŒé€‰ä¸€ï¼‰
export AZURE_OPENAI_BASE_URL=https://your-resource.openai.azure.com
# æˆ–
export AZURE_OPENAI_RESOURCE_NAME=your-resource

# å¯é€‰ï¼šAPI ç‰ˆæœ¬ï¼ˆé»˜è®¤ï¼š2024-02-01ï¼‰
export AZURE_OPENAI_API_VERSION=2024-02-01

# å¯é€‰ï¼šDeployment æ˜ å°„
export AZURE_OPENAI_DEPLOYMENT_NAME_MAP=gpt-4=my-gpt4-deployment,gpt-4o=my-gpt4o-deployment
```

**Deployment æ˜ å°„è¯´æ˜ï¼š**
- Azure OpenAI ä½¿ç”¨ Deployment Name è€Œéæ¨¡å‹åç§°
- æ˜ å°„æ ¼å¼ï¼š`model-name=deployment-name,model-name2=deployment-name2`
- å¦‚æœä¸è®¾ç½®ï¼ŒPi ä¼šå°è¯•ä½¿ç”¨æ¨¡å‹åç§°ä½œä¸º Deployment Name

### 3.2 Amazon Bedrock é…ç½®

**æ–¹å¼ 1ï¼šAWS Profile**

```bash
export AWS_PROFILE=your-profile
```

**æ–¹å¼ 2ï¼šIAM Keys**

```bash
export AWS_ACCESS_KEY_ID=AKIA...
export AWS_SECRET_ACCESS_KEY=...
export AWS_REGION=us-west-2  # å¯é€‰ï¼Œé»˜è®¤ us-east-1
```

**æ–¹å¼ 3ï¼šBearer Token**

```bash
export AWS_BEARER_TOKEN_BEDROCK=...
```

**Bedrock Proxy é…ç½®ï¼š**

```bash
# ä»£ç† URLï¼ˆæ ‡å‡† AWS SDK ç¯å¢ƒå˜é‡ï¼‰
export AWS_ENDPOINT_URL_BEDROCK_RUNTIME=https://my.corp.proxy/bedrock

# è·³è¿‡è®¤è¯ï¼ˆä»£ç†ä¸éœ€è¦è®¤è¯æ—¶ï¼‰
export AWS_BEDROCK_SKIP_AUTH=1

# å¼ºåˆ¶ HTTP/1.1ï¼ˆä»£ç†ä¸æ”¯æŒ HTTP/2 æ—¶ï¼‰
export AWS_BEDROCK_FORCE_HTTP1=1
```

**ECS/IRSA æ”¯æŒï¼š**
- `AWS_CONTAINER_CREDENTIALS_*`ï¼šECS Task Role
- `AWS_WEB_IDENTITY_TOKEN_FILE`ï¼šIRSA (IAM Roles for Service Accounts)

### 3.3 Google Vertex AI é…ç½®

```bash
# æ–¹å¼ 1ï¼šApplication Default Credentials
gcloud auth application-default login
export GOOGLE_CLOUD_PROJECT=your-project
export GOOGLE_CLOUD_LOCATION=us-central1

# æ–¹å¼ 2ï¼šService Account Key
export GOOGLE_APPLICATION_CREDENTIALS=/path/to/service-account-key.json
export GOOGLE_CLOUD_PROJECT=your-project
export GOOGLE_CLOUD_LOCATION=us-central1
```

---

## å››ã€Pi è¡Œä¸ºé…ç½®ç¯å¢ƒå˜é‡

### 4.1 è·¯å¾„é…ç½®

```bash
# Pi é…ç½®ç›®å½•ï¼ˆé»˜è®¤ï¼š~/.pi/agentï¼‰
export PI_CONFIG_DIR=/custom/path/to/config

# Auth æ–‡ä»¶è·¯å¾„ï¼ˆé»˜è®¤ï¼š~/.pi/agent/auth.jsonï¼‰
export PI_AUTH_FILE=/custom/path/to/auth.json

# Session å­˜å‚¨ç›®å½•ï¼ˆé»˜è®¤ï¼š~/.pi/agent/sessionsï¼‰
export PI_SESSIONS_DIR=/custom/path/to/sessions

# Extensions ç›®å½•ï¼ˆé»˜è®¤ï¼š~/.pi/agent/extensionsï¼‰
export PI_EXTENSIONS_DIR=/custom/path/to/extensions
```

### 4.2 OAuth é…ç½®

```bash
# OAuth å›è°ƒç«¯å£ï¼ˆé»˜è®¤ï¼š8080ï¼‰
export PI_OAUTH_PORT=9090

# OAuth è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼Œé»˜è®¤ï¼š300ï¼‰
export PI_OAUTH_TIMEOUT=600
```

### 4.3 è°ƒè¯•ä¸æ—¥å¿—

```bash
# Debug æ¨¡å¼ï¼ˆæ˜¾ç¤ºè¯¦ç»†æ—¥å¿—ï¼‰
export PI_DEBUG=1

# æ—¥å¿—çº§åˆ«ï¼ˆdebug, info, warn, errorï¼‰
export PI_LOG_LEVEL=debug

# æ—¥å¿—æ–‡ä»¶è·¯å¾„
export PI_LOG_FILE=/path/to/pi.log
```

### 4.4 ç½‘ç»œé…ç½®

```bash
# HTTP ä»£ç†
export HTTP_PROXY=http://proxy.example.com:8080
export HTTPS_PROXY=http://proxy.example.com:8080

# ä¸ä½¿ç”¨ä»£ç†çš„åŸŸå
export NO_PROXY=localhost,127.0.0.1,.local

# è¯·æ±‚è¶…æ—¶ï¼ˆæ¯«ç§’ï¼Œé»˜è®¤ï¼š60000ï¼‰
export PI_REQUEST_TIMEOUT=120000

# è¿æ¥è¶…æ—¶ï¼ˆæ¯«ç§’ï¼Œé»˜è®¤ï¼š10000ï¼‰
export PI_CONNECT_TIMEOUT=20000
```

---

## äº”ã€ç¯å¢ƒå˜é‡ä¼˜å…ˆçº§

### 5.1 è§£æé¡ºåº

Pi æŒ‰ä»¥ä¸‹é¡ºåºè§£æé…ç½®ï¼š

```
1. CLI å‚æ•°ï¼ˆæœ€é«˜ä¼˜å…ˆçº§ï¼‰
   â†“
2. ç¯å¢ƒå˜é‡
   â†“
3. auth.json æ–‡ä»¶
   â†“
4. é¡¹ç›® settings.json (.pi/settings.json)
   â†“
5. å…¨å±€ settings.json (~/.pi/agent/settings.json)
   â†“
6. é»˜è®¤å€¼ï¼ˆæœ€ä½ä¼˜å…ˆçº§ï¼‰
```

### 5.2 ä¼˜å…ˆçº§ç¤ºä¾‹

**åœºæ™¯ 1ï¼šAPI Key è§£æ**

```bash
# è®¾ç½®ç¯å¢ƒå˜é‡
export ANTHROPIC_API_KEY=sk-ant-env-key

# auth.json ä¸­ä¹Ÿæœ‰é…ç½®
{
  "anthropic": {
    "type": "api_key",
    "key": "sk-ant-auth-key"
  }
}

# ç»“æœï¼šä½¿ç”¨ auth.json ä¸­çš„ keyï¼ˆauth.json ä¼˜å…ˆçº§é«˜äºç¯å¢ƒå˜é‡ï¼‰
```

**åœºæ™¯ 2ï¼šCLI å‚æ•°è¦†ç›–**

```bash
# ç¯å¢ƒå˜é‡
export ANTHROPIC_API_KEY=sk-ant-env-key

# CLI å‚æ•°
pi --api-key sk-ant-cli-key

# ç»“æœï¼šä½¿ç”¨ CLI å‚æ•°çš„ keyï¼ˆCLI ä¼˜å…ˆçº§æœ€é«˜ï¼‰
```

**åœºæ™¯ 3ï¼šæ¨¡å‹é€‰æ‹©**

```bash
# å…¨å±€ settings.json
{
  "model": "claude-sonnet-4"
}

# é¡¹ç›® .pi/settings.json
{
  "model": "claude-opus-4"
}

# CLI å‚æ•°
pi --model claude-haiku-4

# ç»“æœï¼šä½¿ç”¨ claude-haiku-4ï¼ˆCLI > é¡¹ç›® > å…¨å±€ï¼‰
```

---

## å…­ã€Shell é…ç½®æŒä¹…åŒ–

### 6.1 Bash é…ç½®

**ä¸´æ—¶è®¾ç½®ï¼ˆå½“å‰ä¼šè¯ï¼‰ï¼š**

```bash
export ANTHROPIC_API_KEY=sk-ant-...
```

**æ°¸ä¹…è®¾ç½®ï¼ˆæ‰€æœ‰ä¼šè¯ï¼‰ï¼š**

```bash
# ç¼–è¾‘ ~/.bashrc æˆ– ~/.bash_profile
echo 'export ANTHROPIC_API_KEY=sk-ant-...' >> ~/.bashrc

# é‡æ–°åŠ è½½é…ç½®
source ~/.bashrc
```

**é¡¹ç›®çº§é…ç½®ï¼ˆ.env æ–‡ä»¶ï¼‰ï¼š**

```bash
# åˆ›å»º .env æ–‡ä»¶
cat > .env << 'EOF'
ANTHROPIC_API_KEY=sk-ant-...
OPENAI_API_KEY=sk-proj-...
EOF

# åŠ è½½ .env
set -a
source .env
set +a

# è¿è¡Œ pi
pi
```

### 6.2 Zsh é…ç½®

```bash
# ç¼–è¾‘ ~/.zshrc
echo 'export ANTHROPIC_API_KEY=sk-ant-...' >> ~/.zshrc

# é‡æ–°åŠ è½½é…ç½®
source ~/.zshrc
```

### 6.3 Fish é…ç½®

```fish
# è®¾ç½®ç¯å¢ƒå˜é‡
set -Ux ANTHROPIC_API_KEY sk-ant-...

# æŸ¥çœ‹ç¯å¢ƒå˜é‡
echo $ANTHROPIC_API_KEY

# åˆ é™¤ç¯å¢ƒå˜é‡
set -e ANTHROPIC_API_KEY
```

### 6.4 Windows PowerShell é…ç½®

**ä¸´æ—¶è®¾ç½®ï¼š**

```powershell
$env:ANTHROPIC_API_KEY="sk-ant-..."
```

**æ°¸ä¹…è®¾ç½®ï¼ˆç”¨æˆ·çº§åˆ«ï¼‰ï¼š**

```powershell
[System.Environment]::SetEnvironmentVariable('ANTHROPIC_API_KEY', 'sk-ant-...', 'User')
```

**æ°¸ä¹…è®¾ç½®ï¼ˆç³»ç»Ÿçº§åˆ«ï¼‰ï¼š**

```powershell
[System.Environment]::SetEnvironmentVariable('ANTHROPIC_API_KEY', 'sk-ant-...', 'Machine')
```

---

## ä¸ƒã€.env æ–‡ä»¶æ”¯æŒ

### 7.1 .env æ–‡ä»¶æ ¼å¼

```bash
# .env æ–‡ä»¶ç¤ºä¾‹
# API Keys
ANTHROPIC_API_KEY=sk-ant-api03-...
OPENAI_API_KEY=sk-proj-...
XAI_API_KEY=xai-...

# Azure OpenAI
AZURE_OPENAI_API_KEY=...
AZURE_OPENAI_BASE_URL=https://your-resource.openai.azure.com

# Google Cloud
GOOGLE_CLOUD_PROJECT=your-project
GOOGLE_CLOUD_LOCATION=us-central1

# Pi é…ç½®
PI_DEBUG=1
PI_LOG_LEVEL=debug
```

### 7.2 åŠ è½½ .env æ–‡ä»¶

**æ–¹å¼ 1ï¼šæ‰‹åŠ¨åŠ è½½ï¼ˆBash/Zshï¼‰**

```bash
# åŠ è½½ .env
set -a
source .env
set +a

# è¿è¡Œ pi
pi
```

**æ–¹å¼ 2ï¼šä½¿ç”¨ direnvï¼ˆæ¨èï¼‰**

```bash
# å®‰è£… direnv
brew install direnv  # macOS
apt install direnv   # Ubuntu

# é…ç½® Shell
echo 'eval "$(direnv hook bash)"' >> ~/.bashrc
source ~/.bashrc

# å…è®¸ .env
direnv allow

# è¿›å…¥ç›®å½•è‡ªåŠ¨åŠ è½½ .env
cd /path/to/project
# direnv: loading .env
```

**æ–¹å¼ 3ï¼šä½¿ç”¨ dotenv CLI**

```bash
# å®‰è£… dotenv-cli
npm install -g dotenv-cli

# è¿è¡Œ pi
dotenv pi
```

### 7.3 .env æ–‡ä»¶å®‰å…¨

```bash
# æ·»åŠ åˆ° .gitignore
echo ".env" >> .gitignore
echo ".env.local" >> .gitignore

# åˆ›å»º .env.example æ¨¡æ¿
cat > .env.example << 'EOF'
# API Keys (replace with your own)
ANTHROPIC_API_KEY=sk-ant-...
OPENAI_API_KEY=sk-proj-...

# Azure OpenAI
AZURE_OPENAI_API_KEY=...
AZURE_OPENAI_BASE_URL=https://your-resource.openai.azure.com
EOF

# æäº¤æ¨¡æ¿åˆ° Git
git add .env.example
git commit -m "Add .env.example template"
```

---

## å…«ã€ç¯å¢ƒå˜é‡éªŒè¯

### 8.1 æ£€æŸ¥ç¯å¢ƒå˜é‡

```bash
# æ£€æŸ¥å•ä¸ªç¯å¢ƒå˜é‡
echo $ANTHROPIC_API_KEY

# æ£€æŸ¥æ‰€æœ‰ Pi ç›¸å…³ç¯å¢ƒå˜é‡
env | grep -E '(ANTHROPIC|OPENAI|XAI|GEMINI|GROQ|PI_)'

# æ£€æŸ¥ API Key æ ¼å¼
if [[ $ANTHROPIC_API_KEY =~ ^sk-ant- ]]; then
  echo "âœ… Valid Anthropic API Key format"
else
  echo "âŒ Invalid Anthropic API Key format"
fi
```

### 8.2 éªŒè¯è„šæœ¬

```bash
#!/bin/bash
# validate-env.sh

echo "ğŸ” Validating Pi environment variables..."

# æ£€æŸ¥ API Keys
if [ -n "$ANTHROPIC_API_KEY" ]; then
  echo "âœ… ANTHROPIC_API_KEY is set"
else
  echo "âŒ ANTHROPIC_API_KEY is not set"
fi

if [ -n "$OPENAI_API_KEY" ]; then
  echo "âœ… OPENAI_API_KEY is set"
else
  echo "âš ï¸  OPENAI_API_KEY is not set"
fi

# æ£€æŸ¥ Azure OpenAI
if [ -n "$AZURE_OPENAI_API_KEY" ]; then
  if [ -n "$AZURE_OPENAI_BASE_URL" ] || [ -n "$AZURE_OPENAI_RESOURCE_NAME" ]; then
    echo "âœ… Azure OpenAI is configured"
  else
    echo "âŒ Azure OpenAI: Missing BASE_URL or RESOURCE_NAME"
  fi
fi

# æ£€æŸ¥ Google Cloud
if [ -n "$GOOGLE_CLOUD_PROJECT" ]; then
  echo "âœ… Google Cloud Project is set: $GOOGLE_CLOUD_PROJECT"
fi

# æ£€æŸ¥ AWS
if [ -n "$AWS_PROFILE" ] || [ -n "$AWS_ACCESS_KEY_ID" ]; then
  echo "âœ… AWS credentials are configured"
fi

echo ""
echo "ğŸ‰ Validation complete!"
```

### 8.3 æµ‹è¯• API Key

```bash
# æµ‹è¯• Anthropic API Key
curl https://api.anthropic.com/v1/messages \
  -H "x-api-key: $ANTHROPIC_API_KEY" \
  -H "anthropic-version: 2023-06-01" \
  -H "content-type: application/json" \
  -d '{
    "model": "claude-opus-4",
    "max_tokens": 10,
    "messages": [{"role": "user", "content": "Hi"}]
  }'

# æµ‹è¯• OpenAI API Key
curl https://api.openai.com/v1/chat/completions \
  -H "Authorization: Bearer $OPENAI_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{
    "model": "gpt-4o",
    "messages": [{"role": "user", "content": "Hi"}],
    "max_tokens": 10
  }'
```

---

## ä¹ã€å¤šç¯å¢ƒç®¡ç†

### 9.1 å¼€å‘/ç”Ÿäº§ç¯å¢ƒåˆ†ç¦»

```bash
# å¼€å‘ç¯å¢ƒ (.env.development)
ANTHROPIC_API_KEY=sk-ant-dev-...
OPENAI_API_KEY=sk-proj-dev-...
PI_DEBUG=1
PI_LOG_LEVEL=debug

# ç”Ÿäº§ç¯å¢ƒ (.env.production)
ANTHROPIC_API_KEY=sk-ant-prod-...
OPENAI_API_KEY=sk-proj-prod-...
PI_DEBUG=0
PI_LOG_LEVEL=warn
```

**åŠ è½½ç‰¹å®šç¯å¢ƒï¼š**

```bash
# å¼€å‘ç¯å¢ƒ
source .env.development
pi

# ç”Ÿäº§ç¯å¢ƒ
source .env.production
pi
```

### 9.2 é¡¹ç›®çº§ç¯å¢ƒéš”ç¦»

```bash
# é¡¹ç›® A
cd /path/to/project-a
cat > .env << 'EOF'
ANTHROPIC_API_KEY=sk-ant-project-a-...
EOF
direnv allow
pi

# é¡¹ç›® B
cd /path/to/project-b
cat > .env << 'EOF'
ANTHROPIC_API_KEY=sk-ant-project-b-...
EOF
direnv allow
pi
```

### 9.3 å›¢é˜Ÿåä½œé…ç½®

```bash
# .env.exampleï¼ˆæäº¤åˆ° Gitï¼‰
ANTHROPIC_API_KEY=sk-ant-your-key-here
OPENAI_API_KEY=sk-proj-your-key-here
AZURE_OPENAI_BASE_URL=https://your-resource.openai.azure.com

# .envï¼ˆä¸æäº¤åˆ° Gitï¼‰
ANTHROPIC_API_KEY=sk-ant-actual-key-...
OPENAI_API_KEY=sk-proj-actual-key-...
AZURE_OPENAI_BASE_URL=https://team-resource.openai.azure.com

# .gitignore
.env
.env.local
.env.*.local
```

---

## åã€æ•…éšœæ’æŸ¥

### 10.1 ç¯å¢ƒå˜é‡æœªç”Ÿæ•ˆ

**é—®é¢˜ï¼š** è®¾ç½®äº†ç¯å¢ƒå˜é‡ä½† Pi æœªè¯†åˆ«

**æ’æŸ¥æ­¥éª¤ï¼š**

```bash
# 1. æ£€æŸ¥ç¯å¢ƒå˜é‡æ˜¯å¦è®¾ç½®
echo $ANTHROPIC_API_KEY

# 2. æ£€æŸ¥ Shell é…ç½®æ–‡ä»¶
cat ~/.bashrc | grep ANTHROPIC
cat ~/.zshrc | grep ANTHROPIC

# 3. é‡æ–°åŠ è½½ Shell é…ç½®
source ~/.bashrc  # æˆ– source ~/.zshrc

# 4. æ£€æŸ¥ Pi æ˜¯å¦è¯»å–åˆ°ç¯å¢ƒå˜é‡
pi --help
# æŸ¥çœ‹æ˜¯å¦æ˜¾ç¤º Provider ä¿¡æ¯

# 5. ä½¿ç”¨ Debug æ¨¡å¼
PI_DEBUG=1 pi
```

### 10.2 ç¯å¢ƒå˜é‡å†²çª

**é—®é¢˜ï¼š** å¤šä¸ªé…ç½®æºå¯¼è‡´å†²çª

**è§£å†³æ–¹æ¡ˆï¼š**

```bash
# æ¸…é™¤æ‰€æœ‰ç›¸å…³ç¯å¢ƒå˜é‡
unset ANTHROPIC_API_KEY
unset OPENAI_API_KEY

# åªä½¿ç”¨ auth.json
cat > ~/.pi/agent/auth.json << 'EOF'
{
  "anthropic": {
    "type": "api_key",
    "key": "sk-ant-..."
  }
}
EOF

# è¿è¡Œ pi
pi
```

### 10.3 æƒé™é—®é¢˜

**é—®é¢˜ï¼š** æ— æ³•è¯»å–ç¯å¢ƒå˜é‡

```bash
# æ£€æŸ¥æ–‡ä»¶æƒé™
ls -la ~/.bashrc
ls -la ~/.zshrc

# ä¿®å¤æƒé™
chmod 644 ~/.bashrc
chmod 644 ~/.zshrc
```

---

## åä¸€ã€æœ€ä½³å®è·µ

### 11.1 å®‰å…¨å»ºè®®

1. **ä¸è¦åœ¨å‘½ä»¤è¡Œå†å²ä¸­æš´éœ²å¯†é’¥**
   ```bash
   # âŒ ä¸å®‰å…¨
   export ANTHROPIC_API_KEY=sk-ant-...

   # âœ… å®‰å…¨
   read -s ANTHROPIC_API_KEY
   export ANTHROPIC_API_KEY
   ```

2. **ä½¿ç”¨å¯†é’¥ç®¡ç†å·¥å…·**
   ```bash
   # macOS Keychain
   export ANTHROPIC_API_KEY=$(security find-generic-password -ws 'anthropic')

   # 1Password CLI
   export ANTHROPIC_API_KEY=$(op read 'op://vault/Anthropic/credential')
   ```

3. **å®šæœŸè½®æ¢å¯†é’¥**
   ```bash
   # æ¯ 90 å¤©è½®æ¢ä¸€æ¬¡
   # ä½¿ç”¨è„šæœ¬è‡ªåŠ¨æé†’
   ```

### 11.2 ç»„ç»‡å»ºè®®

1. **ä½¿ç”¨ .env.example æ¨¡æ¿**
   ```bash
   # æä¾›æ¸…æ™°çš„é…ç½®ç¤ºä¾‹
   # ä¸åŒ…å«å®é™…å¯†é’¥
   ```

2. **æ–‡æ¡£åŒ–ç¯å¢ƒå˜é‡**
   ```markdown
   # README.md
   ## Environment Variables

   - `ANTHROPIC_API_KEY`: Your Anthropic API key
   - `OPENAI_API_KEY`: Your OpenAI API key
   - `PI_DEBUG`: Enable debug mode (0 or 1)
   ```

3. **CI/CD ä½¿ç”¨ Secrets**
   ```yaml
   # GitHub Actions
   env:
     ANTHROPIC_API_KEY: ${{ secrets.ANTHROPIC_API_KEY }}
   ```

### 11.3 å¼€å‘å»ºè®®

1. **ä½¿ç”¨ direnv è‡ªåŠ¨åŠ è½½**
   ```bash
   # è¿›å…¥é¡¹ç›®ç›®å½•è‡ªåŠ¨åŠ è½½ .env
   # ç¦»å¼€ç›®å½•è‡ªåŠ¨å¸è½½
   ```

2. **åˆ†ç¦»å¼€å‘/ç”Ÿäº§é…ç½®**
   ```bash
   # .env.development
   # .env.production
   ```

3. **éªŒè¯ç¯å¢ƒå˜é‡**
   ```bash
   # å¯åŠ¨å‰éªŒè¯å¿…éœ€çš„ç¯å¢ƒå˜é‡
   ./validate-env.sh
   ```

---

## åäºŒã€æ€»ç»“

### 12.1 æ ¸å¿ƒè¦ç‚¹

1. **è®¤è¯ç¯å¢ƒå˜é‡**ï¼š15+ Provider çš„ API Key é…ç½®
2. **Provider é…ç½®**ï¼šAzureã€AWSã€Google çš„ç‰¹å®šé…ç½®
3. **Pi è¡Œä¸ºé…ç½®**ï¼šè·¯å¾„ã€OAuthã€è°ƒè¯•ã€ç½‘ç»œ
4. **ä¼˜å…ˆçº§**ï¼šCLI > ç¯å¢ƒå˜é‡ > auth.json > settings.json
5. **æŒä¹…åŒ–**ï¼šShell é…ç½®æ–‡ä»¶ã€.env æ–‡ä»¶ã€direnv

### 12.2 å¸¸ç”¨ç¯å¢ƒå˜é‡

```bash
# æœ€å¸¸ç”¨çš„ 5 ä¸ª
ANTHROPIC_API_KEY=sk-ant-...
OPENAI_API_KEY=sk-proj-...
PI_DEBUG=1
PI_LOG_LEVEL=debug
HTTP_PROXY=http://proxy:8080
```

### 12.3 ä¸‹ä¸€æ­¥

- å­¦ä¹  **é¡¹ç›®çº§é…ç½®**ï¼ˆæ ¸å¿ƒæ¦‚å¿µ 06ï¼‰
- æŒæ¡ **è‡ªå®šä¹‰ Provider**ï¼ˆæ ¸å¿ƒæ¦‚å¿µ 07ï¼‰
- äº†è§£ **å¤š Provider åˆ‡æ¢**ï¼ˆæ ¸å¿ƒæ¦‚å¿µ 08ï¼‰

---

**å‚è€ƒèµ„æ–™ï¼š**
- [Pi Providers Documentation](https://github.com/badlogic/pi-mono/blob/main/packages/coding-agent/docs/providers.md)
- [Pi Environment Variables Source Code](https://github.com/badlogic/pi-mono/blob/main/packages/ai/src/env-api-keys.ts)
- [direnv Documentation](https://direnv.net/)

**æ–‡æ¡£ç‰ˆæœ¬**ï¼šv1.0 (2026-02-18)
