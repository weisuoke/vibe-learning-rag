# Extensions æ‰©å±•å¼€å‘åŸºç¡€ - æœ€å°å¯ç”¨

> æŒæ¡ä»¥ä¸‹å†…å®¹ï¼Œå°±èƒ½å¼€å§‹å¼€å‘ pi-mono Extensions

---

## æ ¸å¿ƒç†å¿µ

**æœ€å°å¯ç”¨**ï¼šç”¨ 20% çš„æ ¸å¿ƒçŸ¥è¯†è§£å†³ 80% çš„å®é™…é—®é¢˜ã€‚

æœ¬æ–‡æ¡£æç‚¼äº† Extensions å¼€å‘çš„æœ€æ ¸å¿ƒçŸ¥è¯†ç‚¹ï¼Œè®©ä½ èƒ½å¤Ÿå¿«é€Ÿä¸Šæ‰‹ï¼Œå¼€å‘å‡ºå®ç”¨çš„æ‰©å±•ã€‚

---

## 4.1 Extension æ¨¡å—çš„åŸºæœ¬ç»“æ„

### æ ¸å¿ƒæ¦‚å¿µ

ä¸€ä¸ª Extension å°±æ˜¯ä¸€ä¸ª TypeScript æ–‡ä»¶ï¼Œå¯¼å‡ºä¸€ä¸ªé»˜è®¤å‡½æ•°ï¼Œæ¥æ”¶ `ExtensionAPI` å‚æ•°ã€‚

### æœ€å°ç¤ºä¾‹

```typescript
import type { ExtensionAPI } from "@mariozechner/pi-coding-agent";

export default function (pi: ExtensionAPI) {
  // åœ¨è¿™é‡Œæ³¨å†ŒåŠŸèƒ½ã€ç›‘å¬äº‹ä»¶
  console.log("Extension loaded!");
}
```

### æ–‡ä»¶ä½ç½®

```bash
# å…¨å±€æ‰©å±•ï¼ˆæ‰€æœ‰é¡¹ç›®å…±äº«ï¼‰
~/.pi/agent/extensions/my-extension.ts

# é¡¹ç›®æ‰©å±•ï¼ˆä»…å½“å‰é¡¹ç›®ï¼‰
.pi/extensions/my-extension.ts
```

### åŠ è½½æ–¹å¼

```bash
# è‡ªåŠ¨åŠ è½½ï¼ˆæ”¾åœ¨ä¸Šè¿°ç›®å½•ï¼‰
pi

# æ˜¾å¼åŠ è½½
pi --extension ./my-extension.ts

# çƒ­é‡è½½ï¼ˆä¿®æ”¹åï¼‰
/reload
```

### å®é™…åº”ç”¨

**åœºæ™¯ï¼šåˆ›å»ºä¸€ä¸ªç®€å•çš„æ—¥å¿—æ‰©å±•**

```typescript
// ~/.pi/agent/extensions/logger.ts
import type { ExtensionAPI } from "@mariozechner/pi-coding-agent";

export default function (pi: ExtensionAPI) {
  console.log("[Logger] Extension loaded at", new Date().toISOString());

  // ç›‘å¬æ‰€æœ‰å·¥å…·è°ƒç”¨
  pi.on("tool_call", async (event, ctx) => {
    console.log(`[Logger] Tool called: ${event.toolName}`);
  });
}
```

**ä½¿ç”¨ï¼š**
```bash
# 1. ä¿å­˜æ–‡ä»¶åˆ° ~/.pi/agent/extensions/logger.ts
# 2. å¯åŠ¨ piï¼ˆè‡ªåŠ¨åŠ è½½ï¼‰
pi

# 3. ç°åœ¨æ‰€æœ‰å·¥å…·è°ƒç”¨éƒ½ä¼šè¢«è®°å½•
```

---

## 4.2 æ³¨å†Œè‡ªå®šä¹‰å·¥å…·

### æ ¸å¿ƒæ¦‚å¿µ

ä½¿ç”¨ `pi.registerTool()` æ³¨å†Œè‡ªå®šä¹‰å·¥å…·ï¼Œè®© Agent å¯ä»¥è°ƒç”¨ã€‚

### æœ€å°ç¤ºä¾‹

```typescript
import { Type } from "@sinclair/typebox";
import type { ExtensionAPI } from "@mariozechner/pi-coding-agent";

export default function (pi: ExtensionAPI) {
  pi.registerTool({
    // å·¥å…·åç§°ï¼ˆAgent è°ƒç”¨æ—¶ä½¿ç”¨ï¼‰
    name: "greet",

    // å·¥å…·æ ‡ç­¾ï¼ˆUI æ˜¾ç¤ºï¼‰
    label: "Greeting",

    // å·¥å…·æè¿°ï¼ˆAgent ç†è§£å·¥å…·ç”¨é€”ï¼‰
    description: "Generate a personalized greeting",

    // å‚æ•°å®šä¹‰ï¼ˆä½¿ç”¨ TypeBoxï¼‰
    parameters: Type.Object({
      name: Type.String({ description: "Name to greet" }),
      language: Type.Optional(
        Type.String({ description: "Language (en/zh)" })
      ),
    }),

    // æ‰§è¡Œå‡½æ•°
    async execute(toolCallId, params, signal, onUpdate, ctx) {
      const { name, language = "en" } = params as {
        name: string;
        language?: string;
      };

      const greeting = language === "zh"
        ? `ä½ å¥½ï¼Œ${name}ï¼`
        : `Hello, ${name}!`;

      return {
        content: [{ type: "text", text: greeting }],
        details: { name, language },
      };
    },
  });
}
```

### å…³é”®è¦ç´ 

1. **name**: å·¥å…·çš„å”¯ä¸€æ ‡è¯†ç¬¦
2. **description**: è®© Agent ç†è§£å·¥å…·çš„ç”¨é€”
3. **parameters**: ä½¿ç”¨ TypeBox å®šä¹‰å‚æ•° schema
4. **execute**: å¼‚æ­¥å‡½æ•°ï¼Œè¿”å› `{ content, details }`

### å®é™…åº”ç”¨

**åœºæ™¯ï¼šæ·»åŠ ä¸€ä¸ªè®¡ç®—å™¨å·¥å…·**

```typescript
import { Type } from "@sinclair/typebox";
import { StringEnum } from "@mariozechner/pi-ai";
import type { ExtensionAPI } from "@mariozechner/pi-coding-agent";

export default function (pi: ExtensionAPI) {
  pi.registerTool({
    name: "calculator",
    label: "Calculator",
    description: "Perform basic arithmetic operations",
    parameters: Type.Object({
      operation: StringEnum(["add", "subtract", "multiply", "divide"] as const),
      a: Type.Number({ description: "First number" }),
      b: Type.Number({ description: "Second number" }),
    }),

    async execute(toolCallId, params, signal, onUpdate, ctx) {
      const { operation, a, b } = params as {
        operation: "add" | "subtract" | "multiply" | "divide";
        a: number;
        b: number;
      };

      let result: number;
      switch (operation) {
        case "add":
          result = a + b;
          break;
        case "subtract":
          result = a - b;
          break;
        case "multiply":
          result = a * b;
          break;
        case "divide":
          if (b === 0) {
            return {
              content: [{ type: "text", text: "Error: Division by zero" }],
              details: { error: "division_by_zero" },
            };
          }
          result = a / b;
          break;
      }

      return {
        content: [
          { type: "text", text: `${a} ${operation} ${b} = ${result}` }
        ],
        details: { operation, a, b, result },
      };
    },
  });
}
```

**ä½¿ç”¨ï¼š**
```bash
# Agent ç°åœ¨å¯ä»¥ä½¿ç”¨ calculator å·¥å…·
> Calculate 15 * 23
# Agent ä¼šè°ƒç”¨ calculator å·¥å…·
```

---

## 4.3 ç›‘å¬å’Œæ‹¦æˆªäº‹ä»¶

### æ ¸å¿ƒæ¦‚å¿µ

ä½¿ç”¨ `pi.on()` ç›‘å¬äº‹ä»¶ï¼Œå¯ä»¥åœ¨å…³é”®æ—¶åˆ»ä»‹å…¥ Agent çš„æ‰§è¡Œæµç¨‹ã€‚

### æœ€å°ç¤ºä¾‹

```typescript
import type { ExtensionAPI } from "@mariozechner/pi-coding-agent";

export default function (pi: ExtensionAPI) {
  // ç›‘å¬å·¥å…·è°ƒç”¨äº‹ä»¶
  pi.on("tool_call", async (event, ctx) => {
    console.log(`Tool: ${event.toolName}`);
    console.log(`Input:`, event.input);

    // å¯ä»¥é˜»æ­¢å·¥å…·è°ƒç”¨
    if (event.toolName === "bash" && event.input.command?.includes("rm -rf")) {
      return { block: true, reason: "Dangerous command blocked" };
    }

    // é»˜è®¤ï¼šå…è®¸ç»§ç»­æ‰§è¡Œ
  });
}
```

### å¸¸ç”¨äº‹ä»¶

| äº‹ä»¶ | è§¦å‘æ—¶æœº | ç”¨é€” |
|------|---------|------|
| `tool_call` | å·¥å…·è°ƒç”¨å‰ | æ‹¦æˆªã€ä¿®æ”¹ã€è®°å½•å·¥å…·è°ƒç”¨ |
| `session_start` | Session å¯åŠ¨æ—¶ | åˆå§‹åŒ–çŠ¶æ€ |
| `session_fork` | Session åˆ†æ”¯æ—¶ | é‡å»ºçŠ¶æ€ |
| `input` | ç”¨æˆ·è¾“å…¥å | è½¬æ¢è¾“å…¥ |
| `agent_turn_start` | Agent å›åˆå¼€å§‹ | æ›´æ–° UI |

### äº‹ä»¶å¤„ç†æ¨¡å¼

```typescript
// 1. ä»…ç›‘å¬ï¼ˆä¸é˜»æ­¢ï¼‰
pi.on("tool_call", async (event, ctx) => {
  console.log("Tool called:", event.toolName);
  // ä¸è¿”å›ä»»ä½•å€¼ = å…è®¸ç»§ç»­
});

// 2. é˜»æ­¢äº‹ä»¶
pi.on("tool_call", async (event, ctx) => {
  if (shouldBlock(event)) {
    return { block: true, reason: "Blocked by extension" };
  }
});

// 3. è½¬æ¢äº‹ä»¶
pi.on("input", async (event, ctx) => {
  const modified = event.text.replace("!!", "");
  return { transform: modified };
});
```

### å®é™…åº”ç”¨

**åœºæ™¯ï¼šå®‰å…¨é˜²æŠ¤æ‰©å±•**

```typescript
import type { ExtensionAPI } from "@mariozechner/pi-coding-agent";

export default function (pi: ExtensionAPI) {
  // å±é™©å‘½ä»¤åˆ—è¡¨
  const dangerousPatterns = [
    /rm\s+-rf\s+\//,           // rm -rf /
    /sudo\s+rm/,               // sudo rm
    /:\(\)\{\s*:\|:&\s*\};:/,  // fork bomb
    /dd\s+if=/,                // dd command
  ];

  pi.on("tool_call", async (event, ctx) => {
    if (event.toolName !== "bash") return;

    const command = event.input.command;
    if (!command) return;

    // æ£€æŸ¥æ˜¯å¦åŒ…å«å±é™©æ¨¡å¼
    for (const pattern of dangerousPatterns) {
      if (pattern.test(command)) {
        // è¯¢é—®ç”¨æˆ·ç¡®è®¤
        const ok = await ctx.ui.confirm(
          "âš ï¸ Dangerous Command Detected",
          `This command may be dangerous:\n\n${command}\n\nAllow execution?`
        );

        if (!ok) {
          return {
            block: true,
            reason: "Blocked by safety extension",
          };
        }
      }
    }
  });
}
```

---

## 4.4 æ³¨å†Œæ–œæ å‘½ä»¤

### æ ¸å¿ƒæ¦‚å¿µ

ä½¿ç”¨ `pi.registerCommand()` æ³¨å†Œæ–œæ å‘½ä»¤ï¼Œè®©ç”¨æˆ·å¯ä»¥é€šè¿‡ `/command` è°ƒç”¨ã€‚

### æœ€å°ç¤ºä¾‹

```typescript
import type { ExtensionAPI } from "@mariozechner/pi-coding-agent";

export default function (pi: ExtensionAPI) {
  pi.registerCommand("hello", {
    description: "Say hello to the user",
    handler: async (args, ctx) => {
      const name = args.trim() || "World";
      ctx.ui.notify(`Hello, ${name}!`, "info");
    },
  });
}
```

**ä½¿ç”¨ï¼š**
```bash
# åœ¨ pi ä¼šè¯ä¸­
/hello
# è¾“å‡º: Hello, World!

/hello Alice
# è¾“å‡º: Hello, Alice!
```

### å¸¦å‚æ•°è¡¥å…¨çš„å‘½ä»¤

```typescript
import type { ExtensionAPI } from "@mariozechner/pi-coding-agent";

export default function (pi: ExtensionAPI) {
  pi.registerCommand("theme", {
    description: "Change the theme",

    // å‚æ•°è‡ªåŠ¨è¡¥å…¨
    getArgumentCompletions: (prefix) => {
      const themes = ["dark", "light", "auto"];
      return themes
        .filter(t => t.startsWith(prefix))
        .map(t => ({ value: t, label: t }));
    },

    handler: async (args, ctx) => {
      const theme = args.trim();
      if (!["dark", "light", "auto"].includes(theme)) {
        ctx.ui.notify("Invalid theme. Use: dark, light, or auto", "error");
        return;
      }

      // è®¾ç½®ä¸»é¢˜é€»è¾‘
      ctx.ui.notify(`Theme changed to: ${theme}`, "success");
    },
  });
}
```

### å®é™…åº”ç”¨

**åœºæ™¯ï¼šå¿«é€ŸæŸ¥çœ‹ Session ä¿¡æ¯**

```typescript
import type { ExtensionAPI } from "@mariozechner/pi-coding-agent";

export default function (pi: ExtensionAPI) {
  pi.registerCommand("info", {
    description: "Show current session information",
    handler: async (args, ctx) => {
      const branch = ctx.sessionManager.getBranch();
      const messageCount = branch.filter(e => e.type === "message").length;
      const toolCalls = branch.filter(
        e => e.type === "message" && e.message.role === "toolResult"
      ).length;

      const info = [
        "ğŸ“Š Session Information",
        "â”€".repeat(40),
        `Messages: ${messageCount}`,
        `Tool Calls: ${toolCalls}`,
        `Branch Length: ${branch.length}`,
        "â”€".repeat(40),
      ].join("\n");

      ctx.ui.notify(info, "info");
    },
  });
}
```

---

## 4.5 çŠ¶æ€ç®¡ç†ï¼ˆé€šè¿‡ tool result detailsï¼‰

### æ ¸å¿ƒæ¦‚å¿µ

Extensions çš„çŠ¶æ€åº”è¯¥å­˜å‚¨åœ¨ tool result çš„ `details` å­—æ®µä¸­ï¼Œè¿™æ ·å¯ä»¥æ”¯æŒ Session åˆ†æ”¯ã€‚

### ä¸ºä»€ä¹ˆä¸ç”¨å¤–éƒ¨æ–‡ä»¶ï¼Ÿ

```typescript
// âŒ é”™è¯¯ï¼šä½¿ç”¨å¤–éƒ¨æ–‡ä»¶
const todosFile = "~/.pi/todos.json";
pi.registerTool({
  name: "todo",
  async execute(toolCallId, params, signal, onUpdate, ctx) {
    const todos = JSON.parse(fs.readFileSync(todosFile));
    // é—®é¢˜ï¼šfork session åï¼Œä¸¤ä¸ªåˆ†æ”¯å…±äº«åŒä¸€ä¸ªæ–‡ä»¶
  },
});

// âœ… æ­£ç¡®ï¼šä½¿ç”¨ details
let todos: Todo[] = [];
pi.registerTool({
  name: "todo",
  async execute(toolCallId, params, signal, onUpdate, ctx) {
    todos.push(newTodo);
    return {
      content: [{ type: "text", text: "Added" }],
      details: { todos: [...todos] }, // çŠ¶æ€ä¿å­˜åœ¨è¿™é‡Œ
    };
  },
});
```

### çŠ¶æ€é‡å»ºæ¨¡å¼

```typescript
import type { ExtensionAPI, ExtensionContext } from "@mariozechner/pi-coding-agent";

interface Todo {
  id: number;
  text: string;
  done: boolean;
}

interface TodoDetails {
  todos: Todo[];
  nextId: number;
}

export default function (pi: ExtensionAPI) {
  // å†…å­˜çŠ¶æ€
  let todos: Todo[] = [];
  let nextId = 1;

  // ä» Session é‡å»ºçŠ¶æ€
  const reconstructState = (ctx: ExtensionContext) => {
    todos = [];
    nextId = 1;

    // éå†å½“å‰åˆ†æ”¯çš„æ‰€æœ‰æ¶ˆæ¯
    for (const entry of ctx.sessionManager.getBranch()) {
      if (entry.type !== "message") continue;
      const msg = entry.message;

      // æ‰¾åˆ°æˆ‘ä»¬çš„å·¥å…·è°ƒç”¨ç»“æœ
      if (msg.role === "toolResult" && msg.toolName === "todo") {
        const details = msg.details as TodoDetails | undefined;
        if (details) {
          todos = details.todos;
          nextId = details.nextId;
        }
      }
    }
  };

  // åœ¨ Session äº‹ä»¶æ—¶é‡å»ºçŠ¶æ€
  pi.on("session_start", async (_, ctx) => reconstructState(ctx));
  pi.on("session_switch", async (_, ctx) => reconstructState(ctx));
  pi.on("session_fork", async (_, ctx) => reconstructState(ctx));

  // æ³¨å†Œå·¥å…·
  pi.registerTool({
    name: "todo",
    description: "Manage todos",
    parameters: Type.Object({
      action: StringEnum(["add", "list", "toggle"] as const),
      text: Type.Optional(Type.String()),
      id: Type.Optional(Type.Number()),
    }),

    async execute(toolCallId, params, signal, onUpdate, ctx) {
      const { action, text, id } = params as {
        action: "add" | "list" | "toggle";
        text?: string;
        id?: number;
      };

      switch (action) {
        case "add":
          if (!text) {
            return {
              content: [{ type: "text", text: "Error: text required" }],
              details: { todos, nextId },
            };
          }
          todos.push({ id: nextId++, text, done: false });
          return {
            content: [{ type: "text", text: `Added: ${text}` }],
            details: { todos: [...todos], nextId }, // ä¿å­˜çŠ¶æ€
          };

        case "list":
          const list = todos.map(t =>
            `[${t.done ? "x" : " "}] #${t.id}: ${t.text}`
          ).join("\n");
          return {
            content: [{ type: "text", text: list || "No todos" }],
            details: { todos: [...todos], nextId },
          };

        case "toggle":
          const todo = todos.find(t => t.id === id);
          if (!todo) {
            return {
              content: [{ type: "text", text: `Todo #${id} not found` }],
              details: { todos: [...todos], nextId },
            };
          }
          todo.done = !todo.done;
          return {
            content: [{ type: "text", text: `Toggled #${id}` }],
            details: { todos: [...todos], nextId }, // ä¿å­˜çŠ¶æ€
          };
      }
    },
  });
}
```

### å…³é”®ç‚¹

1. **çŠ¶æ€å­˜å‚¨åœ¨ details**ï¼šæ¯æ¬¡å·¥å…·è°ƒç”¨éƒ½è¿”å›å®Œæ•´çŠ¶æ€
2. **Session äº‹ä»¶æ—¶é‡å»º**ï¼šç›‘å¬ `session_start`, `session_fork` ç­‰äº‹ä»¶
3. **éå†åˆ†æ”¯å†å²**ï¼šä½¿ç”¨ `ctx.sessionManager.getBranch()` è·å–å†å²
4. **æ”¯æŒåˆ†æ”¯**ï¼šæ¯ä¸ªåˆ†æ”¯æœ‰ç‹¬ç«‹çš„çŠ¶æ€

---

## è¿™äº›çŸ¥è¯†è¶³ä»¥

æŒæ¡ä»¥ä¸Š 5 ä¸ªæ ¸å¿ƒçŸ¥è¯†ç‚¹ï¼Œä½ å°±å¯ä»¥ï¼š

### âœ… èƒ½åšä»€ä¹ˆ

1. **åˆ›å»ºåŸºç¡€æ‰©å±•**
   - ç¼–å†™ Extension æ¨¡å—
   - åŠ è½½å’Œçƒ­é‡è½½æ‰©å±•

2. **æ·»åŠ è‡ªå®šä¹‰å·¥å…·**
   - æ³¨å†Œæ–°å·¥å…·
   - å®šä¹‰å‚æ•° schema
   - å®ç°æ‰§è¡Œé€»è¾‘

3. **æ‹¦æˆªå’Œæ§åˆ¶**
   - ç›‘å¬äº‹ä»¶
   - é˜»æ­¢å±é™©æ“ä½œ
   - è®°å½•æ—¥å¿—

4. **ç”¨æˆ·äº¤äº’**
   - æ³¨å†Œæ–œæ å‘½ä»¤
   - ä½¿ç”¨ UI APIï¼ˆconfirm, notify, selectï¼‰

5. **ç®¡ç†çŠ¶æ€**
   - é€šè¿‡ details å­˜å‚¨çŠ¶æ€
   - æ”¯æŒ Session åˆ†æ”¯
   - é‡å»ºçŠ¶æ€

### âœ… å®é™…åº”ç”¨åœºæ™¯

- **å®‰å…¨é˜²æŠ¤**ï¼šæ‹¦æˆªå±é™©çš„ bash å‘½ä»¤
- **å·¥å…·å¢å¼º**ï¼šæ·»åŠ é¡¹ç›®ç‰¹å®šçš„å·¥å…·ï¼ˆå¦‚æ•°æ®åº“æŸ¥è¯¢ã€API è°ƒç”¨ï¼‰
- **å·¥ä½œæµè‡ªåŠ¨åŒ–**ï¼šè‡ªåŠ¨åˆ›å»º git checkpointã€è‡ªåŠ¨æäº¤
- **UI å®šåˆ¶**ï¼šæ·»åŠ è‡ªå®šä¹‰å‘½ä»¤ã€æ˜¾ç¤ºé¡¹ç›®ä¿¡æ¯
- **çŠ¶æ€ç®¡ç†**ï¼šå®ç° todo åˆ—è¡¨ã€ä¹¦ç­¾ã€ç¬”è®°ç­‰åŠŸèƒ½

### âœ… ä¸ºåç»­å­¦ä¹ æ‰“åŸºç¡€

- **æ ¸å¿ƒæ¦‚å¿µ**ï¼šæ·±å…¥ç†è§£äº‹ä»¶ç³»ç»Ÿã€UI å®šåˆ¶ã€Provider ç®¡ç†
- **å®æˆ˜ä»£ç **ï¼šå­¦ä¹ æ›´å¤æ‚çš„æ‰©å±•æ¨¡å¼å’Œæœ€ä½³å®è·µ
- **é«˜çº§åŠŸèƒ½**ï¼šè‡ªå®šä¹‰ Providerã€MCP é›†æˆã€Sub-Agents

---

## å¿«é€Ÿå‚è€ƒ

### Extension æ¨¡æ¿

```typescript
import type { ExtensionAPI } from "@mariozechner/pi-coding-agent";
import { Type } from "@sinclair/typebox";
import { StringEnum } from "@mariozechner/pi-ai";

export default function (pi: ExtensionAPI) {
  // 1. æ³¨å†Œå·¥å…·
  pi.registerTool({
    name: "my_tool",
    label: "My Tool",
    description: "Tool description",
    parameters: Type.Object({
      param: Type.String(),
    }),
    async execute(toolCallId, params, signal, onUpdate, ctx) {
      return {
        content: [{ type: "text", text: "Result" }],
        details: {},
      };
    },
  });

  // 2. æ³¨å†Œå‘½ä»¤
  pi.registerCommand("my_cmd", {
    description: "Command description",
    handler: async (args, ctx) => {
      ctx.ui.notify("Command executed", "info");
    },
  });

  // 3. ç›‘å¬äº‹ä»¶
  pi.on("tool_call", async (event, ctx) => {
    console.log("Tool:", event.toolName);
  });

  // 4. çŠ¶æ€ç®¡ç†
  let state = {};
  pi.on("session_start", async (_, ctx) => {
    // é‡å»ºçŠ¶æ€
  });
}
```

### å¸¸ç”¨ API

```typescript
// ExtensionAPI
pi.registerTool(definition)
pi.registerCommand(name, config)
pi.registerShortcut(key, handler)
pi.on(event, handler)
pi.off(event, handler)

// ExtensionContext (ctx)
ctx.ui.confirm(title, message)
ctx.ui.select(title, items)
ctx.ui.notify(message, level)
ctx.ui.setFooter(render)
ctx.ui.setHeader(render)
ctx.ui.setWidget(placement, render)
ctx.sessionManager.getBranch()
ctx.exec(command)

// äº‹ä»¶è¿”å›å€¼
{ block: true, reason: "..." }  // é˜»æ­¢äº‹ä»¶
{ transform: modified }          // è½¬æ¢äº‹ä»¶
undefined                        // å…è®¸ç»§ç»­
```

### æ–‡ä»¶ä½ç½®

```bash
# å…¨å±€æ‰©å±•
~/.pi/agent/extensions/

# é¡¹ç›®æ‰©å±•
.pi/extensions/

# æ˜¾å¼åŠ è½½
pi --extension ./my-extension.ts

# çƒ­é‡è½½
/reload
```

---

## ä¸‹ä¸€æ­¥

å®Œæˆæœ€å°å¯ç”¨å­¦ä¹ åï¼Œå»ºè®®ï¼š

1. **å®è·µ**ï¼šåˆ›å»ºä¸€ä¸ªç®€å•çš„æ‰©å±•ï¼ˆå¦‚æ—¥å¿—è®°å½•ã€å®‰å…¨é˜²æŠ¤ï¼‰
2. **é˜…è¯»ç¤ºä¾‹**ï¼šæŸ¥çœ‹ pi-mono çš„å®˜æ–¹ç¤ºä¾‹æ‰©å±•
3. **æ·±å…¥å­¦ä¹ **ï¼šå­¦ä¹ æ ¸å¿ƒæ¦‚å¿µï¼ˆäº‹ä»¶ç³»ç»Ÿã€UI å®šåˆ¶ã€Provider ç®¡ç†ï¼‰
4. **å®æˆ˜é¡¹ç›®**ï¼šå¼€å‘ä¸€ä¸ªå®Œæ•´çš„æ‰©å±•ï¼ˆå¦‚ todo ç®¡ç†ã€git é›†æˆï¼‰

---

## å‚è€ƒèµ„æº

- **å®˜æ–¹ç¤ºä¾‹**: https://github.com/badlogic/pi-mono/tree/main/packages/coding-agent/examples/extensions
- **ç±»å‹å®šä¹‰**: `@mariozechner/pi-coding-agent` åŒ…
- **æ–‡æ¡£**: https://github.com/badlogic/pi-mono/tree/main/packages/coding-agent/docs/extensions.md

---

**ç‰ˆæœ¬**: v1.0
**æœ€åæ›´æ–°**: 2026-02-20
**é€‚ç”¨äº**: pi-mono 2025-2026 ç‰ˆæœ¬
