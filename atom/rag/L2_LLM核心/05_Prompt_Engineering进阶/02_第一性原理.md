# 第一性原理

### 什么是第一性原理？

**第一性原理**：回到事物最基本的真理，从源头思考问题。

---

## 进阶 Prompt 技巧的第一性原理

### 1. 最基础的定义

**进阶 Prompt = 更精确地控制 LLM 的推理过程和输出形式**

仅此而已！所有进阶技巧都是为了这一个目标。

---

### 2. 为什么需要进阶技巧？

**核心问题：LLM 是概率模型，输出具有不确定性**

```
用户期望                    LLM 实际行为
─────────                  ─────────────
固定格式输出        →      格式随机变化
复杂推理正确        →      跳步、出错
风格一致            →      每次不同
```

**根本原因：**

1. **LLM 不是确定性程序**：同样的输入，可能产生不同的输出
2. **LLM 没有"理解"你的意图**：它只是在预测下一个 token
3. **LLM 的训练数据多样**：它见过各种格式和风格，不知道你想要哪种

---

### 3. 进阶技巧的三层价值

#### 价值1：降低不确定性

```python
# 没有示例 → 输出不确定
prompt_uncertain = "总结这篇文章"
# 可能输出：一段话、要点列表、标题+内容...

# 有示例 → 输出确定
prompt_certain = """
总结这篇文章。

示例输出格式：
【主题】：xxx
【要点】：1. xxx 2. xxx 3. xxx
【结论】：xxx

文章：{article}
"""
# 输出格式固定
```

#### 价值2：引导推理过程

```python
# 直接回答 → 容易出错
prompt_direct = "小明有5个苹果，给了小红2个，又买了3个，现在有几个？"
# LLM 可能直接猜：6个（错误）

# 分步推理 → 准确率提升
prompt_cot = """
小明有5个苹果，给了小红2个，又买了3个，现在有几个？

让我们一步步思考：
1. 初始：5个
2. 给出去：5 - 2 = 3个
3. 买回来：3 + 3 = 6个

答案：6个
"""
```

#### 价值3：约束输出空间

```python
# 无约束 → 输出空间无限
prompt_free = "分析这个用户的情感"
# 可能输出：任意格式的文本

# 有约束 → 输出空间有限
prompt_constrained = """
分析这个用户的情感，输出 JSON：
{"sentiment": "positive/negative/neutral", "confidence": 0.0-1.0}
"""
# 输出被限制在特定格式
```

---

### 4. 从第一性原理推导进阶技巧

**推理链：**

```
1. LLM 是概率模型，输出不确定
   ↓
2. 我们需要更确定、更可控的输出
   ↓
3. 如何降低不确定性？
   ↓
4. 方法1：给示例（Few-shot）
   → 让 LLM 看到你想要的输出样式
   ↓
5. 方法2：引导推理（CoT）
   → 让 LLM 按你期望的步骤思考
   ↓
6. 方法3：约束格式（结构化输出）
   → 限制 LLM 的输出空间
   ↓
7. 组合使用 → 输出更准确、更可控、更稳定
```

---

### 5. 在 RAG 中的第一性原理应用

**RAG 的核心挑战：**

```
检索结果（多个文档片段）
        ↓
      LLM
        ↓
准确、格式化的回答
```

**为什么 RAG 更需要进阶技巧？**

| 挑战 | 原因 | 解决方案 |
|------|------|---------|
| 多文档综合 | LLM 不知道如何整合多个来源 | CoT 引导分步分析 |
| 输出格式化 | RAG 输出常需要被程序解析 | 结构化输出（JSON） |
| 回答风格一致 | 用户期望统一的回答体验 | Few-shot 示例 |
| 复杂问题推理 | 需要跨文档推理 | CoT + Query 分解 |

**RAG + 进阶技巧的组合：**

```python
# RAG 进阶 Prompt 模板
RAG_ADVANCED_PROMPT = """
你是一个知识库问答助手。

## 回答示例（Few-shot）
问题：产品保修期是多久？
思考过程：
1. 在文档中搜索"保修"相关内容
2. 找到：保修政策第3条提到"保修期为1年"
3. 确认信息来源可靠
回答：{"answer": "1年", "source": "保修政策第3条", "confidence": "high"}

## 参考文档
{context}

## 用户问题
{query}

请按以下步骤回答（CoT）：
1. 分析问题需要什么信息
2. 在文档中定位相关内容
3. 综合信息形成答案
4. 输出 JSON 格式结果（结构化输出）
"""
```

---

### 6. 一句话总结第一性原理

**进阶 Prompt 技巧的本质是：通过示例、推理引导、格式约束，降低 LLM 输出的不确定性，让结果更可控。**

---

## 三大技巧的第一性原理对比

| 技巧 | 第一性原理 | 核心机制 |
|------|-----------|---------|
| **Few-shot** | 人类通过模仿学习 | 给 LLM 看例子，它会模仿 |
| **CoT** | 复杂问题需要分解 | 引导 LLM 分步思考，减少跳步错误 |
| **结构化输出** | 约束产生确定性 | 限制输出空间，强制特定格式 |

---

**下一步：** [03_核心概念](./03_核心概念.md) - 深入学习 Few-shot、CoT、结构化输出
