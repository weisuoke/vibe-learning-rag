# 30字核心

**长文档处理策略是突破 Context Window 限制的技术，通过分层索引、摘要链与 Map-Reduce 实现超长文档的高效检索与理解。**

---

## 拆解理解

| 关键词 | 含义 |
|-------|------|
| **长文档处理（Long Document Processing）** | 处理超过 LLM Context Window 限制的文档 |
| **Context Window 限制** | LLM 一次能处理的最大 Token 数（如 GPT-4 128K tokens） |
| **分层索引（Hierarchical Indexing）** | 构建多层次索引结构，从粗到细逐层检索 |
| **摘要链（Summary Chain）** | 逐层总结压缩信息，保留核心内容 |
| **Map-Reduce 策略** | 并行处理文档片段，再聚合结果 |

---

## 为什么这句话重要？

理解这句话，你就理解了：

1. **Context Window 是硬约束** → 即使 GPT-4 有 128K tokens，一篇 500 页论文也装不下
2. **不能简单截断** → 直接截断会丢失关键信息，导致回答不完整
3. **需要智能压缩与检索** → 三种策略各有优势，组合使用效果最佳

---

## 长文档处理的一句话公式

```
长文档处理 = 分层索引（快速定位） + 摘要链（信息压缩） + Map-Reduce（并行处理）
```

用前端的话说：

```
长文档处理 = 树形导航（分层索引） + 懒加载（摘要链） + 并发请求（Map-Reduce）
```

---

## 在 RAG 系统中的位置

```
┌─────────────────────────────────────────────────────────────┐
│                    离线索引阶段                               │
│                                                             │
│  长文档输入      ★长文档处理★      向量化          存储        │
│  ┌─────┐       ┌─────────┐       ┌─────┐       ┌─────┐     │
│  │500页│       │分层索引  │       │     │       │     │     │
│  │论文 │  ──→  │摘要链   │  ──→  │Embed│ ──→  │Vector│    │
│  │     │       │Map-Reduce│       │     │       │ DB  │     │
│  └─────┘       └─────────┘       └─────┘       └─────┘     │
│                    ↑                                        │
│                  你在这里                                     │
└─────────────────────────────────────────────────────────────┘
```

---

## 长文档处理 vs 普通分块

| 场景 | 普通分块 | 分层索引 | 摘要链 | Map-Reduce |
|------|---------|---------|--------|-----------|
| 50 页技术文档 | ✅ 直接分块即可 | ⚠️ 有点过度设计 | ⚠️ 有点过度设计 | ⚠️ 有点过度设计 |
| 500 页学术论文 | ❌ 检索精度低 | ✅ 快速定位章节 | ✅ 保留核心观点 | ✅ 并行处理加速 |
| 多文档问答 | ❌ 无法跨文档 | ✅ 统一索引结构 | ✅ 生成全局摘要 | ✅ 并行处理多文档 |
| 需要全文理解 | ❌ 只能局部理解 | ⚠️ 仍需多次检索 | ✅ 摘要包含全局信息 | ✅ 聚合所有片段 |

---

## 三种策略的核心区别

| 策略 | 核心思想 | 适用场景 | 类比 |
|------|---------|---------|------|
| **分层索引** | 构建树形结构，从粗到细检索 | 需要快速定位具体章节 | 书的目录 |
| **摘要链** | 逐层总结，保留核心信息 | 需要理解全文大意 | 读书笔记 |
| **Map-Reduce** | 并行处理，最后聚合 | 需要处理多个独立问题 | 分工合作 |

---

**记住这句话：** 长文档处理 = 分层索引 + 摘要链 + Map-Reduce，突破 Context Window 限制。

---

**下一步：** [02_第一性原理](./02_第一性原理.md) - 从根本理解为什么需要长文档处理策略
