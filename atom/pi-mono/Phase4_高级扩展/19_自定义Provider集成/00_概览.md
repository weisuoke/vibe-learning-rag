# 概览

## 知识点介绍

**自定义Provider集成**是pi-mono扩展能力的核心体现，允许开发者将任何LLM服务（云端API、本地模型、企业内部服务）无缝集成到pi-coding-agent中。

**核心价值：**
- **灵活性**：支持从本地Ollama到企业OAuth服务的各种场景
- **可扩展性**：无需修改源码，通过配置或Extension实现
- **统一体验**：所有Provider使用相同的交互方式

## 学习目标

完成本知识点学习后，你将能够：

1. **基础配置**：使用models.json配置OpenAI兼容的Provider
2. **OAuth集成**：实现Device Code Flow认证
3. **API适配**：为非标准API开发streamSimple函数
4. **生产部署**：理解安全性、性能和监控要点

## 核心概念速览

### 1. models.json配置
- 声明式配置文件
- 适用于80%的场景（OpenAI兼容API）
- 零代码，热重载

### 2. 自定义OAuth
- Device Code Flow适合CLI环境
- 三个核心方法：login, refreshToken, getApiKey
- 自动Token刷新机制

### 3. API适配器
- streamSimple函数统一不同API格式
- AssistantMessageEventStream统一事件流
- 支持文本、工具调用、推理

## 文件导航

### 基础维度（8个文件）
- **01_30字核心.md** - 一句话定义
- **02_第一性原理.md** - 为什么需要自定义Provider
- **04_最小可用.md** - 20%核心知识
- **05_双重类比.md** - TypeScript/Node.js + 日常生活类比
- **06_反直觉点.md** - 3个常见误区
- **08_面试必问.md** - 企业LLM集成面试题
- **10_一句话总结.md** - 50-80字总结

### 核心概念（3个文件）
- **03_核心概念_01_models.json配置.md** - 配置文件详解（300-500行）
- **03_核心概念_02_自定义OAuth.md** - OAuth认证详解（300-500行）
- **03_核心概念_03_API适配器.md** - streamSimple实现详解（300-500行）

### 实战代码（3个文件）
- **07_实战代码_01_基础Provider注册.md** - Ollama本地模型集成
- **07_实战代码_02_OAuth集成实战.md** - 企业OAuth认证实现
- **07_实战代码_03_API适配器开发.md** - 自定义API适配

### 综合（1个文件）
- **09_化骨绵掌.md** - 10个知识卡片

## 学习路径建议

### 快速上手（1小时）
1. 阅读：01_30字核心.md
2. 阅读：04_最小可用.md
3. 实践：07_实战代码_01_基础Provider注册.md（配置Ollama）

### 深入理解（3小时）
1. 阅读：02_第一性原理.md
2. 阅读：03_核心概念_01_models.json配置.md
3. 阅读：05_双重类比.md
4. 阅读：06_反直觉点.md

### 高级应用（5小时）
1. 阅读：03_核心概念_02_自定义OAuth.md
2. 实践：07_实战代码_02_OAuth集成实战.md
3. 阅读：03_核心概念_03_API适配器.md
4. 实践：07_实战代码_03_API适配器开发.md

### 面试准备（1小时）
1. 阅读：08_面试必问.md
2. 复习：09_化骨绵掌.md

## 前置知识

**必需：**
- TypeScript/JavaScript基础
- Node.js开发经验
- HTTP/REST API基础
- 异步编程（async/await）

**推荐：**
- OAuth 2.0基础
- 流式处理概念
- LLM API使用经验

## 实践环境

**开发环境：**
- Node.js 18+
- pi-coding-agent已安装
- 代码编辑器（VS Code推荐）

**测试环境：**
- Ollama（本地模型测试）
- 企业OAuth服务器（OAuth测试）
- 自定义API服务（API适配测试）

## 常见问题

### Q1: 什么时候用models.json，什么时候用Extension？
- **models.json**：OpenAI兼容API，无需OAuth
- **Extension**：需要OAuth、自定义API、复杂逻辑

### Q2: 如何选择API类型？
- API文档说"OpenAI兼容" → `openai-completions`
- Anthropic格式 → `anthropic-messages`
- 完全自定义 → 实现streamSimple

### Q3: OAuth认证失败怎么办？
- 删除`~/.pi/agent/auth.json`
- 重新运行`/login provider-id`
- 检查OAuth服务器连接

### Q4: 如何调试自定义Provider？
- 添加console.log
- 使用curl测试API
- 查看pi日志
- 检查auth.json

## 参考资源

**Pi-mono官方文档：**
- Custom Provider: https://github.com/badlogic/pi-mono/blob/main/packages/coding-agent/docs/custom-provider.md
- Models: https://github.com/badlogic/pi-mono/blob/main/packages/coding-agent/docs/models.md
- Extensions: https://github.com/badlogic/pi-mono/blob/main/packages/coding-agent/docs/extensions.md

**OAuth规范：**
- RFC 8628: OAuth 2.0 Device Authorization Grant

**示例代码：**
- https://github.com/badlogic/pi-mono/tree/main/packages/coding-agent/examples/extensions

## 学习时长

- **快速上手**：1小时
- **深入理解**：3小时
- **高级应用**：5小时
- **面试准备**：1小时
- **总计**：约10小时

## 下一步

完成本知识点后，建议学习：
- **20_MCP_Server集成** - 集成外部服务
- **21_Sub_Agents子代理实现** - 多Agent协作
- **25_构建自定义Coding_Agent** - 完整项目实战
