# åç›´è§‰ç‚¹ - åŠ¨æ€Schema

> æ­ç¤ºåŠ¨æ€Schemaçš„4ä¸ªå¸¸è§è¯¯åŒºï¼Œé¿å…è¸©å‘

---

## è¯¯åŒº1ï¼šåŠ¨æ€å­—æ®µå¯ä»¥éšæ„æ·»åŠ ç´¢å¼•

### âŒ é”™è¯¯è®¤çŸ¥

"æ—¢ç„¶åŠ¨æ€å­—æ®µå¯ä»¥çµæ´»æ·»åŠ ï¼Œé‚£åº”è¯¥ä¹Ÿå¯ä»¥ä¸ºå®ƒä»¬åˆ›å»ºç´¢å¼•æ¥æå‡æŸ¥è¯¢æ€§èƒ½ã€‚"

```python
# é”™è¯¯ç¤ºä¾‹
from pymilvus import Collection, CollectionSchema, FieldSchema, DataType

# åˆ›å»ºå¯ç”¨åŠ¨æ€Schemaçš„Collection
fields = [
    FieldSchema(name="id", dtype=DataType.INT64, is_primary=True, auto_id=True),
    FieldSchema(name="embedding", dtype=DataType.FLOAT_VECTOR, dim=768),
    FieldSchema(name="text", dtype=DataType.VARCHAR, max_length=1000)
]

schema = CollectionSchema(fields=fields, enable_dynamic_field=True)
collection = Collection(name="test", schema=schema)

# æ’å…¥æ•°æ®ï¼ˆåŒ…å«åŠ¨æ€å­—æ®µï¼‰
data = [
    {"text": "doc1", "embedding": [0.1]*768, "author": "Alice"},
    {"text": "doc2", "embedding": [0.2]*768, "author": "Bob"}
]
collection.insert(data)

# âŒ å°è¯•ä¸ºåŠ¨æ€å­—æ®µåˆ›å»ºç´¢å¼•
try:
    collection.create_index(
        field_name="author",  # åŠ¨æ€å­—æ®µ
        index_params={"index_type": "TRIE"}
    )
except Exception as e:
    print(f"é”™è¯¯: {e}")
    # æŠ¥é”™: Field 'author' not found in schema
```

### âœ… æ­£ç¡®ç†è§£

**åŠ¨æ€å­—æ®µä¸æ”¯æŒç´¢å¼•**ï¼Œè¿™æ˜¯è®¾è®¡ä¸Šçš„æƒè¡¡ï¼š

**åŽŸå› 1ï¼šSchemaæœªçŸ¥**
```python
# åŠ¨æ€å­—æ®µçš„Schemaåœ¨æ’å…¥æ—¶æ‰ç¡®å®š
# Milvusæ— æ³•åœ¨åˆ›å»ºCollectionæ—¶ä¸ºæœªçŸ¥å­—æ®µåˆ›å»ºç´¢å¼•

# ç¬¬1æ¡æ•°æ®
{"author": "Alice"}  # authoræ˜¯VARCHAR

# ç¬¬2æ¡æ•°æ®
{"priority": 5}  # priorityæ˜¯INT64

# ç¬¬3æ¡æ•°æ®
{"tags": ["AI", "ML"]}  # tagsæ˜¯ARRAY

# é—®é¢˜ï¼šå¦‚ä½•ä¸ºæœªçŸ¥ç±»åž‹çš„å­—æ®µé¢„å…ˆåˆ›å»ºç´¢å¼•ï¼Ÿ
```

**åŽŸå› 2ï¼šå­˜å‚¨ç»“æž„**
```python
# å›ºå®šå­—æ®µï¼šåˆ—å¼å­˜å‚¨ï¼Œæ”¯æŒç´¢å¼•
fixed_storage = {
    "author": ["Alice", "Bob", "Carol", ...]  # åˆ—å¼å­˜å‚¨ï¼Œå¯ä»¥åˆ›å»ºç´¢å¼•
}

# åŠ¨æ€å­—æ®µï¼šè¡Œå¼å­˜å‚¨ï¼Œä¸æ”¯æŒç´¢å¼•
dynamic_storage = {
    "row_1": {"author": "Alice", "category": "tech"},
    "row_2": {"priority": 5, "tags": ["AI"]},
    "row_3": {"author": "Bob"}
    # æ¯è¡Œçš„å­—æ®µä¸åŒï¼Œæ— æ³•åˆ›å»ºåˆ—å¼ç´¢å¼•
}
```

**åŽŸå› 3ï¼šæ€§èƒ½æƒè¡¡**
```python
# å¦‚æžœæ”¯æŒåŠ¨æ€å­—æ®µç´¢å¼•ï¼Œä¼šå¯¼è‡´ï¼š
# 1. æ¯æ¬¡æ’å…¥æ–°å­—æ®µæ—¶ï¼Œéƒ½è¦åˆ›å»ºæ–°ç´¢å¼•ï¼ˆæ€§èƒ½å¼€é”€å¤§ï¼‰
# 2. ç´¢å¼•å…ƒæ•°æ®çˆ†ç‚¸ï¼ˆæ¯ä¸ªåŠ¨æ€å­—æ®µéƒ½æœ‰ç´¢å¼•ï¼‰
# 3. æŸ¥è¯¢ä¼˜åŒ–å™¨å¤æ‚åº¦æŒ‡æ•°çº§å¢žé•¿
```

### ðŸŽ¯ æ­£ç¡®åšæ³•

**æ–¹æ¡ˆ1ï¼šå°†é«˜é¢‘æŸ¥è¯¢å­—æ®µè¿ç§»åˆ°å›ºå®šå­—æ®µ**

```python
# å¦‚æžœå‘çŽ°æŸä¸ªåŠ¨æ€å­—æ®µæŸ¥è¯¢é¢‘ç¹ï¼Œè¿ç§»åˆ°å›ºå®šå­—æ®µ
# æ­¥éª¤1ï¼šåˆ›å»ºæ–°Schemaï¼ˆæ·»åŠ authorä¸ºå›ºå®šå­—æ®µï¼‰
new_fields = [
    FieldSchema(name="id", dtype=DataType.INT64, is_primary=True, auto_id=True),
    FieldSchema(name="embedding", dtype=DataType.FLOAT_VECTOR, dim=768),
    FieldSchema(name="text", dtype=DataType.VARCHAR, max_length=1000),
    FieldSchema(name="author", dtype=DataType.VARCHAR, max_length=100)  # æ–°å¢žå›ºå®šå­—æ®µ
]

new_schema = CollectionSchema(fields=new_fields, enable_dynamic_field=True)
new_collection = Collection(name="test_v2", schema=new_schema)

# æ­¥éª¤2ï¼šä¸ºå›ºå®šå­—æ®µåˆ›å»ºç´¢å¼•
new_collection.create_index(
    field_name="author",
    index_params={"index_type": "TRIE"}  # âœ… å›ºå®šå­—æ®µæ”¯æŒç´¢å¼•
)

# æ­¥éª¤3ï¼šè¿ç§»æ•°æ®
old_data = old_collection.query(expr="id > 0", output_fields=["*"])
new_collection.insert(old_data)
```

**æ–¹æ¡ˆ2ï¼šä½¿ç”¨ç»„åˆè¿‡æ»¤ç­–ç•¥**

```python
# å…ˆç”¨å›ºå®šå­—æ®µè¿‡æ»¤ï¼ˆæœ‰ç´¢å¼•ï¼Œå¿«ï¼‰ï¼Œå†ç”¨åŠ¨æ€å­—æ®µè¿‡æ»¤ï¼ˆæ— ç´¢å¼•ï¼Œæ…¢ï¼‰
results = collection.search(
    data=[[0.1]*768],
    anns_field="embedding",
    param={"metric_type": "L2", "params": {"nprobe": 10}},
    limit=100,
    expr='text like "database%"',  # å›ºå®šå­—æ®µè¿‡æ»¤ï¼ˆå¿«ï¼‰
    output_fields=["*"]
)

# åœ¨åº”ç”¨å±‚å†è¿‡æ»¤åŠ¨æ€å­—æ®µ
filtered_results = [
    r for r in results[0]
    if r.entity.get("author") == "Alice"  # åŠ¨æ€å­—æ®µè¿‡æ»¤ï¼ˆåº”ç”¨å±‚ï¼‰
]
```

**æ–¹æ¡ˆ3ï¼šæŽ¥å—æ€§èƒ½æŸå¤±**

```python
# å¦‚æžœæŸ¥è¯¢é¢‘çŽ‡ä½Žï¼ŒæŽ¥å—åŠ¨æ€å­—æ®µçš„å…¨æ‰«ææ€§èƒ½
results = collection.query(
    expr='author == "Alice"',  # åŠ¨æ€å­—æ®µè¿‡æ»¤ï¼ˆå…¨æ‰«æï¼‰
    output_fields=["*"]
)
# æ€§èƒ½ï¼š10-100å€æ…¢äºŽå›ºå®šå­—æ®µç´¢å¼•æŸ¥è¯¢
```

### ðŸ“Š æ€§èƒ½å¯¹æ¯”

| å­—æ®µç±»åž‹ | ç´¢å¼•æ”¯æŒ | æŸ¥è¯¢æ€§èƒ½ | é€‚ç”¨åœºæ™¯ |
|---------|---------|---------|---------|
| å›ºå®šå­—æ®µï¼ˆæœ‰ç´¢å¼•ï¼‰ | âœ… | å¿«ï¼ˆæ¯«ç§’çº§ï¼‰ | é«˜é¢‘æŸ¥è¯¢ |
| å›ºå®šå­—æ®µï¼ˆæ— ç´¢å¼•ï¼‰ | âŒ | ä¸­ï¼ˆç§’çº§ï¼‰ | ä¸­é¢‘æŸ¥è¯¢ |
| åŠ¨æ€å­—æ®µ | âŒ | æ…¢ï¼ˆç§’-åˆ†é’Ÿçº§ï¼‰ | ä½Žé¢‘æŸ¥è¯¢ |

---

## è¯¯åŒº2ï¼šåŠ¨æ€å­—æ®µçš„ç±»åž‹å¯ä»¥éšæ„å˜åŒ–

### âŒ é”™è¯¯è®¤çŸ¥

"æ—¢ç„¶æ˜¯åŠ¨æ€å­—æ®µï¼Œé‚£åŒä¸€ä¸ªå­—æ®µååœ¨ä¸åŒæ•°æ®ä¸­å¯ä»¥æœ‰ä¸åŒçš„ç±»åž‹ã€‚"

```python
# é”™è¯¯ç¤ºä¾‹
data = [
    {
        "text": "doc1",
        "embedding": [0.1]*768,
        "priority": 5  # priorityæ˜¯INT64
    },
    {
        "text": "doc2",
        "embedding": [0.2]*768,
        "priority": "high"  # âŒ priorityå˜æˆäº†VARCHAR
    },
    {
        "text": "doc3",
        "embedding": [0.3]*768,
        "priority": [1, 2, 3]  # âŒ priorityå˜æˆäº†ARRAY
    }
]

collection.insert(data)
# å¯èƒ½å¯¼è‡´æŸ¥è¯¢é”™è¯¯æˆ–ç±»åž‹ä¸ä¸€è‡´
```

### âœ… æ­£ç¡®ç†è§£

**åŠ¨æ€å­—æ®µçš„ç±»åž‹åœ¨ç¬¬ä¸€æ¬¡æ’å…¥æ—¶ç¡®å®šï¼ŒåŽç»­æ’å…¥å¿…é¡»ä¿æŒä¸€è‡´**

**åŽŸå› 1ï¼šç±»åž‹æŽ¨æ–­æœºåˆ¶**
```python
# Milvusåœ¨ç¬¬ä¸€æ¬¡é‡åˆ°åŠ¨æ€å­—æ®µæ—¶ï¼ŒæŽ¨æ–­å…¶ç±»åž‹
# ç¬¬1æ¬¡æ’å…¥
data1 = {"text": "doc1", "embedding": [0.1]*768, "priority": 5}
# MilvusæŽ¨æ–­: priorityçš„ç±»åž‹æ˜¯INT64

# ç¬¬2æ¬¡æ’å…¥
data2 = {"text": "doc2", "embedding": [0.2]*768, "priority": "high"}
# MilvusæœŸæœ›: priorityæ˜¯INT64
# å®žé™…: priorityæ˜¯VARCHAR
# ç»“æžœ: ç±»åž‹ä¸åŒ¹é…é”™è¯¯æˆ–éšå¼è½¬æ¢
```

**åŽŸå› 2ï¼šæŸ¥è¯¢ä¸€è‡´æ€§**
```python
# å¦‚æžœå…è®¸ç±»åž‹å˜åŒ–ï¼ŒæŸ¥è¯¢ä¼šå‡ºçŽ°é—®é¢˜
results = collection.query(
    expr='priority > 3',  # å‡è®¾priorityæ˜¯INT64
    output_fields=["*"]
)
# å¦‚æžœæŸäº›è¡Œçš„priorityæ˜¯VARCHARï¼ŒæŸ¥è¯¢ä¼šå¤±è´¥
```

**åŽŸå› 3ï¼šå­˜å‚¨ä¼˜åŒ–**
```python
# Milvuså†…éƒ¨ä¸ºæ¯ä¸ªåŠ¨æ€å­—æ®µç»´æŠ¤ç±»åž‹æ˜ å°„
field_mapping = {
    "priority": {"type": INT64, "first_seen": "2024-01-01"},
    "author": {"type": VARCHAR, "first_seen": "2024-01-01"}
}
# å¦‚æžœç±»åž‹å˜åŒ–ï¼Œæ˜ å°„è¡¨ä¼šæ··ä¹±
```

### ðŸŽ¯ æ­£ç¡®åšæ³•

**æ–¹æ¡ˆ1ï¼šä¿æŒç±»åž‹ä¸€è‡´**

```python
# âœ… æ­£ç¡®ï¼šæ‰€æœ‰æ•°æ®çš„priorityéƒ½æ˜¯INT64
data = [
    {"text": "doc1", "embedding": [0.1]*768, "priority": 5},
    {"text": "doc2", "embedding": [0.2]*768, "priority": 3},
    {"text": "doc3", "embedding": [0.3]*768, "priority": 1}
]
collection.insert(data)
```

**æ–¹æ¡ˆ2ï¼šä½¿ç”¨ä¸åŒçš„å­—æ®µå**

```python
# å¦‚æžœéœ€è¦ä¸åŒç±»åž‹ï¼Œä½¿ç”¨ä¸åŒçš„å­—æ®µå
data = [
    {
        "text": "doc1",
        "embedding": [0.1]*768,
        "priority_level": 5  # INT64
    },
    {
        "text": "doc2",
        "embedding": [0.2]*768,
        "priority_label": "high"  # VARCHAR
    }
]
collection.insert(data)
```

**æ–¹æ¡ˆ3ï¼šç»Ÿä¸€ä¸ºå­—ç¬¦ä¸²ç±»åž‹**

```python
# å¦‚æžœç±»åž‹ä¸ç¡®å®šï¼Œç»Ÿä¸€ä¸ºVARCHAR
data = [
    {"text": "doc1", "embedding": [0.1]*768, "priority": "5"},      # VARCHAR
    {"text": "doc2", "embedding": [0.2]*768, "priority": "high"},   # VARCHAR
    {"text": "doc3", "embedding": [0.3]*768, "priority": "medium"}  # VARCHAR
]
collection.insert(data)

# æŸ¥è¯¢æ—¶è½¬æ¢ç±»åž‹
results = collection.query(expr='priority == "5"', output_fields=["*"])
```

**æ–¹æ¡ˆ4ï¼šä½¿ç”¨JSONå­—æ®µ**

```python
# å¦‚æžœç¡®å®žéœ€è¦çµæ´»ç±»åž‹ï¼Œä½¿ç”¨JSONå­—æ®µ
import json

data = [
    {
        "text": "doc1",
        "embedding": [0.1]*768,
        "metadata": json.dumps({"priority": 5})  # JSONå­—ç¬¦ä¸²
    },
    {
        "text": "doc2",
        "embedding": [0.2]*768,
        "metadata": json.dumps({"priority": "high"})  # JSONå­—ç¬¦ä¸²
    }
]
collection.insert(data)

# æŸ¥è¯¢æ—¶è§£æžJSON
results = collection.query(expr='id > 0', output_fields=["*"])
for r in results:
    metadata = json.loads(r["metadata"])
    print(metadata["priority"])
```

### ðŸ“Š ç±»åž‹ä¸€è‡´æ€§æ£€æŸ¥

```python
# å®žç”¨å·¥å…·ï¼šæ£€æŸ¥åŠ¨æ€å­—æ®µçš„ç±»åž‹ä¸€è‡´æ€§
def check_dynamic_field_types(collection, field_name, sample_size=1000):
    """æ£€æŸ¥åŠ¨æ€å­—æ®µçš„ç±»åž‹ä¸€è‡´æ€§"""
    results = collection.query(
        expr=f"id > 0",
        output_fields=["*"],
        limit=sample_size
    )

    types = {}
    for r in results:
        if field_name in r:
            value = r[field_name]
            value_type = type(value).__name__
            types[value_type] = types.get(value_type, 0) + 1

    if len(types) > 1:
        print(f"âš ï¸ è­¦å‘Š: å­—æ®µ '{field_name}' æœ‰å¤šç§ç±»åž‹:")
        for t, count in types.items():
            print(f"  - {t}: {count} æ¡")
    else:
        print(f"âœ… å­—æ®µ '{field_name}' ç±»åž‹ä¸€è‡´: {list(types.keys())[0]}")

# ä½¿ç”¨ç¤ºä¾‹
check_dynamic_field_types(collection, "priority")
```

---

## è¯¯åŒº3ï¼šåŠ¨æ€Schemaæ¯”å›ºå®šSchemaæ›´å¿«

### âŒ é”™è¯¯è®¤çŸ¥

"åŠ¨æ€Schemaæ›´çµæ´»ï¼Œåº”è¯¥ä¹Ÿæ›´å¿«ï¼Œå› ä¸ºä¸éœ€è¦é¢„å…ˆå®šä¹‰Schemaã€‚"

```python
# é”™è¯¯å‡è®¾
# åŠ¨æ€Schemaï¼šæ— éœ€é¢„å…ˆå®šä¹‰ï¼Œåº”è¯¥æ›´å¿«
dynamic_schema = CollectionSchema(
    fields=[...],
    enable_dynamic_field=True  # è®¤ä¸ºè¿™æ ·æ›´å¿«
)

# å›ºå®šSchemaï¼šéœ€è¦é¢„å…ˆå®šä¹‰ï¼Œåº”è¯¥æ›´æ…¢
fixed_schema = CollectionSchema(
    fields=[...],  # é¢„å…ˆå®šä¹‰æ‰€æœ‰å­—æ®µ
    enable_dynamic_field=False
)
```

### âœ… æ­£ç¡®ç†è§£

**åŠ¨æ€Schemaåœ¨æŸ¥è¯¢æ€§èƒ½ä¸Šé€šå¸¸æ¯”å›ºå®šSchemaæ…¢**

**åŽŸå› 1ï¼šæ— ç´¢å¼•æ”¯æŒ**
```python
# å›ºå®šå­—æ®µï¼šæœ‰ç´¢å¼•ï¼ŒæŸ¥è¯¢å¿«
fixed_field_query = collection.query(
    expr='author == "Alice"',  # authoræ˜¯å›ºå®šå­—æ®µï¼Œæœ‰ç´¢å¼•
    output_fields=["*"]
)
# æ€§èƒ½ï¼šO(log N)ï¼Œæ¯«ç§’çº§

# åŠ¨æ€å­—æ®µï¼šæ— ç´¢å¼•ï¼ŒæŸ¥è¯¢æ…¢
dynamic_field_query = collection.query(
    expr='category == "tech"',  # categoryæ˜¯åŠ¨æ€å­—æ®µï¼Œæ— ç´¢å¼•
    output_fields=["*"]
)
# æ€§èƒ½ï¼šO(N)ï¼Œç§’çº§
```

**åŽŸå› 2ï¼šå­˜å‚¨ç»“æž„**
```python
# å›ºå®šå­—æ®µï¼šåˆ—å¼å­˜å‚¨ï¼Œç¼“å­˜å‹å¥½
fixed_storage = {
    "author": ["Alice", "Bob", "Carol", ...]  # è¿žç»­å†…å­˜ï¼Œç¼“å­˜å‘½ä¸­çŽ‡é«˜
}

# åŠ¨æ€å­—æ®µï¼šè¡Œå¼å­˜å‚¨ï¼Œç¼“å­˜ä¸å‹å¥½
dynamic_storage = {
    "row_1": {"author": "Alice", "category": "tech"},
    "row_2": {"priority": 5},
    "row_3": {"author": "Bob"}
    # åˆ†æ•£å­˜å‚¨ï¼Œç¼“å­˜å‘½ä¸­çŽ‡ä½Ž
}
```

**åŽŸå› 3ï¼šæŸ¥è¯¢ä¼˜åŒ–**
```python
# å›ºå®šå­—æ®µï¼šæŸ¥è¯¢ä¼˜åŒ–å™¨å¯ä»¥ä¼˜åŒ–
# - ä½¿ç”¨ç´¢å¼•
# - å‘é‡åŒ–æ‰§è¡Œ
# - å¹¶è¡ŒæŸ¥è¯¢

# åŠ¨æ€å­—æ®µï¼šæŸ¥è¯¢ä¼˜åŒ–å™¨æ— æ³•ä¼˜åŒ–
# - å…¨è¡¨æ‰«æ
# - é€è¡Œè§£æž
# - ä¸²è¡Œæ‰§è¡Œ
```

### ðŸŽ¯ æ­£ç¡®åšæ³•

**æ–¹æ¡ˆ1ï¼šé«˜é¢‘å­—æ®µä½¿ç”¨å›ºå®šSchema**

```python
# æ ¹æ®æŸ¥è¯¢é¢‘çŽ‡é€‰æ‹©Schemaç­–ç•¥
# é«˜é¢‘æŸ¥è¯¢å­—æ®µï¼šå›ºå®šSchema
high_freq_schema = CollectionSchema(
    fields=[
        FieldSchema(name="id", dtype=DataType.INT64, is_primary=True),
        FieldSchema(name="embedding", dtype=DataType.FLOAT_VECTOR, dim=768),
        FieldSchema(name="author", dtype=DataType.VARCHAR, max_length=100),  # é«˜é¢‘
        FieldSchema(name="category", dtype=DataType.VARCHAR, max_length=50)  # é«˜é¢‘
    ],
    enable_dynamic_field=True  # ä½Žé¢‘å­—æ®µä½¿ç”¨åŠ¨æ€
)
```

**æ–¹æ¡ˆ2ï¼šåˆ†å±‚æŸ¥è¯¢ç­–ç•¥**

```python
# å…ˆç”¨å›ºå®šå­—æ®µè¿‡æ»¤ï¼ˆå¿«ï¼‰ï¼Œå†ç”¨åŠ¨æ€å­—æ®µè¿‡æ»¤ï¼ˆæ…¢ï¼‰
# æ­¥éª¤1ï¼šç”¨å›ºå®šå­—æ®µç¼©å°èŒƒå›´
results = collection.search(
    data=[[0.1]*768],
    anns_field="embedding",
    param={"metric_type": "L2", "params": {"nprobe": 10}},
    limit=1000,  # å…ˆè¿”å›ž1000æ¡
    expr='author == "Alice"',  # å›ºå®šå­—æ®µè¿‡æ»¤ï¼ˆå¿«ï¼‰
    output_fields=["*"]
)

# æ­¥éª¤2ï¼šç”¨åŠ¨æ€å­—æ®µç²¾ç¡®è¿‡æ»¤
filtered = [
    r for r in results[0]
    if r.entity.get("priority", 0) > 3  # åŠ¨æ€å­—æ®µè¿‡æ»¤ï¼ˆåº”ç”¨å±‚ï¼‰
]
```

**æ–¹æ¡ˆ3ï¼šç¼“å­˜çƒ­æ•°æ®**

```python
# å¯¹äºŽé¢‘ç¹æŸ¥è¯¢çš„åŠ¨æ€å­—æ®µï¼Œç¼“å­˜ç»“æžœ
import functools

@functools.lru_cache(maxsize=1000)
def query_by_dynamic_field(field_name, field_value):
    """ç¼“å­˜åŠ¨æ€å­—æ®µæŸ¥è¯¢ç»“æžœ"""
    return collection.query(
        expr=f'{field_name} == "{field_value}"',
        output_fields=["*"]
    )

# ç¬¬ä¸€æ¬¡æŸ¥è¯¢ï¼šæ…¢ï¼ˆå…¨æ‰«æï¼‰
results1 = query_by_dynamic_field("category", "tech")

# ç¬¬äºŒæ¬¡æŸ¥è¯¢ï¼šå¿«ï¼ˆç¼“å­˜å‘½ä¸­ï¼‰
results2 = query_by_dynamic_field("category", "tech")
```

### ðŸ“Š æ€§èƒ½å¯¹æ¯”å®žæµ‹

```python
import time

# æµ‹è¯•1ï¼šå›ºå®šå­—æ®µæŸ¥è¯¢
start = time.time()
results = collection.query(
    expr='author == "Alice"',  # å›ºå®šå­—æ®µï¼Œæœ‰ç´¢å¼•
    output_fields=["*"]
)
fixed_time = time.time() - start
print(f"å›ºå®šå­—æ®µæŸ¥è¯¢: {fixed_time:.3f}ç§’")

# æµ‹è¯•2ï¼šåŠ¨æ€å­—æ®µæŸ¥è¯¢
start = time.time()
results = collection.query(
    expr='category == "tech"',  # åŠ¨æ€å­—æ®µï¼Œæ— ç´¢å¼•
    output_fields=["*"]
)
dynamic_time = time.time() - start
print(f"åŠ¨æ€å­—æ®µæŸ¥è¯¢: {dynamic_time:.3f}ç§’")

print(f"æ€§èƒ½å·®å¼‚: {dynamic_time / fixed_time:.1f}x")
```

**å…¸åž‹ç»“æžœ**ï¼š
```
å›ºå®šå­—æ®µæŸ¥è¯¢: 0.015ç§’
åŠ¨æ€å­—æ®µæŸ¥è¯¢: 1.250ç§’
æ€§èƒ½å·®å¼‚: 83.3x
```

---

## è¯¯åŒº4ï¼šåŠ¨æ€Schemaå¯ä»¥å®Œå…¨æ›¿ä»£å›ºå®šSchema

### âŒ é”™è¯¯è®¤çŸ¥

"æ—¢ç„¶åŠ¨æ€Schemaè¿™ä¹ˆçµæ´»ï¼Œé‚£å°±å…¨éƒ¨ä½¿ç”¨åŠ¨æ€Schemaï¼Œä¸éœ€è¦å›ºå®šSchemaäº†ã€‚"

```python
# é”™è¯¯ç¤ºä¾‹ï¼šå…¨éƒ¨ä½¿ç”¨åŠ¨æ€Schema
fields = [
    FieldSchema(name="id", dtype=DataType.INT64, is_primary=True, auto_id=True),
    FieldSchema(name="embedding", dtype=DataType.FLOAT_VECTOR, dim=768)
]

schema = CollectionSchema(
    fields=fields,
    enable_dynamic_field=True
)

# æ‰€æœ‰å­—æ®µéƒ½ä½œä¸ºåŠ¨æ€å­—æ®µæ’å…¥
data = [
    {
        "embedding": [0.1]*768,
        "text": "doc1",        # åŠ¨æ€å­—æ®µ
        "author": "Alice",     # åŠ¨æ€å­—æ®µ
        "category": "tech",    # åŠ¨æ€å­—æ®µ
        "priority": 5,         # åŠ¨æ€å­—æ®µ
        "created_at": "2024-01-01"  # åŠ¨æ€å­—æ®µ
    }
]
collection.insert(data)
```

### âœ… æ­£ç¡®ç†è§£

**åŠ¨æ€Schemaå’Œå›ºå®šSchemaå„æœ‰ä¼˜åŠ¿ï¼Œåº”è¯¥ç»“åˆä½¿ç”¨**

**å›ºå®šSchemaçš„ä¼˜åŠ¿**ï¼š

1. **æ€§èƒ½ä¼˜åŒ–**
```python
# å›ºå®šå­—æ®µï¼šæ”¯æŒç´¢å¼•ï¼ŒæŸ¥è¯¢å¿«
fixed_field = FieldSchema(name="author", dtype=DataType.VARCHAR, max_length=100)
collection.create_index(field_name="author", index_params={"index_type": "TRIE"})
# æŸ¥è¯¢æ€§èƒ½ï¼šæ¯«ç§’çº§
```

2. **ç±»åž‹å®‰å…¨**
```python
# å›ºå®šå­—æ®µï¼šç¼–è¯‘æ—¶ç±»åž‹æ£€æŸ¥
fixed_field = FieldSchema(
    name="priority",
    dtype=DataType.INT64,
    # ç±»åž‹çº¦æŸï¼šåªèƒ½æ˜¯INT64
)

# åŠ¨æ€å­—æ®µï¼šè¿è¡Œæ—¶ç±»åž‹æŽ¨æ–­
# å¯èƒ½å¯¼è‡´ç±»åž‹ä¸ä¸€è‡´
```

3. **æŸ¥è¯¢èƒ½åŠ›**
```python
# å›ºå®šå­—æ®µï¼šæ”¯æŒå¤æ‚æŸ¥è¯¢
results = collection.query(
    expr='priority > 3 and priority < 10',  # èŒƒå›´æŸ¥è¯¢
    output_fields=["*"]
)

# åŠ¨æ€å­—æ®µï¼šåªæ”¯æŒåŸºæœ¬è¿‡æ»¤
results = collection.query(
    expr='priority == 5',  # åªæ”¯æŒç­‰å€¼æŸ¥è¯¢
    output_fields=["*"]
)
```

4. **å­˜å‚¨æ•ˆçŽ‡**
```python
# å›ºå®šå­—æ®µï¼šåˆ—å¼å­˜å‚¨ï¼ŒåŽ‹ç¼©çŽ‡é«˜
# 100ä¸‡æ¡æ•°æ®ï¼Œauthorå­—æ®µï¼š10MB

# åŠ¨æ€å­—æ®µï¼šè¡Œå¼å­˜å‚¨ï¼ŒåŽ‹ç¼©çŽ‡ä½Ž
# 100ä¸‡æ¡æ•°æ®ï¼Œauthorå­—æ®µï¼š50MB
```

**åŠ¨æ€Schemaçš„ä¼˜åŠ¿**ï¼š

1. **çµæ´»æ€§**
```python
# æ— éœ€é¢„å…ˆå®šä¹‰ï¼Œå¯ä»¥éšæ—¶æ·»åŠ æ–°å­—æ®µ
data1 = {"embedding": [0.1]*768, "author": "Alice"}
data2 = {"embedding": [0.2]*768, "category": "tech"}  # ä¸åŒçš„å­—æ®µ
```

2. **å¿«é€Ÿè¿­ä»£**
```python
# æ— éœ€é‡å»ºCollectionï¼Œå¯ä»¥å¿«é€Ÿè¯•é”™
# ä»Šå¤©æ·»åŠ "priority"å­—æ®µ
data1 = {"embedding": [0.1]*768, "priority": 5}

# æ˜Žå¤©æ·»åŠ "tags"å­—æ®µ
data2 = {"embedding": [0.2]*768, "tags": ["AI", "ML"]}
```

3. **å¤šæ¨¡æ€æ”¯æŒ**
```python
# ä¸åŒç±»åž‹çš„æ•°æ®æœ‰ä¸åŒçš„å­—æ®µ
text_doc = {"embedding": [0.1]*768, "text": "content", "author": "Alice"}
image_doc = {"embedding": [0.2]*768, "image_url": "http://...", "resolution": "1920x1080"}
audio_doc = {"embedding": [0.3]*768, "audio_url": "http://...", "duration": 120}
```

### ðŸŽ¯ æ­£ç¡®åšæ³•

**æ–¹æ¡ˆ1ï¼šæ··åˆä½¿ç”¨ï¼ˆæŽ¨èï¼‰**

```python
# æ ¸å¿ƒå­—æ®µï¼šå›ºå®šSchemaï¼ˆæ€§èƒ½ï¼‰
# æ‰©å±•å­—æ®µï¼šåŠ¨æ€Schemaï¼ˆçµæ´»æ€§ï¼‰
fields = [
    FieldSchema(name="id", dtype=DataType.INT64, is_primary=True, auto_id=True),
    FieldSchema(name="embedding", dtype=DataType.FLOAT_VECTOR, dim=768),
    FieldSchema(name="text", dtype=DataType.VARCHAR, max_length=1000),
    FieldSchema(name="author", dtype=DataType.VARCHAR, max_length=100),  # é«˜é¢‘æŸ¥è¯¢
    FieldSchema(name="category", dtype=DataType.VARCHAR, max_length=50)  # é«˜é¢‘æŸ¥è¯¢
]

schema = CollectionSchema(
    fields=fields,
    enable_dynamic_field=True  # ä½Žé¢‘å­—æ®µä½¿ç”¨åŠ¨æ€
)

# æ’å…¥æ•°æ®
data = {
    # å›ºå®šå­—æ®µ
    "text": "Document content",
    "embedding": [0.1]*768,
    "author": "Alice",
    "category": "tech",
    # åŠ¨æ€å­—æ®µ
    "priority": 5,
    "tags": ["AI", "ML"],
    "metadata": {"version": "1.0"}
}
collection.insert([data])
```

**æ–¹æ¡ˆ2ï¼šæ¸è¿›å¼è¿ç§»**

```python
# é˜¶æ®µ1ï¼šå¿«é€ŸåŽŸåž‹ï¼ˆå…¨éƒ¨åŠ¨æ€ï¼‰
schema_v1 = CollectionSchema(
    fields=[
        FieldSchema(name="id", dtype=DataType.INT64, is_primary=True),
        FieldSchema(name="embedding", dtype=DataType.FLOAT_VECTOR, dim=768)
    ],
    enable_dynamic_field=True
)

# é˜¶æ®µ2ï¼šä¼˜åŒ–é«˜é¢‘å­—æ®µï¼ˆè¿ç§»åˆ°å›ºå®šï¼‰
schema_v2 = CollectionSchema(
    fields=[
        FieldSchema(name="id", dtype=DataType.INT64, is_primary=True),
        FieldSchema(name="embedding", dtype=DataType.FLOAT_VECTOR, dim=768),
        FieldSchema(name="author", dtype=DataType.VARCHAR, max_length=100)  # è¿ç§»
    ],
    enable_dynamic_field=True
)

# é˜¶æ®µ3ï¼šç”Ÿäº§çŽ¯å¢ƒï¼ˆå›ºå®šSchemaï¼‰
schema_v3 = CollectionSchema(
    fields=[
        FieldSchema(name="id", dtype=DataType.INT64, is_primary=True),
        FieldSchema(name="embedding", dtype=DataType.FLOAT_VECTOR, dim=768),
        FieldSchema(name="author", dtype=DataType.VARCHAR, max_length=100),
        FieldSchema(name="category", dtype=DataType.VARCHAR, max_length=50),
        FieldSchema(name="priority", dtype=DataType.INT64)
    ],
    enable_dynamic_field=False  # å…³é—­åŠ¨æ€
)
```

**æ–¹æ¡ˆ3ï¼šæŒ‰åœºæ™¯é€‰æ‹©**

```python
# åœºæ™¯1ï¼šå®žéªŒæ€§é¡¹ç›® â†’ åŠ¨æ€Schema
# åœºæ™¯2ï¼šç”Ÿäº§çŽ¯å¢ƒ â†’ å›ºå®šSchema
# åœºæ™¯3ï¼šå¤šç§Ÿæˆ·ç³»ç»Ÿ â†’ æ··åˆSchema
# åœºæ™¯4ï¼šé«˜æ€§èƒ½è¦æ±‚ â†’ å›ºå®šSchema
# åœºæ™¯5ï¼šå¿«é€Ÿè¿­ä»£ â†’ åŠ¨æ€Schema
```

### ðŸ“Š å†³ç­–çŸ©é˜µ

| éœ€æ±‚ | å›ºå®šSchema | åŠ¨æ€Schema | æ··åˆSchema |
|------|-----------|-----------|-----------|
| é«˜æ€§èƒ½æŸ¥è¯¢ | âœ… æœ€ä½³ | âŒ ä¸é€‚åˆ | âš ï¸ éƒ¨åˆ†æ”¯æŒ |
| çµæ´»æ‰©å±• | âŒ ä¸æ”¯æŒ | âœ… æœ€ä½³ | âœ… æ”¯æŒ |
| ç±»åž‹å®‰å…¨ | âœ… å¼ºç±»åž‹ | âš ï¸ å¼±ç±»åž‹ | âš ï¸ éƒ¨åˆ†å¼ºç±»åž‹ |
| å¿«é€Ÿè¿­ä»£ | âŒ éœ€é‡å»º | âœ… æ— éœ€é‡å»º | âœ… æ— éœ€é‡å»º |
| å­˜å‚¨æ•ˆçŽ‡ | âœ… é«˜ | âš ï¸ ä¸­ | âš ï¸ ä¸­ |
| æŸ¥è¯¢èƒ½åŠ› | âœ… å¼º | âš ï¸ å¼± | âš ï¸ éƒ¨åˆ†å¼º |

---

## æ€»ç»“ï¼šé¿å‘æŒ‡å—

### æ ¸å¿ƒåŽŸåˆ™

1. **åŠ¨æ€å­—æ®µä¸æ”¯æŒç´¢å¼•** â†’ é«˜é¢‘æŸ¥è¯¢å­—æ®µä½¿ç”¨å›ºå®šSchema
2. **åŠ¨æ€å­—æ®µç±»åž‹å¿…é¡»ä¸€è‡´** â†’ ç¬¬ä¸€æ¬¡æ’å…¥ç¡®å®šç±»åž‹ï¼ŒåŽç»­ä¿æŒä¸€è‡´
3. **åŠ¨æ€Schemaæ€§èƒ½è¾ƒä½Ž** â†’ æ ¹æ®æ€§èƒ½è¦æ±‚é€‰æ‹©Schemaç­–ç•¥
4. **åŠ¨æ€Schemaä¸èƒ½å®Œå…¨æ›¿ä»£å›ºå®šSchema** â†’ æ··åˆä½¿ç”¨ï¼Œå‘æŒ¥å„è‡ªä¼˜åŠ¿

### æœ€ä½³å®žè·µ

```python
# âœ… æŽ¨èï¼šæ··åˆä½¿ç”¨
schema = CollectionSchema(
    fields=[
        # å›ºå®šå­—æ®µï¼šæ ¸å¿ƒå­—æ®µ + é«˜é¢‘æŸ¥è¯¢å­—æ®µ
        FieldSchema(name="id", dtype=DataType.INT64, is_primary=True),
        FieldSchema(name="embedding", dtype=DataType.FLOAT_VECTOR, dim=768),
        FieldSchema(name="text", dtype=DataType.VARCHAR, max_length=1000),
        FieldSchema(name="author", dtype=DataType.VARCHAR, max_length=100),
    ],
    enable_dynamic_field=True  # åŠ¨æ€å­—æ®µï¼šä½Žé¢‘æŸ¥è¯¢å­—æ®µ + æ‰©å±•å­—æ®µ
)

# âœ… æŽ¨èï¼šæ¸è¿›å¼ä¼˜åŒ–
# åˆæœŸï¼šåŠ¨æ€Schemaï¼ˆå¿«é€Ÿè¿­ä»£ï¼‰
# ä¸­æœŸï¼šæ··åˆSchemaï¼ˆä¼˜åŒ–é«˜é¢‘å­—æ®µï¼‰
# åŽæœŸï¼šå›ºå®šSchemaï¼ˆç”Ÿäº§çŽ¯å¢ƒï¼‰

# âœ… æŽ¨èï¼šåˆ†å±‚æŸ¥è¯¢
# å…ˆç”¨å›ºå®šå­—æ®µè¿‡æ»¤ï¼ˆå¿«ï¼‰
# å†ç”¨åŠ¨æ€å­—æ®µè¿‡æ»¤ï¼ˆæ…¢ï¼‰
```

---

**è®°ä½**ï¼šåŠ¨æ€Schemaæ˜¯å·¥å…·ï¼Œä¸æ˜¯é“¶å¼¹ã€‚æ ¹æ®å®žé™…éœ€æ±‚é€‰æ‹©åˆé€‚çš„Schemaç­–ç•¥ï¼Œæ‰èƒ½å‘æŒ¥æœ€å¤§ä»·å€¼ã€‚
