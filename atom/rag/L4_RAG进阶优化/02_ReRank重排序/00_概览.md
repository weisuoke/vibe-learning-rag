# 00_概览

## ReRank重排序完整知识体系

本文档是ReRank重排序的完整学习路径，涵盖从基础概念到生产实践的所有内容。

---

## 学习路径

### 第一阶段：快速入门（30分钟）

**目标：** 理解ReRank的核心概念和价值

**学习顺序：**
1. [01_30字核心](./01_30字核心.md) - 30秒理解ReRank本质
2. [10_一句话总结](./10_一句话总结.md) - 1分钟掌握核心要点
3. [04_最小可用](./04_最小可用.md) - 10分钟上手实现
4. [05_双重类比](./05_双重类比.md) - 通过类比深化理解

**学习成果：**
- 理解ReRank是什么、为什么需要
- 能够实现一个基础的ReRank系统
- 掌握Cross-Encoder vs Bi-Encoder的区别

---

### 第二阶段：核心概念（2小时）

**目标：** 深入理解ReRank的技术原理和最佳实践

**学习顺序：**
1. [03_核心概念_01_Cross-Encoder架构](./03_核心概念_01_Cross-Encoder架构.md)
2. [03_核心概念_02_训练方法对比](./03_核心概念_02_训练方法对比.md)
3. [03_核心概念_03_评估指标体系](./03_核心概念_03_评估指标体系.md)
4. [03_核心概念_04_候选集优化](./03_核心概念_04_候选集优化.md)
5. [03_核心概念_05_主流Reranker对比](./03_核心概念_05_主流Reranker对比.md)
6. [03_核心概念_06_成本与延迟权衡](./03_核心概念_06_成本与延迟权衡.md)
7. [03_核心概念_07_LLM_based_Reranking](./03_核心概念_07_LLM_based_Reranking.md)
8. [03_核心概念_08_生产级架构模式](./03_核心概念_08_生产级架构模式.md)

**学习成果：**
- 掌握Cross-Encoder的工作原理
- 理解Pointwise/Pairwise/Listwise训练方法
- 掌握NDCG@10等评估指标
- 能够选择合适的Reranker模型
- 理解成本与延迟的权衡策略

---

### 第三阶段：深度理解（1小时）

**目标：** 从第一性原理理解ReRank，掌握反直觉点

**学习顺序：**
1. [02_第一性原理](./02_第一性原理.md) - 从根本原理推导ReRank的必然性
2. [06_反直觉点](./06_反直觉点.md) - 避免常见误区
3. [09_化骨绵掌](./09_化骨绵掌.md) - 10个知识卡片速记

**学习成果：**
- 理解为什么需要两阶段策略
- 理解为什么候选集50-75是最佳
- 掌握8个反直觉点
- 能够快速回答面试问题

---

### 第四阶段：实战代码（4小时）

**目标：** 掌握各种场景的实战代码实现

**学习顺序：**
1. BGE reranker基础实现
2. Cohere Rerank集成
3. 混合检索+Rerank管道
4. LLM Pointwise重排序
5. LLM Listwise重排序
6. 多模态Reranking
7. 实时优化策略
8. 性能评估与对比
9. 生产级部署示例

**学习成果：**
- 能够集成主流Reranker（BGE、Cohere）
- 能够实现完整的RAG管道
- 能够实现LLM-based reranking
- 能够优化性能和成本
- 能够部署到生产环境

---

### 第五阶段：面试准备（30分钟）

**目标：** 准备技术面试

**学习顺序：**
1. [08_面试必问](./08_面试必问.md) - 8个核心面试问题
2. [09_化骨绵掌](./09_化骨绵掌.md) - 快速复习清单

**学习成果：**
- 能够回答所有核心面试问题
- 掌握面试速答模板
- 理解技术细节和实践经验

---

## 核心知识点速查

### 1. ReRank的本质

**一句话：** ReRank是RAG的二轮面试官，用Cross-Encoder深度评估候选文档，把真正相关的排到前面。

**关键数据：**
- NDCG@10提升：15-48%
- 成本：$0.025/M tokens
- 延迟：50文档200ms
- 候选集最佳大小：50-75

### 2. Cross-Encoder vs Bi-Encoder

| 维度 | Bi-Encoder | Cross-Encoder |
|------|-----------|--------------|
| 编码方式 | 分别编码 | 联合编码 |
| 交互深度 | 无交互 | 深度注意力 |
| 精度 | 中等 | 高（+15-48%） |
| 延迟 | 10-50ms | 200ms-2s |
| 适用 | 初检 | 精排 |

### 3. 主流Reranker选择

| Reranker | NDCG@10 | 延迟 | 成本 | 推荐场景 |
|----------|---------|------|------|---------|
| **BGE reranker-v2-m3** | 0.85 | 200ms | $0.025/M | 生产首选 |
| Cohere Rerank 4 | 0.90 | 150ms | $0.050/M | 企业级 |
| ZeroEntropy zerank-1 | 0.87 | 60ms | $0.030/M | 性能优先 |

### 4. 两阶段策略

```
BM25初检（10ms）→ 向量检索（50ms）→ RRF融合（5ms）→
Cross-Encoder ReRank（200ms）→ LLM生成（1s）= 总计1.3秒
```

### 5. 成本对比

| 方法 | 成本/M tokens | 10万query/天 |
|------|--------------|-------------|
| Cross-Encoder | $0.025 | $2.5 |
| LLM Pointwise | $0.50 | $50 |
| LLM Listwise | $1.00 | $100 |

---

## 常见问题速答

**Q: 什么时候需要ReRank？**
A: 所有需要高精度排序的RAG系统都需要ReRank。

**Q: 候选集大小如何选择？**
A: 50-75是最佳平衡点，召回率90-93%，NDCG@10达0.85-0.87。

**Q: 选择哪个Reranker？**
A: 生产环境推荐BGE reranker-v2-m3（开源、成本低、精度高）。

**Q: LLM reranking值得吗？**
A: 不值得。精度仅高5-8%，但成本高60倍，延迟慢12倍。

**Q: 如何优化延迟？**
A: 批处理（5倍加速）、语义缓存（降低成本68.8%）、异步处理。

---

## 学习建议

### 初学者路径（总计8小时）

1. **第一天（2小时）：** 快速入门 + 核心概念前4个
2. **第二天（2小时）：** 核心概念后4个 + 深度理解
3. **第三天（4小时）：** 实战代码全部完成

### 进阶者路径（总计4小时）

1. **核心概念（2小时）：** 重点学习概念5-8
2. **实战代码（2小时）：** 重点学习场景3、7、9

### 面试准备路径（总计1小时）

1. **快速复习（30分钟）：** 化骨绵掌 + 一句话总结
2. **面试必问（30分钟）：** 8个核心问题 + 速答模板

---

## 实战检查清单

### 设计阶段
- [ ] 确定初检方法（BM25、向量检索、混合检索）
- [ ] 选择ReRank模型（Cohere、BGE、ZeroEntropy）
- [ ] 设定候选集大小（推荐50-75）
- [ ] 设定输出Top-K（推荐5-10）
- [ ] 评估延迟预算（目标<2秒）
- [ ] 评估成本预算（目标<$0.05/M tokens）

### 实现阶段
- [ ] 集成初检模块（BM25/向量检索）
- [ ] 集成ReRank模型（API或自托管）
- [ ] 实现RRF融合（如果使用混合检索）
- [ ] 添加批处理优化
- [ ] 添加缓存机制
- [ ] 添加降级策略（超时时使用初检结果）

### 评估阶段
- [ ] 计算NDCG@10（目标>0.85）
- [ ] 测量端到端延迟（目标<2秒）
- [ ] 计算成本（目标<$0.05/M tokens）
- [ ] A/B测试（vs无ReRank基线）
- [ ] 用户满意度调查

### 优化阶段
- [ ] 调整候选集大小（平衡召回率和延迟）
- [ ] 尝试不同ReRank模型
- [ ] 优化批处理大小
- [ ] 实现语义缓存（降低重复请求成本）
- [ ] 监控生产指标（延迟、成本、准确率）

---

## 参考资料

### 核心研究
- [Cross-Encoder Reranking Improves RAG Accuracy by 40%](https://app.ailog.fr/en/blog/news/reranking-cross-encoders-study) - MIT, 2026
- [Databricks Reranking Research](https://www.databricks.com/blog/reranking-mosaic-ai-vector-search-faster-smarter-retrieval-rag-agents) - 2026

### 技术指南
- [Ultimate Guide to Choosing the Best Reranking Model in 2026](https://www.zeroentropy.dev/articles/ultimate-guide-to-choosing-the-best-reranking-model-in-2025)
- [Top 7 Rerankers for RAG](https://www.analyticsvidhya.com/blog/2025/06/top-rerankers-for-rag)

### 官方文档
- [Cohere Rerank Best Practices](https://docs.cohere.com/docs/reranking-best-practices)
- [BGE Reranker v2-m3](https://huggingface.co/BAAI/bge-reranker-v2-m3)
- [FlagEmbedding GitHub](https://github.com/FlagOpen/FlagEmbedding)

---

**版本：** v1.0 (2026年标准)
**最后更新：** 2026-02-16
**总学习时间：** 8小时（初学者）/ 4小时（进阶者）/ 1小时（面试准备）
