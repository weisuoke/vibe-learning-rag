# 多语言生态

**知识点数**: 15个 | **学习时长**: 2周 | **优先级**: P2

---

## 概览

**适合人群**: 前端方向、全栈开发

**学习路径**: TypeScript生态（8个）→ 跨语言集成（7个）

---

## L1_TypeScript生态（8个知识点）

### 01_Vercel AI SDK基础

**核心概念**: TypeScript/React生态的AI工具包。

**快速开始**:
```typescript
import { openai } from '@ai-sdk/openai';
import { generateText } from 'ai';

const { text } = await generateText({
  model: openai('gpt-4'),
  prompt: 'What is AI?',
});

console.log(text);
```

**流式响应**:
```typescript
import { streamText } from 'ai';

const result = await streamText({
  model: openai('gpt-4'),
  prompt: 'Write a story',
});

for await (const chunk of result.textStream) {
  process.stdout.write(chunk);
}
```

---

### 02_React集成模式

**核心概念**: useChat和useCompletion Hooks。

**实战代码**:
```typescript
'use client';

import { useChat } from 'ai/react';

export default function Chat() {
  const { messages, input, handleInputChange, handleSubmit } = useChat();

  return (
    <div>
      {messages.map(m => (
        <div key={m.id}>
          {m.role}: {m.content}
        </div>
      ))}

      <form onSubmit={handleSubmit}>
        <input
          value={input}
          onChange={handleInputChange}
          placeholder="Say something..."
        />
      </form>
    </div>
  );
}
```

---

### 03_Next.js集成

**核心概念**: Server Actions和Route Handlers。

**Server Action**:
```typescript
'use server';

import { generateText } from 'ai';
import { openai } from '@ai-sdk/openai';

export async function generateResponse(prompt: string) {
  const { text } = await generateText({
    model: openai('gpt-4'),
    prompt,
  });

  return text;
}
```

**Route Handler**:
```typescript
import { openai } from '@ai-sdk/openai';
import { streamText } from 'ai';

export async function POST(req: Request) {
  const { prompt } = await req.json();

  const result = await streamText({
    model: openai('gpt-4'),
    prompt,
  });

  return result.toAIStreamResponse();
}
```

---

### 04_类型安全Agent

**核心概念**: TypeScript类型系统保证安全。

**实战代码**:
```typescript
import { z } from 'zod';
import { generateObject } from 'ai';

const ResponseSchema = z.object({
  answer: z.string(),
  confidence: z.number().min(0).max(1),
  sources: z.array(z.string()),
});

type Response = z.infer<typeof ResponseSchema>;

async function queryAgent(query: string): Promise<Response> {
  const { object } = await generateObject({
    model: openai('gpt-4'),
    schema: ResponseSchema,
    prompt: query,
  });

  return object;
}
```

---

### 05_工具定义

**核心概念**: 定义和使用工具。

**实战代码**:
```typescript
import { tool } from 'ai';
import { z } from 'zod';

const weatherTool = tool({
  description: 'Get the weather for a location',
  parameters: z.object({
    location: z.string().describe('The city name'),
  }),
  execute: async ({ location }) => {
    const response = await fetch(`https://api.weather.com/${location}`);
    return response.json();
  },
});

const result = await generateText({
  model: openai('gpt-4'),
  tools: { weather: weatherTool },
  prompt: 'What is the weather in San Francisco?',
});
```

---

## L2_跨语言集成（7个知识点）

### 01_API设计

**核心概念**: RESTful API和类型共享。

**FastAPI后端**:
```python
from fastapi import FastAPI
from pydantic import BaseModel

class QueryRequest(BaseModel):
    query: str
    max_tokens: int = 1000

class QueryResponse(BaseModel):
    answer: str
    confidence: float

app = FastAPI()

@app.post("/query", response_model=QueryResponse)
async def query_agent(request: QueryRequest):
    result = await agent.run(request.query)
    return QueryResponse(answer=result.answer, confidence=result.confidence)
```

**TypeScript客户端**:
```typescript
interface QueryRequest {
  query: string;
  maxTokens?: number;
}

interface QueryResponse {
  answer: string;
  confidence: number;
}

async function queryAgent(request: QueryRequest): Promise<QueryResponse> {
  const response = await fetch('/api/query', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(request),
  });

  return response.json();
}
```

---

### 02_类型共享

**核心概念**: 使用OpenAPI生成类型。

**生成TypeScript类型**:
```bash
# 从FastAPI生成OpenAPI schema
curl http://localhost:8000/openapi.json > openapi.json

# 生成TypeScript类型
npx openapi-typescript openapi.json --output types.ts
```

**使用生成的类型**:
```typescript
import type { paths } from './types';

type QueryRequest = paths['/query']['post']['requestBody']['content']['application/json'];
type QueryResponse = paths['/query']['post']['responses']['200']['content']['application/json'];
```

---

### 03_WebSocket实时通信

**核心概念**: 双向实时通信。

**FastAPI WebSocket**:
```python
from fastapi import WebSocket

@app.websocket("/ws")
async def websocket_endpoint(websocket: WebSocket):
    await websocket.accept()

    async for message in websocket.iter_text():
        response = await agent.run(message)
        await websocket.send_text(response)
```

**React WebSocket客户端**:
```typescript
import { useEffect, useState } from 'react';

export function useWebSocket(url: string) {
  const [messages, setMessages] = useState<string[]>([]);
  const [ws, setWs] = useState<WebSocket | null>(null);

  useEffect(() => {
    const socket = new WebSocket(url);

    socket.onmessage = (event) => {
      setMessages(prev => [...prev, event.data]);
    };

    setWs(socket);

    return () => socket.close();
  }, [url]);

  const send = (message: string) => {
    ws?.send(message);
  };

  return { messages, send };
}
```

---

### 04_认证授权

**核心概念**: JWT跨语言认证。

**Python生成JWT**:
```python
from jose import jwt
from datetime import datetime, timedelta

def create_token(user_id: str) -> str:
    payload = {
        "sub": user_id,
        "exp": datetime.utcnow() + timedelta(hours=24)
    }
    return jwt.encode(payload, SECRET_KEY, algorithm="HS256")
```

**TypeScript验证JWT**:
```typescript
import { jwtVerify } from 'jose';

async function verifyToken(token: string) {
  const { payload } = await jwtVerify(
    token,
    new TextEncoder().encode(SECRET_KEY)
  );

  return payload.sub as string;
}
```

---

### 05_错误处理

**核心概念**: 统一错误格式。

**Python错误响应**:
```python
from fastapi import HTTPException

class ErrorResponse(BaseModel):
    error: str
    code: str
    details: dict = {}

@app.exception_handler(Exception)
async def global_exception_handler(request, exc):
    return JSONResponse(
        status_code=500,
        content=ErrorResponse(
            error=str(exc),
            code="INTERNAL_ERROR"
        ).dict()
    )
```

**TypeScript错误处理**:
```typescript
class APIError extends Error {
  constructor(
    public code: string,
    public details: Record<string, any> = {}
  ) {
    super(code);
  }
}

async function handleAPIError(response: Response) {
  if (!response.ok) {
    const error = await response.json();
    throw new APIError(error.code, error.details);
  }
}
```

---

## 核心20%（3个知识点）

1. ⭐⭐⭐ **Vercel AI SDK基础**
2. ⭐⭐⭐ **React集成模式**
3. ⭐⭐⭐ **API设计与类型共享**

---

## 实战项目

### 项目: 全栈AI聊天应用

**技术栈**:
- 前端: Next.js + Vercel AI SDK
- 后端: FastAPI + LangChain
- 通信: REST API + WebSocket

**功能**:
- 实时聊天
- 流式响应
- 类型安全
- JWT认证

---

## 学习资源

- [Vercel AI SDK](https://sdk.vercel.ai/)
- [Next.js文档](https://nextjs.org/docs)
- [OpenAPI Generator](https://openapi-generator.tech/)

---

**版本**: v1.0 | **最后更新**: 2026-02-12
