# 化骨绵掌

> 10个2分钟知识卡片，快速掌握Knowledge Graph核心

---

## 卡片1：直觉理解

**图是什么？**

想象一个社交网络：
- 你是一个节点
- 你的朋友是其他节点
- 你们之间的关系是边

这就是图！

**知识图谱 = 用图表示知识**

```
张三 --[朋友]--> 李四
张三 --[同事]--> 王五
李四 --[同事]--> 王五
```

**核心洞察**：
- 关系和实体同等重要
- 遍历比JOIN快
- 可视化直观

**2分钟记忆**：
图 = 节点 + 边，知识图谱 = 实体 + 关系

---

## 卡片2：SPO三元组

**形式化定义**：
```
三元组 = (Subject, Predicate, Object)
       = (主语, 谓语, 宾语)
```

**示例**：
```
(张三, 工作于, 阿里巴巴)
(阿里巴巴, 位于, 杭州)
(张三, 使用, Python)
```

**提取方法**：
1. 规则：正则表达式
2. NER：命名实体识别
3. LLM：最准确（2025-2026主流）

**代码**：
```python
# LLM提取
result = llm.extract(
    "张三在阿里巴巴工作，使用Python开发"
)
# 输出：
# [(张三, 工作于, 阿里巴巴),
#  (张三, 使用, Python)]
```

**2分钟记忆**：
SPO = 句子结构，LLM提取最准确

---

## 卡片3：Neo4j基础

**Cypher查询语言**：

```cypher
// 创建
CREATE (p:Person {name: '张三', age: 30})

// 查询
MATCH (p:Person {name: '张三'})
RETURN p

// 关系
MATCH (p:Person)-[:WORKS_AT]->(c:Company)
RETURN p.name, c.name

// 多跳
MATCH (p:Person {name: '张三'})
      -[:WORKS_AT]->(:Company)
      -[:LOCATED_IN]->(city:City)
RETURN city.name
```

**Python连接**：
```python
from neo4j import GraphDatabase

driver = GraphDatabase.driver(
    "bolt://localhost:7687",
    auth=("neo4j", "password")
)

with driver.session() as session:
    result = session.run(
        "MATCH (p:Person) RETURN p"
    )
```

**2分钟记忆**：
Cypher像画图，MATCH查询，CREATE创建

---

## 卡片4：向量 vs 图

**对比**：

| 特性 | 向量检索 | 图检索 |
|------|---------|--------|
| 原理 | 语义相似度 | 关系遍历 |
| 优势 | 模糊匹配 | 精确关系 |
| 劣势 | 无关系理解 | 需结构化 |
| 速度 | 快 | 快 |

**混合检索**：
```python
# 1. 向量检索
vector_results = vector_db.search(query)

# 2. 图检索
graph_results = graph_db.search(entities)

# 3. RRF融合
merged = rrf_fusion(vector_results, graph_results)
```

**2分钟记忆**：
向量找相似，图找关系，混合最强

---

## 卡片5：Graphiti时序

**核心概念**：
- Episode：时间快照
- 时序查询：查询历史状态
- 演化追踪：知识变化

**代码**：
```python
# 添加Episode
await graphiti.add_episode(
    name="job_change",
    episode_body="张三从阿里跳槽到腾讯",
    reference_time=datetime(2024, 1, 1)
)

# 时序查询
results = await graphiti.search(
    query="张三在2022年在哪工作？",
    reference_time=datetime(2022, 6, 1)
)
# 答案：阿里巴巴
```

**应用**：
- AI Agent长期记忆
- 对话历史管理
- 知识演化分析

**2分钟记忆**：
Graphiti = 时序图谱，支持历史查询

---

## 卡片6：GraphRAG架构

**流程**：
```
文档 → 实体提取 → 图谱构建
         ↓
    向量检索 + 图检索
         ↓
      结果融合
         ↓
      LLM生成
```

**优势**：
1. 支持多跳推理
2. 提供推理路径
3. 减少幻觉
4. 提高准确率

**代码**：
```python
# 1. 提取实体
entities = extract_entities(query)

# 2. 混合检索
results = hybrid_search(query, entities)

# 3. 生成答案
answer = llm.generate(query, results)
```

**2分钟记忆**：
GraphRAG = 向量 + 图 + LLM

---

## 卡片7：LangGraph集成

**三层记忆**：
```
短期记忆（Thread State）
    ↓
工作记忆（Checkpoints）
    ↓
长期记忆（Graph Store）
```

**代码**：
```python
# 创建状态图
workflow = StateGraph(AgentState)

# 添加节点
workflow.add_node("read_memory", read_memory)
workflow.add_node("process", process)
workflow.add_node("write_memory", write_memory)

# 编译
app = workflow.compile(checkpointer=checkpointer)
```

**应用**：
- 多代理协作
- 跨会话记忆
- 知识共享

**2分钟记忆**：
LangGraph = 状态图 + Neo4j记忆

---

## 卡片8：性能优化

**索引策略**：
```cypher
// 实体名称索引
CREATE INDEX entity_name FOR (e:Entity) ON (e.name)

// 向量索引
CREATE VECTOR INDEX entity_embedding FOR (e:Entity) ON (e.embedding)
OPTIONS {
  indexConfig: {
    `vector.dimensions`: 1536,
    `vector.similarity_function`: 'cosine'
  }
}
```

**查询优化**：
```cypher
// ❌ 慢：全表扫描
MATCH (p:Person)
WHERE p.name = '张三'
RETURN p

// ✅ 快：使用索引
MATCH (p:Person {name: '张三'})
RETURN p
```

**批量导入**：
```python
# 批量导入（1000条/批次）
for i in range(0, len(triples), 1000):
    batch = triples[i:i+1000]
    session.run("UNWIND $batch AS t ...", batch=batch)
```

**2分钟记忆**：
索引 + 批量 + 查询优化 = 高性能

---

## 卡片9：生产部署

**架构**：
```
负载均衡
    ↓
Neo4j集群（3节点）
├── Leader（读写）
├── Follower1（只读）
└── Follower2（只读）
```

**关键配置**：
```bash
# 堆内存
dbms.memory.heap.max_size=8G

# 页缓存
dbms.memory.pagecache.size=4G

# 集群
dbms.mode=CORE
```

**监控指标**：
- 可用性：99.9%
- 查询延迟：P95 < 100ms
- 吞吐量：1000 QPS

**2分钟记忆**：
集群 + 监控 + 备份 = 生产级

---

## 卡片10：2025-2026趋势

**三大趋势**：

1. **Graphiti时序图谱**
   - Episode-based记忆
   - AI Agent长期记忆
   - 时序推理

2. **Neo4j GraphRAG**
   - 官方Python包
   - 端到端自动化
   - 混合检索

3. **AI Agent-Ready**
   - 多代理协作
   - 知识共享
   - LangGraph集成

**市场预测**：
- 2026年50%企业AI使用知识图谱
- 图数据库市场年增长30%+
- GraphRAG成为核心竞争力

**2分钟记忆**：
时序 + GraphRAG + AI Agent = 未来

---

## 快速复习清单

**5分钟复习**：
- [ ] 图 = 节点 + 边
- [ ] SPO三元组 = 主谓宾
- [ ] Cypher像画图
- [ ] 向量 + 图 = 混合检索
- [ ] Graphiti = 时序图谱
- [ ] GraphRAG = 向量 + 图 + LLM
- [ ] LangGraph = 状态图 + 记忆
- [ ] 索引 + 批量 = 性能
- [ ] 集群 + 监控 = 生产
- [ ] 时序 + AI Agent = 趋势

**10分钟深入**：
- 阅读【第一性原理】
- 阅读【最小可用】
- 运行一个实战代码

**1小时掌握**：
- 完成所有实战代码
- 理解核心概念
- 准备面试问题

---

## 记忆技巧

### 1. 类比记忆

- 图 = 地铁线路图
- SPO = 句子结构
- Cypher = 画图
- 向量检索 = 模糊搜索
- 图检索 = 沿着路线走

### 2. 对比记忆

- 关系数据库 vs 图数据库
- 向量检索 vs 图检索
- Cypher vs SPARQL
- 传统RAG vs GraphRAG

### 3. 实践记忆

- 手写SPO提取器
- 构建Neo4j图谱
- 实现混合检索
- 部署生产系统

---

## 学习路径

**Day 1**（2小时）：
- 10个卡片快速浏览
- 理解核心概念
- 运行基础示例

**Day 2**（3小时）：
- 深入学习核心概念
- 完成实战代码1-2
- 理解GraphRAG架构

**Day 3**（3小时）：
- 完成实战代码3-5
- 学习生产部署
- 准备面试问题

**Day 4**（2小时）：
- 复习10个卡片
- 模拟面试
- 总结经验

---

**版本**：v1.0
**最后更新**：2026-02-14
**维护者**：Claude Code
