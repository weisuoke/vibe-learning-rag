# æœ€å°å¯ç”¨

3 æ­¥å¿«é€Ÿä¸Šæ‰‹ Milvus 2.6ï¼Œä»é›¶åˆ°è¿è¡Œç¬¬ä¸€ä¸ªå‘é‡æ£€ç´¢ç¨‹åºã€‚

---

## ç›®æ ‡

ç”¨æœ€å°‘çš„æ­¥éª¤ï¼Œè®©ä½ ï¼š
1. å¯åŠ¨ Milvus 2.6 æœåŠ¡
2. å®‰è£… pymilvus SDK
3. è¿æ¥å¹¶éªŒè¯æœåŠ¡

**æ—¶é—´æŠ•å…¥**ï¼š5 åˆ†é’Ÿ
**å‰ç½®è¦æ±‚**ï¼šå·²å®‰è£… Docker å’Œ Python 3.9+

---

## ç¬¬ä¸€æ­¥ï¼šå¯åŠ¨ Milvus 2.6

### 1.1 ä¸‹è½½ Docker Compose é…ç½®

```bash
# ä¸‹è½½ Milvus 2.6.11 çš„ Docker Compose é…ç½®æ–‡ä»¶
wget https://github.com/milvus-io/milvus/releases/download/v2.6.11/milvus-standalone-docker-compose.yml -O docker-compose.yml
```

**ä¸ºä»€ä¹ˆè¿™æ ·åš**ï¼š
- å®˜æ–¹æä¾›çš„é…ç½®æ–‡ä»¶å·²ç»åŒ…å«æ‰€æœ‰å¿…è¦çš„æœåŠ¡ï¼ˆetcdã€MinIOã€Milvusï¼‰
- ç‰ˆæœ¬é”å®šä¸º 2.6.11ï¼Œç¡®ä¿ç¨³å®šæ€§
- é…ç½®å·²ä¼˜åŒ–ï¼Œé€‚åˆå¼€å‘å’Œæµ‹è¯•

### 1.2 å¯åŠ¨ Milvus

```bash
# å¯åŠ¨æ‰€æœ‰æœåŠ¡
docker compose up -d

# è¾“å‡ºç¤ºä¾‹ï¼š
# [+] Running 3/3
#  âœ” Container milvus-etcd        Started
#  âœ” Container milvus-minio       Started
#  âœ” Container milvus-standalone  Started
```

**ä¸ºä»€ä¹ˆä½¿ç”¨ `-d`**ï¼š
- `-d` è¡¨ç¤ºåå°è¿è¡Œï¼ˆdetached modeï¼‰
- æœåŠ¡åœ¨åå°æŒç»­è¿è¡Œï¼Œä¸å ç”¨ç»ˆç«¯

### 1.3 éªŒè¯æœåŠ¡å¯åŠ¨

```bash
# æ£€æŸ¥å®¹å™¨çŠ¶æ€
docker compose ps

# è¾“å‡ºç¤ºä¾‹ï¼š
# NAME                COMMAND                  SERVICE      STATUS       PORTS
# milvus-etcd         etcd -advertise-clientâ€¦  etcd         Up 30 seconds  2379/tcp, 2380/tcp
# milvus-minio        /usr/bin/docker-entrypâ€¦  minio        Up 30 seconds  9000/tcp
# milvus-standalone   /tini -- milvus run stâ€¦  standalone   Up 30 seconds  0.0.0.0:19530->19530/tcp, 0.0.0.0:9091->9091/tcp
```

**å…³é”®æ£€æŸ¥ç‚¹**ï¼š
- æ‰€æœ‰å®¹å™¨çš„ STATUS éƒ½æ˜¯ `Up`
- `milvus-standalone` æš´éœ²äº†ç«¯å£ `19530`ï¼ˆgRPCï¼‰å’Œ `9091`ï¼ˆWebUIï¼‰

### 1.4 è®¿é—® WebUIï¼ˆå¯é€‰ï¼‰

```bash
# åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€
open http://127.0.0.1:9091/webui/
```

**WebUI åŠŸèƒ½**ï¼š
- æŸ¥çœ‹ Collection åˆ—è¡¨
- ç›‘æ§ç³»ç»ŸçŠ¶æ€
- æŸ¥çœ‹æ—¥å¿—å’ŒæŒ‡æ ‡

---

## ç¬¬äºŒæ­¥ï¼šå®‰è£… pymilvus

### 2.1 å®‰è£… pymilvus 2.6+

```bash
# å®‰è£…æœ€æ–°ç‰ˆæœ¬çš„ pymilvus
pip install pymilvus>=2.6.0

# æˆ–è€…æŒ‡å®šå…·ä½“ç‰ˆæœ¬
pip install pymilvus==2.6.9
```

**ä¸ºä»€ä¹ˆé€‰æ‹© 2.6+**ï¼š
- æ”¯æŒ MilvusClient ç®€åŒ–æ¥å£
- æ”¯æŒ Embedding Functionsï¼ˆå†…ç½®å‘é‡åŒ–ï¼‰
- æ”¯æŒå¼‚æ­¥ API
- ä¸ Milvus 2.6.11 å®Œå…¨å…¼å®¹

### 2.2 éªŒè¯å®‰è£…

```bash
# æ£€æŸ¥ pymilvus ç‰ˆæœ¬
python -c "import pymilvus; print(pymilvus.__version__)"

# è¾“å‡ºç¤ºä¾‹ï¼š
# 2.6.9
```

---

## ç¬¬ä¸‰æ­¥ï¼šè¿æ¥å¹¶éªŒè¯

### 3.1 åˆ›å»ºæµ‹è¯•è„šæœ¬

åˆ›å»ºæ–‡ä»¶ `test_milvus.py`ï¼š

```python
from pymilvus import MilvusClient

# è¿æ¥åˆ° Milvus
client = MilvusClient(uri="http://localhost:19530")

# éªŒè¯è¿æ¥
collections = client.list_collections()
print(f"âœ… è¿æ¥æˆåŠŸï¼å½“å‰ Collection æ•°é‡: {len(collections)}")

# è¾“å‡ºç³»ç»Ÿä¿¡æ¯
print(f"ğŸ“Š Milvus ç‰ˆæœ¬: 2.6.11")
print(f"ğŸ”— è¿æ¥åœ°å€: http://localhost:19530")
```

### 3.2 è¿è¡Œæµ‹è¯•

```bash
# è¿è¡Œæµ‹è¯•è„šæœ¬
python test_milvus.py

# è¾“å‡ºç¤ºä¾‹ï¼š
# âœ… è¿æ¥æˆåŠŸï¼å½“å‰ Collection æ•°é‡: 0
# ğŸ“Š Milvus ç‰ˆæœ¬: 2.6.11
# ğŸ”— è¿æ¥åœ°å€: http://localhost:19530
```

**æˆåŠŸæ ‡å¿—**ï¼š
- æ²¡æœ‰æŠ¥é”™
- è¾“å‡º "è¿æ¥æˆåŠŸ"
- Collection æ•°é‡ä¸º 0ï¼ˆå…¨æ–°å®‰è£…ï¼‰

---

## å®Œæ•´ç¤ºä¾‹ï¼šç¬¬ä¸€ä¸ªå‘é‡æ£€ç´¢ç¨‹åº

ç°åœ¨ä½ å·²ç»å®Œæˆäº†åŸºç¡€è®¾ç½®ï¼Œè®©æˆ‘ä»¬è¿è¡Œä¸€ä¸ªå®Œæ•´çš„å‘é‡æ£€ç´¢ç¤ºä¾‹ï¼š

```python
from pymilvus import MilvusClient
import random

# 1. è¿æ¥åˆ° Milvus
client = MilvusClient(uri="http://localhost:19530")

# 2. åˆ›å»º Collection
collection_name = "quick_start"

# å¦‚æœ Collection å·²å­˜åœ¨ï¼Œå…ˆåˆ é™¤
if client.has_collection(collection_name):
    client.drop_collection(collection_name)

# åˆ›å»ºæ–° Collectionï¼ˆ128 ç»´å‘é‡ï¼‰
client.create_collection(
    collection_name=collection_name,
    dimension=128,
    metric_type="COSINE"
)
print(f"âœ… Collection '{collection_name}' åˆ›å»ºæˆåŠŸ")

# 3. æ’å…¥æ•°æ®
data = [
    {
        "id": i,
        "vector": [random.random() for _ in range(128)],
        "text": f"è¿™æ˜¯ç¬¬ {i} æ¡æ•°æ®"
    }
    for i in range(100)
]

client.insert(collection_name=collection_name, data=data)
print(f"âœ… æ’å…¥ {len(data)} æ¡æ•°æ®")

# 4. å‘é‡æ£€ç´¢
query_vector = [random.random() for _ in range(128)]
results = client.search(
    collection_name=collection_name,
    data=[query_vector],
    limit=5,
    output_fields=["id", "text"]
)

print(f"\nğŸ” æ£€ç´¢ç»“æœï¼ˆTop-5ï¼‰ï¼š")
for i, hit in enumerate(results[0], 1):
    print(f"{i}. ID: {hit['id']}, ç›¸ä¼¼åº¦: {hit['distance']:.4f}, æ–‡æœ¬: {hit['entity']['text']}")

# 5. æ¸…ç†
client.drop_collection(collection_name)
print(f"\nğŸ—‘ï¸  Collection '{collection_name}' å·²åˆ é™¤")
```

### è¿è¡Œå®Œæ•´ç¤ºä¾‹

```bash
# ä¿å­˜ä¸º quick_start.py
python quick_start.py

# è¾“å‡ºç¤ºä¾‹ï¼š
# âœ… Collection 'quick_start' åˆ›å»ºæˆåŠŸ
# âœ… æ’å…¥ 100 æ¡æ•°æ®
#
# ğŸ” æ£€ç´¢ç»“æœï¼ˆTop-5ï¼‰ï¼š
# 1. ID: 42, ç›¸ä¼¼åº¦: 0.9234, æ–‡æœ¬: è¿™æ˜¯ç¬¬ 42 æ¡æ•°æ®
# 2. ID: 17, ç›¸ä¼¼åº¦: 0.9156, æ–‡æœ¬: è¿™æ˜¯ç¬¬ 17 æ¡æ•°æ®
# 3. ID: 89, ç›¸ä¼¼åº¦: 0.9087, æ–‡æœ¬: è¿™æ˜¯ç¬¬ 89 æ¡æ•°æ®
# 4. ID: 5, ç›¸ä¼¼åº¦: 0.9012, æ–‡æœ¬: è¿™æ˜¯ç¬¬ 5 æ¡æ•°æ®
# 5. ID: 73, ç›¸ä¼¼åº¦: 0.8945, æ–‡æœ¬: è¿™æ˜¯ç¬¬ 73 æ¡æ•°æ®
#
# ğŸ—‘ï¸  Collection 'quick_start' å·²åˆ é™¤
```

---

## å¸¸è§é—®é¢˜æ’æŸ¥

### é—®é¢˜ 1ï¼šDocker å¯åŠ¨å¤±è´¥

**ç—‡çŠ¶**ï¼š
```bash
docker compose up -d
# Error: Cannot connect to the Docker daemon
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# å¯åŠ¨ Docker Desktopï¼ˆmacOS/Windowsï¼‰
# æˆ–å¯åŠ¨ Docker æœåŠ¡ï¼ˆLinuxï¼‰
sudo systemctl start docker
```

### é—®é¢˜ 2ï¼šç«¯å£è¢«å ç”¨

**ç—‡çŠ¶**ï¼š
```bash
docker compose up -d
# Error: Bind for 0.0.0.0:19530 failed: port is already allocated
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# æŸ¥æ‰¾å ç”¨ç«¯å£çš„è¿›ç¨‹
lsof -i :19530

# åœæ­¢å ç”¨ç«¯å£çš„è¿›ç¨‹
kill -9 <PID>

# æˆ–ä¿®æ”¹ docker-compose.yml ä¸­çš„ç«¯å£æ˜ å°„
# ports:
#   - "19531:19530"  # ä½¿ç”¨ 19531 ä»£æ›¿ 19530
```

### é—®é¢˜ 3ï¼šè¿æ¥è¶…æ—¶

**ç—‡çŠ¶**ï¼š
```python
client = MilvusClient(uri="http://localhost:19530")
# Error: Connection timeout
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# 1. æ£€æŸ¥å®¹å™¨æ˜¯å¦æ­£åœ¨è¿è¡Œ
docker compose ps

# 2. æŸ¥çœ‹ Milvus æ—¥å¿—
docker compose logs milvus-standalone

# 3. ç­‰å¾…æœåŠ¡å®Œå…¨å¯åŠ¨ï¼ˆé€šå¸¸éœ€è¦ 10-30 ç§’ï¼‰
sleep 30

# 4. é‡æ–°å°è¯•è¿æ¥
```

### é—®é¢˜ 4ï¼špymilvus ç‰ˆæœ¬ä¸å…¼å®¹

**ç—‡çŠ¶**ï¼š
```python
from pymilvus import MilvusClient
# ImportError: cannot import name 'MilvusClient'
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# å‡çº§åˆ° pymilvus 2.6+
pip install --upgrade pymilvus>=2.6.0

# éªŒè¯ç‰ˆæœ¬
python -c "import pymilvus; print(pymilvus.__version__)"
```

---

## åœæ­¢å’Œæ¸…ç†

### åœæ­¢ Milvus

```bash
# åœæ­¢æ‰€æœ‰æœåŠ¡
docker compose down

# è¾“å‡ºç¤ºä¾‹ï¼š
# [+] Running 3/3
#  âœ” Container milvus-standalone  Removed
#  âœ” Container milvus-minio       Removed
#  âœ” Container milvus-etcd        Removed
```

### åˆ é™¤æ•°æ®ï¼ˆå¯é€‰ï¼‰

```bash
# åˆ é™¤æ‰€æœ‰æ•°æ®ï¼ˆåŒ…æ‹¬ volumesï¼‰
docker compose down -v

# æˆ–æ‰‹åŠ¨åˆ é™¤ volumes ç›®å½•
rm -rf volumes/
```

**è­¦å‘Š**ï¼šåˆ é™¤æ•°æ®åæ— æ³•æ¢å¤ï¼Œè¯·è°¨æ…æ“ä½œï¼

---

## ä¸‹ä¸€æ­¥

å®Œæˆæœ€å°å¯ç”¨åï¼Œä½ å¯ä»¥ï¼š

1. **æ·±å…¥å­¦ä¹  Docker éƒ¨ç½²**ï¼š
   - é˜…è¯» **03_æ ¸å¿ƒæ¦‚å¿µ_1_Dockerå®‰è£….md**
   - å­¦ä¹ è‡ªå®šä¹‰é…ç½®å’Œç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

2. **æŒæ¡ pymilvus åŸºç¡€**ï¼š
   - é˜…è¯» **03_æ ¸å¿ƒæ¦‚å¿µ_2_pymilvusåŸºç¡€.md**
   - å­¦ä¹  MilvusClient çš„é«˜çº§ç”¨æ³•

3. **æ„å»º RAG ç³»ç»Ÿ**ï¼š
   - é˜…è¯» **07_å®æˆ˜ä»£ç _åœºæ™¯4_ç«¯åˆ°ç«¯RAG.md**
   - å­¦ä¹ å¦‚ä½•å°† Milvus é›†æˆåˆ° RAG ç³»ç»Ÿ

4. **å­¦ä¹ ç±»æ¯”ç†è§£**ï¼š
   - é˜…è¯» **05_åŒé‡ç±»æ¯”.md**
   - é€šè¿‡å‰ç«¯å’Œæ—¥å¸¸ç”Ÿæ´»ç±»æ¯”åŠ æ·±ç†è§£

---

## æ€»ç»“

é€šè¿‡è¿™ 3 æ­¥ï¼Œä½ å·²ç»ï¼š

âœ… å¯åŠ¨äº† Milvus 2.6.11 æœåŠ¡ï¼ˆDocker Composeï¼‰
âœ… å®‰è£…äº† pymilvus 2.6+ SDK
âœ… è¿æ¥å¹¶éªŒè¯äº†æœåŠ¡
âœ… è¿è¡Œäº†ç¬¬ä¸€ä¸ªå‘é‡æ£€ç´¢ç¨‹åº

**æ ¸å¿ƒå‘½ä»¤å›é¡¾**ï¼š

```bash
# 1. å¯åŠ¨ Milvus
wget https://github.com/milvus-io/milvus/releases/download/v2.6.11/milvus-standalone-docker-compose.yml -O docker-compose.yml
docker compose up -d

# 2. å®‰è£… pymilvus
pip install pymilvus>=2.6.0

# 3. éªŒè¯è¿æ¥
python -c "from pymilvus import MilvusClient; client = MilvusClient('http://localhost:19530'); print('âœ… è¿æ¥æˆåŠŸï¼')"
```

**è®°ä½**ï¼šè¿™æ˜¯æœ€å°å¯ç”¨ç‰ˆæœ¬ï¼Œé€‚åˆå¿«é€Ÿä¸Šæ‰‹å’Œå¼€å‘æµ‹è¯•ã€‚ç”Ÿäº§ç¯å¢ƒéœ€è¦æ›´å¤šé…ç½®å’Œä¼˜åŒ–ã€‚

---

**å‚è€ƒæ–‡æ¡£**ï¼š
- Milvus 2.6 Installation: https://milvus.io/docs/install_standalone-docker-compose.md
- pymilvus Quickstart: https://milvus.io/docs/quickstart.md
- Docker Compose Documentation: https://docs.docker.com/compose/
