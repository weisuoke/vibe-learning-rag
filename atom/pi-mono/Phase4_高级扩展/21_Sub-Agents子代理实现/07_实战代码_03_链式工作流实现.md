# é“¾å¼å·¥ä½œæµå®ç° - å®æˆ˜ä»£ç 

> **çŸ¥è¯†ç‚¹**: Sub-Agents å­ä»£ç†å®ç° - é“¾å¼å·¥ä½œæµæ‰§è¡Œæ¨¡å¼
> **éš¾åº¦**: â­â­â­â­â­
> **å‰ç½®çŸ¥è¯†**: åŸºç¡€å•ä»£ç†æ‰§è¡Œã€ä¸Šä¸‹æ–‡ç®¡ç†ã€Promiseé“¾å¼è°ƒç”¨

---

## 1. åœºæ™¯æè¿°

é“¾å¼å·¥ä½œæµæ˜¯ Sub-Agents ç³»ç»Ÿä¸­æœ€å¼ºå¤§çš„æ¨¡å¼ï¼Œé€šè¿‡é¡ºåºæ‰§è¡Œå¤šä¸ªä¸“ä¸šåŒ–ä»£ç†å¹¶ä¼ é€’ä¸Šä¸‹æ–‡ï¼Œå®ç°å¤æ‚çš„å¤šæ­¥éª¤ä»»åŠ¡ã€‚æ¯ä¸ªä»£ç†çš„è¾“å‡ºæˆä¸ºä¸‹ä¸€ä¸ªä»£ç†çš„è¾“å…¥ï¼Œå½¢æˆå®Œæ•´çš„å¤„ç†æµæ°´çº¿ã€‚

**å…¸å‹åº”ç”¨åœºæ™¯**:
- Scout â†’ Planner â†’ Workerï¼šå…ˆä¾¦å¯Ÿä»£ç åº“ï¼Œå†åˆ¶å®šè®¡åˆ’ï¼Œæœ€åæ‰§è¡Œå®ç°
- Analyzer â†’ Optimizer â†’ Validatorï¼šåˆ†æé—®é¢˜ï¼Œä¼˜åŒ–æ–¹æ¡ˆï¼ŒéªŒè¯ç»“æœ
- Extractor â†’ Transformer â†’ Loaderï¼šETL æ•°æ®å¤„ç†æµç¨‹
- Researcher â†’ Writer â†’ Reviewerï¼šå†…å®¹åˆ›ä½œå·¥ä½œæµ

æ ¹æ® [Reddit ç¤¾åŒºçš„ä»£ç†æ£€ç´¢åè®®ç ”ç©¶](https://www.reddit.com/r/AI_Agents/comments/1jugj0e/we_reduced_token_usage_by_60_using_an_agentic/)ï¼Œé“¾å¼å·¥ä½œæµé€šè¿‡ä¸Šä¸‹æ–‡ä¼ é€’ä¼˜åŒ–å¯ä»¥å®ç° **60% çš„ token ä½¿ç”¨å‡å°‘**ã€‚[Google çš„å¤šä»£ç†ä¸Šä¸‹æ–‡å·¥ç¨‹æŒ‡å—](https://x.com/rohanpaul_ai/status/1997405403987222642) å¼ºè°ƒåˆ†å±‚ä¸Šä¸‹æ–‡ç®¡ç†æ˜¯å‡å°‘å¹»è§‰å’Œä¼˜åŒ–æˆæœ¬çš„å…³é”®ã€‚

---

## 2. æ ¸å¿ƒæ¦‚å¿µ

### 2.1 é“¾å¼æ‰§è¡Œæ¨¡å‹

é“¾å¼å·¥ä½œæµéµå¾ªä»¥ä¸‹æ ¸å¿ƒåŸåˆ™ï¼š

1. **é¡ºåºä¾èµ–**: æ¯ä¸ªä»£ç†ä¾èµ–å‰ä¸€ä¸ªä»£ç†çš„è¾“å‡º
2. **ä¸Šä¸‹æ–‡ä¼ é€’**: ä½¿ç”¨ `{previous}` å ä½ç¬¦ä¼ é€’å‰åºç»“æœ
3. **å¢é‡ç»†åŒ–**: æ¯ä¸ªé˜¶æ®µåœ¨å‰åºåŸºç¡€ä¸Šå¢é‡æ”¹è¿›
4. **å¤±è´¥ä¼ æ’­**: ä»»ä½•é˜¶æ®µå¤±è´¥ä¼šä¸­æ–­æ•´ä¸ªé“¾

æ ¹æ® [Microsoft çš„ 5 ç§ AI ä»£ç†ç¼–æ’æ¨¡å¼](https://medium.com/@lakkanaperera/the-5-ai-agent-orchestration-patterns-by-microsoft-9a27844eec9a)ï¼Œé¡ºåºè£…é…çº¿æ¨¡å¼ï¼ˆSequential Assembly Line Patternï¼‰æ˜¯æœ€å¸¸ç”¨çš„ç”Ÿäº§æ¨¡å¼ä¹‹ä¸€ã€‚

### 2.2 ä¸Šä¸‹æ–‡ä¼ é€’æœºåˆ¶

**{previous} å ä½ç¬¦**:

```typescript
{
  chain: [
    { agent: "scout", task: "Find authentication code" },
    { agent: "planner", task: "Based on {previous}, create implementation plan" },
    { agent: "worker", task: "Implement the plan from {previous}" }
  ]
}
```

åœ¨æ‰§è¡Œæ—¶ï¼Œ`{previous}` ä¼šè¢«æ›¿æ¢ä¸ºå‰ä¸€ä¸ªä»£ç†çš„å®Œæ•´è¾“å‡ºã€‚

æ ¹æ® [847 æ¬¡ä»£ç†è¿è¡Œçš„ä¸Šä¸‹æ–‡é€€åŒ–è¿½è¸ª](https://www.reddit.com/r/LocalLLaMA/comments/1qio9nj/i_tracked_context_degradation_across_847_agent/)ï¼Œä¸Šä¸‹æ–‡ç®¡ç†å±‚æ˜¯è§£å†³é“¾å¼æ‰§è¡Œä¸­ä¸Šä¸‹æ–‡é€€åŒ–çš„å…³é”®ã€‚

### 2.3 ä¸ pi-mono çš„é›†æˆ

åœ¨ pi-mono æ¶æ„ä¸­ï¼Œé“¾å¼æ‰§è¡Œé€šè¿‡ `subagent` Extension çš„ `chain` å‚æ•°å®ç°ï¼š

```typescript
{
  chain: [
    { agent: "scout", task: "..." },
    { agent: "planner", task: "Based on {previous}, ..." },
    { agent: "worker", task: "Implement {previous}" }
  ]
}
```

---

## 3. å®Œæ•´ä»£ç ç¤ºä¾‹

### 3.1 é“¾å¼å·¥ä½œæµæ‰§è¡Œå™¨å®ç°

```typescript
import { ExtensionAPI } from "@pi-mono/extension-api";
import { z } from "zod";

// å®šä¹‰é“¾å¼ä»»åŠ¡å‚æ•° Schema
const ChainWorkflowParams = z.object({
  chain: z.array(z.object({
    agent: z.string(),
    task: z.string(),
    context: z.record(z.any()).optional(),
  })).min(2).max(5).describe("Chain of tasks (2-5 steps)"),
});

type ChainWorkflowParams = z.infer<typeof ChainWorkflowParams>;

interface ChainStepResult {
  agent: string;
  task: string;
  success: boolean;
  output: string;
  error?: string;
  duration: number;
  usage?: {
    inputTokens: number;
    outputTokens: number;
    totalCost: number;
  };
}

/**
 * é“¾å¼å·¥ä½œæµæ‰§è¡Œå™¨
 *
 * å‚è€ƒ:
 * - https://www.reddit.com/r/AI_Agents/comments/1jugj0e/ (60% token reduction)
 * - https://x.com/rohanpaul_ai/status/1997405403987222642 (Google context engineering)
 * - https://www.reddit.com/r/LocalLLaMA/comments/1qio9nj/ (847 agent runs analysis)
 */
export class ChainWorkflowExecutor {
  private singleExecutor: any; // SingleAgentExecutor from File 01
  private cwd: string;

  constructor(cwd: string, singleExecutor: any) {
    this.cwd = cwd;
    this.singleExecutor = singleExecutor;
  }

  /**
   * æ‰§è¡Œé“¾å¼å·¥ä½œæµ
   *
   * @param chain - ä»»åŠ¡é“¾
   * @param signal - ä¸­æ–­ä¿¡å·
   * @param onUpdate - è¿›åº¦æ›´æ–°å›è°ƒ
   * @returns æ‰€æœ‰æ­¥éª¤çš„ç»“æœ
   */
  async executeChain(
    chain: Array<{ agent: string; task: string; context?: Record<string, any> }>,
    signal?: AbortSignal,
    onUpdate?: (update: string) => void
  ): Promise<ChainStepResult[]> {
    const startTime = Date.now();
    const results: ChainStepResult[] = [];
    let previousOutput = "";

    onUpdate?.(`ğŸ”— Starting chain workflow with ${chain.length} steps`);

    for (let i = 0; i < chain.length; i++) {
      const step = chain[i];
      const stepStartTime = Date.now();

      try {
        // æ›¿æ¢ {previous} å ä½ç¬¦
        const taskWithContext = this.replacePreviousPlaceholder(
          step.task,
          previousOutput
        );

        onUpdate?.(`\n[Step ${i + 1}/${chain.length}] ğŸ”„ Starting ${step.agent}...`);
        onUpdate?.(`Task: ${taskWithContext.substring(0, 100)}${taskWithContext.length > 100 ? '...' : ''}`);

        const result = await this.singleExecutor.execute(
          step.agent,
          taskWithContext,
          step.context || {},
          signal,
          (msg: string) => {
            onUpdate?.(`[Step ${i + 1}/${chain.length}] ${step.agent}: ${msg}`);
          }
        );

        const duration = Date.now() - stepStartTime;

        if (!result.success) {
          throw new Error(result.error || "Agent execution failed");
        }

        onUpdate?.(`[Step ${i + 1}/${chain.length}] âœ… ${step.agent} completed (${duration}ms)`);

        // ä¿å­˜ç»“æœ
        const stepResult: ChainStepResult = {
          agent: step.agent,
          task: step.task,
          success: true,
          output: result.output,
          duration,
          usage: result.usage,
        };

        results.push(stepResult);

        // æ›´æ–° previousOutput ä¾›ä¸‹ä¸€æ­¥ä½¿ç”¨
        previousOutput = result.output;

      } catch (error) {
        const duration = Date.now() - stepStartTime;
        const errorMessage = error instanceof Error ? error.message : String(error);

        onUpdate?.(`[Step ${i + 1}/${chain.length}] âŒ ${step.agent} failed: ${errorMessage}`);

        // è®°å½•å¤±è´¥æ­¥éª¤
        results.push({
          agent: step.agent,
          task: step.task,
          success: false,
          output: "",
          error: errorMessage,
          duration,
        });

        // é“¾å¼æ‰§è¡Œå¤±è´¥ï¼Œä¸­æ–­åç»­æ­¥éª¤
        throw new Error(`Chain failed at step ${i + 1} (${step.agent}): ${errorMessage}`);
      }
    }

    const totalDuration = Date.now() - startTime;
    onUpdate?.(`\nğŸ“Š Chain completed: ${results.length} steps, ${totalDuration}ms total`);

    // è®¡ç®—æ€» usage
    const totalUsage = results.reduce((acc, r) => {
      if (r.usage) {
        acc.inputTokens += r.usage.inputTokens;
        acc.outputTokens += r.usage.outputTokens;
        acc.totalCost += r.usage.totalCost;
      }
      return acc;
    }, { inputTokens: 0, outputTokens: 0, totalCost: 0 });

    onUpdate?.(`ğŸ’° Total usage: ${totalUsage.inputTokens} input + ${totalUsage.outputTokens} output tokens ($${totalUsage.totalCost.toFixed(4)})`);

    return results;
  }

  /**
   * æ›¿æ¢ä»»åŠ¡ä¸­çš„ {previous} å ä½ç¬¦
   *
   * @param task - åŸå§‹ä»»åŠ¡æè¿°
   * @param previousOutput - å‰ä¸€æ­¥çš„è¾“å‡º
   * @returns æ›¿æ¢åçš„ä»»åŠ¡æè¿°
   */
  private replacePreviousPlaceholder(task: string, previousOutput: string): string {
    if (!task.includes("{previous}")) {
      return task;
    }

    // å¦‚æœ previousOutput å¤ªé•¿ï¼Œè¿›è¡Œæˆªæ–­
    const maxContextLength = 2000; // é™åˆ¶ä¸Šä¸‹æ–‡é•¿åº¦
    let contextToInsert = previousOutput;

    if (previousOutput.length > maxContextLength) {
      contextToInsert = previousOutput.substring(0, maxContextLength) + "\n\n[... truncated for length ...]";
    }

    return task.replace(/{previous}/g, contextToInsert);
  }

  /**
   * è·å–é“¾å¼æ‰§è¡Œçš„æœ€ç»ˆç»“æœ
   *
   * @param results - æ‰€æœ‰æ­¥éª¤çš„ç»“æœ
   * @returns æœ€åä¸€æ­¥çš„è¾“å‡º
   */
  getFinalOutput(results: ChainStepResult[]): string {
    if (results.length === 0) {
      return "";
    }

    const lastResult = results[results.length - 1];
    return lastResult.success ? lastResult.output : "";
  }

  /**
   * ç”Ÿæˆé“¾å¼æ‰§è¡Œçš„æ‘˜è¦
   *
   * @param results - æ‰€æœ‰æ­¥éª¤çš„ç»“æœ
   * @returns æ‰§è¡Œæ‘˜è¦
   */
  generateSummary(results: ChainStepResult[]): {
    totalSteps: number;
    successfulSteps: number;
    failedStep?: number;
    steps: Array<{ agent: string; success: boolean; duration: number }>;
  } {
    const failedIndex = results.findIndex(r => !r.success);

    return {
      totalSteps: results.length,
      successfulSteps: results.filter(r => r.success).length,
      failedStep: failedIndex >= 0 ? failedIndex + 1 : undefined,
      steps: results.map(r => ({
        agent: r.agent,
        success: r.success,
        duration: r.duration,
      })),
    };
  }
}

/**
 * Extension æ³¨å†Œå‡½æ•°
 */
export default function (pi: ExtensionAPI) {
  pi.registerTool({
    name: "execute_chain_workflow",
    description: "Execute a chain of specialized agents with context passing",
    parameters: ChainWorkflowParams,
    async execute(toolCallId, params, signal, onUpdate, ctx) {
      // å‡è®¾ SingleAgentExecutor å·²ç»æ³¨å†Œ
      const singleExecutor = new (require("./single-agent-executor")).SingleAgentExecutor(ctx.cwd);
      const chainExecutor = new ChainWorkflowExecutor(ctx.cwd, singleExecutor);

      const results = await chainExecutor.executeChain(
        params.chain,
        signal,
        (update) => {
          onUpdate({
            type: "progress",
            content: update,
          });
        }
      );

      const summary = chainExecutor.generateSummary(results);

      if (summary.failedStep) {
        throw new Error(`Chain failed at step ${summary.failedStep}`);
      }

      return {
        finalOutput: chainExecutor.getFinalOutput(results),
        summary,
        steps: results.map(r => ({
          agent: r.agent,
          success: r.success,
          output: r.output?.substring(0, 200) + (r.output?.length > 200 ? "..." : ""),
        })),
      };
    },
  });
}
```

### 3.2 ä½¿ç”¨ç¤ºä¾‹

```typescript
// ç¤ºä¾‹ 1: Scout â†’ Planner â†’ Worker å·¥ä½œæµ
const result = await pi.tools.execute_chain_workflow({
  chain: [
    {
      agent: "scout",
      task: "Find all authentication-related files in the codebase"
    },
    {
      agent: "planner",
      task: "Based on {previous}, create a plan to add OAuth2 support"
    },
    {
      agent: "worker",
      task: "Implement the OAuth2 changes according to {previous}"
    }
  ]
});

// ç¤ºä¾‹ 2: Analyzer â†’ Optimizer â†’ Validator å·¥ä½œæµ
const optimizationResult = await pi.tools.execute_chain_workflow({
  chain: [
    {
      agent: "performance-analyzer",
      task: "Analyze performance bottlenecks in the API endpoints"
    },
    {
      agent: "optimizer",
      task: "Propose optimizations for the issues found in {previous}"
    },
    {
      agent: "validator",
      task: "Validate that the optimizations in {previous} are safe and effective"
    }
  ]
});

// ç¤ºä¾‹ 3: Researcher â†’ Writer â†’ Reviewer å·¥ä½œæµ
const contentResult = await pi.tools.execute_chain_workflow({
  chain: [
    {
      agent: "researcher",
      task: "Research best practices for React hooks"
    },
    {
      agent: "technical-writer",
      task: "Write a comprehensive guide based on {previous}"
    },
    {
      agent: "reviewer",
      task: "Review and improve the guide from {previous}"
    }
  ]
});
```

---

## 4. ä»£ç è§£æ

### 4.1 æ ¸å¿ƒè®¾è®¡å†³ç­–

**1. é¡ºåºæ‰§è¡Œä¸ä¸Šä¸‹æ–‡ä¼ é€’**

```typescript
for (let i = 0; i < chain.length; i++) {
  const taskWithContext = this.replacePreviousPlaceholder(
    step.task,
    previousOutput
  );

  const result = await this.singleExecutor.execute(...);
  previousOutput = result.output; // ä¼ é€’ç»™ä¸‹ä¸€æ­¥
}
```

è¿™ç§è®¾è®¡ç¡®ä¿æ¯ä¸ªä»£ç†éƒ½èƒ½è®¿é—®å‰åºä»£ç†çš„å®Œæ•´è¾“å‡ºï¼Œå®ç°å¢é‡ç»†åŒ–ã€‚

**2. å¤±è´¥å¿«é€Ÿä¼ æ’­**

```typescript
if (!result.success) {
  throw new Error(result.error || "Agent execution failed");
}
```

ä»»ä½•æ­¥éª¤å¤±è´¥ç«‹å³ä¸­æ–­é“¾å¼æ‰§è¡Œï¼Œé¿å…æµªè´¹èµ„æºåœ¨æ— æ•ˆçš„åç»­æ­¥éª¤ä¸Šã€‚

**3. ä¸Šä¸‹æ–‡é•¿åº¦æ§åˆ¶**

```typescript
const maxContextLength = 2000;
if (previousOutput.length > maxContextLength) {
  contextToInsert = previousOutput.substring(0, maxContextLength) +
    "\n\n[... truncated for length ...]";
}
```

æ ¹æ® [60% token å‡å°‘çš„ç ”ç©¶](https://www.reddit.com/r/AI_Agents/comments/1jugj0e/)ï¼Œæ§åˆ¶ä¸Šä¸‹æ–‡é•¿åº¦æ˜¯ä¼˜åŒ– token ä½¿ç”¨çš„å…³é”®ã€‚

### 4.2 æ€§èƒ½ä¼˜åŒ–

æ ¹æ® [2026 ä»£ç†å·¥ä½œæµæ¶æ„æŒ‡å—](https://www.stack-ai.com/blog/the-2026-guide-to-agentic-workflow-architectures)ï¼Œé¡ºåºç®¡é“æ¨¡å¼çš„æ€§èƒ½ä¼˜åŒ–åŒ…æ‹¬ï¼š

- **ä¸Šä¸‹æ–‡å‹ç¼©**: åªä¼ é€’å¿…è¦ä¿¡æ¯
- **å¢é‡ç»†åŒ–**: æ¯æ­¥åœ¨å‰åºåŸºç¡€ä¸Šæ”¹è¿›
- **æ—©æœŸå¤±è´¥**: å¿«é€Ÿæ£€æµ‹å¹¶ä¸­æ–­æ— æ•ˆé“¾

---

## 5. å®é™…æ¡ˆä¾‹åˆ†æ

### æ¡ˆä¾‹ 1: 60% Token å‡å°‘çš„ä»£ç†æ£€ç´¢åè®®

**æ¥æº**: [Reddit - Agentic Retrieval Protocol](https://www.reddit.com/r/AI_Agents/comments/1jugj0e/we_reduced_token_usage_by_60_using_an_agentic/)

é€šè¿‡é“¾å¼å·¥ä½œæµä¼˜åŒ–ä¸Šä¸‹æ–‡ä¼ é€’ï¼Œå®ç°äº† 60% çš„ token ä½¿ç”¨å‡å°‘ã€‚

**å…³é”®æŠ€æœ¯**:
- åˆ†å±‚ä¸Šä¸‹æ–‡ç®¡ç†
- è¯­ä¹‰ç¼“å­˜
- å¢é‡ä¸Šä¸‹æ–‡ä¼ é€’

**ç»éªŒæ•™è®­**:
- ä¸è¦åœ¨æ¯æ­¥ä¼ é€’å®Œæ•´å†å²
- ä½¿ç”¨æ‘˜è¦å’Œå¼•ç”¨è€Œéå®Œæ•´å†…å®¹
- å®æ–½ä¸Šä¸‹æ–‡ç®¡ç†å±‚

### æ¡ˆä¾‹ 2: 847 æ¬¡ä»£ç†è¿è¡Œçš„ä¸Šä¸‹æ–‡é€€åŒ–åˆ†æ

**æ¥æº**: [Reddit - Context Degradation Tracking](https://www.reddit.com/r/LocalLLaMA/comments/1qio9nj/i_tracked_context_degradation_across_847_agent/)

å®è¯è¿½è¸ªäº† 847 æ¬¡ä»£ç†è¿è¡Œä¸­çš„ä¸Šä¸‹æ–‡é€€åŒ–é—®é¢˜ã€‚

**å…³é”®å‘ç°**:
- ä¸Šä¸‹æ–‡é€€åŒ–åœ¨ç¬¬ 3-4 æ­¥æœ€æ˜æ˜¾
- ä¸Šä¸‹æ–‡ç®¡ç†å±‚å¯ä»¥ç¼“è§£é€€åŒ–
- å®šæœŸä¸Šä¸‹æ–‡åˆ·æ–°æ˜¯å¿…è¦çš„

**è§£å†³æ–¹æ¡ˆ**:
- å®æ–½ä¸Šä¸‹æ–‡ç®¡ç†å±‚
- ä½¿ç”¨ç»“æ„åŒ–ä¸Šä¸‹æ–‡ä¼ é€’
- å®šæœŸéªŒè¯ä¸Šä¸‹æ–‡è´¨é‡

### æ¡ˆä¾‹ 3: Microsoft çš„ 5 ç§ä»£ç†ç¼–æ’æ¨¡å¼

**æ¥æº**: [Medium - Microsoft AI Agent Orchestration Patterns](https://medium.com/@lakkanaperera/the-5-ai-agent-orchestration-patterns-by-microsoft-9a27844eec9a)

Microsoft å®šä¹‰äº† 5 ç§ä»£ç†ç¼–æ’æ¨¡å¼ï¼Œå…¶ä¸­é¡ºåºè£…é…çº¿æ¨¡å¼æœ€é€‚åˆé“¾å¼å·¥ä½œæµã€‚

**åº”ç”¨åœºæ™¯**:
- æ–‡æ¡£å¤„ç†æµæ°´çº¿
- ä»£ç ç”Ÿæˆä¸å®¡æŸ¥
- æ•°æ® ETL æµç¨‹

**æœ€ä½³å®è·µ**:
- æ˜ç¡®å®šä¹‰æ¯æ­¥çš„è¾“å…¥è¾“å‡º
- å®æ–½é”™è¯¯å¤„ç†å’Œé‡è¯•
- ç›‘æ§æ¯æ­¥çš„æ€§èƒ½

---

## 6. æœ€ä½³å®è·µ

### 6.1 é“¾å¼è®¾è®¡åŸåˆ™

**1. æ˜ç¡®çš„é˜¶æ®µè¾¹ç•Œ**

```typescript
// âœ… å¥½çš„è®¾è®¡ - æ¸…æ™°çš„é˜¶æ®µåˆ’åˆ†
const chain = [
  { agent: "scout", task: "Find files" },
  { agent: "planner", task: "Create plan based on {previous}" },
  { agent: "worker", task: "Implement {previous}" }
];

// âŒ ä¸å¥½çš„è®¾è®¡ - é˜¶æ®µæ¨¡ç³Š
const chain = [
  { agent: "general", task: "Do everything" }
];
```

### 6.2 ä¸Šä¸‹æ–‡ä¼ é€’ä¼˜åŒ–

**2. ä½¿ç”¨æ‘˜è¦è€Œéå®Œæ•´å†…å®¹**

```typescript
// âœ… ä¼˜åŒ–çš„ä¸Šä¸‹æ–‡ä¼ é€’
task: "Based on the key findings in {previous}, create a plan"

// âŒ æœªä¼˜åŒ–çš„ä¼ é€’
task: "Based on {previous}, do something" // å¯èƒ½ä¼ é€’å¤§é‡æ— å…³å†…å®¹
```

### 6.3 é”™è¯¯å¤„ç†ç­–ç•¥

**3. å®æ–½é‡è¯•æœºåˆ¶**

```typescript
// ä¸ºå…³é”®æ­¥éª¤æ·»åŠ é‡è¯•
const maxRetries = 3;
for (let retry = 0; retry < maxRetries; retry++) {
  try {
    const result = await executor.execute(...);
    break;
  } catch (error) {
    if (retry === maxRetries - 1) throw error;
  }
}
```

---

## 7. å¸¸è§é—®é¢˜

### Q1: é“¾å¼æ‰§è¡Œ vs å¹¶è¡Œæ‰§è¡Œçš„é€‰æ‹©ï¼Ÿ

**A**: æ ¹æ®ä»»åŠ¡ä¾èµ–å…³ç³»é€‰æ‹©ï¼š

- **é“¾å¼æ‰§è¡Œ**: ä»»åŠ¡æœ‰é¡ºåºä¾èµ–ï¼ˆB éœ€è¦ A çš„ç»“æœï¼‰
- **å¹¶è¡Œæ‰§è¡Œ**: ä»»åŠ¡ç‹¬ç«‹ï¼ˆA å’Œ B å¯ä»¥åŒæ—¶è¿›è¡Œï¼‰

**æ€§èƒ½å¯¹æ¯”**:
- é“¾å¼æ‰§è¡Œï¼šæ€»æ—¶é—´ = Î£(æ¯æ­¥æ—¶é—´)
- å¹¶è¡Œæ‰§è¡Œï¼šæ€»æ—¶é—´ = max(æ¯æ­¥æ—¶é—´)

### Q2: å¦‚ä½•å¤„ç†é“¾å¼æ‰§è¡Œä¸­çš„ä¸Šä¸‹æ–‡çˆ†ç‚¸ï¼Ÿ

**A**: ä½¿ç”¨ä¸Šä¸‹æ–‡å‹ç¼©ç­–ç•¥ï¼š

```typescript
// æ–¹æ¡ˆ 1: åªä¼ é€’æ‘˜è¦
const summary = extractKeySummary(previousOutput);
task.replace("{previous}", summary);

// æ–¹æ¡ˆ 2: ä½¿ç”¨å¼•ç”¨
const reference = saveToTempFile(previousOutput);
task.replace("{previous}", `See file: ${reference}`);
```

### Q3: é“¾å¼æ‰§è¡Œå¦‚ä½•ä¼˜åŒ–æˆæœ¬ï¼Ÿ

**A**: æ ¹æ® [60% token å‡å°‘ç ”ç©¶](https://www.reddit.com/r/AI_Agents/comments/1jugj0e/)ï¼š

1. **ä¸Šä¸‹æ–‡å‹ç¼©**: åªä¼ é€’å¿…è¦ä¿¡æ¯
2. **è¯­ä¹‰ç¼“å­˜**: ç¼“å­˜é‡å¤çš„ä¸Šä¸‹æ–‡
3. **å¢é‡ä¼ é€’**: åªä¼ é€’å¢é‡å˜åŒ–
4. **æ¨¡å‹é€‰æ‹©**: ç®€å•æ­¥éª¤ä½¿ç”¨ Haiku

---

## 8. æ‰©å±•é˜…è¯»

### æ ¸å¿ƒèµ„æº

1. **[Reddit - 60% Token Reduction](https://www.reddit.com/r/AI_Agents/comments/1jugj0e/)**
   - ä»£ç†æ£€ç´¢åè®®ä¼˜åŒ–
   - ä¸Šä¸‹æ–‡ä¼ é€’æœ€ä½³å®è·µ

2. **[Reddit - 847 Agent Runs Analysis](https://www.reddit.com/r/LocalLLaMA/comments/1qio9nj/)**
   - ä¸Šä¸‹æ–‡é€€åŒ–å®è¯ç ”ç©¶
   - ä¸Šä¸‹æ–‡ç®¡ç†å±‚è§£å†³æ–¹æ¡ˆ

3. **[Microsoft - 5 Orchestration Patterns](https://medium.com/@lakkanaperera/the-5-ai-agent-orchestration-patterns-by-microsoft-9a27844eec9a)**
   - é¡ºåºè£…é…çº¿æ¨¡å¼
   - ç”Ÿäº§çº§æœ€ä½³å®è·µ

4. **[2026 Agentic Workflow Guide](https://www.stack-ai.com/blog/the-2026-guide-to-agentic-workflow-architectures)**
   - é¡ºåºç®¡é“æ¶æ„
   - åˆ†å±‚å¤šä»£ç†æ¨¡å¼

### ç›¸å…³çŸ¥è¯†ç‚¹

- `07_å®æˆ˜ä»£ç _01_åŸºç¡€å•ä»£ç†æ‰§è¡Œ.md` - å•ä»£ç†æ‰§è¡ŒåŸºç¡€
- `07_å®æˆ˜ä»£ç _02_å¹¶è¡Œä»£ç†æ‰§è¡Œ.md` - å¹¶è¡Œæ‰§è¡Œæ¨¡å¼
- `03_æ ¸å¿ƒæ¦‚å¿µ_04_è¿›ç¨‹éš”ç¦»ä¸ä¸Šä¸‹æ–‡ç®¡ç†.md` - ä¸Šä¸‹æ–‡ç®¡ç†

---

**ç‰ˆæœ¬**: v1.0
**æœ€åæ›´æ–°**: 2026-02-21
**ä½œè€…**: Claude Code
**å®¡æ ¸**: åŸºäº 2025-2026 å¹´æœ€æ–°å®è·µ
