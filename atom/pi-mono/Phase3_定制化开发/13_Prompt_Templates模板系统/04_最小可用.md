# 最小可用

## 5 分钟上手 Prompt Templates

### 目标

用最少的步骤，创建并使用你的第一个 Prompt Template。

---

## 最小可用示例

### 步骤 1：创建模板文件（30 秒）

```bash
# 创建全局模板目录
mkdir -p ~/.pi/agent/prompts

# 创建第一个模板
cat > ~/.pi/agent/prompts/hello.md << 'EOF'
---
description: Say hello to someone
---
Hello, $1! Welcome to Pi-mono Prompt Templates.
EOF
```

**解释：**
- `~/.pi/agent/prompts/` - 全局模板目录
- `hello.md` - 模板文件名（不含 `.md` 的部分是模板名）
- `---` - YAML frontmatter 分隔符
- `description` - 模板描述（可选）
- `$1` - 第一个参数

---

### 步骤 2：使用模板（10 秒）

```bash
# 启动 pi
pi

# 使用模板
/hello World
```

**输出：**
```
Hello, World! Welcome to Pi-mono Prompt Templates.
```

**就这么简单！** 你已经创建并使用了第一个 Prompt Template。

---

## 进阶示例：代码审查模板

### 步骤 1：创建代码审查模板（1 分钟）

```bash
cat > ~/.pi/agent/prompts/review.md << 'EOF'
---
description: Review code changes
---
Please review the following code changes and provide feedback:

**File:** $1
**Changes:** $2

Focus on:
1. Code quality and readability
2. Potential bugs or issues
3. Performance considerations
4. Best practices

Provide specific, actionable suggestions.
EOF
```

---

### 步骤 2：使用代码审查模板（10 秒）

```bash
pi

/review src/utils/helper.ts "Added new validation function"
```

**输出：**
```
Please review the following code changes and provide feedback:

**File:** src/utils/helper.ts
**Changes:** Added new validation function

Focus on:
1. Code quality and readability
2. Potential bugs or issues
3. Performance considerations
4. Best practices

Provide specific, actionable suggestions.
```

---

## 实战示例：多参数模板

### 步骤 1：创建 PR 审查模板（1 分钟）

```bash
cat > ~/.pi/agent/prompts/pr.md << 'EOF'
---
description: Review GitHub PRs
---
You are given GitHub PR URLs: $@

For each PR, please:
1. Summarize the changes
2. Identify potential issues
3. Suggest improvements
4. Check for security concerns

Provide a structured review for each PR.
EOF
```

**解释：**
- `$@` - 所有参数（可以传递多个 PR URL）

---

### 步骤 2：使用 PR 审查模板（10 秒）

```bash
pi

/pr https://github.com/user/repo/pull/123 https://github.com/user/repo/pull/456
```

**输出：**
```
You are given GitHub PR URLs: https://github.com/user/repo/pull/123 https://github.com/user/repo/pull/456

For each PR, please:
1. Summarize the changes
2. Identify potential issues
3. Suggest improvements
4. Check for security concerns

Provide a structured review for each PR.
```

---

## 项目级模板

### 步骤 1：创建项目模板目录（30 秒）

```bash
# 在项目根目录
mkdir -p .pi/prompts

# 创建项目特定的模板
cat > .pi/prompts/test.md << 'EOF'
---
description: Generate unit tests for this project
---
Generate unit tests for the following file: $1

Use our project's testing conventions:
- Jest as the testing framework
- Test file naming: *.test.ts
- Coverage target: 80%+
- Include edge cases and error scenarios

Generate comprehensive tests.
EOF
```

---

### 步骤 2：使用项目模板（10 秒）

```bash
pi

/test src/services/auth.ts
```

**输出：**
```
Generate unit tests for the following file: src/services/auth.ts

Use our project's testing conventions:
- Jest as the testing framework
- Test file naming: *.test.ts
- Coverage target: 80%+
- Include edge cases and error scenarios

Generate comprehensive tests.
```

**注意：** 项目模板优先级高于全局模板。如果项目和全局都有同名模板，使用项目模板。

---

## 参数切片示例

### 步骤 1：创建参数切片模板（1 分钟）

```bash
cat > ~/.pi/agent/prompts/compare.md << 'EOF'
---
description: Compare multiple files
---
Compare the following files:

**Base file:** $1
**Files to compare:** ${@:2}

Identify:
1. Differences in implementation
2. Common patterns
3. Potential refactoring opportunities

Provide a detailed comparison.
EOF
```

**解释：**
- `$1` - 第一个参数（基准文件）
- `${@:2}` - 从第二个参数开始的所有参数（要比较的文件）

---

### 步骤 2：使用参数切片模板（10 秒）

```bash
pi

/compare src/base.ts src/variant1.ts src/variant2.ts src/variant3.ts
```

**输出：**
```
Compare the following files:

**Base file:** src/base.ts
**Files to compare:** src/variant1.ts src/variant2.ts src/variant3.ts

Identify:
1. Differences in implementation
2. Common patterns
3. Potential refactoring opportunities

Provide a detailed comparison.
```

---

## 完整工作流示例

### 场景：团队代码审查工作流

#### 步骤 1：创建团队模板库（2 分钟）

```bash
# 创建团队模板目录
mkdir -p ~/.pi/agent/prompts/team

# 1. PR 审查模板
cat > ~/.pi/agent/prompts/team-pr.md << 'EOF'
---
description: Team PR review workflow
---
# PR Review Checklist

**PR URL:** $1

## Code Quality
- [ ] Code follows team style guide
- [ ] No code smells or anti-patterns
- [ ] Proper error handling

## Testing
- [ ] Unit tests included
- [ ] Integration tests if needed
- [ ] Edge cases covered

## Documentation
- [ ] Code comments where needed
- [ ] README updated if needed
- [ ] API docs updated

## Security
- [ ] No security vulnerabilities
- [ ] Input validation
- [ ] Authentication/authorization checks

Please review the PR and check each item.
EOF

# 2. Bug 分析模板
cat > ~/.pi/agent/prompts/team-bug.md << 'EOF'
---
description: Team bug analysis workflow
---
# Bug Analysis

**Issue:** $1

## Investigation Steps
1. Reproduce the bug
2. Identify root cause
3. Propose fix
4. Consider side effects
5. Plan testing strategy

## Questions to Answer
- What is the expected behavior?
- What is the actual behavior?
- What are the steps to reproduce?
- What is the impact?
- What is the urgency?

Please analyze the bug systematically.
EOF

# 3. 功能设计模板
cat > ~/.pi/agent/prompts/team-design.md << 'EOF'
---
description: Team feature design workflow
---
# Feature Design

**Feature:** $1

## Design Considerations
1. User requirements
2. Technical approach
3. API design
4. Data model
5. Testing strategy
6. Deployment plan

## Trade-offs
- Performance vs. simplicity
- Flexibility vs. complexity
- Time to market vs. quality

Please design the feature with these considerations.
EOF
```

---

#### 步骤 2：使用团队模板（每次 10 秒）

```bash
# PR 审查
pi
/team-pr https://github.com/team/project/pull/789

# Bug 分析
pi
/team-bug "Login fails with OAuth provider"

# 功能设计
pi
/team-design "Real-time notification system"
```

---

## 模板组织最佳实践

### 目录结构

```
~/.pi/agent/prompts/
├── code/
│   ├── review.md
│   ├── refactor.md
│   └── optimize.md
├── docs/
│   ├── api.md
│   ├── readme.md
│   └── changelog.md
├── team/
│   ├── pr.md
│   ├── bug.md
│   └── design.md
└── personal/
    ├── notes.md
    └── ideas.md
```

**注意：** Pi-mono 目前不支持子目录，所有模板必须在 `prompts/` 根目录下。上面的结构是建议的命名约定：

```
~/.pi/agent/prompts/
├── code-review.md
├── code-refactor.md
├── code-optimize.md
├── docs-api.md
├── docs-readme.md
├── docs-changelog.md
├── team-pr.md
├── team-bug.md
├── team-design.md
├── personal-notes.md
└── personal-ideas.md
```

---

## 快速参考

### 变量语法

| 语法 | 说明 | 示例 |
|------|------|------|
| `$1`, `$2`, ... | 位置参数 | `/hello World` → `$1` = "World" |
| `$@` | 所有参数 | `/pr url1 url2` → `$@` = "url1 url2" |
| `$ARGUMENTS` | 所有参数（新语法） | 同 `$@` |
| `${@:N}` | 从第 N 个参数开始 | `${@:2}` = 第 2 个参数及之后 |
| `${@:N:L}` | 从第 N 个参数开始，取 L 个 | `${@:2:3}` = 第 2-4 个参数 |

### 模板位置

| 位置 | 优先级 | 用途 |
|------|--------|------|
| `./.pi/prompts/` | 高 | 项目特定模板 |
| `~/.pi/agent/prompts/` | 中 | 全局个人模板 |
| 显式路径 | 低 | 临时或实验性模板 |

### 常用命令

```bash
# 列出所有可用模板
pi
/help

# 使用模板
/template-name arg1 arg2 ...

# 查看模板内容
cat ~/.pi/agent/prompts/template-name.md

# 编辑模板
vim ~/.pi/agent/prompts/template-name.md

# 删除模板
rm ~/.pi/agent/prompts/template-name.md
```

---

## 常见问题

### Q1: 模板不生效？

**检查清单：**
1. 文件名是否正确？（`.md` 扩展名）
2. 文件位置是否正确？（`~/.pi/agent/prompts/` 或 `./.pi/prompts/`）
3. YAML frontmatter 格式是否正确？（`---` 分隔符）
4. 是否重启了 pi？（通常不需要，但可以尝试）

**调试方法：**
```bash
# 检查文件是否存在
ls -la ~/.pi/agent/prompts/

# 检查文件内容
cat ~/.pi/agent/prompts/template-name.md

# 检查 YAML frontmatter
head -n 5 ~/.pi/agent/prompts/template-name.md
```

---

### Q2: 变量替换不工作？

**常见错误：**
```markdown
# ❌ 错误：使用了 Handlebars 语法
Hello, {{name}}!

# ✅ 正确：使用 Bash 风格语法
Hello, $1!
```

**调试方法：**
```bash
# 测试模板
pi
/template-name test-arg

# 检查输出是否包含变量名（如果包含，说明替换失败）
```

---

### Q3: 如何传递包含空格的参数？

**使用引号：**
```bash
pi
/review "src/utils/helper.ts" "Added new validation function"
```

**或者使用转义：**
```bash
pi
/review src/utils/helper.ts Added\ new\ validation\ function
```

---

### Q4: 如何在模板中使用 `$` 符号？

**转义 `$` 符号：**
```markdown
---
description: Example with dollar sign
---
The price is \$100.
The variable is $1.
```

**输出：**
```
The price is $100.
The variable is [参数值].
```

---

## 下一步

现在你已经掌握了 Prompt Templates 的基本使用，可以：

1. **创建更多模板** - 为常用任务创建模板
2. **学习高级特性** - 参数切片、条件逻辑等
3. **团队协作** - 与团队共享模板库
4. **集成工作流** - 将模板集成到 CI/CD 流程

---

## 2025-2026 年最佳实践

根据 2025-2026 年的实际应用，以下是推荐的最佳实践：

### 1. 使用 Git 管理模板

```bash
# 初始化模板仓库
cd ~/.pi/agent/prompts
git init
git add .
git commit -m "Initial commit"

# 推送到远程仓库
git remote add origin https://github.com/your-team/pi-templates.git
git push -u origin main
```

**参考：**
- [Awesome AI System Prompts](https://github.com/dontriskit/awesome-ai-system-prompts) - 使用 Git 管理系统提示
- [Reddit: 生产环境演化提示模板管理](https://www.reddit.com/r/PromptEngineering/comments/1nwynw5/how_do_you_manage_dozens_of_evolving_prompts_in/) - 通过 Git 管理数十个可重用提示

### 2. 模板命名约定

```
<category>-<action>-<target>.md

示例：
code-review-pr.md
docs-generate-api.md
test-create-unit.md
team-analyze-bug.md
```

### 3. 模板文档化

```markdown
---
description: Review GitHub PRs
author: team@example.com
version: 1.0.0
tags: [code-review, pr, github]
---
# PR Review Template

## Usage
/pr <pr-url>

## Example
/pr https://github.com/user/repo/pull/123

## Template
...
```

### 4. 模板测试

```bash
# 创建测试脚本
cat > test-templates.sh << 'EOF'
#!/bin/bash

# 测试 hello 模板
echo "Testing hello template..."
pi -c "/hello World" | grep "Hello, World"

# 测试 review 模板
echo "Testing review template..."
pi -c "/review test.ts 'test changes'" | grep "test.ts"

echo "All tests passed!"
EOF

chmod +x test-templates.sh
./test-templates.sh
```

---

## 总结

**Prompt Templates 的最小可用只需要 3 步：**

1. **创建模板文件** - `~/.pi/agent/prompts/name.md`
2. **编写模板内容** - Markdown + YAML frontmatter + Bash 变量
3. **使用模板** - `/name args`

**就这么简单！** 从这个最小可用开始，你可以逐步扩展到更复杂的用例。

---

**版本：** v1.0
**最后更新：** 2026-02-20
**维护者：** Claude Code
