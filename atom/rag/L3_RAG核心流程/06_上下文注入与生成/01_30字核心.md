# 30字核心

**上下文注入与生成是将检索结果组装成 Prompt 并调用 LLM 生成答案的过程，是 RAG 系统的最终输出环节。**

---

## 拆解理解

| 关键词 | 含义 |
|-------|------|
| **上下文注入（Context Injection）** | 将检索到的文档块"注入"到 Prompt 中 |
| **Prompt 组装** | 按特定模板将 System、Context、Query 拼接成完整提示词 |
| **LLM 生成** | 调用大语言模型，基于注入的上下文生成答案 |
| **最终输出环节** | RAG 流程的最后一步，前面所有工作都是为这一步服务 |

---

## 为什么这句话重要？

理解这句话，你就理解了：

1. **检索只是手段，生成才是目的** → 检索再好，组装不当也白搭
2. **Prompt 质量决定答案质量** → 同样的检索结果，不同的 Prompt 模板效果天差地别
3. **这是 RAG 与普通 LLM 的核心区别** → 普通 LLM 靠"记忆"，RAG 靠"现场参考资料"

---

## 上下文注入与生成的一句话公式

```
上下文注入与生成 = Prompt 模板 + 检索结果格式化 + LLM 调用 + 答案后处理
```

用前端的话说：

```
上下文注入与生成 = 请求体组装 + 数据序列化 + API 调用 + 响应处理
```

---

## 在 RAG 系统中的位置

```
┌─────────────────────────────────────────────────────────────┐
│                    在线查询阶段                               │
│                                                             │
│  用户问题        查询向量化        检索器        ★上下文注入★   │
│  ┌─────┐       ┌─────┐       ┌─────┐       ┌─────────┐     │
│  │ "如何│       │query│       │Top-K│       │ Prompt  │     │
│  │ 请假"│  ──→  │ vec │  ──→  │ 文档 │  ──→  │  + LLM  │     │
│  │     │       │     │       │     │       │  = 答案 │     │
│  └─────┘       └─────┘       └─────┘       └─────────┘     │
│                                                ↑           │
│                                              你在这里        │
└─────────────────────────────────────────────────────────────┘
```

---

## 上下文注入的核心任务

```
┌─────────────────────────────────────────────────────────────┐
│                                                             │
│  输入                        处理                    输出    │
│                                                             │
│  ┌─────────┐              ┌─────────┐           ┌─────┐    │
│  │ 检索结果 │              │ Prompt  │           │ 最终 │    │
│  │ (Top-K  │     ──→      │  组装   │    ──→    │ 答案 │    │
│  │  文档块) │              │ + LLM   │           │     │    │
│  └─────────┘              └─────────┘           └─────┘    │
│                                                             │
│  + 用户问题                 + 模板设计                        │
│  + 系统指令                 + Token 管理                      │
│                            + 生成参数                        │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

---

## 与前面章节的关系

| 章节 | 产出 | 与本章的关系 |
|------|------|-------------|
| 文档加载与解析 | 结构化文档 | 原始数据来源 |
| 文本分块 | 文档块 | 检索的基本单位 |
| 向量存储 | 向量索引 | 检索的数据基础 |
| 检索器设计 | Top-K 文档块 | **本章的直接输入** |
| **上下文注入与生成** | **最终答案** | **RAG 的最终产出** |

---

**记住这句话：** 上下文注入与生成 = Prompt 组装 + LLM 调用，把检索结果变成用户能用的答案。

---

**下一步：** [02_第一性原理](./02_第一性原理.md) - 从根本理解为什么需要"注入"上下文
