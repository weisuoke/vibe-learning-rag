# 30字核心

**Query改写是通过 LLM 优化用户原始查询的技术，弥补用户表达与文档表达的语义鸿沟，显著提升 RAG 检索效果。**

---

## 拆解理解

| 关键词 | 含义 |
|-------|------|
| **Query改写（Query Rewriting）** | 将用户原始查询转换为更适合检索的形式 |
| **LLM 优化** | 利用大语言模型的语言理解能力进行改写 |
| **语义鸿沟（Semantic Gap）** | 用户表达方式与文档表达方式之间的差异 |
| **检索效果** | 召回率、准确率、相关性的综合提升 |

---

## 为什么这句话重要？

理解这句话，你就理解了：

1. **用户查询往往不完美** → 口语化、模糊、不完整、缺乏专业术语
2. **文档表达有其特点** → 专业术语、完整句子、特定格式
3. **改写是桥梁** → 将用户意图翻译成文档能理解的语言

---

## Query改写的一句话公式

```
Query改写 = 理解用户意图 + 转换为检索友好形式 + 保持语义一致
```

用前端的话说：

```
Query改写 = 搜索框自动补全 + 拼写纠错 + 同义词扩展
```

---

## 在 RAG 系统中的位置

```
┌─────────────────────────────────────────────────────────────┐
│                    在线查询阶段                               │
│                                                             │
│  用户查询      ★Query改写★       检索          生成回答      │
│  ┌─────┐       ┌─────────┐       ┌─────┐       ┌─────┐     │
│  │原始  │       │ HyDE    │       │混合  │       │     │     │
│  │Query│  ──→  │ Multi-Q │  ──→  │检索  │  ──→  │ LLM │     │
│  │     │       │ 扩展... │       │     │       │     │     │
│  └─────┘       └─────────┘       └─────┘       └─────┘     │
│                    ↑                                        │
│                  你在这里                                     │
└─────────────────────────────────────────────────────────────┘
```

---

## Query改写 vs 直接检索

| 场景 | 直接检索 | Query改写后检索 |
|------|---------|----------------|
| "代码跑不动了" | ❌ 找不到相关文档 | ✅ 改写为"程序运行错误/异常处理" |
| "Python 咋异步" | ❌ 口语化匹配差 | ✅ 改写为"Python 异步编程 asyncio" |
| "数据库太慢" | ⚠️ 结果不精准 | ✅ 改写为"数据库性能优化/查询优化" |
| "API 报错 401" | ✅ 精确匹配有效 | ⚠️ 改写可能引入噪音 |

---

## 核心改写策略速览

| 策略 | 核心思想 | 适用场景 |
|------|---------|---------|
| **HyDE** | 先生成假设答案，用答案去检索 | 开放性问题 |
| **Multi-Query** | 生成多个查询变体并行检索 | 模糊/多义查询 |
| **Query Expansion** | 添加同义词、相关词 | 专业术语查询 |
| **Query Decomposition** | 拆解复杂问题为子问题 | 复合型问题 |
| **Step-back Prompting** | 先问更抽象的背景问题 | 需要背景知识的问题 |

---

**记住这句话：** Query改写 = 翻译官，把用户的口语翻译成文档能听懂的专业语言。

---

**下一步：** [02_第一性原理](./02_第一性原理.md) - 从根本理解为什么需要 Query改写
