# 化骨绵掌

> **10 张速查卡片，每张 2 分钟掌握**

---

## 卡片 1：15+ Provider 支持列表

### 主流云服务

| Provider | 模型示例 | 特点 |
|----------|----------|------|
| **Anthropic** | Claude 3.5 Sonnet/Haiku/Opus | 最强代码能力 |
| **OpenAI** | GPT-4o/GPT-4o Mini | 多模态支持 |
| **xAI** | Grok 2 | 实时信息 |
| **Google** | Gemini 2.0 Flash | 超长上下文 (2M) |
| **Mistral** | Mistral Large | 欧洲数据驻留 |
| **Cohere** | Command R+ | 企业级 RAG |
| **Groq** | Llama 3.1 70B | 超快推理 |

### 自定义集成

- **Ollama**：本地部署，免费
- **LM Studio**：GUI 界面，易用
- **OpenRouter**：聚合服务，统一接口
- **Azure OpenAI**：企业级，合规
- **AWS Bedrock**：云原生，集成

**记忆口诀**：7 大云服务 + 5 种自定义 = 15+ 选择

---

## 卡片 2：/model 命令速查

### 基本用法

```bash
# 交互式选择
> /model

# 搜索模型
Search: sonnet

# 按 Provider 搜索
Search: openai

# 按标签搜索
Search: coding
```

### 显示信息

```
claude-3-5-sonnet-20241022 (Anthropic)
Claude 3.5 Sonnet - 200K context - $3/$15 per MTok
```

**字段解析**：
- 模型 ID
- Provider 名称
- 显示名称
- 上下文窗口
- 成本（输入/输出）

### 快捷操作

- **↑/↓**：选择模型
- **Enter**：确认选择
- **Esc**：取消

---

## 卡片 3：Scoped Models 配置模板

### 最小配置

```json
{
  "scopedModels": [
    "claude-3-5-haiku-20241022",
    "claude-3-5-sonnet-20241022",
    "claude-opus-4-20250514"
  ]
}
```

### 场景配置

**前端开发**：

```json
{
  "scopedModels": [
    "claude-3-5-haiku-20241022",
    "claude-3-5-sonnet-20241022",
    "gpt-4o"
  ]
}
```

**后端开发**：

```json
{
  "scopedModels": [
    "claude-3-5-haiku-20241022",
    "claude-3-5-sonnet-20241022",
    "claude-opus-4-20250514"
  ]
}
```

**本地开发**：

```json
{
  "scopedModels": [
    "llama3.1:8b",
    "claude-3-5-haiku-20241022",
    "claude-3-5-sonnet-20241022"
  ]
}
```

**快捷键**：
- `Ctrl+P`：向前循环
- `Shift+Ctrl+P`：向后循环

---

## 卡片 4：models.json 最小配置

### 单 Provider

```json
{
  "providers": {
    "anthropic": {
      "apiType": "anthropic-messages",
      "baseUrl": "https://api.anthropic.com",
      "models": {
        "claude-3-5-sonnet-20241022": {
          "id": "claude-3-5-sonnet-20241022",
          "name": "Claude 3.5 Sonnet",
          "contextWindow": 200000,
          "maxOutput": 8192,
          "cost": { "input": 3.0, "output": 15.0 }
        }
      }
    }
  }
}
```

### 多 Provider

```json
{
  "providers": {
    "anthropic": { ... },
    "openai": { ... },
    "ollama": { ... }
  }
}
```

### 必需字段

- `apiType`：API 协议类型
- `baseUrl`：API 端点
- `models`：模型列表
- `id`：模型唯一标识
- `name`：显示名称

---

## 卡片 5：成本对比表 (2025-2026)

### Claude 系列

| 模型 | Input ($/MTok) | Output ($/MTok) | 成本比 |
|------|----------------|-----------------|--------|
| **Haiku** | 0.8 | 4.0 | 1x |
| **Sonnet** | 3.0 | 15.0 | 4x |
| **Opus** | 15.0 | 75.0 | 19x |

### OpenAI 系列

| 模型 | Input ($/MTok) | Output ($/MTok) | 成本比 |
|------|----------------|-----------------|--------|
| **GPT-4o Mini** | 0.15 | 0.6 | 0.2x |
| **GPT-4o** | 2.5 | 10.0 | 3x |
| **GPT-4 Turbo** | 10.0 | 30.0 | 13x |

### 本地模型

| 模型 | 成本 |
|------|------|
| **Ollama** | 免费 |
| **LM Studio** | 免费 |

### 成本优化策略

```
简单任务 → Haiku ($0.8/MTok)
中等任务 → Sonnet ($3/MTok)
复杂任务 → Opus ($15/MTok)
```

**节省潜力**：智能选择可节省 **88%** 成本

---

## 卡片 6：常用命令速查

### 核心命令

```bash
# 选择模型
> /model

# 查看会话信息
> /session

# 重载配置
> /reload

# 配置 Scoped Models
> /scoped-models

# 选择 Provider
> /provider

# 帮助
> /help
```

### CLI 参数

```bash
# 指定 Provider
pi --provider anthropic

# 指定模型
pi --model claude-3-5-sonnet-20241022

# 组合使用
pi --provider anthropic --model claude-3-5-sonnet-20241022
```

### 快捷键

```bash
# 向前循环 Scoped Models
Ctrl+P

# 向后循环 Scoped Models
Shift+Ctrl+P
```

---

## 卡片 7：配置文件位置

### 全局配置

```bash
~/.pi/agent/
├── models.json      # 模型定义
├── auth.json        # API 密钥 (0600 权限)
└── settings.json    # 用户设置
```

### 项目配置

```bash
project-root/
└── .pi/
    ├── models.json      # 项目特定模型
    ├── settings.json    # 项目特定设置
    ├── SYSTEM.md        # 系统提示词
    └── AGENTS.md        # 自定义 Agent
```

### 优先级

```
CLI 参数 > 项目配置 > 全局配置 > 环境变量 > 默认值
```

### 快速编辑

```bash
# 编辑全局配置
vim ~/.pi/agent/settings.json

# 编辑项目配置
vim .pi/settings.json

# 重载配置
> /reload
```

---

## 卡片 8：故障排查清单

### 问题 1：API Key 无效

```bash
# 检查文件权限
ls -la ~/.pi/agent/auth.json
# 应该显示：-rw------- (600)

# 修复权限
chmod 600 ~/.pi/agent/auth.json

# 验证 JSON 语法
cat ~/.pi/agent/auth.json | jq .
```

### 问题 2：模型不可用

```bash
# 重载配置
> /reload

# 查看可用模型
> /model

# 检查配置文件
cat ~/.pi/agent/models.json | jq .
```

### 问题 3：Ctrl+P 不工作

```bash
# 检查 Scoped Models 配置
cat ~/.pi/agent/settings.json | jq .scopedModels

# 确保数组不为空
# 至少配置 2 个模型
```

### 问题 4：代理连接失败

```bash
# 检查代理设置
echo $HTTP_PROXY
echo $HTTPS_PROXY

# 测试连接
curl -x "$HTTP_PROXY" -I https://api.anthropic.com
```

### 问题 5：Ollama 不可用

```bash
# 检查服务状态
pgrep -x "ollama"

# 启动服务
ollama serve

# 检查端口
lsof -i :11434
```

---

## 卡片 9：最佳实践 5 条

### 1. Scoped Models 数量控制

```
✅ 3-5 个模型
❌ 10+ 个模型
```

**原因**：太多选择降低效率

### 2. 按成本排序

```json
{
  "scopedModels": [
    "claude-3-5-haiku-20241022",    // 最便宜
    "claude-3-5-sonnet-20241022",   // 中等
    "claude-opus-4-20250514"        // 最贵
  ]
}
```

**原因**：默认使用最便宜的模型

### 3. 项目配置隔离

```bash
# 每个项目独立配置
project-a/.pi/settings.json
project-b/.pi/settings.json
```

**原因**：不同项目不同需求

### 4. 定期成本审查

```bash
# 每周检查
> /session

# 目标分布
# 80% Haiku
# 15% Sonnet
# 5% Opus
```

**原因**：避免成本失控

### 5. 使用热重载

```bash
# 修改配置后
> /reload

# 而不是重启 Pi
```

**原因**：保留对话历史，零中断

---

## 卡片 10：资源链接

### 官方文档

- **Pi GitHub**：https://github.com/pi-mono/pi
- **Models 配置**：https://github.com/pi-mono/pi/blob/main/docs/models.md
- **Provider 开发**：https://github.com/pi-mono/pi/blob/main/docs/providers.md

### 社区资源

- **GitHub Issues**：https://github.com/pi-mono/pi/issues
- **GitHub Discussions**：https://github.com/pi-mono/pi/discussions

### Provider 官网

- **Anthropic**：https://www.anthropic.com/
- **OpenAI**：https://openai.com/
- **xAI**：https://x.ai/
- **Google AI**：https://ai.google.dev/
- **Ollama**：https://ollama.com/

### 相关知识点

- [01_Pi_Coding_Agent安装与配置](../01_Pi_Coding_Agent安装与配置/00_概览.md)
- [02_基础命令与工作流](../02_基础命令与工作流/00_概览.md)

### 快速参考

```bash
# 配置模板
cp ~/.pi/agent/settings.json.example ~/.pi/agent/settings.json

# 验证配置
cat ~/.pi/agent/settings.json | jq .

# 测试连接
pi --provider anthropic --model claude-3-5-haiku-20241022
```

---

## 使用建议

### 学习顺序

1. **卡片 1-3**：基础概念（5 分钟）
2. **卡片 4-5**：配置与成本（5 分钟）
3. **卡片 6-7**：命令与文件（5 分钟）
4. **卡片 8-9**：故障排查与最佳实践（5 分钟）
5. **卡片 10**：资源链接（随时查阅）

### 打印建议

- 打印卡片 2、6、8 作为日常参考
- 卡片 5 贴在显示器旁边（成本提醒）
- 卡片 9 作为代码审查清单

### 记忆技巧

- **卡片 1**：7+5=12（云服务+自定义）
- **卡片 3**：3-5 个模型最优
- **卡片 5**：Haiku:Sonnet:Opus = 1:4:19
- **卡片 6**：5 个核心命令
- **卡片 9**：5 条最佳实践

---

**记住**：这 10 张卡片涵盖 90% 的日常使用场景，遇到问题先查卡片，再查完整文档。
