# æ•…éšœæ’æŸ¥ä¸è°ƒè¯•

> ä½¿ç”¨å››ä¸ªå·¥å…·è¯Šæ–­å’Œè§£å†³å¸¸è§é—®é¢˜

---

## å¸¸è§é—®é¢˜ 1ï¼šæ–‡ä»¶è¯»å–å¤±è´¥

### é—®é¢˜è¯Šæ–­

```typescript
// diagnose-read-error.ts
import fs from 'fs'

function diagnoseReadError(filePath: string): void {
  console.log(`\nğŸ” Diagnosing read error for: ${filePath}\n`)

  // 1. æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
  if (!fs.existsSync(filePath)) {
    console.log(`âŒ File does not exist: ${filePath}`)
    console.log(`\nSuggestions:`)
    console.log(`  - Check the file path spelling`)
    console.log(`  - Verify the file hasn't been moved or deleted`)
    return
  }

  // 2. æ£€æŸ¥æ˜¯å¦æ˜¯ç›®å½•
  const stats = fs.statSync(filePath)
  if (stats.isDirectory()) {
    console.log(`âŒ Path is a directory, not a file`)
    console.log(`\nSuggestions:`)
    console.log(`  - Use bash ls to list directory contents`)
    console.log(`  - Specify a file within the directory`)
    return
  }

  // 3. æ£€æŸ¥æ–‡ä»¶æƒé™
  try {
    fs.accessSync(filePath, fs.constants.R_OK)
    console.log(`âœ… File is readable`)
  } catch (error) {
    console.log(`âŒ Permission denied`)
    console.log(`\nSuggestions:`)
    console.log(`  - Check file permissions with: ls -la ${filePath}`)
    console.log(`  - Run: chmod +r ${filePath}`)
    return
  }

  // 4. æ£€æŸ¥æ–‡ä»¶å¤§å°
  const sizeInMB = stats.size / (1024 * 1024)
  if (sizeInMB > 10) {
    console.log(`âš ï¸  File is very large: ${sizeInMB.toFixed(2)} MB`)
    console.log(`\nSuggestions:`)
    console.log(`  - Read file in chunks`)
    console.log(`  - Use bash head/tail for preview`)
  } else {
    console.log(`âœ… File size is acceptable: ${sizeInMB.toFixed(2)} MB`)
  }

  // 5. æ£€æŸ¥æ–‡ä»¶ç¼–ç 
  try {
    const content = fs.readFileSync(filePath, 'utf-8')
    console.log(`âœ… File encoding is valid UTF-8`)
    console.log(`   Lines: ${content.split('\n').length}`)
  } catch (error) {
    console.log(`âŒ Encoding error: ${error.message}`)
    console.log(`\nSuggestions:`)
    console.log(`  - File may not be UTF-8 encoded`)
    console.log(`  - Try reading as binary or different encoding`)
  }
}

diagnoseReadError('src/app.ts')
```

---

## å¸¸è§é—®é¢˜ 2ï¼šç¼–è¾‘å¤±è´¥ï¼ˆå†…å®¹ä¸åŒ¹é…ï¼‰

### é—®é¢˜è¯Šæ–­

```typescript
// diagnose-edit-error.ts
import fs from 'fs'

function diagnoseEditError(
  filePath: string,
  oldText: string,
  newText: string
): void {
  console.log(`\nğŸ” Diagnosing edit error\n`)

  // 1. è¯»å–æ–‡ä»¶å†…å®¹
  const content = fs.readFileSync(filePath, 'utf-8')

  // 2. æ£€æŸ¥æ—§æ–‡æœ¬æ˜¯å¦å­˜åœ¨
  if (!content.includes(oldText)) {
    console.log(`âŒ Old text not found in file\n`)

    // æŸ¥æ‰¾ç›¸ä¼¼å†…å®¹
    const lines = content.split('\n')
    const similarLines = lines.filter(line =>
      line.includes(oldText.substring(0, 20))
    )

    if (similarLines.length > 0) {
      console.log(`Found similar lines:`)
      similarLines.forEach((line, i) => {
        console.log(`  ${i + 1}. ${line}`)
      })
      console.log(`\nSuggestions:`)
      console.log(`  - Check for whitespace differences`)
      console.log(`  - Verify exact text including spaces/tabs`)
    } else {
      console.log(`No similar content found\n`)
      console.log(`Suggestions:`)
      console.log(`  - Use read tool to verify file content`)
      console.log(`  - Search for partial text`)
    }
    return
  }

  // 3. æ£€æŸ¥æ˜¯å¦æœ‰å¤šä¸ªåŒ¹é…
  const matches = content.split(oldText).length - 1
  if (matches > 1) {
    console.log(`âš ï¸  Multiple matches found: ${matches}\n`)
    console.log(`Suggestions:`)
    console.log(`  - Provide more context to make oldText unique`)
    console.log(`  - Include surrounding lines in oldText`)

    // æ˜¾ç¤ºæ‰€æœ‰åŒ¹é…ä½ç½®
    let index = 0
    let matchCount = 0
    while ((index = content.indexOf(oldText, index)) !== -1) {
      matchCount++
      const lineNumber = content.substring(0, index).split('\n').length
      console.log(`  Match ${matchCount} at line ${lineNumber}`)
      index += oldText.length
    }
    return
  }

  console.log(`âœ… Old text found exactly once`)
  console.log(`\nEdit should succeed`)
}

diagnoseEditError('src/app.ts', 'const port = 3000', 'const port = 8080')
```

---

## å¸¸è§é—®é¢˜ 3ï¼šå‘½ä»¤æ‰§è¡Œå¤±è´¥

### é—®é¢˜è¯Šæ–­

```typescript
// diagnose-bash-error.ts
import { execSync } from 'child_process'
import fs from 'fs'

function diagnoseBashError(command: string): void {
  console.log(`\nğŸ” Diagnosing bash error: ${command}\n`)

  try {
    // 1. å°è¯•æ‰§è¡Œå‘½ä»¤
    const output = execSync(command, { encoding: 'utf-8', stdio: 'pipe' })
    console.log(`âœ… Command executed successfully`)
    console.log(`Output: ${output}`)
  } catch (error) {
    console.log(`âŒ Command failed\n`)

    // 2. åˆ†æé”™è¯¯ç±»å‹
    if (error.code === 127) {
      console.log(`Error: Command not found`)
      console.log(`\nSuggestions:`)
      console.log(`  - Check if command is installed`)
      console.log(`  - Verify command spelling`)
      console.log(`  - Check PATH: echo $PATH`)
    } else if (error.code === 126) {
      console.log(`Error: Permission denied`)
      console.log(`\nSuggestions:`)
      console.log(`  - Check file permissions`)
      console.log(`  - Run: chmod +x <file>`)
    } else if (error.code === 1) {
      console.log(`Error: Command failed with exit code 1`)
      console.log(`\nError output:`)
      console.log(error.stderr || error.stdout)
      console.log(`\nSuggestions:`)
      console.log(`  - Check command syntax`)
      console.log(`  - Verify input files exist`)
      console.log(`  - Check for missing dependencies`)
    } else {
      console.log(`Error: Exit code ${error.code}`)
      console.log(`\nError output:`)
      console.log(error.stderr || error.stdout)
    }

    // 3. æ£€æŸ¥å·¥ä½œç›®å½•
    console.log(`\nCurrent directory: ${process.cwd()}`)
    console.log(`\nSuggestions:`)
    console.log(`  - Verify you're in the correct directory`)
    console.log(`  - Use absolute paths if needed`)
  }
}

diagnoseBashError('npm test')
```

---

## å¸¸è§é—®é¢˜ 4ï¼šæµ‹è¯•å¤±è´¥è°ƒè¯•

### è‡ªåŠ¨åŒ–è°ƒè¯•æµç¨‹

```typescript
// auto-debug-tests.ts
import { execSync } from 'child_process'
import fs from 'fs'

class TestDebugger {
  async debugFailingTests(): Promise<void> {
    console.log(`\nğŸ› Debugging failing tests\n`)

    let attempt = 0
    const maxAttempts = 3

    while (attempt < maxAttempts) {
      attempt++
      console.log(`\nğŸ”„ Attempt ${attempt}/${maxAttempts}`)

      try {
        // 1. è¿è¡Œæµ‹è¯•
        console.log(`Running tests...`)
        execSync('npm test', { stdio: 'inherit' })
        console.log(`\nâœ… All tests passed!`)
        break
      } catch (error) {
        // 2. åˆ†æå¤±è´¥
        console.log(`\nâŒ Tests failed`)
        const failures = this.analyzeTestFailures()

        // 3. å°è¯•ä¿®å¤
        for (const failure of failures) {
          await this.attemptFix(failure)
        }
      }
    }

    if (attempt === maxAttempts) {
      console.log(`\nâš ï¸  Max attempts reached. Manual intervention needed.`)
      this.generateDebugReport()
    }
  }

  private analyzeTestFailures(): Array<{ file: string; test: string; error: string }> {
    // è¯»å–æµ‹è¯•è¾“å‡º
    try {
      const output = execSync('npm test 2>&1', { encoding: 'utf-8' })
      const failures: Array<{ file: string; test: string; error: string }> = []

      // è§£æå¤±è´¥çš„æµ‹è¯•
      const lines = output.split('\n')
      for (let i = 0; i < lines.length; i++) {
        if (lines[i].includes('FAIL')) {
          const file = lines[i].match(/FAIL\s+(.+\.test\.ts)/)?.[1] || ''
          const test = lines[i + 1] || ''
          const error = lines[i + 2] || ''
          failures.push({ file, test, error })
        }
      }

      return failures
    } catch (error) {
      return []
    }
  }

  private async attemptFix(failure: { file: string; test: string; error: string }): Promise<void> {
    console.log(`\nAttempting to fix: ${failure.test}`)

    // è¯»å–æµ‹è¯•æ–‡ä»¶
    const content = fs.readFileSync(failure.file, 'utf-8')

    // å¸¸è§ä¿®å¤æ¨¡å¼
    let fixed = content

    // ä¿®å¤ 1: æ·»åŠ  await
    if (failure.error.includes('Promise')) {
      fixed = fixed.replace(/(\w+)\(/g, 'await $1(')
      console.log(`  Applied fix: Added await`)
    }

    // ä¿®å¤ 2: ä¿®å¤æ–­è¨€
    if (failure.error.includes('toBe')) {
      fixed = fixed.replace(/toBe\(/g, 'toEqual(')
      console.log(`  Applied fix: Changed toBe to toEqual`)
    }

    // å†™å…¥ä¿®å¤
    if (fixed !== content) {
      fs.writeFileSync(failure.file, fixed)
      console.log(`  âœ“ File updated`)
    }
  }

  private generateDebugReport(): void {
    console.log(`\nğŸ“‹ Debug Report\n`)

    // æ”¶é›†ä¿¡æ¯
    const report = {
      timestamp: new Date().toISOString(),
      nodeVersion: process.version,
      testCommand: 'npm test',
      failures: this.analyzeTestFailures()
    }

    // å†™å…¥æŠ¥å‘Š
    fs.writeFileSync('debug-report.json', JSON.stringify(report, null, 2))
    console.log(`Report saved to: debug-report.json`)
  }
}

new TestDebugger().debugFailingTests()
```

---

## å¸¸è§é—®é¢˜ 5ï¼šæ€§èƒ½é—®é¢˜è¯Šæ–­

### æ€§èƒ½åˆ†æå·¥å…·

```typescript
// performance-analyzer.ts
import { execSync } from 'child_process'
import fs from 'fs'

class PerformanceAnalyzer {
  async analyzePerformance(): Promise<void> {
    console.log(`\nâš¡ Analyzing performance\n`)

    // 1. åˆ†ææ–‡ä»¶å¤§å°
    await this.analyzeFileSizes()

    // 2. åˆ†æä¾èµ–
    await this.analyzeDependencies()

    // 3. åˆ†ææ„å»ºæ—¶é—´
    await this.analyzeBuildTime()

    // 4. ç”ŸæˆæŠ¥å‘Š
    this.generateReport()
  }

  private async analyzeFileSizes(): Promise<void> {
    console.log(`ğŸ“Š Analyzing file sizes...`)

    const output = execSync('find src -type f -exec ls -lh {} \\;', { encoding: 'utf-8' })
    const files = output.split('\n').filter(f => f)

    // æ‰¾å‡ºå¤§æ–‡ä»¶
    const largeFiles = files
      .map(line => {
        const parts = line.split(/\s+/)
        return { size: parts[4], path: parts[8] }
      })
      .filter(f => f.size && f.size.includes('M'))

    if (largeFiles.length > 0) {
      console.log(`\nâš ï¸  Large files found:`)
      largeFiles.forEach(f => console.log(`  ${f.size} - ${f.path}`))
      console.log(`\nSuggestions:`)
      console.log(`  - Consider splitting large files`)
      console.log(`  - Move large data to separate files`)
    } else {
      console.log(`âœ… No large files found`)
    }
  }

  private async analyzeDependencies(): Promise<void> {
    console.log(`\nğŸ“¦ Analyzing dependencies...`)

    const pkg = JSON.parse(fs.readFileSync('package.json', 'utf-8'))
    const depCount = Object.keys(pkg.dependencies || {}).length
    const devDepCount = Object.keys(pkg.devDependencies || {}).length

    console.log(`Dependencies: ${depCount}`)
    console.log(`Dev dependencies: ${devDepCount}`)

    if (depCount > 50) {
      console.log(`\nâš ï¸  Many dependencies detected`)
      console.log(`Suggestions:`)
      console.log(`  - Review if all dependencies are needed`)
      console.log(`  - Consider lighter alternatives`)
    }
  }

  private async analyzeBuildTime(): Promise<void> {
    console.log(`\nâ±ï¸  Analyzing build time...`)

    const start = Date.now()
    try {
      execSync('npm run build', { stdio: 'pipe' })
      const duration = Date.now() - start
      console.log(`Build time: ${(duration / 1000).toFixed(2)}s`)

      if (duration > 30000) {
        console.log(`\nâš ï¸  Slow build detected`)
        console.log(`Suggestions:`)
        console.log(`  - Enable incremental compilation`)
        console.log(`  - Use build cache`)
        console.log(`  - Optimize TypeScript config`)
      }
    } catch (error) {
      console.log(`âŒ Build failed`)
    }
  }

  private generateReport(): void {
    console.log(`\nğŸ“‹ Performance report generated`)
  }
}

new PerformanceAnalyzer().analyzePerformance()
```

---

## è°ƒè¯•æŠ€å·§æ€»ç»“

### 1. ç³»ç»ŸåŒ–è¯Šæ–­æµç¨‹

```
1. é‡ç°é—®é¢˜
2. æ”¶é›†ä¿¡æ¯ï¼ˆé”™è¯¯æ¶ˆæ¯ã€æ—¥å¿—ã€ç¯å¢ƒï¼‰
3. éš”ç¦»é—®é¢˜ï¼ˆæœ€å°åŒ–å¤ç°æ­¥éª¤ï¼‰
4. åˆ†æåŸå› 
5. å°è¯•ä¿®å¤
6. éªŒè¯ä¿®å¤
7. è®°å½•è§£å†³æ–¹æ¡ˆ
```

### 2. å¸¸ç”¨è°ƒè¯•å‘½ä»¤

```bash
# æ£€æŸ¥æ–‡ä»¶
ls -la <file>
file <file>
cat <file>

# æ£€æŸ¥æƒé™
chmod +r <file>
chmod +x <file>

# æ£€æŸ¥è¿›ç¨‹
ps aux | grep <process>
lsof -p <pid>

# æ£€æŸ¥ç½‘ç»œ
netstat -an | grep <port>
curl -v <url>
```

### 3. æ—¥å¿—åˆ†æ

```typescript
// æ·»åŠ è¯¦ç»†æ—¥å¿—
console.log(`[DEBUG] Variable value: ${value}`)
console.log(`[DEBUG] Function called with: ${JSON.stringify(args)}`)
console.error(`[ERROR] Operation failed:`, error)
```

---

## æœ€ä½³å®è·µ

### 1. é¢„é˜²æ€§æ£€æŸ¥

```typescript
// åœ¨æ“ä½œå‰æ£€æŸ¥
if (!fs.existsSync(file)) {
  throw new Error(`File not found: ${file}`)
}

if (!content.includes(oldText)) {
  throw new Error(`Text not found: ${oldText}`)
}
```

### 2. è¯¦ç»†é”™è¯¯ä¿¡æ¯

```typescript
try {
  // æ“ä½œ
} catch (error) {
  console.error(`Operation failed:`, {
    file,
    operation: 'read',
    error: error.message,
    stack: error.stack
  })
}
```

### 3. å¢é‡è°ƒè¯•

```typescript
// é€æ­¥éªŒè¯
console.log(`Step 1: Reading file...`)
const content = fs.readFileSync(file, 'utf-8')
console.log(`âœ“ File read successfully`)

console.log(`Step 2: Processing content...`)
const processed = process(content)
console.log(`âœ“ Content processed`)
```

---

**ç‰ˆæœ¬ï¼š** v1.0
**æœ€åæ›´æ–°ï¼š** 2026-02-19
**ç»´æŠ¤è€…ï¼š** Claude Code
