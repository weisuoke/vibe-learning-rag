# 面试必问

> 文档加载与解析相关的高频面试问题

---

## 问题1："RAG 系统中，文档加载环节最大的挑战是什么？"

### 普通回答（❌ 不出彩）

"文档加载的挑战主要是处理不同格式的文件，比如 PDF、Word 等。"

### 出彩回答（✅ 推荐）

> **文档加载的挑战可以从三个层面来分析：**
>
> **1. 格式层面：PDF 解析的复杂性**
>
> PDF 的设计目标是精确还原打印效果，而不是方便文本提取。PDF 内部将文本存储为独立的绘制指令，每个字符都有独立坐标，没有"段落"或"表格"的概念。解析器需要重组这些分散的字符，识别布局结构，这是一个"尽力而为"的过程，无法保证 100% 准确。
>
> **2. 质量层面：信息损失与噪音**
>
> 解析过程中可能丢失重要信息（如表格结构、图片内容），同时引入噪音（如页眉页脚、水印）。这些问题会直接影响后续的检索质量——垃圾进，垃圾出。
>
> **3. 工程层面：编码与异常处理**
>
> 实际项目中会遇到各种边界情况：文件编码不一致、PDF 加密、扫描版 PDF 需要 OCR、文件损坏等。需要建立完善的异常处理和降级策略。
>
> **在实际工作中的应对策略：**
> - 针对不同场景选择合适的解析库（简单 PDF 用 pypdf，复杂布局用 pdfplumber）
> - 建立预处理流程清理噪音
> - 保留元数据用于答案溯源和问题排查

### 为什么这个回答出彩？

1. ✅ 分层次分析，展示系统性思维
2. ✅ 有具体技术细节（PDF 内部结构）
3. ✅ 联系实际工作经验
4. ✅ 给出了解决方案，不只是提出问题

---

## 问题2："如何设计一个支持多格式的文档加载模块？"

### 普通回答（❌ 不出彩）

"可以用 if-else 判断文件扩展名，然后调用不同的解析库。"

### 出彩回答（✅ 推荐）

> **我会采用策略模式来设计，核心是三个部分：**
>
> **1. 统一的数据结构（Document）**
>
> ```python
> @dataclass
> class Document:
>     page_content: str  # 文本内容
>     metadata: dict     # 元数据（来源、页码等）
> ```
>
> 所有格式的解析结果都输出为这个统一结构，后续处理只需要关心一种格式。
>
> **2. 统一的 Loader 接口**
>
> ```python
> class BaseLoader(ABC):
>     @abstractmethod
>     def load(self) -> List[Document]:
>         pass
> ```
>
> 每种格式实现自己的 Loader，但对外暴露相同的接口。这样新增格式只需要实现新的 Loader，不影响现有代码。
>
> **3. 工厂方法自动选择**
>
> ```python
> def get_loader(file_path: str) -> BaseLoader:
>     ext = Path(file_path).suffix.lower()
>     return loader_map.get(ext, DefaultLoader)(file_path)
> ```
>
> 调用方不需要关心具体用哪个 Loader，工厂方法根据扩展名自动选择。
>
> **这种设计的优点：**
> - **开闭原则**：新增格式不修改现有代码
> - **单一职责**：每个 Loader 只负责一种格式
> - **易于测试**：可以单独测试每个 Loader
>
> **在 LangChain 中就是这样设计的**，我们可以直接使用，也可以参考其设计自己实现。

### 为什么这个回答出彩？

1. ✅ 使用了设计模式术语（策略模式、工厂方法）
2. ✅ 有代码示例，具体可落地
3. ✅ 解释了设计的优点
4. ✅ 联系了实际框架（LangChain）

---

## 问题3："PDF 解析效果不好怎么办？"

### 普通回答（❌ 不出彩）

"换一个更好的 PDF 解析库。"

### 出彩回答（✅ 推荐）

> **PDF 解析效果不好需要分情况处理：**
>
> **首先，判断 PDF 类型：**
>
> | 类型 | 特征 | 解决方案 |
> |-----|------|---------|
> | 文本型 PDF | 可以选中文字 | 换更好的解析库 |
> | 扫描型 PDF | 文字是图片 | 需要 OCR |
> | 加密 PDF | 打开需要密码 | 先解密再解析 |
>
> **针对文本型 PDF，可以尝试：**
>
> 1. **换解析库**：pypdf → pdfplumber → PyMuPDF → unstructured
>    - pypdf：轻量但效果一般
>    - pdfplumber：表格提取好
>    - unstructured：效果最好但较重
>
> 2. **调整解析参数**：
>    ```python
>    # pdfplumber 可以调整表格识别参数
>    table_settings = {
>        "vertical_strategy": "text",
>        "horizontal_strategy": "text"
>    }
>    ```
>
> 3. **后处理修复**：
>    - 合并被错误分割的段落
>    - 修复表格结构
>    - 移除重复的页眉页脚
>
> **针对扫描型 PDF：**
>
> ```python
> # 使用 OCR
> from pdf2image import convert_from_path
> import pytesseract
>
> images = convert_from_path('scanned.pdf')
> text = pytesseract.image_to_string(images[0], lang='chi_sim')
> ```
>
> **最后，如果实在解析不好，可以考虑：**
> - 要求上游提供更好格式的文档（如 Word 原稿）
> - 人工标注关键内容
> - 接受一定程度的信息损失，在 Prompt 中说明

### 为什么这个回答出彩？

1. ✅ 先分类再解决，展示分析能力
2. ✅ 给出多种解决方案，由简到繁
3. ✅ 有具体代码示例
4. ✅ 考虑了实际工程中的妥协方案

---

## 面试技巧总结

| 问题类型 | 回答策略 |
|---------|---------|
| "最大挑战是什么" | 分层次分析 + 解决方案 |
| "如何设计" | 设计模式 + 代码示例 + 优点 |
| "效果不好怎么办" | 分类讨论 + 多种方案 + 工程妥协 |

**通用技巧：**
1. 先分析问题，再给方案
2. 有代码示例更有说服力
3. 联系实际框架和工作经验
4. 展示系统性思维，不只是点状知识

---

**下一步：** [09_化骨绵掌](./09_化骨绵掌.md) - 10个2分钟知识卡片，碎片化学习
