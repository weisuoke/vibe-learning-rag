# 面试必问

> Context Files 配置相关的高频面试题及出彩回答

---

## Q1: Pi Agent 的 Context Files 有哪些？各自的作用是什么？

### 普通回答
"有 AGENTS.md、settings.json 和 SYSTEM.md 三个文件，分别用于配置项目规范、系统设置和 AI 行为。"

### 出彩回答
"Pi Agent 的 Context Files 包括三个核心文件，它们形成了一个完整的配置体系：

1. **AGENTS.md** - 项目知识库，采用累加式加载机制。从全局到当前目录的所有 AGENTS.md 都会被合并，支持 mono-repo 的渐进式披露模式。

2. **settings.json** - 配置中心，采用覆盖式合并。支持全局（~/.pi/agent/）和项目级（.pi/）两层配置，嵌套对象深度合并，但数组完全替换。

3. **SYSTEM.md / APPEND_SYSTEM.md** - 系统提示词定制。SYSTEM.md 完全替换默认提示词，APPEND_SYSTEM.md 追加到默认提示词，用于定制 AI 的工作风格和行为准则。

这三个文件的设计体现了'约定优于配置'的理念，同时支持团队协作（Git 跟踪）和个人定制（.pi/ 目录）的平衡。"

**加分点：**
- 提到累加 vs 覆盖的区别
- 提到渐进式披露（progressive disclosure）
- 提到团队协作和个人定制的平衡

---

## Q2: AGENTS.md 的加载顺序是怎样的？为什么这样设计？

### 普通回答
"从全局配置开始，然后加载项目配置，最后加载当前目录配置。"

### 出彩回答
"AGENTS.md 采用自底向上的搜索和自顶向下的加载顺序：

**搜索路径：**
```
当前目录 → 父目录 → 祖父目录 → ... → 根目录 → ~/.pi/agent/
```

**加载顺序（合并）：**
```
全局 AGENTS.md → 项目根 AGENTS.md → 子目录 AGENTS.md
```

**设计理由：**
1. **渐进式上下文** - 从通用规则到特定规则，符合人类认知习惯
2. **Mono-repo 友好** - 支持根目录通用规范 + 子包特定规范
3. **团队协作** - 根目录配置可提交 Git，子目录配置可个性化
4. **热重载支持** - 通过 /reload 命令可快速更新配置

这种设计类似 Node.js 的模块解析机制，但关键区别是 Pi Agent 会合并所有找到的文件，而不是找到第一个就停止。"

**加分点：**
- 类比 Node.js 模块解析
- 提到 mono-repo 场景
- 提到热重载机制

---

## Q3: settings.json 的配置覆盖规则是什么？有什么需要注意的？

### 普通回答
"项目级配置会覆盖全局配置。"

### 出彩回答
"settings.json 采用智能合并策略，规则是：**嵌套对象深度合并，数组完全替换**。

**示例：**
```json
// 全局配置
{
  "defaultModel": "claude-sonnet-4",
  "compaction": {
    "enabled": true,
    "reserveTokens": 50000
  },
  "packages": ["@pi/core"]
}

// 项目配置
{
  "defaultModel": "claude-opus-4",
  "compaction": {
    "reserveTokens": 80000
  },
  "packages": ["@pi/custom"]
}

// 最终生效
{
  "defaultModel": "claude-opus-4",     // 覆盖
  "compaction": {
    "enabled": true,                   // 继承
    "reserveTokens": 80000             // 覆盖
  },
  "packages": ["@pi/custom"]           // 完全替换（不合并）
}
```

**注意事项：**
1. 数组配置（packages、skills 等）需要显式包含全局值
2. 项目配置放在 .pi/settings.json，建议加入 .gitignore
3. 全局配置适合个人偏好（主题、模型），项目配置适合项目特定需求

这种设计平衡了灵活性和可预测性，避免了数组合并可能导致的重复和冲突。"

**加分点：**
- 用具体示例说明合并规则
- 提到数组替换的设计理由
- 提到 Git 管理策略

---

## Q4: 如何为团队项目配置 Context Files？

### 普通回答
"在项目根目录创建 AGENTS.md，写入团队规范，提交到 Git。"

### 出彩回答
"团队项目的 Context Files 配置需要平衡'共享规范'和'个人定制'：

**推荐配置结构：**
```bash
project-root/
├── AGENTS.md              # 提交到 Git（团队共享）
├── .gitignore             # 忽略个人配置
│   └── .pi/settings.json
└── .pi/
    └── settings.json      # 不提交（个人定制）
```

**AGENTS.md 内容设计：**
```markdown
# 项目概述
TypeScript + React 项目，使用 pnpm

# 开发规范（团队共识）
- 代码风格：Prettier + ESLint
- 提交规范：Conventional Commits
- 测试要求：单元测试覆盖率 > 80%

# 常用命令
- pnpm dev - 开发服务器
- pnpm test - 运行测试
- pnpm lint - 代码检查

# 注意事项
- 不要修改 src/legacy/
- API 调用统一使用 src/api/client.ts
```

**个人配置示例（.pi/settings.json）：**
```json
{
  "defaultModel": "claude-opus-4",  // 个人偏好
  "theme": "dark"
}
```

**最佳实践：**
1. AGENTS.md 只包含团队共识，不包含个人偏好
2. 使用 progressive disclosure 模式（根目录通用 + 子目录特定）
3. 定期 review 和更新 AGENTS.md
4. 新成员 onboarding 时，先读 AGENTS.md

这种配置方式确保了团队规范的一致性，同时保留了个人工作习惯的灵活性。"

**加分点：**
- 提到 Git 管理策略
- 提到 progressive disclosure
- 提到团队协作流程

---

## Q5: SYSTEM.md 和 APPEND_SYSTEM.md 有什么区别？应该用哪个？

### 普通回答
"SYSTEM.md 会替换默认提示词，APPEND_SYSTEM.md 会追加。一般用 APPEND_SYSTEM.md。"

### 出彩回答
"两者的核心区别在于对默认系统提示词的处理方式：

**SYSTEM.md（完全替换）：**
- 替换 Pi Agent 的整个默认系统提示词
- 需要自己重新定义所有 AI 能力和行为
- 适合高级用户完全自定义 AI 行为

**APPEND_SYSTEM.md（追加）：**
- 在默认系统提示词后追加自定义内容
- 保留 Pi Agent 的所有默认能力
- 适合大多数场景的定制需求

**选择建议：**
- **99% 的情况用 APPEND_SYSTEM.md**，因为：
  - 保留默认能力（工具使用、文件操作等）
  - 只需添加项目特定规则
  - 更安全，不会破坏基础功能

- **只在以下情况用 SYSTEM.md**：
  - 你完全理解默认提示词的内容
  - 你需要从零定义 AI 的所有行为
  - 你有能力维护完整的系统提示词

**实际案例：**
```markdown
# .pi/APPEND_SYSTEM.md（推荐）
# 代码风格
- 使用函数式编程
- 优先使用 const 和箭头函数

# 工作方式
- 代码优先，少说多做
- 每次修改后自动运行测试
```

这种设计体现了'安全默认'的原则，让用户在不破坏基础功能的前提下定制 AI 行为。"

**加分点：**
- 明确使用场景和选择标准
- 提到安全性考虑
- 用实际案例说明

---

**总结：** 这些问题考察的是对 Context Files 配置机制的深入理解，以及在实际项目中的应用能力。回答时要结合具体场景和设计理由，展现系统性思维。
