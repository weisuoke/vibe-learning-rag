# å®æˆ˜ä»£ç  01ï¼šåŸºç¡€æŠ€èƒ½å¼€å‘

## åœºæ™¯ 1ï¼šåˆ›å»ºç®€å•çš„ä»£ç å®¡æŸ¥æŠ€èƒ½

### éœ€æ±‚

åˆ›å»ºä¸€ä¸ªåŸºç¡€çš„ä»£ç å®¡æŸ¥æŠ€èƒ½ï¼Œèƒ½å¤Ÿåˆ†æä»£ç è´¨é‡ã€å‘ç°æ½œåœ¨é—®é¢˜å¹¶æä¾›æ”¹è¿›å»ºè®®ã€‚

### å®ç°æ­¥éª¤

**æ­¥éª¤ 1ï¼šåˆ›å»ºæŠ€èƒ½ç›®å½•**

```bash
mkdir -p ~/.pi/agent/skills/code-review
cd ~/.pi/agent/skills/code-review
```

**æ­¥éª¤ 2ï¼šåˆ›å»º SKILL.md æ–‡ä»¶**

```markdown
---
name: code-review
description: Review code for quality, security, and performance issues
---

You are an expert code reviewer with 10+ years of experience in software development.

## Your Expertise

- **Security**: OWASP Top 10, secure coding practices
- **Performance**: Algorithm complexity, optimization techniques
- **Maintainability**: SOLID principles, design patterns
- **Testing**: Unit testing, integration testing, TDD

## Review Process

### 1. Understand the Context
- Read the code carefully
- Understand the intent and requirements
- Consider the broader system architecture

### 2. Security Analysis
- Check for SQL injection vulnerabilities
- Look for XSS attack vectors
- Verify authentication and authorization
- Review data validation and sanitization

### 3. Performance Review
- Analyze algorithm complexity (Big O)
- Identify potential bottlenecks
- Check for unnecessary computations
- Review database query efficiency

### 4. Code Quality Assessment
- Evaluate readability and maintainability
- Check adherence to coding standards
- Assess error handling
- Review test coverage

## Output Format

Provide your review in the following structure:

### âœ… Strengths
- List positive aspects of the code

### âš ï¸ Issues
- **Critical**: Security vulnerabilities, major bugs
- **Important**: Performance issues, design flaws
- **Minor**: Style issues, minor improvements

### ğŸ’¡ Suggestions
- Specific, actionable recommendations
- Code examples where helpful
- Links to relevant documentation

## Example

```typescript
// âŒ Vulnerable code
app.get('/user', (req, res) => {
  const userId = req.query.id;
  db.query(`SELECT * FROM users WHERE id = ${userId}`);
});

// âœ… Secure code
app.get('/user', (req, res) => {
  const userId = req.query.id;
  db.query('SELECT * FROM users WHERE id = ?', [userId]);
});
```

Be constructive, specific, and helpful in your feedback.
```

**æ­¥éª¤ 3ï¼šæµ‹è¯•æŠ€èƒ½**

```bash
# å¯åŠ¨ pi
pi

# ä½¿ç”¨æŠ€èƒ½
/skill:code-review src/app.ts
```

### é¢„æœŸè¾“å‡º

```
### âœ… Strengths
- Clean code structure with clear separation of concerns
- Good error handling with try-catch blocks
- Comprehensive input validation

### âš ï¸ Issues
- **Critical**: SQL injection vulnerability in user query (line 45)
- **Important**: Missing rate limiting on API endpoints
- **Minor**: Inconsistent naming conventions

### ğŸ’¡ Suggestions
1. Use parameterized queries to prevent SQL injection
2. Implement rate limiting middleware
3. Standardize variable naming (camelCase vs snake_case)
```

---

## åœºæ™¯ 2ï¼šæ·»åŠ å‚æ•°å’Œé…ç½®

### éœ€æ±‚

æ‰©å±•ä»£ç å®¡æŸ¥æŠ€èƒ½ï¼Œæ”¯æŒä¸åŒçš„å®¡æŸ¥é‡ç‚¹ï¼ˆå®‰å…¨ã€æ€§èƒ½ã€è´¨é‡ï¼‰ã€‚

### å®ç°æ­¥éª¤

**æ­¥éª¤ 1ï¼šæ›´æ–° SKILL.md**

```markdown
---
name: code-review
description: Review code with configurable focus areas
---

You are an expert code reviewer.

## Usage

When the user provides code, they may specify a focus area:
- **security**: Focus on security vulnerabilities
- **performance**: Focus on performance optimization
- **quality**: Focus on code quality and maintainability
- **all** (default): Comprehensive review

## Focus Areas

### Security Focus
When the user specifies "security" or mentions security concerns:
- Prioritize OWASP Top 10 vulnerabilities
- Check authentication and authorization
- Review data validation and sanitization
- Analyze cryptographic implementations

### Performance Focus
When the user specifies "performance" or mentions performance:
- Analyze algorithm complexity
- Identify bottlenecks
- Review database queries
- Check caching strategies

### Quality Focus
When the user specifies "quality" or mentions maintainability:
- Evaluate code readability
- Check SOLID principles
- Review design patterns
- Assess test coverage

### Comprehensive Review (Default)
When no specific focus is mentioned:
- Cover all areas (security, performance, quality)
- Prioritize by severity
- Provide balanced feedback

## Output Format

### ğŸ¯ Focus Area
[Identified focus area]

### âœ… Strengths
[Positive aspects]

### âš ï¸ Issues
[Issues found, prioritized by severity]

### ğŸ’¡ Suggestions
[Actionable recommendations]
```

**æ­¥éª¤ 2ï¼šæµ‹è¯•ä¸åŒå‚æ•°**

```bash
# é»˜è®¤å®¡æŸ¥ï¼ˆå…¨é¢ï¼‰
/skill:code-review src/app.ts

# å®‰å…¨å®¡æŸ¥
/skill:code-review security src/app.ts

# æ€§èƒ½å®¡æŸ¥
/skill:code-review performance src/app.ts

# è´¨é‡å®¡æŸ¥
/skill:code-review quality src/app.ts
```

### é¢„æœŸè¾“å‡º

```bash
# å®‰å…¨å®¡æŸ¥è¾“å‡º
### ğŸ¯ Focus Area
Security

### âœ… Strengths
- Input validation on all endpoints
- HTTPS enforced

### âš ï¸ Issues
- **Critical**: SQL injection in line 45
- **Important**: Missing CSRF protection

### ğŸ’¡ Suggestions
1. Use parameterized queries
2. Implement CSRF tokens
```

---

## åœºæ™¯ 3ï¼šä½¿ç”¨ Prompt Templates

### éœ€æ±‚

åˆ›å»ºä¸€ä¸ªæŠ€èƒ½ï¼Œä½¿ç”¨ Prompt Templates æ¥å¤ç”¨å¸¸è§çš„å®¡æŸ¥æ¨¡å¼ã€‚

### å®ç°æ­¥éª¤

**æ­¥éª¤ 1ï¼šåˆ›å»º Prompt Template**

```bash
mkdir -p ~/.pi/agent/prompts
cat > ~/.pi/agent/prompts/security-checklist.md << 'EOF'
---
description: Security review checklist
---

## Security Checklist

### Authentication & Authorization
- [ ] Proper authentication mechanisms
- [ ] Authorization checks on all endpoints
- [ ] Session management
- [ ] Password hashing (bcrypt, Argon2)

### Input Validation
- [ ] All user inputs validated
- [ ] SQL injection prevention
- [ ] XSS prevention
- [ ] Command injection prevention

### Data Protection
- [ ] Sensitive data encrypted
- [ ] HTTPS enforced
- [ ] Secure cookie flags
- [ ] CORS properly configured

### Error Handling
- [ ] No sensitive info in error messages
- [ ] Proper logging
- [ ] Rate limiting
- [ ] DDoS protection
EOF
```

**æ­¥éª¤ 2ï¼šåˆ›å»ºä½¿ç”¨æ¨¡æ¿çš„æŠ€èƒ½**

```markdown
---
name: security-audit
description: Comprehensive security audit using checklist
---

You are a security expert performing a comprehensive security audit.

## Process

1. **Load Security Checklist**
   Use the security-checklist template to guide your review.

2. **Analyze Code**
   Check each item in the checklist against the provided code.

3. **Report Findings**
   For each checklist item:
   - âœ… Pass: Item is properly implemented
   - âš ï¸ Fail: Item has issues
   - â“ Unknown: Cannot determine from provided code

## Output Format

### Security Audit Report

#### Authentication & Authorization
- âœ… Proper authentication mechanisms
- âš ï¸ Missing authorization checks on /admin endpoint
- âœ… Session management implemented

#### Input Validation
- âš ï¸ SQL injection vulnerability in user query
- âœ… XSS prevention with sanitization
- âœ… Command injection prevention

[Continue for all checklist items]

### Summary
- **Pass**: 8/12 items
- **Fail**: 4/12 items
- **Critical Issues**: 2
- **Important Issues**: 2

### Recommendations
1. [Priority 1] Fix SQL injection vulnerability
2. [Priority 2] Add authorization checks
```

**æ­¥éª¤ 3ï¼šæµ‹è¯•æŠ€èƒ½**

```bash
/skill:security-audit src/app.ts
```

---

## åœºæ™¯ 4ï¼šæœ¬åœ°æµ‹è¯•æŠ€èƒ½

### éœ€æ±‚

åœ¨å‘å¸ƒæŠ€èƒ½å‰ï¼Œè¿›è¡Œæœ¬åœ°æµ‹è¯•ä»¥ç¡®ä¿æŠ€èƒ½æŒ‰é¢„æœŸå·¥ä½œã€‚

### æµ‹è¯•ç­–ç•¥

**ç­–ç•¥ 1ï¼šå•å…ƒæµ‹è¯•ï¼ˆæ‰‹åŠ¨ï¼‰**

åˆ›å»ºæµ‹è¯•ç”¨ä¾‹æ–‡ä»¶ï¼š

```bash
mkdir -p ~/.pi/agent/skills/code-review/tests
cat > ~/.pi/agent/skills/code-review/tests/test-cases.md << 'EOF'
# Code Review Skill Test Cases

## Test Case 1: SQL Injection Detection

### Input
```typescript
app.get('/user', (req, res) => {
  const userId = req.query.id;
  db.query(`SELECT * FROM users WHERE id = ${userId}`);
});
```

### Expected Output
- Should detect SQL injection vulnerability
- Should suggest parameterized queries
- Should mark as Critical severity

## Test Case 2: Secure Code

### Input
```typescript
app.get('/user', (req, res) => {
  const userId = req.query.id;
  db.query('SELECT * FROM users WHERE id = ?', [userId]);
});
```

### Expected Output
- Should recognize secure implementation
- Should list as a strength
- No critical issues

## Test Case 3: Performance Issue

### Input
```typescript
function findUser(users, targetId) {
  for (let i = 0; i < users.length; i++) {
    for (let j = 0; j < users.length; j++) {
      if (users[i].id === targetId) {
        return users[i];
      }
    }
  }
}
```

### Expected Output
- Should detect O(nÂ²) complexity
- Should suggest optimization
- Should mark as Important severity
EOF
```

**ç­–ç•¥ 2ï¼šè‡ªåŠ¨åŒ–æµ‹è¯•è„šæœ¬**

```typescript
// test-skill.ts
import { execSync } from 'child_process';
import { readFileSync } from 'fs';

interface TestCase {
  name: string;
  input: string;
  expectedKeywords: string[];
}

const testCases: TestCase[] = [
  {
    name: 'SQL Injection Detection',
    input: 'app.get("/user", (req, res) => { db.query(`SELECT * FROM users WHERE id = ${req.query.id}`); });',
    expectedKeywords: ['SQL injection', 'parameterized', 'Critical']
  },
  {
    name: 'Secure Code Recognition',
    input: 'app.get("/user", (req, res) => { db.query("SELECT * FROM users WHERE id = ?", [req.query.id]); });',
    expectedKeywords: ['secure', 'strength', 'parameterized']
  }
];

function testSkill(testCase: TestCase): boolean {
  console.log(`\nTesting: ${testCase.name}`);

  // åˆ›å»ºä¸´æ—¶æ–‡ä»¶
  const tempFile = '/tmp/test-code.ts';
  writeFileSync(tempFile, testCase.input);

  // è°ƒç”¨æŠ€èƒ½
  const output = execSync(`echo "/skill:code-review ${tempFile}" | pi --non-interactive`).toString();

  // æ£€æŸ¥é¢„æœŸå…³é”®è¯
  const passed = testCase.expectedKeywords.every(keyword =>
    output.toLowerCase().includes(keyword.toLowerCase())
  );

  console.log(`Result: ${passed ? 'âœ… PASS' : 'âŒ FAIL'}`);
  if (!passed) {
    console.log('Expected keywords:', testCase.expectedKeywords);
    console.log('Actual output:', output);
  }

  return passed;
}

// è¿è¡Œæ‰€æœ‰æµ‹è¯•
const results = testCases.map(testSkill);
const passCount = results.filter(r => r).length;

console.log(`\n\nTest Summary: ${passCount}/${testCases.length} passed`);
process.exit(passCount === testCases.length ? 0 : 1);
```

**ç­–ç•¥ 3ï¼šé›†æˆæµ‹è¯•**

```bash
#!/bin/bash
# test-integration.sh

echo "Running integration tests for code-review skill..."

# Test 1: Basic usage
echo "Test 1: Basic usage"
echo "/skill:code-review src/app.ts" | pi --non-interactive > /tmp/test1-output.txt
if grep -q "Strengths" /tmp/test1-output.txt && grep -q "Issues" /tmp/test1-output.txt; then
  echo "âœ… Test 1 passed"
else
  echo "âŒ Test 1 failed"
  exit 1
fi

# Test 2: Security focus
echo "Test 2: Security focus"
echo "/skill:code-review security src/app.ts" | pi --non-interactive > /tmp/test2-output.txt
if grep -q "Security" /tmp/test2-output.txt; then
  echo "âœ… Test 2 passed"
else
  echo "âŒ Test 2 failed"
  exit 1
fi

# Test 3: Performance focus
echo "Test 3: Performance focus"
echo "/skill:code-review performance src/app.ts" | pi --non-interactive > /tmp/test3-output.txt
if grep -q "Performance" /tmp/test3-output.txt; then
  echo "âœ… Test 3 passed"
else
  echo "âŒ Test 3 failed"
  exit 1
fi

echo "All integration tests passed!"
```

**ç­–ç•¥ 4ï¼šéªŒè¯æ¸…å•**

```markdown
# Skill Validation Checklist

## Format Validation
- [ ] SKILL.md file exists
- [ ] YAML frontmatter is valid
- [ ] name matches directory name
- [ ] description is clear and concise (< 1024 chars)
- [ ] name follows naming conventions (lowercase, hyphens only)

## Content Validation
- [ ] Role definition is clear
- [ ] Process/workflow is well-defined
- [ ] Output format is specified
- [ ] Examples are provided
- [ ] Edge cases are handled

## Functionality Validation
- [ ] Skill loads without errors
- [ ] Skill responds to basic input
- [ ] Output format matches specification
- [ ] Parameters work as expected
- [ ] Error handling works correctly

## Quality Validation
- [ ] Instructions are clear and unambiguous
- [ ] Examples are realistic and helpful
- [ ] Output is consistent across runs
- [ ] Performance is acceptable
- [ ] No security issues in skill logic
```

### è¿è¡Œæµ‹è¯•

```bash
# æ‰‹åŠ¨æµ‹è¯•
pi
/skill:code-review tests/test-cases/sql-injection.ts

# è‡ªåŠ¨åŒ–æµ‹è¯•
npm run test:skills

# é›†æˆæµ‹è¯•
./tests/test-integration.sh

# éªŒè¯æ¸…å•
# é€é¡¹æ£€æŸ¥æ¸…å•ä¸­çš„æ¯ä¸€é¡¹
```

---

## å®Œæ•´ç¤ºä¾‹ï¼šç«¯åˆ°ç«¯æŠ€èƒ½å¼€å‘

### éœ€æ±‚

åˆ›å»ºä¸€ä¸ªå®Œæ•´çš„æµ‹è¯•ç”ŸæˆæŠ€èƒ½ï¼Œä»é›¶å¼€å§‹åˆ°æµ‹è¯•å®Œæˆã€‚

### å®ç°

**æ­¥éª¤ 1ï¼šè§„åˆ’**

```markdown
# Test Generation Skill Plan

## Goal
Generate unit tests for TypeScript functions using Jest.

## Features
- Analyze function signature
- Generate test cases for:
  - Happy path
  - Edge cases
  - Error cases
- Use Jest syntax
- Include setup/teardown if needed

## Output
- Complete test file
- Test descriptions
- Assertions
```

**æ­¥éª¤ 2ï¼šå®ç°**

```bash
mkdir -p ~/.pi/agent/skills/test-generation
cat > ~/.pi/agent/skills/test-generation/SKILL.md << 'EOF'
---
name: test-generation
description: Generate unit tests for TypeScript functions using Jest
---

You are a test automation expert specializing in Jest and TypeScript.

## Process

1. **Analyze Function**
   - Understand function signature
   - Identify parameters and return type
   - Note any side effects

2. **Generate Test Cases**
   - **Happy Path**: Normal, expected usage
   - **Edge Cases**: Boundary conditions, empty inputs, null/undefined
   - **Error Cases**: Invalid inputs, exceptions

3. **Write Tests**
   - Use Jest syntax
   - Clear test descriptions
   - Proper assertions
   - Setup/teardown if needed

## Output Format

```typescript
import { functionName } from './module';

describe('functionName', () => {
  // Happy path tests
  it('should return expected result for valid input', () => {
    const result = functionName(validInput);
    expect(result).toBe(expectedOutput);
  });

  // Edge case tests
  it('should handle empty input', () => {
    const result = functionName('');
    expect(result).toBe(defaultValue);
  });

  it('should handle null input', () => {
    const result = functionName(null);
    expect(result).toBeNull();
  });

  // Error case tests
  it('should throw error for invalid input', () => {
    expect(() => functionName(invalidInput)).toThrow('Error message');
  });
});
```

## Example

Given function:
```typescript
function add(a: number, b: number): number {
  if (typeof a !== 'number' || typeof b !== 'number') {
    throw new Error('Both arguments must be numbers');
  }
  return a + b;
}
```

Generated tests:
```typescript
import { add } from './math';

describe('add', () => {
  it('should add two positive numbers', () => {
    expect(add(2, 3)).toBe(5);
  });

  it('should add negative numbers', () => {
    expect(add(-2, -3)).toBe(-5);
  });

  it('should handle zero', () => {
    expect(add(0, 5)).toBe(5);
  });

  it('should throw error for non-number input', () => {
    expect(() => add('2' as any, 3)).toThrow('Both arguments must be numbers');
  });
});
```
EOF
```

**æ­¥éª¤ 3ï¼šæµ‹è¯•**

```bash
# åˆ›å»ºæµ‹è¯•å‡½æ•°
cat > /tmp/test-function.ts << 'EOF'
function validateEmail(email: string): boolean {
  if (!email) return false;
  const regex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  return regex.test(email);
}
EOF

# ä½¿ç”¨æŠ€èƒ½ç”Ÿæˆæµ‹è¯•
pi
/skill:test-generation /tmp/test-function.ts
```

**æ­¥éª¤ 4ï¼šéªŒè¯è¾“å‡º**

é¢„æœŸç”Ÿæˆçš„æµ‹è¯•ï¼š

```typescript
import { validateEmail } from './validation';

describe('validateEmail', () => {
  it('should return true for valid email', () => {
    expect(validateEmail('user@example.com')).toBe(true);
  });

  it('should return false for empty string', () => {
    expect(validateEmail('')).toBe(false);
  });

  it('should return false for email without @', () => {
    expect(validateEmail('userexample.com')).toBe(false);
  });

  it('should return false for email without domain', () => {
    expect(validateEmail('user@')).toBe(false);
  });

  it('should return false for null input', () => {
    expect(validateEmail(null as any)).toBe(false);
  });
});
```

---

## æ€»ç»“

**åŸºç¡€æŠ€èƒ½å¼€å‘æµç¨‹ï¼š**

1. **åˆ›å»ºç›®å½•å’Œæ–‡ä»¶** - éµå¾ªå‘½åè§„èŒƒ
2. **å®šä¹‰æŠ€èƒ½é€»è¾‘** - æ¸…æ™°çš„è§’è‰²ã€æµç¨‹ã€è¾“å‡º
3. **æ·»åŠ å‚æ•°æ”¯æŒ** - çµæ´»é…ç½®
4. **ä½¿ç”¨æ¨¡æ¿** - å¤ç”¨å¸¸è§æ¨¡å¼
5. **æœ¬åœ°æµ‹è¯•** - ç¡®ä¿è´¨é‡

**å…³é”®è¦ç‚¹ï¼š**

- **YAML frontmatter** - name å’Œ description å¿…éœ€
- **æ¸…æ™°çš„æŒ‡ä»¤** - æ˜ç¡®çš„æµç¨‹å’Œè¾“å‡ºæ ¼å¼
- **ç¤ºä¾‹** - æä¾›å…·ä½“çš„ä»£ç ç¤ºä¾‹
- **æµ‹è¯•** - æ‰‹åŠ¨å’Œè‡ªåŠ¨åŒ–æµ‹è¯•ç»“åˆ

**ä¸‹ä¸€æ­¥ï¼š**

- ã€é«˜çº§æŠ€èƒ½ä¸ç»„åˆã€‘- å­¦ä¹ æŠ€èƒ½ç»„åˆå’Œé«˜çº§ç‰¹æ€§
- ã€æµ‹è¯•å‘å¸ƒä¸é›†æˆã€‘- å­¦ä¹ å‘å¸ƒå’Œ CI/CD é›†æˆ

---

**ç‰ˆæœ¬ï¼š** v1.0
**æœ€åæ›´æ–°ï¼š** 2026-02-20
**ç»´æŠ¤è€…ï¼š** Claude Code
