# 10_ä¸€å¥è¯æ€»ç»“

> **æœ¬æ–‡æ¡£ç”¨ä¸€å¥è¯æ€»ç»“ RunnableLambda çš„å…¨éƒ¨ç²¾é«“ï¼Œå¸®åŠ©ä½ å¿«é€Ÿå›é¡¾å’Œè®°å¿†æ ¸å¿ƒè¦ç‚¹ã€‚**

---

## ç»ˆææ€»ç»“

**RunnableLambda æ˜¯ LangChain ä¸­å°†æ™®é€š Python å‡½æ•°è½¬æ¢ä¸º Runnable çš„é€‚é…å™¨ï¼Œé€šè¿‡ç»Ÿä¸€æ¥å£å®ç°è‡ªå®šä¹‰é€»è¾‘ä¸ LCEL é“¾çš„æ— ç¼é›†æˆï¼Œæ”¯æŒå¼‚æ­¥ä¼˜åŒ–ã€é”™è¯¯é‡è¯•ç­‰ç”Ÿäº§çº§ç‰¹æ€§ï¼Œåœ¨ RAGã€æ•°æ®å¤„ç†ã€æ¡ä»¶è·¯ç”±ç­‰åœºæ™¯ä¸­å¹¿æ³›åº”ç”¨ã€‚**

---

## æ‹†è§£è®°å¿†

è®©æˆ‘ä»¬æŠŠè¿™å¥è¯æ‹†è§£æˆ 7 ä¸ªå…³é”®ç‚¹ï¼Œæ–¹ä¾¿è®°å¿†ï¼š

### 1. **èº«ä»½å®šä½**
- "LangChain ä¸­çš„é€‚é…å™¨"
- è¿æ¥æ™®é€šå‡½æ•°å’Œ Runnable åè®®çš„æ¡¥æ¢

### 2. **æ ¸å¿ƒåŠŸèƒ½**
- "å°† Python å‡½æ•°è½¬æ¢ä¸º Runnable"
- åŒ…è£…æœºåˆ¶ï¼Œä¸æ”¹å˜åŸå‡½æ•°

### 3. **ä»·å€¼ä¸»å¼ **
- "ç»Ÿä¸€æ¥å£"
- invokeã€batchã€stream ç­‰æ ‡å‡†æ–¹æ³•

### 4. **é›†æˆèƒ½åŠ›**
- "ä¸ LCEL é“¾æ— ç¼é›†æˆ"
- é€šè¿‡ | æ“ä½œç¬¦ç»„åˆ

### 5. **ç”Ÿäº§çº§ç‰¹æ€§**
- "å¼‚æ­¥ä¼˜åŒ–ã€é”™è¯¯é‡è¯•"
- ä¼ä¸šçº§å¯é æ€§ä¿éšœ

### 6. **åº”ç”¨åœºæ™¯**
- "RAGã€æ•°æ®å¤„ç†ã€æ¡ä»¶è·¯ç”±"
- è¦†ç›–ä¸»æµåº”ç”¨é¢†åŸŸ

### 7. **ä½¿ç”¨å¹¿åº¦**
- "å¹¿æ³›åº”ç”¨"
- ç”Ÿäº§ç¯å¢ƒéªŒè¯çš„æˆç†Ÿæ–¹æ¡ˆ

---

## ä¸‰å±‚ç†è§£

### ç¬¬ä¸€å±‚ï¼šæ˜¯ä»€ä¹ˆ
- **é€‚é…å™¨**ï¼šå°†å‡½æ•°è½¬æ¢ä¸º Runnable
- **åŒ…è£…å™¨**ï¼šä¸æ”¹å˜åŸå‡½æ•°ï¼Œåªæ˜¯åŠ ä¸€å±‚å¤–å£³

### ç¬¬äºŒå±‚ï¼šä¸ºä»€ä¹ˆ
- **ç»Ÿä¸€æ¥å£**ï¼šè®©å‡½æ•°è·å¾— Runnable çš„æ ‡å‡†èƒ½åŠ›
- **æ— ç¼é›†æˆ**ï¼šä¸ LCEL é“¾è‡ªç„¶ç»„åˆ

### ç¬¬ä¸‰å±‚ï¼šæ€ä¹ˆç”¨
- **åŸºç¡€ç”¨æ³•**ï¼š`RunnableLambda(func)`
- **é“¾å¼ç»„åˆ**ï¼š`runnable1 | runnable2`
- **å¼‚æ­¥ä¼˜åŒ–**ï¼šæä¾› `afunc` å‚æ•°
- **é”™è¯¯å¤„ç†**ï¼š`.with_retry()`

---

## æ ¸å¿ƒå…¬å¼

```
æ™®é€šå‡½æ•° + RunnableLambda = Runnable ç»„ä»¶
Runnable ç»„ä»¶ + | æ“ä½œç¬¦ = LCEL é“¾
LCEL é“¾ + ç”Ÿäº§çº§ç‰¹æ€§ = ä¼ä¸šçº§åº”ç”¨
```

---

## æœ€å°çŸ¥è¯†é›†

å¦‚æœåªèƒ½è®°ä½ 5 ä¸ªè¦ç‚¹ï¼Œè®°ä½è¿™äº›ï¼š

1. **RunnableLambda æ˜¯é€‚é…å™¨**
   - å°†å‡½æ•°è½¬æ¢ä¸º Runnable

2. **æä¾›ç»Ÿä¸€æ¥å£**
   - invokeã€batchã€stream ç­‰æ–¹æ³•

3. **æ”¯æŒé“¾å¼ç»„åˆ**
   - é€šè¿‡ | æ“ä½œç¬¦è¿æ¥

4. **éœ€è¦å¼‚æ­¥ä¼˜åŒ–**
   - æä¾› afunc å‚æ•°æ‰èƒ½é«˜æ•ˆ

5. **ç”Ÿäº§çº§ç‰¹æ€§**
   - é‡è¯•ã€å›è°ƒã€é…ç½®ç­‰è‡ªåŠ¨è·å¾—

---

## å…¸å‹ä»£ç æ¨¡å¼

```python
from langchain_core.runnables import RunnableLambda

# æ¨¡å¼1: åŸºç¡€åŒ…è£…
def process(text: str) -> str:
    return text.upper()

runnable = RunnableLambda(process)

# æ¨¡å¼2: é“¾å¼ç»„åˆ
chain = (
    RunnableLambda(clean_text)
    | RunnableLambda(tokenize)
    | RunnableLambda(analyze)
)

# æ¨¡å¼3: å¼‚æ­¥ä¼˜åŒ–
async def async_process(text: str) -> str:
    await asyncio.sleep(0.1)
    return text.upper()

runnable = RunnableLambda(process, afunc=async_process)

# æ¨¡å¼4: é”™è¯¯é‡è¯•
safe_runnable = runnable.with_retry(stop_after_attempt=3)
```

---

## å…³é”®å¯¹æ¯”

| ç»´åº¦ | æ™®é€šå‡½æ•° | RunnableLambda |
|------|----------|----------------|
| **æœ¬è´¨** | å¯è°ƒç”¨å¯¹è±¡ | Runnable ç»„ä»¶ |
| **æ¥å£** | ç›´æ¥è°ƒç”¨ | invoke/batch/stream |
| **ç»„åˆ** | æ‰‹åŠ¨åµŒå¥— | \| æ“ä½œç¬¦ |
| **ç‰¹æ€§** | åŸºç¡€åŠŸèƒ½ | é‡è¯•/å›è°ƒ/é…ç½® |
| **åœºæ™¯** | ç‹¬ç«‹ä½¿ç”¨ | LCEL é“¾é›†æˆ |

---

## ä¸‰ä¸ªæ ¸å¿ƒè¯¯åŒº

1. **âŒ è¯¯åŒº**: è®¤ä¸ºä¼šè‡ªåŠ¨ä¼˜åŒ–å¼‚æ­¥æ‰§è¡Œ
   - **âœ… çœŸç›¸**: éœ€è¦æ˜¾å¼æä¾› afunc

2. **âŒ è¯¯åŒº**: è®¤ä¸º stream ä¼šçœŸæ­£æµå¼è¾“å‡º
   - **âœ… çœŸç›¸**: é»˜è®¤å§”æ‰˜ invokeï¼Œä¸€æ¬¡æ€§è¿”å›

3. **âŒ è¯¯åŒº**: è®¤ä¸ºå¤æ‚é“¾ä¸­ä½¿ç”¨æå‡å¯è¯»æ€§
   - **âœ… çœŸç›¸**: è¿‡åº¦ä½¿ç”¨åè€Œé™ä½å¯è¯»æ€§

---

## ç”Ÿäº§çº§åº”ç”¨æ¡ˆä¾‹

### MUFG é“¶è¡Œæ¡ˆä¾‹
- **åœºæ™¯**: å¤–æ±‡é”€å”®ç ”ç©¶
- **æŠ€æœ¯**: RunnableLambda åŠ¨æ€è°ƒæ•´ RAG é“¾
- **æ•ˆæœ**: æ•ˆç‡æå‡ 10 å€

### å…³é”®æŠ€æœ¯ç‚¹
- çµæ´»çš„ä¸šåŠ¡é€»è¾‘æ³¨å…¥
- å¼‚æ­¥æ‰¹å¤„ç†ä¼˜åŒ–
- é”™è¯¯é‡è¯•æœºåˆ¶

---

## å­¦ä¹ è·¯å¾„å›é¡¾

å¦‚æœä½ å·²ç»å­¦å®Œæ•´ä¸ªçŸ¥è¯†ç‚¹ï¼Œåº”è¯¥æŒæ¡ï¼š

### åŸºç¡€å±‚
- âœ… RunnableLambda çš„å®šä¹‰å’Œä½œç”¨
- âœ… åŸºç¡€åŒ…è£…å’Œè°ƒç”¨æ–¹å¼
- âœ… ä¸ LCEL é“¾çš„ç»„åˆ

### è¿›é˜¶å±‚
- âœ… å¼‚æ­¥æœºåˆ¶ï¼ˆå§”æ‰˜ vs afuncï¼‰
- âœ… é”™è¯¯å¤„ç†å’Œé‡è¯•ç­–ç•¥
- âœ… æ€§èƒ½ä¼˜åŒ–æŠ€å·§

### åº”ç”¨å±‚
- âœ… æ•°æ®å¤„ç†ä¸è½¬æ¢
- âœ… RAG åº”ç”¨é›†æˆ
- âœ… æ¡ä»¶è·¯ç”±ä¸åˆ†æ”¯
- âœ… å¼‚æ­¥ä¸æ€§èƒ½ä¼˜åŒ–

### ç”Ÿäº§å±‚
- âœ… å¸¸è§è¯¯åŒºå’Œé™·é˜±
- âœ… æœ€ä½³å®è·µå’Œè®¾è®¡æ¨¡å¼
- âœ… çœŸå®æ¡ˆä¾‹åˆ†æ

---

## ä½•æ—¶å›é¡¾è¿™ä¸ªæ€»ç»“

åœ¨ä»¥ä¸‹æƒ…å†µä¸‹ï¼Œå›æ¥è¯»è¿™ä¸ªæ€»ç»“ï¼š

1. **é¢è¯•å‰å¤ä¹ **
   - å¿«é€Ÿå›é¡¾æ ¸å¿ƒè¦ç‚¹
   - å‡†å¤‡é«˜é¢‘é¢è¯•é—®é¢˜

2. **é¡¹ç›®å¼€å§‹å‰**
   - ç¡®è®¤æŠ€æœ¯é€‰å‹
   - å›é¡¾æœ€ä½³å®è·µ

3. **é‡åˆ°é—®é¢˜æ—¶**
   - æ£€æŸ¥æ˜¯å¦è¸©å‘
   - å›é¡¾æ­£ç¡®ç”¨æ³•

4. **å®šæœŸå¤ä¹ **
   - å·©å›ºè®°å¿†
   - æ›´æ–°ç†è§£

---

## å»¶ä¼¸å­¦ä¹ 

### ç›¸å…³çŸ¥è¯†ç‚¹
- **RunnablePassthrough**: æ•°æ®é€ä¼ å’Œå­—æ®µæå–
- **RunnableParallel**: å¹¶è¡Œæ‰§è¡Œå¤šä¸ª Runnable
- **RunnableBranch**: æ¡ä»¶è·¯ç”±å’Œåˆ†æ”¯é€»è¾‘
- **è‡ªå®šä¹‰ Runnable ç±»**: å¤æ‚é€»è¾‘çš„æ›´å¥½é€‰æ‹©

### æ·±å…¥æ–¹å‘
- **æºç é˜…è¯»**: `langchain_core/runnables/base.py`
- **æ€§èƒ½ä¼˜åŒ–**: å¼‚æ­¥æ‰§è¡Œå’Œæ‰¹å¤„ç†
- **è®¾è®¡æ¨¡å¼**: é€‚é…å™¨æ¨¡å¼å’Œç»„åˆæ¨¡å¼
- **ç”Ÿäº§å®è·µ**: é”™è¯¯å¤„ç†å’Œå¯è§‚æµ‹æ€§

---

## æœ€åçš„æœ€å

å¦‚æœåªèƒ½è®°ä½ä¸€å¥è¯ï¼Œè®°ä½è¿™å¥ï¼š

> **RunnableLambda è®©ä½ çš„ Python å‡½æ•°è·å¾— LangChain å…¬æ°‘èº«ä»½ï¼Œä»æ­¤å¯ä»¥è‡ªç”±åœ°åœ¨ LCEL é“¾ä¸­å·¥ä½œã€‚**

---

## å¼•ç”¨æ¥æº

- [LangChain å®˜æ–¹æ–‡æ¡£ - RunnableLambda](https://python.langchain.com/docs/expression_language/primitives/lambda) - å®˜æ–¹å®šä¹‰
- [LangChain API Reference v0.3](https://reference.langchain.com/v0.3/python/core/runnables/) - å®Œæ•´ API
- [MUFG Bank Case Study](https://blog.langchain.dev/customers-mufgbank) - ç”Ÿäº§æ¡ˆä¾‹
- [Building Production-Ready AI Pipelines (2026)](https://medium.com/@techsachin/building-production-ready-ai-pipelines-with-langchain-a-comprehensive-guide-2026-edition) - æœ€ä½³å®è·µ

---

**ç‰ˆæœ¬**: v1.0
**æœ€åæ›´æ–°**: 2026-02-20
**é€‚ç”¨äº**: LangChain v0.3+
**Python ç‰ˆæœ¬**: 3.13+

---

**æ­å–œä½ å®Œæˆäº† RunnableLambda çš„å­¦ä¹ ï¼** ğŸ‰

ç°åœ¨ä½ å·²ç»æŒæ¡äº†ï¼š
- âœ… æ ¸å¿ƒæ¦‚å¿µå’ŒåŸç†
- âœ… å®æˆ˜åº”ç”¨å’Œåœºæ™¯
- âœ… å¸¸è§è¯¯åŒºå’Œé™·é˜±
- âœ… ç”Ÿäº§çº§æœ€ä½³å®è·µ

**ä¸‹ä¸€æ­¥å»ºè®®**:
1. åŠ¨æ‰‹å®è·µï¼šå®Œæˆ `07_å®æˆ˜ä»£ç _*.md` ä¸­çš„æ‰€æœ‰ç¤ºä¾‹
2. é˜…è¯»æºç ï¼šæ·±å…¥ç†è§£ `langchain_core/runnables/base.py`
3. å®é™…åº”ç”¨ï¼šåœ¨è‡ªå·±çš„é¡¹ç›®ä¸­ä½¿ç”¨ RunnableLambda
4. æŒç»­å­¦ä¹ ï¼šå…³æ³¨ LangChain çš„æœ€æ–°å‘å±•
