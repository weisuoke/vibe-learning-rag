# æœ€å°å¯ç”¨

> æŒæ¡ 20% çš„æ ¸å¿ƒçŸ¥è¯†ï¼Œè§£å†³ 80% çš„è¯·æ±‚ä½“éªŒè¯é—®é¢˜

---

## æ ¸å¿ƒç†å¿µ

ä½ ä¸éœ€è¦æŒæ¡ Pydantic çš„æ‰€æœ‰ç‰¹æ€§ï¼Œåªéœ€è¦æŒæ¡ä»¥ä¸‹å†…å®¹ï¼Œå°±èƒ½å¼€å§‹ä½¿ç”¨ FastAPI çš„è¯·æ±‚ä½“éªŒè¯ï¼š

---

## 6.1 å®šä¹‰ Pydantic æ¨¡å‹

**æ ¸å¿ƒï¼š** ç”¨ç±»å®šä¹‰æ•°æ®ç»“æ„ï¼ŒFastAPI è‡ªåŠ¨éªŒè¯

```python
from pydantic import BaseModel

class User(BaseModel):
    username: str
    email: str
    age: int
    is_active: bool = True  # å¯é€‰å­—æ®µï¼Œé»˜è®¤å€¼ True
```

**åœ¨ FastAPI ä¸­ä½¿ç”¨ï¼š**

```python
from fastapi import FastAPI

app = FastAPI()

@app.post("/users")
async def create_user(user: User):
    # user å·²ç»è¢«éªŒè¯å’Œè§£æ
    return {"username": user.username, "email": user.email}
```

**è¿™å°±å¤Ÿäº†ï¼** FastAPI ä¼šè‡ªåŠ¨ï¼š
- âœ… éªŒè¯è¯·æ±‚ä½“æ˜¯ JSON
- âœ… éªŒè¯æ‰€æœ‰å¿…éœ€å­—æ®µå­˜åœ¨
- âœ… éªŒè¯å­—æ®µç±»å‹æ­£ç¡®
- âœ… åº”ç”¨é»˜è®¤å€¼
- âœ… è¿”å› 422 é”™è¯¯ï¼ˆå¦‚æœéªŒè¯å¤±è´¥ï¼‰

---

## 6.2 ä½¿ç”¨ Field æ·»åŠ çº¦æŸ

**æ ¸å¿ƒï¼š** ç”¨ `Field()` æ·»åŠ éªŒè¯è§„åˆ™

```python
from pydantic import BaseModel, Field

class User(BaseModel):
    username: str = Field(..., min_length=3, max_length=20)
    email: str = Field(..., pattern=r'^[\w\.-]+@[\w\.-]+\.\w+$')
    age: int = Field(..., ge=0, le=150)  # ge=greater or equal, le=less or equal
    bio: str = Field(default="", max_length=500)
```

**å¸¸ç”¨çº¦æŸï¼š**

| çº¦æŸ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| `min_length` | æœ€å°é•¿åº¦ | `Field(min_length=3)` |
| `max_length` | æœ€å¤§é•¿åº¦ | `Field(max_length=20)` |
| `ge` | å¤§äºç­‰äº | `Field(ge=0)` |
| `le` | å°äºç­‰äº | `Field(le=100)` |
| `gt` | å¤§äº | `Field(gt=0)` |
| `lt` | å°äº | `Field(lt=100)` |
| `pattern` | æ­£åˆ™è¡¨è¾¾å¼ | `Field(pattern=r'^\d{3}-\d{4}$')` |
| `default` | é»˜è®¤å€¼ | `Field(default="")` |

**`...` çš„å«ä¹‰ï¼š** è¡¨ç¤ºå¿…éœ€å­—æ®µï¼ˆæ²¡æœ‰é»˜è®¤å€¼ï¼‰

---

## 6.3 åµŒå¥—æ¨¡å‹

**æ ¸å¿ƒï¼š** æ¨¡å‹å¯ä»¥åŒ…å«å…¶ä»–æ¨¡å‹

```python
from pydantic import BaseModel
from typing import List

class Address(BaseModel):
    street: str
    city: str
    country: str

class User(BaseModel):
    username: str
    email: str
    address: Address  # åµŒå¥—æ¨¡å‹
    tags: List[str]   # å­—ç¬¦ä¸²åˆ—è¡¨
```

**è¯·æ±‚ç¤ºä¾‹ï¼š**

```json
{
  "username": "alice",
  "email": "alice@example.com",
  "address": {
    "street": "123 Main St",
    "city": "New York",
    "country": "USA"
  },
  "tags": ["developer", "python"]
}
```

**FastAPI ä¼šè‡ªåŠ¨éªŒè¯ï¼š**
- âœ… `address` æ˜¯å¯¹è±¡
- âœ… `address` åŒ…å«æ‰€æœ‰å¿…éœ€å­—æ®µ
- âœ… `tags` æ˜¯æ•°ç»„
- âœ… `tags` çš„æ¯ä¸ªå…ƒç´ éƒ½æ˜¯å­—ç¬¦ä¸²

---

## 6.4 å¯é€‰å­—æ®µ

**æ ¸å¿ƒï¼š** ä½¿ç”¨ `Optional` æˆ–é»˜è®¤å€¼å®šä¹‰å¯é€‰å­—æ®µ

```python
from pydantic import BaseModel, Field
from typing import Optional

class User(BaseModel):
    username: str
    email: str
    age: Optional[int] = None  # å¯é€‰ï¼Œé»˜è®¤ None
    bio: str = ""              # å¯é€‰ï¼Œé»˜è®¤ç©ºå­—ç¬¦ä¸²
    is_active: bool = True     # å¯é€‰ï¼Œé»˜è®¤ True
```

**ä¸‰ç§å¯é€‰æ–¹å¼ï¼š**

1. **`Optional[T] = None`** - å¯ä»¥æ˜¯ `T` æˆ– `None`
2. **`T = default_value`** - å¯ä»¥çœç•¥ï¼Œä½¿ç”¨é»˜è®¤å€¼
3. **`Optional[T] = Field(default=None)`** - å¸¦çº¦æŸçš„å¯é€‰å­—æ®µ

```python
class User(BaseModel):
    # æ–¹å¼1ï¼šå¯ä»¥æ˜¯ int æˆ– None
    age: Optional[int] = None

    # æ–¹å¼2ï¼šå¯ä»¥çœç•¥ï¼Œé»˜è®¤ç©ºå­—ç¬¦ä¸²
    bio: str = ""

    # æ–¹å¼3ï¼šå¯é€‰ä½†æœ‰çº¦æŸ
    phone: Optional[str] = Field(default=None, pattern=r'^\d{3}-\d{4}$')
```

---

## 6.5 å“åº”æ¨¡å‹

**æ ¸å¿ƒï¼š** ç”¨ `response_model` éªŒè¯å’Œåºåˆ—åŒ–å“åº”

```python
from fastapi import FastAPI
from pydantic import BaseModel

app = FastAPI()

class UserIn(BaseModel):
    username: str
    password: str
    email: str

class UserOut(BaseModel):
    username: str
    email: str
    # æ³¨æ„ï¼šæ²¡æœ‰ password

@app.post("/users", response_model=UserOut)
async def create_user(user: UserIn):
    # å³ä½¿è¿”å›åŒ…å« passwordï¼ŒFastAPI ä¹Ÿä¼šè‡ªåŠ¨è¿‡æ»¤
    return user  # FastAPI åªè¿”å› username å’Œ email
```

**ä»·å€¼ï¼š**
- âœ… è‡ªåŠ¨è¿‡æ»¤æ•æ„Ÿå­—æ®µï¼ˆå¦‚å¯†ç ï¼‰
- âœ… éªŒè¯å“åº”æ•°æ®æ ¼å¼
- âœ… è‡ªåŠ¨ç”Ÿæˆå“åº”æ–‡æ¡£

---

## è¿™äº›çŸ¥è¯†è¶³ä»¥

æŒæ¡ä»¥ä¸Š 5 ä¸ªæ ¸å¿ƒçŸ¥è¯†ç‚¹ï¼Œä½ å°±èƒ½ï¼š

### âœ… èƒ½åšä»€ä¹ˆ

1. **å®šä¹‰ API è¯·æ±‚ä½“æ¨¡å‹**
   - åŸºç¡€å­—æ®µéªŒè¯ï¼ˆç±»å‹ã€å¿…éœ€/å¯é€‰ï¼‰
   - å­—æ®µçº¦æŸï¼ˆé•¿åº¦ã€èŒƒå›´ã€æ­£åˆ™ï¼‰
   - åµŒå¥—å¯¹è±¡å’Œåˆ—è¡¨

2. **è‡ªåŠ¨éªŒè¯è¯·æ±‚æ•°æ®**
   - FastAPI è‡ªåŠ¨éªŒè¯ç±»å‹
   - è‡ªåŠ¨éªŒè¯çº¦æŸè§„åˆ™
   - è‡ªåŠ¨è¿”å›å‹å¥½çš„é”™è¯¯æ¶ˆæ¯

3. **ä¿æŠ¤å“åº”æ•°æ®**
   - è¿‡æ»¤æ•æ„Ÿå­—æ®µ
   - éªŒè¯å“åº”æ ¼å¼
   - è‡ªåŠ¨ç”Ÿæˆæ–‡æ¡£

### ğŸ“š ä¸ºåç»­å­¦ä¹ æ‰“åŸºç¡€

- **è‡ªå®šä¹‰éªŒè¯å™¨** - å¤æ‚ä¸šåŠ¡è§„åˆ™éªŒè¯
- **é”™è¯¯å¤„ç†** - è‡ªå®šä¹‰éªŒè¯é”™è¯¯æ ¼å¼
- **é«˜çº§ç±»å‹** - Unionã€Literalã€Enum
- **æ€§èƒ½ä¼˜åŒ–** - éªŒè¯ç¼“å­˜ã€æ‡’åŠ è½½

---

## å¿«é€Ÿå‚è€ƒ

### æœ€å°ç¤ºä¾‹

```python
from fastapi import FastAPI
from pydantic import BaseModel, Field

app = FastAPI()

class Question(BaseModel):
    text: str = Field(..., min_length=1, max_length=500)
    user_id: int = Field(..., gt=0)

@app.post("/ask")
async def ask_question(question: Question):
    return {"answer": f"æ”¶åˆ°é—®é¢˜: {question.text}"}
```

### å¸¸ç”¨æ¨¡å¼

```python
from pydantic import BaseModel, Field, EmailStr
from typing import Optional, List

class User(BaseModel):
    # å¿…éœ€å­—æ®µ
    username: str = Field(..., min_length=3, max_length=20)
    email: EmailStr  # è‡ªåŠ¨éªŒè¯é‚®ç®±æ ¼å¼

    # å¯é€‰å­—æ®µ
    age: Optional[int] = Field(default=None, ge=0, le=150)
    bio: str = ""

    # åµŒå¥—å’Œåˆ—è¡¨
    tags: List[str] = []
    address: Optional[Address] = None
```

---

## åœ¨ AI Agent å¼€å‘ä¸­çš„åº”ç”¨

### RAG æŸ¥è¯¢å‚æ•°éªŒè¯

```python
from pydantic import BaseModel, Field

class RAGQuery(BaseModel):
    question: str = Field(..., min_length=1, max_length=500)
    top_k: int = Field(default=5, ge=1, le=20)
    threshold: float = Field(default=0.7, ge=0.0, le=1.0)

@app.post("/rag/query")
async def rag_query(query: RAGQuery):
    # ä¿è¯å‚æ•°åœ¨åˆç†èŒƒå›´
    results = await search_documents(
        query.question,
        top_k=query.top_k,
        threshold=query.threshold
    )
    return results
```

### Agent é…ç½®éªŒè¯

```python
from pydantic import BaseModel, Field
from typing import Optional

class AgentConfig(BaseModel):
    model: str = Field(default="gpt-4", pattern=r'^gpt-[34]')
    temperature: float = Field(default=0.7, ge=0.0, le=2.0)
    max_tokens: int = Field(default=1000, ge=1, le=4000)
    stream: bool = False

@app.post("/agent/chat")
async def chat(message: str, config: Optional[AgentConfig] = None):
    config = config or AgentConfig()
    # ä½¿ç”¨éªŒè¯è¿‡çš„é…ç½®
    response = await llm.chat(message, **config.dict())
    return response
```

---

## æ ¸å¿ƒè¦ç‚¹

1. **BaseModel** - å®šä¹‰æ•°æ®ç»“æ„
2. **Field** - æ·»åŠ éªŒè¯çº¦æŸ
3. **åµŒå¥—æ¨¡å‹** - éªŒè¯å¤æ‚æ•°æ®
4. **Optional** - å®šä¹‰å¯é€‰å­—æ®µ
5. **response_model** - éªŒè¯å’Œè¿‡æ»¤å“åº”

**è®°ä½ï¼š** è¿™ 5 ä¸ªçŸ¥è¯†ç‚¹å°±èƒ½è§£å†³ 80% çš„è¯·æ±‚ä½“éªŒè¯éœ€æ±‚ï¼

---

**ç‰ˆæœ¬ï¼š** v1.0
**æœ€åæ›´æ–°ï¼š** 2026-02-11
