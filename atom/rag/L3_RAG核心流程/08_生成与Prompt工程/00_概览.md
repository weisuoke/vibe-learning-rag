# 生成与Prompt工程 - 概览

> RAG系统的最后一环：将检索结果转化为高质量答案

---

## 知识点定位

**在RAG流程中的位置：** 最后一步 - 生成阶段

```
文档加载 → 分块 → 向量化 → 存储 → 查询处理 → 检索 → 上下文管理 → 【生成与Prompt工程】
                                                                              ↓
                                                                         最终答案
```

**核心作用：**
- 将检索到的文档片段组装成LLM可理解的指令
- 控制生成参数以优化输出质量
- 添加引用溯源确保答案可追溯
- 实施质量控制防止幻觉和错误

---

## 2025-2026 范式转变

### 从 Prompt Engineering 到 Context Engineering

**传统观念（2023-2024）：**
- Prompt = 精心设计的文字指令
- 关注如何"措辞"和"格式化"提示词
- 主要靠人工调试和经验积累

**现代范式（2025-2026）：**
- Context = 系统化的上下文基础设施
- 关注如何"选择"、"结构化"和"传递"上下文
- 包括：System Prompts + RAG + Tools + Memory
- 强调工程化和可复现性

**来源：** Redis blog "Context engineering: Best practices for an emerging discipline" (Sept 2025)
https://redis.io/blog/context-engineering-best-practices-for-an-emerging-discipline

---

## 本知识点涵盖内容

### 核心概念（7个）

1. **Prompt模板设计** - System vs User分离、上下文注入模式
2. **生成参数调优** - Temperature、Top-P、Top-K、Max Tokens
3. **引用与溯源** - Citation-aware RAG、空间元数据
4. **答案质量控制** - Groundedness评估、幻觉检测
5. **Context Engineering** - 上下文作为基础设施
6. **Multi-Stage Agentic RAG** - Draft → Critique → Synthesis
7. **Context Pruning** - 避免上下文过载和污染

### 实战代码（8个）

1. 基础Prompt模板
2. System/User分离
3. 生成参数调优
4. Citation实现
5. Groundedness评估
6. Multi-Stage RAG
7. Context Pruning
8. 完整RAG生成流程

---

## 2025-2026 最新研究

### 1. Citation-Aware RAG（2025年9月）

**来源：** Tensorlake blog "Citation-Aware RAG: How to add Fine Grained Citations"
https://www.tensorlake.ai/blog/rag-citations

**核心技术：**
- 内联引用锚点：`<c>2.1</c>`
- 空间元数据：bounding box坐标
- 可追溯性：从LLM输出回溯到源文档精确位置

### 2. Groundedness Evaluation（2026年2月）

**来源：** Openlayer blog "Measuring RAG groundedness: complete evaluation guide"
https://www.openlayer.com/blog/post/measuring-rag-groundedness-complete-evaluation-guide

**RAG Triad：**
- Context Relevance（上下文相关性）
- Groundedness（答案基于上下文）
- Answer Relevance（答案相关性）

**生产阈值：**
- 关键领域：>0.85
- 客服支持：>0.75

### 3. Prompt Engineering for RAG（2025年11月）

**来源：** Stack AI "Complete Guide to Prompt Engineering for RAG"
https://www.stack-ai.com/blog/prompt-engineering-for-rag-pipelines-the-complete-guide-to-prompt-engineering-for-retrieval-augmented-generation

**关键发现：**
- System vs User Prompts明确分离
- Multi-stage workflows减少幻觉
- Context pruning避免噪音和漂移

---

## 学习路径

### 初学者路径（20%核心）

1. 理解Prompt模板基本结构
2. 掌握System/User分离原则
3. 学会调整Temperature参数
4. 实现基础引用功能
5. 了解Groundedness概念

### 进阶路径（完整掌握）

1. 深入Context Engineering理念
2. 实现Multi-Stage验证流程
3. 掌握Context Pruning技术
4. 构建完整质量控制体系
5. 优化生产环境性能

---

## 与RAG开发的关系

| 维度 | 重要性 | 影响 |
|------|--------|------|
| 答案质量 | ⭐⭐⭐⭐⭐ | 直接决定用户体验 |
| 可追溯性 | ⭐⭐⭐⭐⭐ | 生产环境必需 |
| 幻觉控制 | ⭐⭐⭐⭐⭐ | 关键业务场景 |
| 成本优化 | ⭐⭐⭐⭐ | Token使用效率 |
| 响应速度 | ⭐⭐⭐ | 用户等待时间 |

---

## 常见误区预警

1. ❌ "Prompt就是拼接检索结果"
2. ❌ "Temperature越低越好"
3. ❌ "LLM会自动忽略无关上下文"
4. ❌ "引用只需要标注文档ID"
5. ❌ "一次生成就能得到完美答案"

---

## 前置知识

- ✅ L2_LLM核心/04_Prompt_Engineering基础
- ✅ L2_LLM核心/05_Prompt_Engineering进阶
- ✅ L3_RAG核心流程/01-07（前面所有环节）

## 后续学习

- → L4_RAG进阶优化/06_幻觉检测与缓解
- → L4_RAG进阶优化/07_评估与调优

---

**版本：** v1.0 (2025-2026最新研究)
**最后更新：** 2026-02-16
**维护者：** Claude Code
