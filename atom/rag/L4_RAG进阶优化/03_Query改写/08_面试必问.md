# 面试必问

Query改写相关的高频面试问题，以及如何答出彩。

---

## 问题1："什么是 HyDE？它为什么有效？"

### 普通回答（❌ 不出彩）

"HyDE 就是让 LLM 先生成一个假设的答案，然后用这个答案去检索。因为答案和文档更相似，所以检索效果更好。"

### 出彩回答（✅ 推荐）

> **HyDE（Hypothetical Document Embeddings）是一种 Query改写技术，核心思想是"用答案找答案"。**
>
> **为什么传统检索有问题？**
>
> 传统检索是用"问题"去找"答案"。但问题和答案在向量空间中的表示可能差异很大：
> - 问题："Python 怎么实现异步？"
> - 答案："使用 asyncio 库，通过 async/await 语法..."
>
> 问题是疑问句，答案是陈述句，它们的语义表示天然不同。
>
> **HyDE 的解决方案：**
>
> 1. 先让 LLM 生成一个"假设答案"
> 2. 用假设答案的 Embedding 去检索
> 3. 假设答案和真实文档都是"答案形式"，向量距离更近
>
> **类比理解：** 就像"以图搜图"——用一张参考图片找相似图片，比用文字描述找图片更准确。
>
> **实际应用中的注意点：**
> - 假设答案要简洁（100字左右），太长会引入噪音
> - 对事实性问题要谨慎，假设答案可能有错误
> - 适合开放性、概念性问题，不适合精确查询

### 为什么这个回答出彩？

1. ✅ 解释了"为什么"而不只是"是什么"
2. ✅ 用具体例子说明问题和答案的差异
3. ✅ 提供了直观的类比（以图搜图）
4. ✅ 展示了实际应用的经验（注意点）
5. ✅ 体现了对技术边界的理解（适用场景）

---

## 问题2："RAG 系统中，Query改写应该放在哪个环节？有哪些策略？"

### 普通回答（❌ 不出彩）

"Query改写放在检索之前，有 HyDE、Multi-Query 这些策略。"

### 出彩回答（✅ 推荐）

> **Query改写在 RAG 流程中的位置：**
>
> ```
> 用户查询 → [Query改写] → 检索 → ReRank → 生成
> ```
>
> 它是检索前的"预处理"环节，目的是弥补用户表达与文档表达之间的语义鸿沟。
>
> **主要策略及适用场景：**
>
> | 策略 | 核心思想 | 适用场景 |
> |------|---------|---------|
> | **HyDE** | 生成假设答案，用答案检索 | 开放性问题 |
> | **Multi-Query** | 生成多个查询变体 | 模糊/多义查询 |
> | **Query Decomposition** | 拆解为子问题 | 复杂复合问题 |
> | **Step-back Prompting** | 先问背景问题 | 需要上下文的问题 |
>
> **实际工程中的选择：**
>
> 1. **不是所有查询都需要改写**：精确查询（错误码、版本号）直接检索更好
> 2. **可以组合使用**：比如先 Decomposition 拆解，再对每个子问题用 HyDE
> 3. **需要权衡延迟**：每种策略都会增加 LLM 调用，要考虑响应时间
>
> **我在实际项目中的做法：**
>
> 实现一个"智能路由"，根据查询特征自动选择策略：
> - 检测到版本号/错误码 → 不改写
> - 检测到"比较"/"对比" → Decomposition
> - 检测到"如何"/"怎么" → HyDE
> - 其他 → Multi-Query

### 为什么这个回答出彩？

1. ✅ 清晰展示了在整体流程中的位置
2. ✅ 系统性地介绍了多种策略
3. ✅ 展示了工程思维（不是所有查询都需要改写）
4. ✅ 提到了实际项目经验（智能路由）
5. ✅ 考虑了工程权衡（延迟问题）

---

## 问题3："Query改写和 ReRank 有什么区别？它们的关系是什么？"

### 普通回答（❌ 不出彩）

"Query改写是改查询，ReRank 是重排序结果，它们是不同的优化手段。"

### 出彩回答（✅ 推荐）

> **Query改写和 ReRank 是 RAG 优化的两个不同环节：**
>
> | 维度 | Query改写 | ReRank |
> |------|----------|--------|
> | **位置** | 检索前 | 检索后 |
> | **作用对象** | 查询 | 检索结果 |
> | **目标** | 提高召回率 | 提高准确率 |
> | **方法** | LLM 改写查询 | Cross-Encoder 重排序 |
>
> **它们的关系是互补的：**
>
> ```
> 用户查询 → Query改写 → 检索（召回更多） → ReRank（精选最相关）→ 生成
>            ↑                              ↑
>         扩大搜索范围                    精细筛选
> ```
>
> **类比理解：**
> - Query改写 = 撒大网捕鱼（尽可能多地找到相关文档）
> - ReRank = 挑选最好的鱼（从候选中选出最相关的）
>
> **为什么需要两者配合？**
>
> 1. 只有 Query改写：召回了很多文档，但可能包含不相关的
> 2. 只有 ReRank：如果召回阶段就漏掉了，ReRank 也救不回来
> 3. 两者配合：先扩大召回范围，再精细筛选，效果最好
>
> **实际应用建议：**
> - 如果召回率低（找不到相关文档）→ 优先优化 Query改写
> - 如果准确率低（找到但排序不好）→ 优先优化 ReRank
> - 理想情况：两者都做，形成完整的优化链路

### 为什么这个回答出彩？

1. ✅ 用表格清晰对比两者的区别
2. ✅ 用流程图展示它们的关系
3. ✅ 提供了直观的类比（撒网捕鱼）
4. ✅ 解释了为什么需要配合使用
5. ✅ 给出了实际应用的决策建议

---

## 面试技巧总结

| 技巧 | 说明 |
|------|------|
| **先说结论** | 开门见山，不要绕圈子 |
| **用表格对比** | 清晰展示多个概念的区别 |
| **举具体例子** | 抽象概念用具体例子说明 |
| **提供类比** | 用熟悉的事物类比陌生概念 |
| **展示工程思维** | 不只是理论，还要考虑实际应用 |
| **说明边界** | 什么时候用、什么时候不用 |

---

**下一步：** [09_化骨绵掌](./09_化骨绵掌.md) - 10 个 2 分钟知识卡片，碎片化学习
