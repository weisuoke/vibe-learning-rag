# Agent执行器 - 化骨绵掌

> 10个2分钟知识卡片，深度理解 Agent执行器

---

## 卡片1：Agent执行器的本质

**一句话**：Agent执行器是将 LLM 的推理能力、工具的执行能力和循环的迭代能力结合起来的系统。

**核心公式**：
```
Agent执行器 = LLM（决策大脑）+ 工具集（能力）+ 循环机制（执行引擎）
```

**应用**：在 AI Agent 后端开发中，Agent执行器让我们能够构建智能客服、数据分析助手、自动化运维等复杂应用。

---

## 卡片2：ReAct 循环的核心

**一句话**：ReAct 是 Thought（推理）→ Action（行动）→ Observation（观察）的循环。

**流程**：
```
1. Thought: LLM 思考"下一步该做什么"
2. Action: 选择并调用合适的工具
3. Observation: 观察工具执行结果
4. 循环: 根据结果继续思考，直到完成
```

**应用**：ReAct 让 Agent 能够自主决策并执行多步骤任务，不需要硬编码所有逻辑。

---

## 卡片3：工具的本质

**一句话**：工具 = 函数 + 文本描述。

**关键要素**：
- **name**：工具的唯一标识
- **description**：告诉 LLM 这个工具是干什么的（最重要！）
- **func**：实际执行的函数

**应用**：LLM 根据工具描述选择工具，描述越清晰，选择越准确。

---

## 卡片4：三种停止条件

**一句话**：Agent 通过三种方式停止执行。

**停止条件**：
1. **LLM 返回 Final Answer**：任务完成
2. **达到最大迭代次数**：防止无限循环
3. **遇到错误**：工具调用失败

**应用**：合理设置 max_iterations（5-20次），使用 generate 早停策略。

---

## 卡片5：Agent vs Chain

**一句话**：Agent 动态决策，Chain 固定流程。

**对比**：
| 维度 | Agent | Chain |
|------|-------|-------|
| 决策方式 | LLM 动态决定 | 开发者预先定义 |
| 灵活性 | 高 | 低 |
| 成本 | 高（多次 LLM 调用） | 低（单次或少量调用） |
| 适用场景 | 流程不确定 | 流程固定 |

**应用**：简单任务用 Chain，复杂任务用 Agent。

---

## 卡片6：工具数量的影响

**一句话**：工具越多，Agent 选择越困难。

**实验数据**：
- 5个工具：准确率 95%
- 10个工具：准确率 85%
- 20个工具：准确率 70%

**应用**：控制工具数量在 5-10 个，合并相似工具，优化工具描述。

---

## 卡片7：工具描述的重要性

**一句话**：工具描述是 LLM 选择工具的唯一依据。

**好的描述包含**：
- 功能说明
- 输入输出
- 适用场景
- 示例

**应用**：花时间写好工具描述，比优化 Prompt 更有效。

---

## 卡片8：异步执行的优势

**一句话**：异步工具不会阻塞，可以并发执行。

**对比**：
```python
# 同步：阻塞
def query_db(query): ...

# 异步：不阻塞
async def query_db(query): ...
```

**应用**：在 FastAPI 中使用异步工具，提高并发性能。

---

## 卡片9：错误处理策略

**一句话**：返回错误信息，不要抛出异常。

**原因**：
- 让 Agent 知道发生了什么
- Agent 可以根据错误信息调整策略
- 避免整个任务失败

**应用**：
```python
@tool
def query_order(order_id: str) -> str:
    try:
        return db.query(order_id)
    except Exception as e:
        return f"查询失败：{str(e)}"  # 返回错误信息
```

---

## 卡片10：生产环境的关键

**一句话**：超时、缓存、降级、监控缺一不可。

**关键要素**：
1. **超时控制**：防止 Agent 执行过长
2. **缓存优化**：缓存常见问题的答案
3. **降级策略**：失败时使用简单的 LLM 调用
4. **性能监控**：监控迭代次数、响应时间

**应用**：生产环境必须考虑这四个方面，确保系统稳定可靠。

---

## 学习检查清单

完成本文档学习后，你应该能够：

- [ ] 理解 Agent执行器 的本质
- [ ] 掌握 ReAct 循环的核心流程
- [ ] 理解工具的本质和重要性
- [ ] 知道三种停止条件
- [ ] 区分 Agent 和 Chain 的适用场景
- [ ] 理解工具数量对性能的影响
- [ ] 编写清晰的工具描述
- [ ] 使用异步工具
- [ ] 实现正确的错误处理
- [ ] 应用生产环境的最佳实践

---

**版本：** v1.0
**最后更新：** 2026-02-12
**维护者：** Claude Code
