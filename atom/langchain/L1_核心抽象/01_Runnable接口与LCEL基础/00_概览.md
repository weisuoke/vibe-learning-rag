# Runnable接口与LCEL基础 - 学习概览

> LangChain 核心抽象的基石：理解 Runnable 协议和 LCEL 声明式编程

---

## 文档导航

本知识点包含 **18 个文档**，按照 10 个维度组织，帮助你全面掌握 Runnable 和 LCEL。

### 快速入门 (5 个文档)

| 文档 | 内容 | 阅读时间 |
|------|------|----------|
| [01_30字核心](./01_30字核心.md) | 一句话理解 Runnable 和 LCEL | 2 分钟 |
| [04_最小可用](./04_最小可用.md) | 20% 核心知识解决 80% 问题 | 10 分钟 |
| [06_反直觉点](./06_反直觉点.md) | 3 个常见误区和正确理解 | 10 分钟 |
| [10_一句话总结](./10_一句话总结.md) | 完整总结和学习检查清单 | 5 分钟 |
| [00_概览](./00_概览.md) | 本文档：学习路径和导航 | 5 分钟 |

### 核心概念 (5 个文档)

| 文档 | 内容 | 阅读时间 |
|------|------|----------|
| [03_核心概念_01_Runnable协议](./03_核心概念_01_Runnable协议.md) | 协议定义、类型系统、2025 安全更新 | 15 分钟 |
| [03_核心概念_02_invoke方法](./03_核心概念_02_invoke方法.md) | 同步单次执行、Config 参数、错误处理 | 15 分钟 |
| [03_核心概念_03_batch方法](./03_核心概念_03_batch方法.md) | 批量并发、成本优化、langasync 集成 | 20 分钟 |
| [03_核心概念_04_stream方法](./03_核心概念_04_stream方法.md) | 流式输出、异步迭代、UI 集成模式 | 20 分钟 |
| [03_核心概念_05_LCEL设计哲学](./03_核心概念_05_LCEL设计哲学.md) | 声明式编程、管道操作符、性能优化 | 20 分钟 |

### 深度理解 (4 个文档)

| 文档 | 内容 | 阅读时间 |
|------|------|----------|
| [02_第一性原理](./02_第一性原理.md) | 从组合性推导 Runnable 设计 | 15 分钟 |
| [05_双重类比](./05_双重类比.md) | 前端开发 + 日常生活类比 | 15 分钟 |
| [08_面试必问](./08_面试必问.md) | 2 个高频面试题和出彩回答 | 10 分钟 |
| [09_化骨绵掌](./09_化骨绵掌.md) | 10 个 2 分钟知识卡片 | 20 分钟 |

### 实战代码 (3 个文档)

| 文档 | 内容 | 阅读时间 |
|------|------|----------|
| [07_实战代码_01_基础调用](./07_实战代码_01_基础调用.md) | 自定义 Runnable 和基础调用 | 20 分钟 |
| [07_实战代码_02_批处理场景](./07_实战代码_02_批处理场景.md) | 批量分类和成本追踪 | 25 分钟 |
| [07_实战代码_03_流式输出](./07_实战代码_03_流式输出.md) | 流式聊天和 FastAPI 集成 | 25 分钟 |

---

## 推荐学习路径

### 路径 1: 快速上手（1 小时）

适合想快速了解 Runnable 和 LCEL 的开发者。

```
01_30字核心 (2分钟)
    ↓
04_最小可用 (10分钟)
    ↓
07_实战代码_01_基础调用 (20分钟)
    ↓
06_反直觉点 (10分钟)
    ↓
10_一句话总结 (5分钟)
```

### 路径 2: 系统学习（3-4 小时）

适合想全面掌握 Runnable 和 LCEL 的开发者。

```
第一阶段：建立认知 (30分钟)
├─ 01_30字核心
├─ 02_第一性原理
└─ 05_双重类比

第二阶段：核心概念 (90分钟)
├─ 03_核心概念_01_Runnable协议
├─ 03_核心概念_02_invoke方法
├─ 03_核心概念_03_batch方法
├─ 03_核心概念_04_stream方法
└─ 03_核心概念_05_LCEL设计哲学

第三阶段：实战练习 (70分钟)
├─ 07_实战代码_01_基础调用
├─ 07_实战代码_02_批处理场景
└─ 07_实战代码_03_流式输出

第四阶段：巩固提升 (40分钟)
├─ 04_最小可用
├─ 06_反直觉点
├─ 08_面试必问
├─ 09_化骨绵掌
└─ 10_一句话总结
```

### 路径 3: 面试突击（30 分钟）

适合准备面试的开发者。

```
01_30字核心 (2分钟)
    ↓
04_最小可用 (10分钟)
    ↓
08_面试必问 (10分钟)
    ↓
09_化骨绵掌 (20分钟)
```

---

## 前置知识

在学习本知识点前，建议掌握：

- **Python 基础**: 类型注解、Protocol、泛型
- **异步编程**: async/await、asyncio
- **函数式编程**: 高阶函数、函数组合
- **LLM 基础**: 了解 OpenAI API 或类似接口

---

## 学习目标

完成本知识点学习后，你将能够：

### 理解层面
- [ ] 理解 Runnable 协议的设计哲学和第一性原理
- [ ] 理解 LCEL 声明式编程的优势和执行优化
- [ ] 理解 invoke/batch/stream 三大方法的使用场景
- [ ] 理解 2025-2026 年的安全最佳实践和 API 变更

### 应用层面
- [ ] 能够实现自定义 Runnable 组件
- [ ] 能够使用 LCEL 管道操作符组合复杂工作流
- [ ] 能够选择合适的执行方法（invoke/batch/stream）
- [ ] 能够集成 langasync 进行成本优化
- [ ] 能够使用 LangSmith 进行可观测性监控

### 生产层面
- [ ] 能够设计生产级 AI 应用架构
- [ ] 能够处理错误和异常情况
- [ ] 能够优化性能和成本
- [ ] 能够进行单元测试和集成测试

---

## 环境准备

### 1. Python 环境

```bash
# 确认 Python 版本
python --version  # 需要 3.13+

# 激活虚拟环境
source .venv/bin/activate
```

### 2. 安装依赖

```bash
# 安装 LangChain 核心库
uv add langchain langchain-core langchain-openai

# 安装可观测性工具
uv add langsmith

# 安装成本优化工具（可选）
uv add langasync
```

### 3. 配置 API 密钥

```bash
# 复制环境变量模板
cp .env.example .env

# 编辑 .env 文件
# OPENAI_API_KEY=your_key_here
# LANGSMITH_API_KEY=your_key_here
# LANGSMITH_TRACING=true
```

### 4. 验证安装

```python
from langchain_core.runnables import RunnableLambda
from langchain_openai import ChatOpenAI

# 测试 Runnable
runnable = RunnableLambda(lambda x: x.upper())
print(runnable.invoke("hello"))  # 输出: HELLO

# 测试 LLM
llm = ChatOpenAI(model="gpt-4o-mini")
print(llm.invoke("Say hi"))  # 输出: Hi!
```

---

## 版本信息

- **LangChain**: 1.0+ (2025年10月发布)
- **langchain-core**: 1.2.5+ (修复 CVE-2025-68664)
- **Python**: 3.13+
- **文档更新**: 2026年2月

---

## 2025-2026 重要更新

### LangChain 1.0 稳定性承诺

2025年10月，LangChain 1.0 正式发布，承诺到 2.0 版本无重大 breaking changes。Runnable 协议作为核心抽象保持稳定。

### 安全修复

2025年12月修复 CVE-2025-68664 序列化注入漏洞，影响 `load()`/`loads()` 函数。务必升级到 langchain-core 1.2.5+。

### 企业级应用

- **Klarna**: 使用 LangGraph 和 LCEL 构建 AI 助手，服务 8500 万用户
- **Elastic**: 基于 LCEL 构建 AI 安全助手，为 2 万客户提供服务
- **C.H. Robinson**: 采用 LCEL 实现物流自动化转型

---

## 下一步学习

完成本知识点后，推荐继续学习：

1. **L1_核心抽象/02_ChatModel与PromptTemplate**: 学习 LLM 调用和提示词模板
2. **L2_LCEL表达式**: 深入学习 LCEL 的高级用法
3. **L3_组件生态**: 了解 LangChain 的丰富组件生态
4. **L7_LangGraph与状态管理**: 学习有状态的工作流引擎

---

## 参考资源

### 官方文档
- [LangChain Runnable Documentation](https://python.langchain.com/docs/concepts/runnables) - 2025-2026
- [LCEL Expression Language Guide](https://python.langchain.com/docs/concepts/lcel) - 2025-2026

### 企业案例
- [LangChain Customer Stories](https://www.langchain.com/customers) - Klarna, Elastic, C.H. Robinson
- [State of Agent Engineering 2026](https://www.langchain.com/state-of-agent-engineering)

### 安全资源
- [CVE-2025-68664 Details](https://nvd.nist.gov/vuln/detail/CVE-2025-68664)
- [LangChain Security Best Practices](https://python.langchain.com/docs/security)

### 成本优化
- [langasync GitHub](https://github.com/langasync/langasync) - 50% Cost Savings

---

**开始学习**: 从 [01_30字核心.md](./01_30字核心.md) 开始你的 Runnable 和 LCEL 学习之旅！
