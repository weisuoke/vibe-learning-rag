# 最小可用

掌握以下内容，就能开始使用环境变量管理：

## 4.1 创建 .env 文件

**最基础的配置方式**

```bash
# .env
DATABASE_URL=postgresql://user:password@localhost:5432/mydb
OPENAI_API_KEY=sk-xxx
SECRET_KEY=your-secret-key-here
DEBUG=True
```

**在代码中加载：**

```python
from dotenv import load_dotenv
import os

# 加载 .env 文件
load_dotenv()

# 读取环境变量
db_url = os.getenv("DATABASE_URL")
api_key = os.getenv("OPENAI_API_KEY")
```

**实际应用：** 本地开发时快速配置数据库连接和 API 密钥，避免硬编码。

---

## 4.2 使用 Pydantic Settings 验证配置

**类型安全的配置类**

```python
from pydantic_settings import BaseSettings

class Settings(BaseSettings):
    database_url: str
    openai_api_key: str
    secret_key: str
    debug: bool = False

    class Config:
        env_file = ".env"

# 自动加载并验证
settings = Settings()
print(settings.database_url)  # 类型安全，IDE 有提示
```

**实际应用：** FastAPI 项目中统一管理配置，自动验证类型，缺少必需配置时启动失败。

---

## 4.3 区分不同环境

**多环境文件模式**

```bash
# 项目结构
.env.dev       # 开发环境
.env.test      # 测试环境
.env.prod      # 生产环境（不提交到 git）
.env.example   # 配置模板（提交到 git）
```

**根据环境加载：**

```python
import os
from dotenv import load_dotenv

# 根据环境变量选择配置文件
env = os.getenv("ENV", "dev")
load_dotenv(f".env.{env}")

print(f"当前环境: {env}")
print(f"数据库: {os.getenv('DATABASE_URL')}")
```

**实际应用：** 开发时连接本地数据库，生产时连接云数据库，避免配置混乱。

---

## 4.4 Docker 环境变量注入

**docker-compose.yml 中配置：**

```yaml
services:
  api:
    build: .
    environment:
      - DATABASE_URL=${DATABASE_URL}
      - OPENAI_API_KEY=${OPENAI_API_KEY}
    env_file:
      - .env.prod
```

**实际应用：** 容器化部署时，通过环境变量传递配置，不需要修改镜像。

---

## 4.5 保护敏感信息

**gitignore 配置：**

```bash
# .gitignore
.env
.env.local
.env.*.local
.env.prod
```

**使用 .env.example 作为模板：**

```bash
# .env.example（提交到 git）
DATABASE_URL=postgresql://user:password@localhost:5432/dbname
OPENAI_API_KEY=your_key_here
SECRET_KEY=your-secret-key-here
```

**实际应用：** 团队成员复制 `.env.example` 为 `.env`，填入自己的密钥，避免泄露到 git。

---

## 这些知识足以：

- ✅ 在本地开发时管理配置
- ✅ 区分开发/测试/生产环境
- ✅ 使用 Pydantic 验证配置类型
- ✅ 在 Docker 中注入环境变量
- ✅ 保护 API 密钥等敏感信息
- ✅ 为后续学习配置层级、验证机制打基础
