# å®æˆ˜ä»£ç  08ï¼šæ•…éšœæ’æŸ¥è„šæœ¬

> **å®æˆ˜ç›®æ ‡**ï¼šæŒæ¡å®Œæ•´çš„æ•…éšœæ’æŸ¥æµç¨‹ï¼Œå¿«é€Ÿå®šä½å’Œè§£å†³ Pi Coding Agent çš„å¸¸è§é—®é¢˜

---

## ä¸€ã€ç»¼åˆè¯Šæ–­è„šæœ¬

### 1.1 å®Œæ•´è¯Šæ–­å·¥å…·

```bash
#!/bin/bash
# pi-doctor.sh - Pi Coding Agent ç»¼åˆè¯Šæ–­å·¥å…·

echo "ğŸ¥ Pi Coding Agent è¯Šæ–­å·¥å…·"
echo "================================"
echo ""

# é¢œè‰²å®šä¹‰
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

# è¯Šæ–­ç»“æœç»Ÿè®¡
total_checks=0
passed_checks=0
failed_checks=0
warnings=0

check_item() {
    local name=$1
    local status=$2
    local message=$3

    total_checks=$((total_checks + 1))

    case $status in
        "pass")
            echo -e "${GREEN}âœ…${NC} $name: $message"
            passed_checks=$((passed_checks + 1))
            ;;
        "fail")
            echo -e "${RED}âŒ${NC} $name: $message"
            failed_checks=$((failed_checks + 1))
            ;;
        "warn")
            echo -e "${YELLOW}âš ï¸${NC}  $name: $message"
            warnings=$((warnings + 1))
            ;;
    esac
}

# 1. æ£€æŸ¥ Node.js
echo "1ï¸âƒ£ æ£€æŸ¥ Node.js ç¯å¢ƒ"
echo "-------------------"
if command -v node &> /dev/null; then
    node_version=$(node -v | cut -d'.' -f1 | sed 's/v//')
    if [ "$node_version" -ge 18 ]; then
        check_item "Node.js" "pass" "ç‰ˆæœ¬ $(node -v)"
    else
        check_item "Node.js" "fail" "ç‰ˆæœ¬è¿‡ä½ ($(node -v))ï¼Œéœ€è¦ >= 18"
    fi
else
    check_item "Node.js" "fail" "æœªå®‰è£…"
fi
echo ""

# 2. æ£€æŸ¥ Pi å®‰è£…
echo "2ï¸âƒ£ æ£€æŸ¥ Pi å®‰è£…"
echo "-------------------"
if command -v pi &> /dev/null; then
    pi_version=$(pi --version 2>/dev/null || echo "æœªçŸ¥")
    check_item "Pi å‘½ä»¤" "pass" "v$pi_version"
else
    check_item "Pi å‘½ä»¤" "fail" "æœªå®‰è£…æˆ–ä¸åœ¨ PATH ä¸­"
fi
echo ""

# 3. æ£€æŸ¥é…ç½®æ–‡ä»¶
echo "3ï¸âƒ£ æ£€æŸ¥é…ç½®æ–‡ä»¶"
echo "-------------------"
if [ -d ~/.pi/agent ]; then
    check_item "é…ç½®ç›®å½•" "pass" "~/.pi/agent å­˜åœ¨"

    # æ£€æŸ¥ auth.json
    if [ -f ~/.pi/agent/auth.json ]; then
        perms=$(stat -f "%Lp" ~/.pi/agent/auth.json 2>/dev/null || stat -c "%a" ~/.pi/agent/auth.json 2>/dev/null)
        if [ "$perms" = "600" ]; then
            check_item "auth.json" "pass" "æƒé™æ­£ç¡® (600)"
        else
            check_item "auth.json" "warn" "æƒé™ä¸æ­£ç¡® ($perms)ï¼Œåº”è¯¥æ˜¯ 600"
        fi
    else
        check_item "auth.json" "warn" "ä¸å­˜åœ¨"
    fi

    # æ£€æŸ¥ models.json
    if [ -f ~/.pi/agent/models.json ]; then
        if jq empty ~/.pi/agent/models.json 2>/dev/null; then
            check_item "models.json" "pass" "æ ¼å¼æ­£ç¡®"
        else
            check_item "models.json" "fail" "JSON æ ¼å¼é”™è¯¯"
        fi
    else
        check_item "models.json" "warn" "ä¸å­˜åœ¨"
    fi
else
    check_item "é…ç½®ç›®å½•" "warn" "~/.pi/agent ä¸å­˜åœ¨"
fi
echo ""

# 4. æ£€æŸ¥ API Keys
echo "4ï¸âƒ£ æ£€æŸ¥ API Keys"
echo "-------------------"
api_keys=(
    "ANTHROPIC_API_KEY:Anthropic"
    "OPENAI_API_KEY:OpenAI"
    "XAI_API_KEY:xAI"
    "GEMINI_API_KEY:Google Gemini"
    "GROQ_API_KEY:Groq"
)

for key_info in "${api_keys[@]}"; do
    key="${key_info%%:*}"
    name="${key_info##*:}"

    if [ -n "${!key}" ]; then
        check_item "$name" "pass" "å·²è®¾ç½®"
    else
        check_item "$name" "warn" "æœªè®¾ç½®"
    fi
done
echo ""

# 5. æ£€æŸ¥ç½‘ç»œè¿æ¥
echo "5ï¸âƒ£ æ£€æŸ¥ç½‘ç»œè¿æ¥"
echo "-------------------"
endpoints=(
    "registry.npmjs.org:npm registry"
    "api.anthropic.com:Anthropic API"
    "api.openai.com:OpenAI API"
)

for endpoint_info in "${endpoints[@]}"; do
    endpoint="${endpoint_info%%:*}"
    name="${endpoint_info##*:}"

    if ping -c 1 "$endpoint" &> /dev/null; then
        check_item "$name" "pass" "å¯è®¿é—®"
    else
        check_item "$name" "warn" "æ— æ³•è®¿é—®"
    fi
done
echo ""

# 6. æ£€æŸ¥é¡¹ç›®é…ç½®
echo "6ï¸âƒ£ æ£€æŸ¥é¡¹ç›®é…ç½®"
echo "-------------------"
if [ -f .pi/settings.json ]; then
    if jq empty .pi/settings.json 2>/dev/null; then
        check_item "é¡¹ç›®é…ç½®" "pass" ".pi/settings.json æ ¼å¼æ­£ç¡®"
    else
        check_item "é¡¹ç›®é…ç½®" "fail" ".pi/settings.json æ ¼å¼é”™è¯¯"
    fi
else
    check_item "é¡¹ç›®é…ç½®" "warn" ".pi/settings.json ä¸å­˜åœ¨"
fi

if [ -f AGENTS.md ]; then
    check_item "é¡¹ç›®ä¸Šä¸‹æ–‡" "pass" "AGENTS.md å­˜åœ¨"
else
    check_item "é¡¹ç›®ä¸Šä¸‹æ–‡" "warn" "AGENTS.md ä¸å­˜åœ¨"
fi
echo ""

# 7. æ€»ç»“
echo "================================"
echo "ğŸ“Š è¯Šæ–­æ€»ç»“"
echo "================================"
echo "æ€»æ£€æŸ¥é¡¹: $total_checks"
echo -e "${GREEN}é€šè¿‡: $passed_checks${NC}"
echo -e "${RED}å¤±è´¥: $failed_checks${NC}"
echo -e "${YELLOW}è­¦å‘Š: $warnings${NC}"
echo ""

if [ $failed_checks -eq 0 ]; then
    echo "ğŸ‰ æ‰€æœ‰å…³é”®æ£€æŸ¥éƒ½é€šè¿‡äº†ï¼"
    exit 0
else
    echo "âš ï¸  å‘ç° $failed_checks ä¸ªé—®é¢˜ï¼Œè¯·ä¿®å¤åé‡è¯•"
    exit 1
fi
```

---

## äºŒã€å¸¸è§é—®é¢˜ä¿®å¤è„šæœ¬

### 2.1 è‡ªåŠ¨ä¿®å¤å·¥å…·

```bash
#!/bin/bash
# pi-fix.sh - Pi è‡ªåŠ¨ä¿®å¤å·¥å…·

echo "ğŸ”§ Pi è‡ªåŠ¨ä¿®å¤å·¥å…·"
echo ""

# ä¿®å¤å‡½æ•°
fix_permissions() {
    echo "ä¿®å¤æ–‡ä»¶æƒé™..."
    if [ -f ~/.pi/agent/auth.json ]; then
        chmod 600 ~/.pi/agent/auth.json
        echo "âœ… auth.json æƒé™å·²ä¿®å¤"
    fi
}

fix_npm_path() {
    echo "ä¿®å¤ npm å…¨å±€è·¯å¾„..."
    npm_prefix=$(npm config get prefix)

    if ! echo "$PATH" | grep -q "$npm_prefix/bin"; then
        echo "export PATH=\"$npm_prefix/bin:\$PATH\"" >> ~/.bashrc
        echo "âœ… å·²æ·»åŠ åˆ° ~/.bashrc"
        echo "è¯·è¿è¡Œ: source ~/.bashrc"
    else
        echo "âœ… PATH å·²æ­£ç¡®é…ç½®"
    fi
}

fix_json_format() {
    local file=$1
    echo "ä¿®å¤ JSON æ ¼å¼: $file..."

    if [ -f "$file.backup" ]; then
        cp "$file.backup" "$file"
        echo "âœ… å·²ä»å¤‡ä»½æ¢å¤"
    else
        echo "âŒ æ²¡æœ‰å¤‡ä»½æ–‡ä»¶"
    fi
}

reinstall_pi() {
    echo "é‡æ–°å®‰è£… Pi..."
    npm uninstall -g @mariozechner/pi-coding-agent
    npm cache clean --force
    npm install -g @mariozechner/pi-coding-agent
    echo "âœ… Pi å·²é‡æ–°å®‰è£…"
}

# ä¸»èœå•
cat << 'EOF'
é€‰æ‹©ä¿®å¤é€‰é¡¹:
1. ä¿®å¤æ–‡ä»¶æƒé™
2. ä¿®å¤ npm PATH
3. ä¿®å¤ JSON æ ¼å¼
4. é‡æ–°å®‰è£… Pi
5. å…¨éƒ¨ä¿®å¤
6. é€€å‡º

EOF

read -p "é€‰æ‹© (1-6): " choice

case $choice in
    1) fix_permissions ;;
    2) fix_npm_path ;;
    3)
        read -p "è¾“å…¥æ–‡ä»¶è·¯å¾„: " file
        fix_json_format "$file"
        ;;
    4) reinstall_pi ;;
    5)
        fix_permissions
        fix_npm_path
        echo "âœ… å…¨éƒ¨ä¿®å¤å®Œæˆ"
        ;;
    6) exit 0 ;;
    *) echo "âŒ æ— æ•ˆé€‰æ‹©" ;;
esac
```

### 2.2 é—®é¢˜åˆ†ç±»ä¿®å¤

```typescript
// fix-issues.ts - é—®é¢˜åˆ†ç±»ä¿®å¤å·¥å…·

import * as fs from 'fs';
import * as path from 'path';
import { execSync } from 'child_process';

interface Issue {
  category: string;
  description: string;
  fix: () => void;
}

class IssueFixer {
  private issues: Issue[] = [];

  detectIssues(): void {
    this.issues = [];

    // æ£€æµ‹ auth.json æƒé™
    const authPath = path.join(process.env.HOME!, '.pi/agent/auth.json');
    if (fs.existsSync(authPath)) {
      const stats = fs.statSync(authPath);
      const mode = (stats.mode & parseInt('777', 8)).toString(8);
      if (mode !== '600') {
        this.issues.push({
          category: 'æƒé™',
          description: `auth.json æƒé™ä¸æ­£ç¡® (${mode})`,
          fix: () => {
            fs.chmodSync(authPath, 0o600);
            console.log('âœ… å·²ä¿®å¤ auth.json æƒé™');
          }
        });
      }
    }

    // æ£€æµ‹ JSON æ ¼å¼
    const modelsPath = path.join(process.env.HOME!, '.pi/agent/models.json');
    if (fs.existsSync(modelsPath)) {
      try {
        JSON.parse(fs.readFileSync(modelsPath, 'utf-8'));
      } catch (error) {
        this.issues.push({
          category: 'JSON',
          description: 'models.json æ ¼å¼é”™è¯¯',
          fix: () => {
            const backupPath = `${modelsPath}.backup`;
            if (fs.existsSync(backupPath)) {
              fs.copyFileSync(backupPath, modelsPath);
              console.log('âœ… å·²ä»å¤‡ä»½æ¢å¤ models.json');
            } else {
              console.log('âŒ æ²¡æœ‰å¤‡ä»½æ–‡ä»¶');
            }
          }
        });
      }
    }

    // æ£€æµ‹ Pi å®‰è£…
    try {
      execSync('pi --version', { stdio: 'ignore' });
    } catch (error) {
      this.issues.push({
        category: 'å®‰è£…',
        description: 'Pi å‘½ä»¤ä¸å¯ç”¨',
        fix: () => {
          console.log('é‡æ–°å®‰è£… Pi...');
          execSync('npm install -g @mariozechner/pi-coding-agent', {
            stdio: 'inherit'
          });
          console.log('âœ… Pi å·²é‡æ–°å®‰è£…');
        }
      });
    }
  }

  listIssues(): void {
    if (this.issues.length === 0) {
      console.log('âœ… æœªå‘ç°é—®é¢˜');
      return;
    }

    console.log(`å‘ç° ${this.issues.length} ä¸ªé—®é¢˜:\n`);
    this.issues.forEach((issue, index) => {
      console.log(`${index + 1}. [${issue.category}] ${issue.description}`);
    });
  }

  fixAll(): void {
    console.log('ä¿®å¤æ‰€æœ‰é—®é¢˜...\n');
    this.issues.forEach((issue) => {
      console.log(`ä¿®å¤: ${issue.description}`);
      issue.fix();
    });
    console.log('\nâœ… æ‰€æœ‰é—®é¢˜å·²ä¿®å¤');
  }

  fixByIndex(index: number): void {
    if (index < 0 || index >= this.issues.length) {
      console.log('âŒ æ— æ•ˆçš„ç´¢å¼•');
      return;
    }

    const issue = this.issues[index];
    console.log(`ä¿®å¤: ${issue.description}`);
    issue.fix();
  }
}

// ä½¿ç”¨ç¤ºä¾‹
const fixer = new IssueFixer();
fixer.detectIssues();
fixer.listIssues();

// ä¿®å¤æ‰€æœ‰é—®é¢˜
fixer.fixAll();
```

---

## ä¸‰ã€æ—¥å¿—æ”¶é›†è„šæœ¬

### 3.1 æ—¥å¿—æ”¶é›†å·¥å…·

```bash
#!/bin/bash
# collect-logs.sh - æ”¶é›† Pi è¯Šæ–­æ—¥å¿—

OUTPUT_DIR="pi-logs-$(date +%Y%m%d-%H%M%S)"
mkdir -p "$OUTPUT_DIR"

echo "ğŸ“‹ æ”¶é›† Pi è¯Šæ–­æ—¥å¿—..."
echo "è¾“å‡ºç›®å½•: $OUTPUT_DIR"
echo ""

# 1. ç³»ç»Ÿä¿¡æ¯
echo "æ”¶é›†ç³»ç»Ÿä¿¡æ¯..."
cat > "$OUTPUT_DIR/system-info.txt" << EOF
æ“ä½œç³»ç»Ÿ: $(uname -a)
Node.js: $(node -v 2>/dev/null || echo "æœªå®‰è£…")
npm: $(npm -v 2>/dev/null || echo "æœªå®‰è£…")
Pi: $(pi --version 2>/dev/null || echo "æœªå®‰è£…")
æ—¥æœŸ: $(date)
EOF

# 2. ç¯å¢ƒå˜é‡
echo "æ”¶é›†ç¯å¢ƒå˜é‡..."
env | grep -E '(ANTHROPIC|OPENAI|XAI|GEMINI|GROQ|PI_)' > "$OUTPUT_DIR/env-vars.txt" 2>/dev/null || echo "æ— ç›¸å…³ç¯å¢ƒå˜é‡" > "$OUTPUT_DIR/env-vars.txt"

# 3. é…ç½®æ–‡ä»¶
echo "æ”¶é›†é…ç½®æ–‡ä»¶..."
if [ -f ~/.pi/agent/settings.json ]; then
    cp ~/.pi/agent/settings.json "$OUTPUT_DIR/global-settings.json"
fi

if [ -f .pi/settings.json ]; then
    cp .pi/settings.json "$OUTPUT_DIR/project-settings.json"
fi

if [ -f ~/.pi/agent/models.json ]; then
    cp ~/.pi/agent/models.json "$OUTPUT_DIR/models.json"
fi

# 4. auth.json (è„±æ•)
echo "æ”¶é›†è®¤è¯ä¿¡æ¯ (è„±æ•)..."
if [ -f ~/.pi/agent/auth.json ]; then
    jq 'walk(if type == "string" and (. | startswith("sk-") or startswith("xai-") or startswith("gsk_")) then "***REDACTED***" else . end)' ~/.pi/agent/auth.json > "$OUTPUT_DIR/auth.json" 2>/dev/null || echo "{}" > "$OUTPUT_DIR/auth.json"
fi

# 5. é¡¹ç›®æ–‡ä»¶
echo "æ”¶é›†é¡¹ç›®æ–‡ä»¶..."
if [ -f AGENTS.md ]; then
    cp AGENTS.md "$OUTPUT_DIR/AGENTS.md"
fi

if [ -f package.json ]; then
    cp package.json "$OUTPUT_DIR/package.json"
fi

# 6. Git ä¿¡æ¯
echo "æ”¶é›† Git ä¿¡æ¯..."
if git rev-parse --git-dir > /dev/null 2>&1; then
    git status > "$OUTPUT_DIR/git-status.txt"
    git log -5 --oneline > "$OUTPUT_DIR/git-log.txt"
fi

# 7. ç½‘ç»œæµ‹è¯•
echo "æ”¶é›†ç½‘ç»œæµ‹è¯•..."
cat > "$OUTPUT_DIR/network-test.txt" << EOF
npm registry: $(ping -c 1 registry.npmjs.org &> /dev/null && echo "å¯è®¿é—®" || echo "ä¸å¯è®¿é—®")
Anthropic API: $(ping -c 1 api.anthropic.com &> /dev/null && echo "å¯è®¿é—®" || echo "ä¸å¯è®¿é—®")
OpenAI API: $(ping -c 1 api.openai.com &> /dev/null && echo "å¯è®¿é—®" || echo "ä¸å¯è®¿é—®")
EOF

# 8. Pi è¯Šæ–­
echo "è¿è¡Œ Pi è¯Šæ–­..."
PI_DEBUG=1 pi --help > "$OUTPUT_DIR/pi-debug.txt" 2>&1 || echo "Pi å‘½ä»¤å¤±è´¥" > "$OUTPUT_DIR/pi-debug.txt"

# 9. åˆ›å»ºå‹ç¼©åŒ…
echo "åˆ›å»ºå‹ç¼©åŒ…..."
tar -czf "$OUTPUT_DIR.tar.gz" "$OUTPUT_DIR"

echo ""
echo "âœ… æ—¥å¿—æ”¶é›†å®Œæˆ"
echo "å‹ç¼©åŒ…: $OUTPUT_DIR.tar.gz"
echo ""
echo "è¯·å°†æ­¤æ–‡ä»¶å‘é€ç»™æ”¯æŒå›¢é˜Ÿ"
```

---

## å››ã€æ€§èƒ½è¯Šæ–­è„šæœ¬

### 4.1 æ€§èƒ½æµ‹è¯•å·¥å…·

```bash
#!/bin/bash
# benchmark-pi.sh - Pi æ€§èƒ½æµ‹è¯•

echo "âš¡ Pi æ€§èƒ½æµ‹è¯•"
echo ""

# æµ‹è¯•å‡½æ•°
benchmark_model() {
    local provider=$1
    local model=$2
    local prompt=$3

    echo "æµ‹è¯• $provider - $model..."

    start_time=$(date +%s%N)
    pi --provider "$provider" --model "$model" --print "$prompt" > /dev/null 2>&1
    end_time=$(date +%s%N)

    duration=$(( (end_time - start_time) / 1000000 ))
    echo "  è€—æ—¶: ${duration}ms"
}

# æµ‹è¯•æç¤º
test_prompt="ç”Ÿæˆä¸€ä¸ªç®€å•çš„ Hello World å‡½æ•°"

# æµ‹è¯•ä¸åŒæ¨¡å‹
echo "1ï¸âƒ£ æµ‹è¯• Anthropic æ¨¡å‹"
benchmark_model "anthropic" "claude-haiku-4" "$test_prompt"
benchmark_model "anthropic" "claude-sonnet-4" "$test_prompt"
echo ""

echo "2ï¸âƒ£ æµ‹è¯• OpenAI æ¨¡å‹"
benchmark_model "openai" "gpt-4o" "$test_prompt"
echo ""

echo "3ï¸âƒ£ æµ‹è¯•æœ¬åœ°æ¨¡å‹ (å¦‚æœå¯ç”¨)"
if command -v ollama &> /dev/null; then
    benchmark_model "ollama" "llama3.1:8b" "$test_prompt"
fi
echo ""

echo "âœ… æ€§èƒ½æµ‹è¯•å®Œæˆ"
```

### 4.2 Token ä½¿ç”¨åˆ†æ

```typescript
// analyze-token-usage.ts - Token ä½¿ç”¨åˆ†æ

import * as fs from 'fs';
import * as path from 'path';

interface SessionData {
  messages: Array<{
    role: string;
    content: string;
    usage?: {
      input_tokens: number;
      output_tokens: number;
    };
  }>;
}

function analyzeTokenUsage(sessionPath: string): void {
  const content = fs.readFileSync(sessionPath, 'utf-8');
  const lines = content.split('\n').filter(line => line.trim());

  let totalInput = 0;
  let totalOutput = 0;
  let messageCount = 0;

  for (const line of lines) {
    try {
      const data = JSON.parse(line);

      if (data.usage) {
        totalInput += data.usage.input_tokens || 0;
        totalOutput += data.usage.output_tokens || 0;
        messageCount++;
      }
    } catch (error) {
      // è·³è¿‡æ— æ•ˆè¡Œ
    }
  }

  console.log('ğŸ“Š Token ä½¿ç”¨åˆ†æ');
  console.log('==================');
  console.log(`æ¶ˆæ¯æ•°é‡: ${messageCount}`);
  console.log(`è¾“å…¥ Tokens: ${totalInput.toLocaleString()}`);
  console.log(`è¾“å‡º Tokens: ${totalOutput.toLocaleString()}`);
  console.log(`æ€»è®¡ Tokens: ${(totalInput + totalOutput).toLocaleString()}`);
  console.log(`å¹³å‡æ¯æ¡æ¶ˆæ¯: ${Math.round((totalInput + totalOutput) / messageCount)} tokens`);
}

// ä½¿ç”¨ç¤ºä¾‹
const sessionsDir = path.join(process.env.HOME!, '.pi/agent/sessions');
const sessions = fs.readdirSync(sessionsDir)
  .filter(f => f.endsWith('.jsonl'))
  .map(f => path.join(sessionsDir, f));

if (sessions.length > 0) {
  console.log(`æ‰¾åˆ° ${sessions.length} ä¸ªä¼šè¯\n`);
  analyzeTokenUsage(sessions[sessions.length - 1]);
} else {
  console.log('æœªæ‰¾åˆ°ä¼šè¯æ–‡ä»¶');
}
```

---

## äº”ã€æ•…éšœæ’æŸ¥æ‰‹å†Œ

### 5.1 é—®é¢˜åˆ†ç±»ç´¢å¼•

```markdown
# Pi Coding Agent æ•…éšœæ’æŸ¥æ‰‹å†Œ

## å®‰è£…é—®é¢˜

### é—®é¢˜: pi å‘½ä»¤æœªæ‰¾åˆ°
**ç—‡çŠ¶**: è¿è¡Œ `pi` æç¤º "command not found"

**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥å…¨å±€å®‰è£…è·¯å¾„
   ```bash
   npm config get prefix
   ```

2. æ·»åŠ åˆ° PATH
   ```bash
   export PATH="$(npm config get prefix)/bin:$PATH"
   echo 'export PATH="$(npm config get prefix)/bin:$PATH"' >> ~/.bashrc
   ```

3. é‡æ–°å®‰è£…
   ```bash
   npm install -g @mariozechner/pi-coding-agent
   ```

### é—®é¢˜: æƒé™é”™è¯¯
**ç—‡çŠ¶**: npm install æç¤ºæƒé™é”™è¯¯

**è§£å†³æ–¹æ¡ˆ**:
```bash
mkdir -p ~/.npm-global
npm config set prefix '~/.npm-global'
echo 'export PATH=~/.npm-global/bin:$PATH' >> ~/.bashrc
source ~/.bashrc
npm install -g @mariozechner/pi-coding-agent
```

## è®¤è¯é—®é¢˜

### é—®é¢˜: API Key æ— æ•ˆ
**ç—‡çŠ¶**: "Authentication failed: Invalid API key"

**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥ API Key æ ¼å¼
   ```bash
   echo $ANTHROPIC_API_KEY
   ```

2. æµ‹è¯• API Key
   ```bash
   curl https://api.anthropic.com/v1/messages \
     -H "x-api-key: $ANTHROPIC_API_KEY" \
     -H "anthropic-version: 2023-06-01" \
     -H "content-type: application/json" \
     -d '{"model":"claude-opus-4","max_tokens":10,"messages":[{"role":"user","content":"Hi"}]}'
   ```

### é—®é¢˜: OAuth Token è¿‡æœŸ
**ç—‡çŠ¶**: "OAuth token expired"

**è§£å†³æ–¹æ¡ˆ**:
```bash
pi
/logout
/login
```

## é…ç½®é—®é¢˜

### é—®é¢˜: models.json æ ¼å¼é”™è¯¯
**ç—‡çŠ¶**: "Failed to parse models.json"

**è§£å†³æ–¹æ¡ˆ**:
```bash
# éªŒè¯ JSON æ ¼å¼
jq empty ~/.pi/agent/models.json

# ä»å¤‡ä»½æ¢å¤
cp ~/.pi/agent/models.json.backup ~/.pi/agent/models.json
```

### é—®é¢˜: æ–‡ä»¶æƒé™é”™è¯¯
**ç—‡çŠ¶**: "Permission denied: auth.json"

**è§£å†³æ–¹æ¡ˆ**:
```bash
chmod 600 ~/.pi/agent/auth.json
```

## ç½‘ç»œé—®é¢˜

### é—®é¢˜: æ— æ³•è®¿é—® API
**ç—‡çŠ¶**: "Connection timeout"

**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥ç½‘ç»œè¿æ¥
   ```bash
   ping api.anthropic.com
   ```

2. é…ç½®ä»£ç†
   ```bash
   export HTTP_PROXY=http://proxy:8080
   export HTTPS_PROXY=http://proxy:8080
   ```

## æ€§èƒ½é—®é¢˜

### é—®é¢˜: å“åº”ç¼“æ…¢
**ç—‡çŠ¶**: Pi å“åº”æ—¶é—´è¿‡é•¿

**è§£å†³æ–¹æ¡ˆ**:
1. åˆ‡æ¢åˆ°æ›´å¿«çš„æ¨¡å‹
   ```bash
   pi --model claude-haiku-4
   ```

2. å¯ç”¨ Compaction
   ```json
   {
     "compaction": {
       "enabled": true,
       "threshold": 0.8
     }
   }
   ```

3. æ¸…ç†ä¼šè¯å†å²
   ```bash
   rm -rf ~/.pi/agent/sessions/*
   ```
```

---

## å…­ã€æ€»ç»“

### 6.1 æ•…éšœæ’æŸ¥æµç¨‹

```
1. è¿è¡Œè¯Šæ–­å·¥å…·
   ./pi-doctor.sh

2. æ”¶é›†æ—¥å¿—
   ./collect-logs.sh

3. æŸ¥çœ‹æ•…éšœæ’æŸ¥æ‰‹å†Œ
   æ‰¾åˆ°å¯¹åº”é—®é¢˜åˆ†ç±»

4. å°è¯•è‡ªåŠ¨ä¿®å¤
   ./pi-fix.sh

5. å¦‚æœä»æœªè§£å†³
   æäº¤ Issue å¹¶é™„ä¸Šæ—¥å¿—
```

### 6.2 å¿«é€Ÿå‚è€ƒ

```bash
# ç»¼åˆè¯Šæ–­
./pi-doctor.sh

# è‡ªåŠ¨ä¿®å¤
./pi-fix.sh

# æ”¶é›†æ—¥å¿—
./collect-logs.sh

# æ€§èƒ½æµ‹è¯•
./benchmark-pi.sh

# é‡æ–°å®‰è£…
npm uninstall -g @mariozechner/pi-coding-agent
npm cache clean --force
npm install -g @mariozechner/pi-coding-agent
```

---

**å‚è€ƒèµ„æ–™:**
- [Pi GitHub Issues](https://github.com/badlogic/pi-mono/issues)
- [Pi Discord Community](https://discord.com/invite/3cU7Bz4UPx)

**æ–‡æ¡£ç‰ˆæœ¬:** v1.0 (2026-02-18)
