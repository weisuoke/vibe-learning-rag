# 最小可用知识

## 核心理念

**掌握 20% 的核心知识，解决 80% 的问题**

本文档提炼 Trie 最核心的 5 个知识点，让你快速上手并应用到实际项目中。

---

## 1. Trie 节点结构

### 核心要点

**Trie 节点 = children（字典）+ is_end（布尔值）**

```python
class TrieNode:
    def __init__(self):
        self.children = {}      # 字符 -> 子节点
        self.is_end = False     # 是否是单词结尾
```

### 为什么重要？

- 这是 Trie 的基础，理解节点结构就理解了 Trie 的本质
- `children` 字典建立字符到子节点的映射
- `is_end` 区分完整单词和前缀

### 在 AI Agent 中的应用

```python
# 存储 Agent 意图关键词
intent_trie = Trie()
intent_trie.insert("查询天气", value="weather_agent")
intent_trie.insert("查询时间", value="time_agent")

# 节点结构：
# root.children = {'查': node_查}
# node_查.children = {'询': node_查询}
# node_查询.children = {'天': node_天, '时': node_时}
```

---

## 2. 插入操作

### 核心要点

**逐字符遍历，不存在则创建**

```python
def insert(self, word: str):
    node = self.root
    for char in word:
        if char not in node.children:
            node.children[char] = TrieNode()
        node = node.children[char]
    node.is_end = True
```

### 时间复杂度

- **O(m)**，m 是单词长度
- 与 Trie 中已有多少单词无关

### 在 RAG 中的应用

```python
# 构建文档关键词索引
keyword_trie = Trie()
keywords = ["机器学习", "深度学习", "神经网络"]

for keyword in keywords:
    keyword_trie.insert(keyword)

# 用户查询时快速匹配
```

---

## 3. 前缀查询

### 核心要点

**找到前缀节点 + DFS 收集所有子节点**

```python
def get_words_with_prefix(self, prefix: str) -> list:
    # 1. 找到前缀节点
    node = self.root
    for char in prefix:
        if char not in node.children:
            return []
        node = node.children[char]

    # 2. DFS 收集所有单词
    results = []
    self._dfs(node, prefix, results)
    return results

def _dfs(self, node, path, results):
    if node.is_end:
        results.append(path)
    for char, child in node.children.items():
        self._dfs(child, path + char, results)
```

### 时间复杂度

- **O(m + k)**
- m：前缀长度
- k：结果数量

### 在 AI Agent 中的应用

```python
# 用户输入："查询"
matches = intent_trie.get_words_with_prefix("查询")
# 返回：["查询天气", "查询时间", "查询日期"]

# 快速识别用户意图
```

---

## 4. Trie vs Hash Table

### 核心对比

| 特性 | Trie | Hash Table |
|------|------|-----------|
| 精确查找 | O(m) | O(1) |
| 前缀查询 | O(m + k) | O(n × m) |
| 空间占用 | 较大 | 较小 |
| 适用场景 | 前缀匹配 | 精确查找 |

### 选择建议

**使用 Trie：**
- ✅ 需要前缀查询（自动补全、搜索建议）
- ✅ 需要通配符匹配
- ✅ 需要最长前缀匹配（实体识别）

**使用 Hash Table：**
- ✅ 只需精确查找
- ✅ 空间受限
- ✅ 不需要前缀相关功能

### 实际案例

```python
# 场景 1：搜索框自动补全 → Trie
# 用户输入："py"
# 需要显示：["python", "pytorch", "pandas"]
# Trie: O(2 + 3) = O(5)
# Hash Table: 需要遍历所有 key，O(n × m)

# 场景 2：用户登录验证 → Hash Table
# 查询用户名是否存在
# Hash Table: O(1)
# Trie: O(m)，但没有前缀查询需求，Hash Table 更优
```

---

## 5. 典型应用场景

### 5.1 自动补全

```python
# 搜索框实时补全
trie = Trie()
trie.insert("python")
trie.insert("pytorch")
trie.insert("pandas")

# 用户输入："py"
suggestions = trie.get_words_with_prefix("py")
# 返回：["python", "pytorch"]
```

### 5.2 拼写检查

```python
# 检查单词是否在词典中
dictionary = Trie()
dictionary.insert("hello")
dictionary.insert("world")

# 检查拼写
print(dictionary.search("hello"))  # True
print(dictionary.search("helo"))   # False（拼写错误）
```

### 5.3 IP 路由

```python
# 存储 IP 前缀
ip_trie = Trie()
ip_trie.insert("192.168.1", value="subnet_1")
ip_trie.insert("192.168.2", value="subnet_2")

# 查询 IP 所属子网
# "192.168.1.100" → 匹配 "192.168.1" → subnet_1
```

### 5.4 Agent 路由

```python
# AI Agent 意图识别
agent_trie = Trie()
agent_trie.insert("查询天气", value="weather_agent")
agent_trie.insert("查询时间", value="time_agent")

# 用户输入："查询明天的天气"
# 前缀匹配："查询" → 找到 ["查询天气", "查询时间"]
# 进一步匹配："天气" → 路由到 weather_agent
```

### 5.5 实体识别

```python
# 构建实体词典
entity_trie = Trie()
entity_trie.insert("北京大学", value="ORG")
entity_trie.insert("清华大学", value="ORG")

# 文本："我在北京大学读书"
# 最长匹配："北京大学" → 识别为机构名
```

---

## 快速上手代码

### 完整的最小实现

```python
"""
Trie 最小可用实现
包含：插入、查找、前缀查询
"""

class TrieNode:
    def __init__(self):
        self.children = {}
        self.is_end = False

class Trie:
    def __init__(self):
        self.root = TrieNode()

    def insert(self, word: str):
        """插入单词"""
        node = self.root
        for char in word:
            if char not in node.children:
                node.children[char] = TrieNode()
            node = node.children[char]
        node.is_end = True

    def search(self, word: str) -> bool:
        """查找单词"""
        node = self.root
        for char in word:
            if char not in node.children:
                return False
            node = node.children[char]
        return node.is_end

    def starts_with(self, prefix: str) -> bool:
        """前缀查询"""
        node = self.root
        for char in prefix:
            if char not in node.children:
                return False
            node = node.children[char]
        return True

    def get_words_with_prefix(self, prefix: str) -> list:
        """获取所有以 prefix 开头的单词"""
        node = self.root
        for char in prefix:
            if char not in node.children:
                return []
            node = node.children[char]

        results = []
        self._dfs(node, prefix, results)
        return results

    def _dfs(self, node, path, results):
        """DFS 遍历"""
        if node.is_end:
            results.append(path)
        for char, child in node.children.items():
            self._dfs(child, path + char, results)


# ===== 测试 =====
trie = Trie()

# 插入
trie.insert("cat")
trie.insert("car")
trie.insert("card")

# 查找
print(trie.search("cat"))   # True
print(trie.search("ca"))    # False

# 前缀查询
print(trie.starts_with("ca"))  # True

# 前缀补全
print(trie.get_words_with_prefix("ca"))  # ['cat', 'car', 'card']
```

---

## 这些知识足以

掌握以上 5 个核心知识点后，你可以：

1. **实现基础 Trie**
   - 手写 Trie 数据结构
   - 理解 Trie 的工作原理

2. **应用到实际项目**
   - 搜索框自动补全
   - 拼写检查
   - 关键词匹配

3. **在 AI Agent 中使用**
   - 意图识别和路由
   - 实体识别（NER）
   - 命令补全

4. **为后续学习打基础**
   - 理解压缩 Trie 和 Radix Tree
   - 学习 Trie 在 LLM 中的应用
   - 掌握高级优化技巧

---

## 下一步学习

### 如果你想深入理解

- 阅读 `02_第一性原理.md` - 理解 Trie 的本质
- 阅读 `03_核心概念/` - 全面掌握所有子概念

### 如果你想优化性能

- 阅读 `03_核心概念/03_压缩Trie与Radix_Tree.md` - 空间优化
- 阅读 `06_反直觉点.md` - 避开常见误区

### 如果你想应用到 AI

- 阅读 `03_核心概念/04_Trie在LLM中的应用.md` - LLM 应用
- 阅读 `03_核心概念/05_Trie在Agent中的应用.md` - Agent 应用

### 如果你想准备面试

- 阅读 `08_面试必问.md` - 面试高频问题
- 阅读 `09_化骨绵掌.md` - 10 个知识卡片

---

## 学习检查清单

完成以下检查，确保你已掌握最小可用知识：

- [ ] 能手写 Trie 节点结构
- [ ] 能实现插入操作
- [ ] 能实现查找操作
- [ ] 能实现前缀查询
- [ ] 理解 Trie vs Hash Table 的区别
- [ ] 能说出 3 个 Trie 的应用场景
- [ ] 能在 10 分钟内实现基础 Trie

---

**版本**: v1.0
**最后更新**: 2026-02-14
**预计学习时长**: 8 分钟
